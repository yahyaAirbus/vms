/*! For license information please see swsipvoip2.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SWSIPVOIP2=t():e.SWSIPVOIP2=t()}(this,(()=>(()=>{var e={1227:(e,t,n)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,o=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(o=r))})),t.splice(o,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(2447)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},2447:(e,t,n)=>{e.exports=function(e){function t(e){let n,o,i,a=null;function s(...e){if(!s.enabled)return;const r=s,o=Number(new Date),i=o-(n||o);r.diff=i,r.prev=n,r.curr=o,n=o,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,o)=>{if("%%"===n)return"%";a++;const i=t.formatters[o];if("function"==typeof i){const t=e[a];n=i.call(r,t),e.splice(a,1),a--}return n})),t.formatArgs.call(r,e);(r.log||t.log).apply(r,e)}return s.namespace=e,s.useColors=t.useColors(),s.color=t.selectColor(e),s.extend=r,s.destroy=t.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(o!==t.namespaces&&(o=t.namespaces,i=t.enabled(e)),i),set:e=>{a=e}}),"function"==typeof t.init&&t.init(s),s}function r(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function o(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(o),...t.skips.map(o).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(n=0;n<o;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(7824),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},7187:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function i(){i.init.call(this)}e.exports=i,e.exports.once=function(e,t){return new Promise((function(n,r){function o(n){e.removeListener(t,i),r(n)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",o),n([].slice.call(arguments))}m(e,t,i,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&m(e,"error",t,n)}(e,o,{once:!0})}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var a=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function u(e,t,n,r){var o,i,a,u;if(s(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),a=i[t]),void 0===a)a=i[t]=n,++e._eventsCount;else if("function"==typeof a?a=i[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(o=l(e))>0&&a.length>o&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,u=c,console&&console.warn&&console.warn(u)}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=c.bind(r);return o.listener=n,r.wrapFn=o,o}function f(e,t,n){var r=e._events;if(void 0===r)return[];var o=r[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):h(o,o.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function h(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function m(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function o(i){r.once&&e.removeEventListener(t,o),n(i)}))}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return l(this)},i.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var o="error"===e,i=this._events;if(void 0!==i)o=o&&void 0===i.error;else if(!o)return!1;if(o){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var l=i[e];if(void 0===l)return!1;if("function"==typeof l)r(l,this,t);else{var u=l.length,c=h(l,u);for(n=0;n<u;++n)r(c[n],this,t)}return!0},i.prototype.addListener=function(e,t){return u(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return u(this,e,t,!0)},i.prototype.once=function(e,t){return s(t),this.on(e,d(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,d(this,e,t)),this},i.prototype.removeListener=function(e,t){var n,r,o,i,a;if(s(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){a=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},i.prototype.listeners=function(e){return f(this,e,!0)},i.prototype.rawListeners=function(e){return f(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},i.prototype.listenerCount=p,i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},7830:(e,t,n)=>{"use strict";function r(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var i=n(5424),a=n(965),s=n(3790),l=n(1987),u=n(7351),c=n(8063);t.settings={authorization_user:null,password:null,realm:null,ha1:null,authorization_jwt:null,display_name:null,uri:null,contact_uri:null,instance_id:null,use_preloaded_route:!1,session_timers:!0,session_timers_refresh_method:a.UPDATE,session_timers_force_refresher:!1,no_answer_timeout:60,register:!0,register_expires:600,registrar_server:null,sockets:null,connection_recovery_max_interval:a.CONNECTION_RECOVERY_MAX_INTERVAL,connection_recovery_min_interval:a.CONNECTION_RECOVERY_MIN_INTERVAL,via_host:"".concat(i.createRandomToken(12),".invalid")};var d={mandatory:{sockets:function(e){var t=[];if(u.isSocket(e))t.push({socket:e});else{if(!Array.isArray(e)||!e.length)return;var n,o=r(e);try{for(o.s();!(n=o.n()).done;){var i=n.value;Object.prototype.hasOwnProperty.call(i,"socket")&&u.isSocket(i.socket)?t.push(i):u.isSocket(i)&&t.push({socket:i})}}catch(e){o.e(e)}finally{o.f()}}return t},uri:function(e){/^sip:/i.test(e)||(e="".concat(a.SIP,":").concat(e));var t=l.parse(e);return t&&t.user?t:void 0}},optional:{authorization_user:function(e){return-1===s.parse('"'.concat(e,'"'),"quoted_string")?void 0:e},authorization_jwt:function(e){if("string"==typeof e)return e},user_agent:function(e){if("string"==typeof e)return e},connection_recovery_max_interval:function(e){if(i.isDecimal(e)){var t=Number(e);if(t>0)return t}},connection_recovery_min_interval:function(e){if(i.isDecimal(e)){var t=Number(e);if(t>0)return t}},contact_uri:function(e){if("string"==typeof e){var t=s.parse(e,"SIP_URI");if(-1!==t)return t}},display_name:function(e){return e},instance_id:function(e){return/^uuid:/i.test(e)&&(e=e.substr(5)),-1===s.parse(e,"uuid")?void 0:e},no_answer_timeout:function(e){if(i.isDecimal(e)){var t=Number(e);if(t>0)return t}},session_timers:function(e){if("boolean"==typeof e)return e},session_timers_refresh_method:function(e){if("string"==typeof e&&((e=e.toUpperCase())===a.INVITE||e===a.UPDATE))return e},session_timers_force_refresher:function(e){if("boolean"==typeof e)return e},password:function(e){return String(e)},realm:function(e){return String(e)},ha1:function(e){return String(e)},register:function(e){if("boolean"==typeof e)return e},register_expires:function(e){if(i.isDecimal(e)){var t=Number(e);if(t>0)return t}},registrar_server:function(e){/^sip:/i.test(e)||(e="".concat(a.SIP,":").concat(e));var t=l.parse(e);return t?t.user?void 0:t:void 0},use_preloaded_route:function(e){if("boolean"==typeof e)return e}}};t.load=function(e,t){for(var n in d.mandatory){if(!t.hasOwnProperty(n))throw new c.ConfigurationError(n);var r=t[n],o=d.mandatory[n](r);if(void 0===o)throw new c.ConfigurationError(n,r);e[n]=o}for(var a in d.optional)if(t.hasOwnProperty(a)){var s=t[a];if(i.isEmpty(s))continue;var l=d.optional[a](s);if(void 0===l)throw new c.ConfigurationError(a,s);e[a]=l}}},965:(e,t,n)=>{"use strict";var r=n(2403);e.exports={USER_AGENT:"".concat(r.title," ").concat(r.version),SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",BYE:"Terminated",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",DIALOG_ERROR:"Dialog Error",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484,424],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",REFER:"REFER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",DTMF_TRANSPORT:{INFO:"INFO",RFC2833:"RFC2833"},REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",424:"Bad Location Information",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"JsSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS,REFER,INFO,NOTIFY",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69,SESSION_EXPIRES:90,MIN_SESSION_EXPIRES:60,CONNECTION_RECOVERY_MAX_INTERVAL:30,CONNECTION_RECOVERY_MIN_INTERVAL:2}},316:(e,t,n)=>{"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}var a=n(356),s=n(6497),l=n(965),u=n(3754),c=n(5604),d=n(5424),f=new a("Dialog"),p={STATUS_EARLY:1,STATUS_CONFIRMED:2};e.exports=function(){function e(t,n,o){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p.STATUS_CONFIRMED;if(r(this,e),this._owner=t,this._ua=t._ua,this._uac_pending_reply=!1,this._uas_pending_reply=!1,!n.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};n instanceof s.IncomingResponse&&(i=n.status_code<200?p.STATUS_EARLY:p.STATUS_CONFIRMED);var a=n.parseHeader("contact");"UAS"===o?(this._id={call_id:n.call_id,local_tag:n.to_tag,remote_tag:n.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this._state=i,this._remote_seqnum=n.cseq,this._local_uri=n.parseHeader("to").uri,this._remote_uri=n.parseHeader("from").uri,this._remote_target=a.uri,this._route_set=n.getHeaders("record-route"),this._ack_seqnum=this._remote_seqnum):"UAC"===o&&(this._id={call_id:n.call_id,local_tag:n.from_tag,remote_tag:n.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this._state=i,this._local_seqnum=n.cseq,this._local_uri=n.parseHeader("from").uri,this._remote_uri=n.parseHeader("to").uri,this._remote_target=a.uri,this._route_set=n.getHeaders("record-route").reverse(),this._ack_seqnum=null),this._ua.newDialog(this),f.debug("new ".concat(o," dialog created with status ").concat(this._state===p.STATUS_EARLY?"EARLY":"CONFIRMED"))}return i(e,null,[{key:"C",get:function(){return p}}]),i(e,[{key:"update",value:function(e,t){this._state=p.STATUS_CONFIRMED,f.debug("dialog ".concat(this._id.toString(),"  changed to CONFIRMED state")),"UAC"===t&&(this._route_set=e.getHeaders("record-route").reverse())}},{key:"terminate",value:function(){f.debug("dialog ".concat(this._id.toString()," deleted")),this._ua.destroyDialog(this)}},{key:"sendRequest",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=d.cloneArray(n.extraHeaders),o=d.cloneObject(n.eventHandlers),i=n.body||null,a=this._createRequest(e,r,i);o.onAuthenticated=function(){t._local_seqnum+=1};var s=new c(this,a,o);return s.send(),a}},{key:"receiveRequest",value:function(e){this._checkInDialogRequest(e)&&(e.method===l.ACK&&null!==this._ack_seqnum?this._ack_seqnum=null:e.method===l.INVITE&&(this._ack_seqnum=e.cseq),this._owner.receiveRequest(e))}},{key:"_createRequest",value:function(e,t,n){t=d.cloneArray(t),this._local_seqnum||(this._local_seqnum=Math.floor(1e4*Math.random()));var r=e===l.CANCEL||e===l.ACK?this._local_seqnum:this._local_seqnum+=1;return new s.OutgoingRequest(e,this._remote_target,this._ua,{cseq:r,call_id:this._id.call_id,from_uri:this._local_uri,from_tag:this._id.local_tag,to_uri:this._remote_uri,to_tag:this._id.remote_tag,route_set:this._route_set},t,n)}},{key:"_checkInDialogRequest",value:function(e){var t=this;if(this._remote_seqnum)if(e.cseq<this._remote_seqnum){if(e.method!==l.ACK)return e.reply(500),!1;if(null===this._ack_seqnum||e.cseq!==this._ack_seqnum)return!1}else e.cseq>this._remote_seqnum&&(this._remote_seqnum=e.cseq);else this._remote_seqnum=e.cseq;if(e.method===l.INVITE||e.method===l.UPDATE&&e.body){if(!0===this._uac_pending_reply)e.reply(491);else{if(!0===this._uas_pending_reply){var n=1+(10*Math.random()|0);return e.reply(500,null,["Retry-After:".concat(n)]),!1}this._uas_pending_reply=!0;e.server_transaction.on("stateChanged",(function n(){e.server_transaction.state!==u.C.STATUS_ACCEPTED&&e.server_transaction.state!==u.C.STATUS_COMPLETED&&e.server_transaction.state!==u.C.STATUS_TERMINATED||(e.server_transaction.removeListener("stateChanged",n),t._uas_pending_reply=!1)}))}e.hasHeader("contact")&&e.server_transaction.on("stateChanged",(function(){e.server_transaction.state===u.C.STATUS_ACCEPTED&&(t._remote_target=e.parseHeader("contact").uri)}))}else e.method===l.NOTIFY&&e.hasHeader("contact")&&e.server_transaction.on("stateChanged",(function(){e.server_transaction.state===u.C.STATUS_COMPLETED&&(t._remote_target=e.parseHeader("contact").uri)}));return!0}},{key:"id",get:function(){return this._id}},{key:"local_seqnum",get:function(){return this._local_seqnum},set:function(e){this._local_seqnum=e}},{key:"owner",get:function(){return this._owner}},{key:"uac_pending_reply",get:function(){return this._uac_pending_reply},set:function(e){this._uac_pending_reply=e}},{key:"uas_pending_reply",get:function(){return this._uas_pending_reply}}]),e}()},5604:(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(965),i=n(3754),a=n(7906),s=n(2066),l={onRequestTimeout:function(){},onTransportError:function(){},onSuccessResponse:function(){},onErrorResponse:function(){},onAuthenticated:function(){},onDialogError:function(){}};e.exports=function(){function e(t,n,r){for(var o in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._dialog=t,this._ua=t._ua,this._request=n,this._eventHandlers=r,this._reattempt=!1,this._reattemptTimer=null,l)Object.prototype.hasOwnProperty.call(l,o)&&(this._eventHandlers[o]||(this._eventHandlers[o]=l[o]))}var t,n,u;return t=e,(n=[{key:"send",value:function(){var e=this,t=new s(this._ua,this._request,{onRequestTimeout:function(){e._eventHandlers.onRequestTimeout()},onTransportError:function(){e._eventHandlers.onTransportError()},onAuthenticated:function(t){e._eventHandlers.onAuthenticated(t)},onReceiveResponse:function(t){e._receiveResponse(t)}});t.send(),(this._request.method===o.INVITE||this._request.method===o.UPDATE&&this._request.body)&&t.clientTransaction.state!==i.C.STATUS_TERMINATED&&(this._dialog.uac_pending_reply=!0,t.clientTransaction.on("stateChanged",(function n(){t.clientTransaction.state!==i.C.STATUS_ACCEPTED&&t.clientTransaction.state!==i.C.STATUS_COMPLETED&&t.clientTransaction.state!==i.C.STATUS_TERMINATED||(t.clientTransaction.removeListener("stateChanged",n),e._dialog.uac_pending_reply=!1)})))}},{key:"_receiveResponse",value:function(e){var t=this;408===e.status_code||481===e.status_code?this._eventHandlers.onDialogError(e):e.method===o.INVITE&&491===e.status_code?this._reattempt?e.status_code>=200&&e.status_code<300?this._eventHandlers.onSuccessResponse(e):e.status_code>=300&&this._eventHandlers.onErrorResponse(e):(this._request.cseq=this._dialog.local_seqnum+=1,this._reattemptTimer=setTimeout((function(){t._dialog.owner.status!==a.C.STATUS_TERMINATED&&(t._reattempt=!0,t._request_sender.send())}),1e3)):e.status_code>=200&&e.status_code<300?this._eventHandlers.onSuccessResponse(e):e.status_code>=300&&this._eventHandlers.onErrorResponse(e)}},{key:"request",get:function(){return this._request}}])&&r(t.prototype,n),u&&r(t,u),e}()},2999:(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(356),i=n(5424),a=new o("DigestAuthentication");e.exports=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._credentials=t,this._cnonce=null,this._nc=0,this._ncHex="00000000",this._algorithm=null,this._realm=null,this._nonce=null,this._opaque=null,this._stale=null,this._qop=null,this._method=null,this._uri=null,this._ha1=null,this._response=null}var t,n,o;return t=e,n=[{key:"get",value:function(e){switch(e){case"realm":return this._realm;case"ha1":return this._ha1;default:return void a.warn('get() | cannot get "%s" parameter',e)}}},{key:"authenticate",value:function(e,t){var n=e.method,r=e.ruri,o=e.body,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._algorithm=t.algorithm,this._realm=t.realm,this._nonce=t.nonce,this._opaque=t.opaque,this._stale=t.stale,this._algorithm){if("MD5"!==this._algorithm)return a.warn('authenticate() | challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this._algorithm="MD5";if(!this._nonce)return a.warn("authenticate() | challenge without Digest nonce, authentication aborted"),!1;if(!this._realm)return a.warn("authenticate() | challenge without Digest realm, authentication aborted"),!1;if(!this._credentials.password){if(!this._credentials.ha1)return a.warn("authenticate() | no plain SIP password nor ha1 provided, authentication aborted"),!1;if(this._credentials.realm!==this._realm)return a.warn('authenticate() | no plain SIP password, and stored `realm` does not match the given `realm`, cannot authenticate [stored:"%s", given:"%s"]',this._credentials.realm,this._realm),!1}if(t.qop)if(t.qop.indexOf("auth-int")>-1)this._qop="auth-int";else{if(!(t.qop.indexOf("auth")>-1))return a.warn('authenticate() | challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this._qop="auth"}else this._qop=null;this._method=n,this._uri=r,this._cnonce=s||i.createRandomToken(12),this._nc+=1;var l,u,c=Number(this._nc).toString(16);return this._ncHex="00000000".substr(0,8-c.length)+c,4294967296===this._nc&&(this._nc=1,this._ncHex="00000001"),this._credentials.password?this._ha1=i.calculateMD5("".concat(this._credentials.username,":").concat(this._realm,":").concat(this._credentials.password)):this._ha1=this._credentials.ha1,"auth"===this._qop?(l="".concat(this._method,":").concat(this._uri),u=i.calculateMD5(l),a.debug('authenticate() | using qop=auth [a2:"%s"]',l),this._response=i.calculateMD5("".concat(this._ha1,":").concat(this._nonce,":").concat(this._ncHex,":").concat(this._cnonce,":auth:").concat(u))):"auth-int"===this._qop?(l="".concat(this._method,":").concat(this._uri,":").concat(i.calculateMD5(o||"")),u=i.calculateMD5(l),a.debug('authenticate() | using qop=auth-int [a2:"%s"]',l),this._response=i.calculateMD5("".concat(this._ha1,":").concat(this._nonce,":").concat(this._ncHex,":").concat(this._cnonce,":auth-int:").concat(u))):null===this._qop&&(l="".concat(this._method,":").concat(this._uri),u=i.calculateMD5(l),a.debug('authenticate() | using qop=null [a2:"%s"]',l),this._response=i.calculateMD5("".concat(this._ha1,":").concat(this._nonce,":").concat(u))),a.debug("authenticate() | response generated"),!0}},{key:"toString",value:function(){var e=[];if(!this._response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm=".concat(this._algorithm)),e.push('username="'.concat(this._credentials.username,'"')),e.push('realm="'.concat(this._realm,'"')),e.push('nonce="'.concat(this._nonce,'"')),e.push('uri="'.concat(this._uri,'"')),e.push('response="'.concat(this._response,'"')),this._opaque&&e.push('opaque="'.concat(this._opaque,'"')),this._qop&&(e.push("qop=".concat(this._qop)),e.push('cnonce="'.concat(this._cnonce,'"')),e.push("nc=".concat(this._ncHex))),"Digest ".concat(e.join(", "))}}],n&&r(t.prototype,n),o&&r(t,o),e}()},8063:e=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function o(e){var t=l();return function(){var n,r=c(e);if(t){var o=c(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return i(this,n)}}function i(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function a(e){var t="function"==typeof Map?new Map:void 0;return a=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return s(e,arguments,c(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),u(r,e)},a(e)}function s(e,t,n){return s=l()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&u(o,n.prototype),o},s.apply(null,arguments)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}var d=function(e){r(i,e);var t=o(i);function i(e,r){var o;return n(this,i),(o=t.call(this)).code=1,o.name="CONFIGURATION_ERROR",o.parameter=e,o.value=r,o.message=o.value?"Invalid value ".concat(JSON.stringify(o.value),' for parameter "').concat(o.parameter,'"'):"Missing parameter: ".concat(o.parameter),o}return i}(a(Error)),f=function(e){r(i,e);var t=o(i);function i(e){var r;return n(this,i),(r=t.call(this)).code=2,r.name="INVALID_STATE_ERROR",r.status=e,r.message="Invalid status: ".concat(e),r}return i}(a(Error)),p=function(e){r(i,e);var t=o(i);function i(e){var r;return n(this,i),(r=t.call(this)).code=3,r.name="NOT_SUPPORTED_ERROR",r.message=e,r}return i}(a(Error)),h=function(e){r(i,e);var t=o(i);function i(e){var r;return n(this,i),(r=t.call(this)).code=4,r.name="NOT_READY_ERROR",r.message=e,r}return i}(a(Error));e.exports={ConfigurationError:d,InvalidStateError:f,NotSupportedError:p,NotReadyError:h}},3790:(e,t,n)=>{"use strict";e.exports=function(){function e(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var t={parse:function(t,r){var o={CRLF:u,DIGIT:c,ALPHA:d,HEXDIG:f,WSP:p,OCTET:h,DQUOTE:m,SP:_,HTAB:v,alphanum:g,reserved:y,unreserved:S,mark:T,escaped:C,LWS:E,SWS:R,HCOLON:b,TEXT_UTF8_TRIM:A,TEXT_UTF8char:I,UTF8_NONASCII:w,UTF8_CONT:O,LHEX:function(){var e;null===(e=c())&&(/^[a-f]/.test(t.charAt(i))?(e=t.charAt(i),i++):(e=null,l("[a-f]")));return e},token:P,token_nodot:N,separators:function(){var e;40===t.charCodeAt(i)?(e="(",i++):(e=null,l('"("'));null===e&&(41===t.charCodeAt(i)?(e=")",i++):(e=null,l('")"')),null===e&&(60===t.charCodeAt(i)?(e="<",i++):(e=null,l('"<"')),null===e&&(62===t.charCodeAt(i)?(e=">",i++):(e=null,l('">"')),null===e&&(64===t.charCodeAt(i)?(e="@",i++):(e=null,l('"@"')),null===e&&(44===t.charCodeAt(i)?(e=",",i++):(e=null,l('","')),null===e&&(59===t.charCodeAt(i)?(e=";",i++):(e=null,l('";"')),null===e&&(58===t.charCodeAt(i)?(e=":",i++):(e=null,l('":"')),null===e&&(92===t.charCodeAt(i)?(e="\\",i++):(e=null,l('"\\\\"')),null===e&&null===(e=m())&&(47===t.charCodeAt(i)?(e="/",i++):(e=null,l('"/"')),null===e&&(91===t.charCodeAt(i)?(e="[",i++):(e=null,l('"["')),null===e&&(93===t.charCodeAt(i)?(e="]",i++):(e=null,l('"]"')),null===e&&(63===t.charCodeAt(i)?(e="?",i++):(e=null,l('"?"')),null===e&&(61===t.charCodeAt(i)?(e="=",i++):(e=null,l('"="')),null===e&&(123===t.charCodeAt(i)?(e="{",i++):(e=null,l('"{"')),null===e&&(125===t.charCodeAt(i)?(e="}",i++):(e=null,l('"}"')),null===e&&null===(e=_())&&(e=v()))))))))))))))));return e},word:D,STAR:M,SLASH:k,EQUAL:x,LPAREN:L,RPAREN:U,RAQUOT:F,LAQUOT:H,COMMA:q,SEMI:j,COLON:V,LDQUOT:G,RDQUOT:B,comment:function e(){var t,n,r,o;if(o=i,null!==(t=L())){for(n=[],null===(r=W())&&null===(r=z())&&(r=e());null!==r;)n.push(r),null===(r=W())&&null===(r=z())&&(r=e());null!==n&&null!==(r=U())?t=[t,n,r]:(t=null,i=o)}else t=null,i=o;return t},ctext:W,quoted_string:K,quoted_string_clean:J,qdtext:Y,quoted_pair:z,SIP_URI_noparams:X,SIP_URI:$,uri_scheme:Q,uri_scheme_sips:Z,uri_scheme_sip:ee,userinfo:te,user:ne,user_unreserved:re,password:oe,hostport:ie,host:ae,hostname:se,domainlabel:le,toplabel:ue,IPv6reference:ce,IPv6address:de,h16:fe,ls32:pe,IPv4address:he,dec_octet:me,port:_e,uri_parameters:ve,uri_parameter:ge,transport_param:ye,user_param:Se,method_param:Te,ttl_param:Ce,maddr_param:Ee,lr_param:Re,other_param:be,pname:Ae,pvalue:Ie,paramchar:we,param_unreserved:Oe,headers:Pe,header:Ne,hname:De,hvalue:Me,hnv_unreserved:ke,Request_Response:function(){var e;null===(e=ct())&&(e=xe());return e},Request_Line:xe,Request_URI:Le,absoluteURI:Ue,hier_part:Fe,net_path:He,abs_path:qe,opaque_part:je,uric:Ve,uric_no_slash:Ge,path_segments:Be,segment:We,param:Ke,pchar:Je,scheme:Ye,authority:ze,srvr:Xe,reg_name:$e,query:Qe,SIP_Version:Ze,INVITEm:et,ACKm:tt,OPTIONSm:nt,BYEm:rt,CANCELm:ot,REGISTERm:it,SUBSCRIBEm:at,NOTIFYm:st,REFERm:lt,Method:ut,Status_Line:ct,Status_Code:dt,extension_code:ft,Reason_Phrase:pt,Allow_Events:function(){var e,t,n,r,o,a;if(o=i,null!==(e=Ut())){for(t=[],a=i,null!==(n=q())&&null!==(r=Ut())?n=[n,r]:(n=null,i=a);null!==n;)t.push(n),a=i,null!==(n=q())&&null!==(r=Ut())?n=[n,r]:(n=null,i=a);null!==t?e=[e,t]:(e=null,i=o)}else e=null,i=o;return e},Call_ID:function(){var e,n,r,o,a,s;o=i,a=i,null!==(e=D())?(s=i,64===t.charCodeAt(i)?(n="@",i++):(n=null,l('"@"')),null!==n&&null!==(r=D())?n=[n,r]:(n=null,i=s),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,i=a)):(e=null,i=a);null!==e&&(e=function(e){qn=t.substring(i,e)}(o));null===e&&(i=o);return e},Contact:function(){var e,t,n,r,o,a,s;if(o=i,null===(e=M()))if(a=i,null!==(e=ht())){for(t=[],s=i,null!==(n=q())&&null!==(r=ht())?n=[n,r]:(n=null,i=s);null!==n;)t.push(n),s=i,null!==(n=q())&&null!==(r=ht())?n=[n,r]:(n=null,i=s);null!==t?e=[e,t]:(e=null,i=a)}else e=null,i=a;null!==e&&(e=function(e){var t,n;for(n=qn.multi_header.length,t=0;t<n;t++)if(null===qn.multi_header[t].parsed){qn=null;break}qn=null!==qn?qn.multi_header:-1}());null===e&&(i=o);return e},contact_param:ht,name_addr:mt,display_name:_t,contact_params:vt,c_p_q:gt,c_p_expires:yt,delta_seconds:St,qvalue:Tt,generic_param:Ct,gen_value:Et,Content_Disposition:function(){var e,t,n,r,o,a;if(o=i,null!==(e=Rt())){for(t=[],a=i,null!==(n=j())&&null!==(r=bt())?n=[n,r]:(n=null,i=a);null!==n;)t.push(n),a=i,null!==(n=j())&&null!==(r=bt())?n=[n,r]:(n=null,i=a);null!==t?e=[e,t]:(e=null,i=o)}else e=null,i=o;return e},disp_type:Rt,disp_param:bt,handling_param:At,Content_Encoding:function(){var e,t,n,r,o,a;if(o=i,null!==(e=P())){for(t=[],a=i,null!==(n=q())&&null!==(r=P())?n=[n,r]:(n=null,i=a);null!==n;)t.push(n),a=i,null!==(n=q())&&null!==(r=P())?n=[n,r]:(n=null,i=a);null!==t?e=[e,t]:(e=null,i=o)}else e=null,i=o;return e},Content_Length:function(){var e,t,n;if(n=i,null!==(t=c()))for(e=[];null!==t;)e.push(t),t=c();else e=null;null!==e&&(e=void(qn=parseInt(e.join(""))));null===e&&(i=n);return e},Content_Type:function(){var e,n;n=i,null!==(e=It())&&(e=function(e){qn=t.substring(i,e)}(n));null===e&&(i=n);return e},media_type:It,m_type:wt,discrete_type:Ot,composite_type:Pt,extension_token:Nt,x_token:Dt,m_subtype:Mt,m_parameter:kt,m_value:xt,CSeq:function(){var e,t,n,r;r=i,null!==(e=Lt())&&null!==(t=E())&&null!==(n=ut())?e=[e,t,n]:(e=null,i=r);return e},CSeq_value:Lt,Expires:function(){var e,t;t=i,null!==(e=St())&&(e=void(qn=e));null===e&&(i=t);return e},Event:function(){var e,t,n,r,o,a,s;if(o=i,a=i,null!==(e=Ut())){for(t=[],s=i,null!==(n=j())&&null!==(r=Ct())?n=[n,r]:(n=null,i=s);null!==n;)t.push(n),s=i,null!==(n=j())&&null!==(r=Ct())?n=[n,r]:(n=null,i=s);null!==t?e=[e,t]:(e=null,i=a)}else e=null,i=a;null!==e&&(l=e[0],e=void(qn.event=l.join("").toLowerCase()));var l;null===e&&(i=o);return e},event_type:Ut,From:function(){var e,t,n,r,o,a,s;o=i,a=i,null===(e=X())&&(e=mt());if(null!==e){for(t=[],s=i,null!==(n=j())&&null!==(r=Ft())?n=[n,r]:(n=null,i=s);null!==n;)t.push(n),s=i,null!==(n=j())&&null!==(r=Ft())?n=[n,r]:(n=null,i=s);null!==t?e=[e,t]:(e=null,i=a)}else e=null,i=a;null!==e&&(e=function(e){var t=qn.tag;try{qn=new Hn(qn.uri,qn.display_name,qn.params),t&&qn.setParam("tag",t)}catch(e){qn=-1}}());null===e&&(i=o);return e},from_param:Ft,tag_param:Ht,Max_Forwards:function(){var e,t,n;if(n=i,null!==(t=c()))for(e=[];null!==t;)e.push(t),t=c();else e=null;null!==e&&(e=void(qn=parseInt(e.join(""))));null===e&&(i=n);return e},Min_Expires:function(){var e,t;t=i,null!==(e=St())&&(e=void(qn=e));null===e&&(i=t);return e},Name_Addr_Header:function(){var e,t,n,r,o,a,s,l,u,c;l=i,u=i,e=[],t=_t();for(;null!==t;)e.push(t),t=_t();if(null!==e)if(null!==(t=H()))if(null!==(n=$()))if(null!==(r=F())){for(o=[],c=i,null!==(a=j())&&null!==(s=Ct())?a=[a,s]:(a=null,i=c);null!==a;)o.push(a),c=i,null!==(a=j())&&null!==(s=Ct())?a=[a,s]:(a=null,i=c);null!==o?e=[e,t,n,r,o]:(e=null,i=u)}else e=null,i=u;else e=null,i=u;else e=null,i=u;else e=null,i=u;null!==e&&(e=function(e){try{qn=new Hn(qn.uri,qn.display_name,qn.params)}catch(e){qn=-1}}());null===e&&(i=l);return e},Proxy_Authenticate:function(){return qt()},challenge:qt,other_challenge:jt,auth_param:Vt,digest_cln:Gt,realm:Bt,realm_value:Wt,domain:Kt,URI:Jt,nonce:Yt,nonce_value:zt,opaque:Xt,stale:$t,algorithm:Qt,qop_options:Zt,qop_value:en,Proxy_Require:function(){var e,t,n,r,o,a;if(o=i,null!==(e=P())){for(t=[],a=i,null!==(n=q())&&null!==(r=P())?n=[n,r]:(n=null,i=a);null!==n;)t.push(n),a=i,null!==(n=q())&&null!==(r=P())?n=[n,r]:(n=null,i=a);null!==t?e=[e,t]:(e=null,i=o)}else e=null,i=o;return e},Record_Route:function(){var e,t,n,r,o,a,s;if(o=i,a=i,null!==(e=tn())){for(t=[],s=i,null!==(n=q())&&null!==(r=tn())?n=[n,r]:(n=null,i=s);null!==n;)t.push(n),s=i,null!==(n=q())&&null!==(r=tn())?n=[n,r]:(n=null,i=s);null!==t?e=[e,t]:(e=null,i=a)}else e=null,i=a;null!==e&&(e=function(e){var t,n;for(n=qn.multi_header.length,t=0;t<n;t++)if(null===qn.multi_header[t].parsed){qn=null;break}qn=null!==qn?qn.multi_header:-1}());null===e&&(i=o);return e},rec_route:tn,Reason:function(){var e,n,r,o,a,s,u;a=i,s=i,"sip"===t.substr(i,3).toLowerCase()?(e=t.substr(i,3),i+=3):(e=null,l('"SIP"'));null===e&&(e=P());if(null!==e){for(n=[],u=i,null!==(r=j())&&null!==(o=nn())?r=[r,o]:(r=null,i=u);null!==r;)n.push(r),u=i,null!==(r=j())&&null!==(o=nn())?r=[r,o]:(r=null,i=u);null!==n?e=[e,n]:(e=null,i=s)}else e=null,i=s;null!==e&&(e=function(e,t){if(qn.protocol=t.toLowerCase(),qn.params||(qn.params={}),qn.params.text&&'"'===qn.params.text[0]){var n=qn.params.text;qn.text=n.substring(1,n.length-1),delete qn.params.text}}(0,e[0]));null===e&&(i=a);return e},reason_param:nn,reason_cause:rn,Require:function(){var e,t,n,r,o,a;if(o=i,null!==(e=P())){for(t=[],a=i,null!==(n=q())&&null!==(r=P())?n=[n,r]:(n=null,i=a);null!==n;)t.push(n),a=i,null!==(n=q())&&null!==(r=P())?n=[n,r]:(n=null,i=a);null!==t?e=[e,t]:(e=null,i=o)}else e=null,i=o;return e},Route:function(){var e,t,n,r,o,a;if(o=i,null!==(e=on())){for(t=[],a=i,null!==(n=q())&&null!==(r=on())?n=[n,r]:(n=null,i=a);null!==n;)t.push(n),a=i,null!==(n=q())&&null!==(r=on())?n=[n,r]:(n=null,i=a);null!==t?e=[e,t]:(e=null,i=o)}else e=null,i=o;return e},route_param:on,Subscription_State:function(){var e,t,n,r,o,a;if(o=i,null!==(e=an())){for(t=[],a=i,null!==(n=j())&&null!==(r=sn())?n=[n,r]:(n=null,i=a);null!==n;)t.push(n),a=i,null!==(n=j())&&null!==(r=sn())?n=[n,r]:(n=null,i=a);null!==t?e=[e,t]:(e=null,i=o)}else e=null,i=o;return e},substate_value:an,subexp_params:sn,event_reason_value:ln,Subject:function(){var e;return e=null!==(e=A())?e:""},Supported:function(){var e,t,n,r,o,a;if(o=i,null!==(e=P())){for(t=[],a=i,null!==(n=q())&&null!==(r=P())?n=[n,r]:(n=null,i=a);null!==n;)t.push(n),a=i,null!==(n=q())&&null!==(r=P())?n=[n,r]:(n=null,i=a);null!==t?e=[e,t]:(e=null,i=o)}else e=null,i=o;return e=null!==e?e:""},To:function(){var e,t,n,r,o,a,s;o=i,a=i,null===(e=X())&&(e=mt());if(null!==e){for(t=[],s=i,null!==(n=j())&&null!==(r=un())?n=[n,r]:(n=null,i=s);null!==n;)t.push(n),s=i,null!==(n=j())&&null!==(r=un())?n=[n,r]:(n=null,i=s);null!==t?e=[e,t]:(e=null,i=a)}else e=null,i=a;null!==e&&(e=function(e){var t=qn.tag;try{qn=new Hn(qn.uri,qn.display_name,qn.params),t&&qn.setParam("tag",t)}catch(e){qn=-1}}());null===e&&(i=o);return e},to_param:un,Via:function(){var e,t,n,r,o,a;if(o=i,null!==(e=cn())){for(t=[],a=i,null!==(n=q())&&null!==(r=cn())?n=[n,r]:(n=null,i=a);null!==n;)t.push(n),a=i,null!==(n=q())&&null!==(r=cn())?n=[n,r]:(n=null,i=a);null!==t?e=[e,t]:(e=null,i=o)}else e=null,i=o;return e},via_param:cn,via_params:dn,via_ttl:fn,via_maddr:pn,via_received:hn,via_branch:mn,response_port:_n,rport:vn,sent_protocol:gn,protocol_name:yn,transport:Sn,sent_by:Tn,via_host:Cn,via_port:En,ttl:Rn,WWW_Authenticate:function(){return qt()},Session_Expires:function(){var e,t,n,r,o,a;if(o=i,null!==(e=bn())){for(t=[],a=i,null!==(n=j())&&null!==(r=An())?n=[n,r]:(n=null,i=a);null!==n;)t.push(n),a=i,null!==(n=j())&&null!==(r=An())?n=[n,r]:(n=null,i=a);null!==t?e=[e,t]:(e=null,i=o)}else e=null,i=o;return e},s_e_expires:bn,s_e_params:An,s_e_refresher:In,extension_header:function(){var e,t,n,r;r=i,null!==(e=P())&&null!==(t=b())&&null!==(n=wn())?e=[e,t,n]:(e=null,i=r);return e},header_value:wn,message_body:function(){var e,t;e=[],t=h();for(;null!==t;)e.push(t),t=h();return e},uuid_URI:function(){var e,n,r;r=i,"uuid:"===t.substr(i,5)?(e="uuid:",i+=5):(e=null,l('"uuid:"'));null!==e&&null!==(n=On())?e=[e,n]:(e=null,i=r);return e},uuid:On,hex4:Pn,hex8:Nn,hex12:Dn,Refer_To:function(){var e,t,n,r,o,a,s;o=i,a=i,null===(e=X())&&(e=mt());if(null!==e){for(t=[],s=i,null!==(n=j())&&null!==(r=Ct())?n=[n,r]:(n=null,i=s);null!==n;)t.push(n),s=i,null!==(n=j())&&null!==(r=Ct())?n=[n,r]:(n=null,i=s);null!==t?e=[e,t]:(e=null,i=a)}else e=null,i=a;null!==e&&(e=function(e){try{qn=new Hn(qn.uri,qn.display_name,qn.params)}catch(e){qn=-1}}());null===e&&(i=o);return e},Replaces:function(){var e,t,n,r,o,a;if(o=i,null!==(e=Mn())){for(t=[],a=i,null!==(n=j())&&null!==(r=kn())?n=[n,r]:(n=null,i=a);null!==n;)t.push(n),a=i,null!==(n=j())&&null!==(r=kn())?n=[n,r]:(n=null,i=a);null!==t?e=[e,t]:(e=null,i=o)}else e=null,i=o;return e},call_id:Mn,replaces_param:kn,to_tag:xn,from_tag:Ln,early_flag:Un};if(void 0!==r){if(void 0===o[r])throw new Error("Invalid rule name: "+e(r)+".")}else r="CRLF";var i=0,a=0,s=[];function l(e){i<a||(i>a&&(a=i,s=[]),s.push(e))}function u(){var e;return"\r\n"===t.substr(i,2)?(e="\r\n",i+=2):(e=null,l('"\\r\\n"')),e}function c(){var e;return/^[0-9]/.test(t.charAt(i))?(e=t.charAt(i),i++):(e=null,l("[0-9]")),e}function d(){var e;return/^[a-zA-Z]/.test(t.charAt(i))?(e=t.charAt(i),i++):(e=null,l("[a-zA-Z]")),e}function f(){var e;return/^[0-9a-fA-F]/.test(t.charAt(i))?(e=t.charAt(i),i++):(e=null,l("[0-9a-fA-F]")),e}function p(){var e;return null===(e=_())&&(e=v()),e}function h(){var e;return/^[\0-\xFF]/.test(t.charAt(i))?(e=t.charAt(i),i++):(e=null,l("[\\0-\\xFF]")),e}function m(){var e;return/^["]/.test(t.charAt(i))?(e=t.charAt(i),i++):(e=null,l('["]')),e}function _(){var e;return 32===t.charCodeAt(i)?(e=" ",i++):(e=null,l('" "')),e}function v(){var e;return 9===t.charCodeAt(i)?(e="\t",i++):(e=null,l('"\\t"')),e}function g(){var e;return/^[a-zA-Z0-9]/.test(t.charAt(i))?(e=t.charAt(i),i++):(e=null,l("[a-zA-Z0-9]")),e}function y(){var e;return 59===t.charCodeAt(i)?(e=";",i++):(e=null,l('";"')),null===e&&(47===t.charCodeAt(i)?(e="/",i++):(e=null,l('"/"')),null===e&&(63===t.charCodeAt(i)?(e="?",i++):(e=null,l('"?"')),null===e&&(58===t.charCodeAt(i)?(e=":",i++):(e=null,l('":"')),null===e&&(64===t.charCodeAt(i)?(e="@",i++):(e=null,l('"@"')),null===e&&(38===t.charCodeAt(i)?(e="&",i++):(e=null,l('"&"')),null===e&&(61===t.charCodeAt(i)?(e="=",i++):(e=null,l('"="')),null===e&&(43===t.charCodeAt(i)?(e="+",i++):(e=null,l('"+"')),null===e&&(36===t.charCodeAt(i)?(e="$",i++):(e=null,l('"$"')),null===e&&(44===t.charCodeAt(i)?(e=",",i++):(e=null,l('","'))))))))))),e}function S(){var e;return null===(e=g())&&(e=T()),e}function T(){var e;return 45===t.charCodeAt(i)?(e="-",i++):(e=null,l('"-"')),null===e&&(95===t.charCodeAt(i)?(e="_",i++):(e=null,l('"_"')),null===e&&(46===t.charCodeAt(i)?(e=".",i++):(e=null,l('"."')),null===e&&(33===t.charCodeAt(i)?(e="!",i++):(e=null,l('"!"')),null===e&&(126===t.charCodeAt(i)?(e="~",i++):(e=null,l('"~"')),null===e&&(42===t.charCodeAt(i)?(e="*",i++):(e=null,l('"*"')),null===e&&(39===t.charCodeAt(i)?(e="'",i++):(e=null,l('"\'"')),null===e&&(40===t.charCodeAt(i)?(e="(",i++):(e=null,l('"("')),null===e&&(41===t.charCodeAt(i)?(e=")",i++):(e=null,l('")"')))))))))),e}function C(){var e,n,r,o,a;return o=i,a=i,37===t.charCodeAt(i)?(e="%",i++):(e=null,l('"%"')),null!==e&&null!==(n=f())&&null!==(r=f())?e=[e,n,r]:(e=null,i=a),null!==e&&(e=e.join("")),null===e&&(i=o),e}function E(){var e,t,n,r,o,a;for(r=i,o=i,a=i,e=[],t=p();null!==t;)e.push(t),t=p();if(null!==e&&null!==(t=u())?e=[e,t]:(e=null,i=a),null!==(e=null!==e?e:"")){if(null!==(n=p()))for(t=[];null!==n;)t.push(n),n=p();else t=null;null!==t?e=[e,t]:(e=null,i=o)}else e=null,i=o;return null!==e&&(e=" "),null===e&&(i=r),e}function R(){var e;return e=null!==(e=E())?e:""}function b(){var e,n,r,o,a;for(o=i,a=i,e=[],null===(n=_())&&(n=v());null!==n;)e.push(n),null===(n=_())&&(n=v());return null!==e?(58===t.charCodeAt(i)?(n=":",i++):(n=null,l('":"')),null!==n&&null!==(r=R())?e=[e,n,r]:(e=null,i=a)):(e=null,i=a),null!==e&&(e=":"),null===e&&(i=o),e}function A(){var e,n,r,o,a,s,l;if(a=i,s=i,null!==(n=I()))for(e=[];null!==n;)e.push(n),n=I();else e=null;if(null!==e){for(n=[],l=i,r=[],o=E();null!==o;)r.push(o),o=E();for(null!==r&&null!==(o=I())?r=[r,o]:(r=null,i=l);null!==r;){for(n.push(r),l=i,r=[],o=E();null!==o;)r.push(o),o=E();null!==r&&null!==(o=I())?r=[r,o]:(r=null,i=l)}null!==n?e=[e,n]:(e=null,i=s)}else e=null,i=s;return null!==e&&(e=function(e){return t.substring(i,e)}(a)),null===e&&(i=a),e}function I(){var e;return/^[!-~]/.test(t.charAt(i))?(e=t.charAt(i),i++):(e=null,l("[!-~]")),null===e&&(e=w()),e}function w(){var e;return/^[\x80-\uFFFF]/.test(t.charAt(i))?(e=t.charAt(i),i++):(e=null,l("[\\x80-\\uFFFF]")),e}function O(){var e;return/^[\x80-\xBF]/.test(t.charAt(i))?(e=t.charAt(i),i++):(e=null,l("[\\x80-\\xBF]")),e}function P(){var e,n,r;if(r=i,null===(n=g())&&(45===t.charCodeAt(i)?(n="-",i++):(n=null,l('"-"')),null===n&&(46===t.charCodeAt(i)?(n=".",i++):(n=null,l('"."')),null===n&&(33===t.charCodeAt(i)?(n="!",i++):(n=null,l('"!"')),null===n&&(37===t.charCodeAt(i)?(n="%",i++):(n=null,l('"%"')),null===n&&(42===t.charCodeAt(i)?(n="*",i++):(n=null,l('"*"')),null===n&&(95===t.charCodeAt(i)?(n="_",i++):(n=null,l('"_"')),null===n&&(43===t.charCodeAt(i)?(n="+",i++):(n=null,l('"+"')),null===n&&(96===t.charCodeAt(i)?(n="`",i++):(n=null,l('"`"')),null===n&&(39===t.charCodeAt(i)?(n="'",i++):(n=null,l('"\'"')),null===n&&(126===t.charCodeAt(i)?(n="~",i++):(n=null,l('"~"')))))))))))),null!==n)for(e=[];null!==n;)e.push(n),null===(n=g())&&(45===t.charCodeAt(i)?(n="-",i++):(n=null,l('"-"')),null===n&&(46===t.charCodeAt(i)?(n=".",i++):(n=null,l('"."')),null===n&&(33===t.charCodeAt(i)?(n="!",i++):(n=null,l('"!"')),null===n&&(37===t.charCodeAt(i)?(n="%",i++):(n=null,l('"%"')),null===n&&(42===t.charCodeAt(i)?(n="*",i++):(n=null,l('"*"')),null===n&&(95===t.charCodeAt(i)?(n="_",i++):(n=null,l('"_"')),null===n&&(43===t.charCodeAt(i)?(n="+",i++):(n=null,l('"+"')),null===n&&(96===t.charCodeAt(i)?(n="`",i++):(n=null,l('"`"')),null===n&&(39===t.charCodeAt(i)?(n="'",i++):(n=null,l('"\'"')),null===n&&(126===t.charCodeAt(i)?(n="~",i++):(n=null,l('"~"'))))))))))));else e=null;return null!==e&&(e=function(e){return t.substring(i,e)}(r)),null===e&&(i=r),e}function N(){var e,n,r;if(r=i,null===(n=g())&&(45===t.charCodeAt(i)?(n="-",i++):(n=null,l('"-"')),null===n&&(33===t.charCodeAt(i)?(n="!",i++):(n=null,l('"!"')),null===n&&(37===t.charCodeAt(i)?(n="%",i++):(n=null,l('"%"')),null===n&&(42===t.charCodeAt(i)?(n="*",i++):(n=null,l('"*"')),null===n&&(95===t.charCodeAt(i)?(n="_",i++):(n=null,l('"_"')),null===n&&(43===t.charCodeAt(i)?(n="+",i++):(n=null,l('"+"')),null===n&&(96===t.charCodeAt(i)?(n="`",i++):(n=null,l('"`"')),null===n&&(39===t.charCodeAt(i)?(n="'",i++):(n=null,l('"\'"')),null===n&&(126===t.charCodeAt(i)?(n="~",i++):(n=null,l('"~"'))))))))))),null!==n)for(e=[];null!==n;)e.push(n),null===(n=g())&&(45===t.charCodeAt(i)?(n="-",i++):(n=null,l('"-"')),null===n&&(33===t.charCodeAt(i)?(n="!",i++):(n=null,l('"!"')),null===n&&(37===t.charCodeAt(i)?(n="%",i++):(n=null,l('"%"')),null===n&&(42===t.charCodeAt(i)?(n="*",i++):(n=null,l('"*"')),null===n&&(95===t.charCodeAt(i)?(n="_",i++):(n=null,l('"_"')),null===n&&(43===t.charCodeAt(i)?(n="+",i++):(n=null,l('"+"')),null===n&&(96===t.charCodeAt(i)?(n="`",i++):(n=null,l('"`"')),null===n&&(39===t.charCodeAt(i)?(n="'",i++):(n=null,l('"\'"')),null===n&&(126===t.charCodeAt(i)?(n="~",i++):(n=null,l('"~"')))))))))));else e=null;return null!==e&&(e=function(e){return t.substring(i,e)}(r)),null===e&&(i=r),e}function D(){var e,n,r;if(r=i,null===(n=g())&&(45===t.charCodeAt(i)?(n="-",i++):(n=null,l('"-"')),null===n&&(46===t.charCodeAt(i)?(n=".",i++):(n=null,l('"."')),null===n&&(33===t.charCodeAt(i)?(n="!",i++):(n=null,l('"!"')),null===n&&(37===t.charCodeAt(i)?(n="%",i++):(n=null,l('"%"')),null===n&&(42===t.charCodeAt(i)?(n="*",i++):(n=null,l('"*"')),null===n&&(95===t.charCodeAt(i)?(n="_",i++):(n=null,l('"_"')),null===n&&(43===t.charCodeAt(i)?(n="+",i++):(n=null,l('"+"')),null===n&&(96===t.charCodeAt(i)?(n="`",i++):(n=null,l('"`"')),null===n&&(39===t.charCodeAt(i)?(n="'",i++):(n=null,l('"\'"')),null===n&&(126===t.charCodeAt(i)?(n="~",i++):(n=null,l('"~"')),null===n&&(40===t.charCodeAt(i)?(n="(",i++):(n=null,l('"("')),null===n&&(41===t.charCodeAt(i)?(n=")",i++):(n=null,l('")"')),null===n&&(60===t.charCodeAt(i)?(n="<",i++):(n=null,l('"<"')),null===n&&(62===t.charCodeAt(i)?(n=">",i++):(n=null,l('">"')),null===n&&(58===t.charCodeAt(i)?(n=":",i++):(n=null,l('":"')),null===n&&(92===t.charCodeAt(i)?(n="\\",i++):(n=null,l('"\\\\"')),null===n&&null===(n=m())&&(47===t.charCodeAt(i)?(n="/",i++):(n=null,l('"/"')),null===n&&(91===t.charCodeAt(i)?(n="[",i++):(n=null,l('"["')),null===n&&(93===t.charCodeAt(i)?(n="]",i++):(n=null,l('"]"')),null===n&&(63===t.charCodeAt(i)?(n="?",i++):(n=null,l('"?"')),null===n&&(123===t.charCodeAt(i)?(n="{",i++):(n=null,l('"{"')),null===n&&(125===t.charCodeAt(i)?(n="}",i++):(n=null,l('"}"')))))))))))))))))))))))),null!==n)for(e=[];null!==n;)e.push(n),null===(n=g())&&(45===t.charCodeAt(i)?(n="-",i++):(n=null,l('"-"')),null===n&&(46===t.charCodeAt(i)?(n=".",i++):(n=null,l('"."')),null===n&&(33===t.charCodeAt(i)?(n="!",i++):(n=null,l('"!"')),null===n&&(37===t.charCodeAt(i)?(n="%",i++):(n=null,l('"%"')),null===n&&(42===t.charCodeAt(i)?(n="*",i++):(n=null,l('"*"')),null===n&&(95===t.charCodeAt(i)?(n="_",i++):(n=null,l('"_"')),null===n&&(43===t.charCodeAt(i)?(n="+",i++):(n=null,l('"+"')),null===n&&(96===t.charCodeAt(i)?(n="`",i++):(n=null,l('"`"')),null===n&&(39===t.charCodeAt(i)?(n="'",i++):(n=null,l('"\'"')),null===n&&(126===t.charCodeAt(i)?(n="~",i++):(n=null,l('"~"')),null===n&&(40===t.charCodeAt(i)?(n="(",i++):(n=null,l('"("')),null===n&&(41===t.charCodeAt(i)?(n=")",i++):(n=null,l('")"')),null===n&&(60===t.charCodeAt(i)?(n="<",i++):(n=null,l('"<"')),null===n&&(62===t.charCodeAt(i)?(n=">",i++):(n=null,l('">"')),null===n&&(58===t.charCodeAt(i)?(n=":",i++):(n=null,l('":"')),null===n&&(92===t.charCodeAt(i)?(n="\\",i++):(n=null,l('"\\\\"')),null===n&&null===(n=m())&&(47===t.charCodeAt(i)?(n="/",i++):(n=null,l('"/"')),null===n&&(91===t.charCodeAt(i)?(n="[",i++):(n=null,l('"["')),null===n&&(93===t.charCodeAt(i)?(n="]",i++):(n=null,l('"]"')),null===n&&(63===t.charCodeAt(i)?(n="?",i++):(n=null,l('"?"')),null===n&&(123===t.charCodeAt(i)?(n="{",i++):(n=null,l('"{"')),null===n&&(125===t.charCodeAt(i)?(n="}",i++):(n=null,l('"}"'))))))))))))))))))))))));else e=null;return null!==e&&(e=function(e){return t.substring(i,e)}(r)),null===e&&(i=r),e}function M(){var e,n,r,o,a;return o=i,a=i,null!==(e=R())?(42===t.charCodeAt(i)?(n="*",i++):(n=null,l('"*"')),null!==n&&null!==(r=R())?e=[e,n,r]:(e=null,i=a)):(e=null,i=a),null!==e&&(e="*"),null===e&&(i=o),e}function k(){var e,n,r,o,a;return o=i,a=i,null!==(e=R())?(47===t.charCodeAt(i)?(n="/",i++):(n=null,l('"/"')),null!==n&&null!==(r=R())?e=[e,n,r]:(e=null,i=a)):(e=null,i=a),null!==e&&(e="/"),null===e&&(i=o),e}function x(){var e,n,r,o,a;return o=i,a=i,null!==(e=R())?(61===t.charCodeAt(i)?(n="=",i++):(n=null,l('"="')),null!==n&&null!==(r=R())?e=[e,n,r]:(e=null,i=a)):(e=null,i=a),null!==e&&(e="="),null===e&&(i=o),e}function L(){var e,n,r,o,a;return o=i,a=i,null!==(e=R())?(40===t.charCodeAt(i)?(n="(",i++):(n=null,l('"("')),null!==n&&null!==(r=R())?e=[e,n,r]:(e=null,i=a)):(e=null,i=a),null!==e&&(e="("),null===e&&(i=o),e}function U(){var e,n,r,o,a;return o=i,a=i,null!==(e=R())?(41===t.charCodeAt(i)?(n=")",i++):(n=null,l('")"')),null!==n&&null!==(r=R())?e=[e,n,r]:(e=null,i=a)):(e=null,i=a),null!==e&&(e=")"),null===e&&(i=o),e}function F(){var e,n,r,o;return r=i,o=i,62===t.charCodeAt(i)?(e=">",i++):(e=null,l('">"')),null!==e&&null!==(n=R())?e=[e,n]:(e=null,i=o),null!==e&&(e=">"),null===e&&(i=r),e}function H(){var e,n,r,o;return r=i,o=i,null!==(e=R())?(60===t.charCodeAt(i)?(n="<",i++):(n=null,l('"<"')),null!==n?e=[e,n]:(e=null,i=o)):(e=null,i=o),null!==e&&(e="<"),null===e&&(i=r),e}function q(){var e,n,r,o,a;return o=i,a=i,null!==(e=R())?(44===t.charCodeAt(i)?(n=",",i++):(n=null,l('","')),null!==n&&null!==(r=R())?e=[e,n,r]:(e=null,i=a)):(e=null,i=a),null!==e&&(e=","),null===e&&(i=o),e}function j(){var e,n,r,o,a;return o=i,a=i,null!==(e=R())?(59===t.charCodeAt(i)?(n=";",i++):(n=null,l('";"')),null!==n&&null!==(r=R())?e=[e,n,r]:(e=null,i=a)):(e=null,i=a),null!==e&&(e=";"),null===e&&(i=o),e}function V(){var e,n,r,o,a;return o=i,a=i,null!==(e=R())?(58===t.charCodeAt(i)?(n=":",i++):(n=null,l('":"')),null!==n&&null!==(r=R())?e=[e,n,r]:(e=null,i=a)):(e=null,i=a),null!==e&&(e=":"),null===e&&(i=o),e}function G(){var e,t,n,r;return n=i,r=i,null!==(e=R())&&null!==(t=m())?e=[e,t]:(e=null,i=r),null!==e&&(e='"'),null===e&&(i=n),e}function B(){var e,t,n,r;return n=i,r=i,null!==(e=m())&&null!==(t=R())?e=[e,t]:(e=null,i=r),null!==e&&(e='"'),null===e&&(i=n),e}function W(){var e;return/^[!-']/.test(t.charAt(i))?(e=t.charAt(i),i++):(e=null,l("[!-']")),null===e&&(/^[*-[]/.test(t.charAt(i))?(e=t.charAt(i),i++):(e=null,l("[*-[]")),null===e&&(/^[\]-~]/.test(t.charAt(i))?(e=t.charAt(i),i++):(e=null,l("[\\]-~]")),null===e&&null===(e=w())&&(e=E()))),e}function K(){var e,n,r,o,a,s;if(a=i,s=i,null!==(e=R()))if(null!==(n=m())){for(r=[],null===(o=Y())&&(o=z());null!==o;)r.push(o),null===(o=Y())&&(o=z());null!==r&&null!==(o=m())?e=[e,n,r,o]:(e=null,i=s)}else e=null,i=s;else e=null,i=s;return null!==e&&(e=function(e){return t.substring(i,e)}(a)),null===e&&(i=a),e}function J(){var e,n,r,o,a,s;if(a=i,s=i,null!==(e=R()))if(null!==(n=m())){for(r=[],null===(o=Y())&&(o=z());null!==o;)r.push(o),null===(o=Y())&&(o=z());null!==r&&null!==(o=m())?e=[e,n,r,o]:(e=null,i=s)}else e=null,i=s;else e=null,i=s;return null!==e&&(e=function(e){var n=t.substring(i,e).trim();return n.substring(1,n.length-1).replace(/\\([\x00-\x09\x0b-\x0c\x0e-\x7f])/g,"$1")}(a)),null===e&&(i=a),e}function Y(){var e;return null===(e=E())&&(33===t.charCodeAt(i)?(e="!",i++):(e=null,l('"!"')),null===e&&(/^[#-[]/.test(t.charAt(i))?(e=t.charAt(i),i++):(e=null,l("[#-[]")),null===e&&(/^[\]-~]/.test(t.charAt(i))?(e=t.charAt(i),i++):(e=null,l("[\\]-~]")),null===e&&(e=w())))),e}function z(){var e,n,r;return r=i,92===t.charCodeAt(i)?(e="\\",i++):(e=null,l('"\\\\"')),null!==e?(/^[\0-\t]/.test(t.charAt(i))?(n=t.charAt(i),i++):(n=null,l("[\\0-\\t]")),null===n&&(/^[\x0B-\f]/.test(t.charAt(i))?(n=t.charAt(i),i++):(n=null,l("[\\x0B-\\f]")),null===n&&(/^[\x0E-\x7f]/.test(t.charAt(i))?(n=t.charAt(i),i++):(n=null,l("[\\x0E-\x7f]")))),null!==n?e=[e,n]:(e=null,i=r)):(e=null,i=r),e}function X(){var e,n,r,o,a,s;return a=i,s=i,null!==(e=Q())?(58===t.charCodeAt(i)?(n=":",i++):(n=null,l('":"')),null!==n&&null!==(r=null!==(r=te())?r:"")&&null!==(o=ie())?e=[e,n,r,o]:(e=null,i=s)):(e=null,i=s),null!==e&&(e=function(e){try{qn.uri=new Fn(qn.scheme,qn.user,qn.host,qn.port),delete qn.scheme,delete qn.user,delete qn.host,delete qn.host_type,delete qn.port}catch(e){qn=-1}}()),null===e&&(i=a),e}function $(){var e,n,o,a,s,u,c,d;return c=i,d=i,null!==(e=Q())?(58===t.charCodeAt(i)?(n=":",i++):(n=null,l('":"')),null!==n&&null!==(o=null!==(o=te())?o:"")&&null!==(a=ie())&&null!==(s=ve())&&null!==(u=null!==(u=Pe())?u:"")?e=[e,n,o,a,s,u]:(e=null,i=d)):(e=null,i=d),null!==e&&(e=function(e){try{qn.uri=new Fn(qn.scheme,qn.user,qn.host,qn.port,qn.uri_params,qn.uri_headers),delete qn.scheme,delete qn.user,delete qn.host,delete qn.host_type,delete qn.port,delete qn.uri_params,"SIP_URI"===r&&(qn=qn.uri)}catch(e){qn=-1}}()),null===e&&(i=c),e}function Q(){var e;return null===(e=Z())&&(e=ee()),e}function Z(){var e,n,r;return n=i,"sips"===t.substr(i,4).toLowerCase()?(e=t.substr(i,4),i+=4):(e=null,l('"sips"')),null!==e&&(r=e,e=void(qn.scheme=r.toLowerCase())),null===e&&(i=n),e}function ee(){var e,n,r;return n=i,"sip"===t.substr(i,3).toLowerCase()?(e=t.substr(i,3),i+=3):(e=null,l('"sip"')),null!==e&&(r=e,e=void(qn.scheme=r.toLowerCase())),null===e&&(i=n),e}function te(){var e,n,r,o,a,s;return o=i,a=i,null!==(e=ne())?(s=i,58===t.charCodeAt(i)?(n=":",i++):(n=null,l('":"')),null!==n&&null!==(r=oe())?n=[n,r]:(n=null,i=s),null!==(n=null!==n?n:"")?(64===t.charCodeAt(i)?(r="@",i++):(r=null,l('"@"')),null!==r?e=[e,n,r]:(e=null,i=a)):(e=null,i=a)):(e=null,i=a),null!==e&&(e=function(e){qn.user=decodeURIComponent(t.substring(i-1,e))}(o)),null===e&&(i=o),e}function ne(){var e,t;if(null===(t=S())&&null===(t=C())&&(t=re()),null!==t)for(e=[];null!==t;)e.push(t),null===(t=S())&&null===(t=C())&&(t=re());else e=null;return e}function re(){var e;return 38===t.charCodeAt(i)?(e="&",i++):(e=null,l('"&"')),null===e&&(61===t.charCodeAt(i)?(e="=",i++):(e=null,l('"="')),null===e&&(43===t.charCodeAt(i)?(e="+",i++):(e=null,l('"+"')),null===e&&(36===t.charCodeAt(i)?(e="$",i++):(e=null,l('"$"')),null===e&&(44===t.charCodeAt(i)?(e=",",i++):(e=null,l('","')),null===e&&(59===t.charCodeAt(i)?(e=";",i++):(e=null,l('";"')),null===e&&(63===t.charCodeAt(i)?(e="?",i++):(e=null,l('"?"')),null===e&&(47===t.charCodeAt(i)?(e="/",i++):(e=null,l('"/"'))))))))),e}function oe(){var e,n,r;for(r=i,e=[],null===(n=S())&&null===(n=C())&&(38===t.charCodeAt(i)?(n="&",i++):(n=null,l('"&"')),null===n&&(61===t.charCodeAt(i)?(n="=",i++):(n=null,l('"="')),null===n&&(43===t.charCodeAt(i)?(n="+",i++):(n=null,l('"+"')),null===n&&(36===t.charCodeAt(i)?(n="$",i++):(n=null,l('"$"')),null===n&&(44===t.charCodeAt(i)?(n=",",i++):(n=null,l('","')))))));null!==n;)e.push(n),null===(n=S())&&null===(n=C())&&(38===t.charCodeAt(i)?(n="&",i++):(n=null,l('"&"')),null===n&&(61===t.charCodeAt(i)?(n="=",i++):(n=null,l('"="')),null===n&&(43===t.charCodeAt(i)?(n="+",i++):(n=null,l('"+"')),null===n&&(36===t.charCodeAt(i)?(n="$",i++):(n=null,l('"$"')),null===n&&(44===t.charCodeAt(i)?(n=",",i++):(n=null,l('","')))))));return null!==e&&(e=function(e){qn.password=t.substring(i,e)}(r)),null===e&&(i=r),e}function ie(){var e,n,r,o,a;return o=i,null!==(e=ae())?(a=i,58===t.charCodeAt(i)?(n=":",i++):(n=null,l('":"')),null!==n&&null!==(r=_e())?n=[n,r]:(n=null,i=a),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,i=o)):(e=null,i=o),e}function ae(){var e,n;return n=i,null===(e=se())&&null===(e=he())&&(e=ce()),null!==e&&(e=function(e){return qn.host=t.substring(i,e).toLowerCase(),qn.host}(n)),null===e&&(i=n),e}function se(){var e,n,r,o,a,s;for(o=i,a=i,e=[],s=i,null!==(n=le())?(46===t.charCodeAt(i)?(r=".",i++):(r=null,l('"."')),null!==r?n=[n,r]:(n=null,i=s)):(n=null,i=s);null!==n;)e.push(n),s=i,null!==(n=le())?(46===t.charCodeAt(i)?(r=".",i++):(r=null,l('"."')),null!==r?n=[n,r]:(n=null,i=s)):(n=null,i=s);return null!==e&&null!==(n=ue())?(46===t.charCodeAt(i)?(r=".",i++):(r=null,l('"."')),null!==(r=null!==r?r:"")?e=[e,n,r]:(e=null,i=a)):(e=null,i=a),null!==e&&(e=function(e){return qn.host_type="domain",t.substring(i,e)}(o)),null===e&&(i=o),e}function le(){var e,n,r,o;if(o=i,null!==(e=g())){for(n=[],null===(r=g())&&(45===t.charCodeAt(i)?(r="-",i++):(r=null,l('"-"')),null===r&&(95===t.charCodeAt(i)?(r="_",i++):(r=null,l('"_"'))));null!==r;)n.push(r),null===(r=g())&&(45===t.charCodeAt(i)?(r="-",i++):(r=null,l('"-"')),null===r&&(95===t.charCodeAt(i)?(r="_",i++):(r=null,l('"_"'))));null!==n?e=[e,n]:(e=null,i=o)}else e=null,i=o;return e}function ue(){var e,n,r,o;if(o=i,null!==(e=d())){for(n=[],null===(r=g())&&(45===t.charCodeAt(i)?(r="-",i++):(r=null,l('"-"')),null===r&&(95===t.charCodeAt(i)?(r="_",i++):(r=null,l('"_"'))));null!==r;)n.push(r),null===(r=g())&&(45===t.charCodeAt(i)?(r="-",i++):(r=null,l('"-"')),null===r&&(95===t.charCodeAt(i)?(r="_",i++):(r=null,l('"_"'))));null!==n?e=[e,n]:(e=null,i=o)}else e=null,i=o;return e}function ce(){var e,n,r,o,a;return o=i,a=i,91===t.charCodeAt(i)?(e="[",i++):(e=null,l('"["')),null!==e&&null!==(n=de())?(93===t.charCodeAt(i)?(r="]",i++):(r=null,l('"]"')),null!==r?e=[e,n,r]:(e=null,i=a)):(e=null,i=a),null!==e&&(e=function(e){return qn.host_type="IPv6",t.substring(i,e)}(o)),null===e&&(i=o),e}function de(){var e,n,r,o,a,s,u,c,d,f,p,h,m,_,v,g;return _=i,v=i,null!==(e=fe())?(58===t.charCodeAt(i)?(n=":",i++):(n=null,l('":"')),null!==n&&null!==(r=fe())?(58===t.charCodeAt(i)?(o=":",i++):(o=null,l('":"')),null!==o&&null!==(a=fe())?(58===t.charCodeAt(i)?(s=":",i++):(s=null,l('":"')),null!==s&&null!==(u=fe())?(58===t.charCodeAt(i)?(c=":",i++):(c=null,l('":"')),null!==c&&null!==(d=fe())?(58===t.charCodeAt(i)?(f=":",i++):(f=null,l('":"')),null!==f&&null!==(p=fe())?(58===t.charCodeAt(i)?(h=":",i++):(h=null,l('":"')),null!==h&&null!==(m=pe())?e=[e,n,r,o,a,s,u,c,d,f,p,h,m]:(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v),null===e&&(v=i,"::"===t.substr(i,2)?(e="::",i+=2):(e=null,l('"::"')),null!==e&&null!==(n=fe())?(58===t.charCodeAt(i)?(r=":",i++):(r=null,l('":"')),null!==r&&null!==(o=fe())?(58===t.charCodeAt(i)?(a=":",i++):(a=null,l('":"')),null!==a&&null!==(s=fe())?(58===t.charCodeAt(i)?(u=":",i++):(u=null,l('":"')),null!==u&&null!==(c=fe())?(58===t.charCodeAt(i)?(d=":",i++):(d=null,l('":"')),null!==d&&null!==(f=fe())?(58===t.charCodeAt(i)?(p=":",i++):(p=null,l('":"')),null!==p&&null!==(h=pe())?e=[e,n,r,o,a,s,u,c,d,f,p,h]:(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v),null===e&&(v=i,"::"===t.substr(i,2)?(e="::",i+=2):(e=null,l('"::"')),null!==e&&null!==(n=fe())?(58===t.charCodeAt(i)?(r=":",i++):(r=null,l('":"')),null!==r&&null!==(o=fe())?(58===t.charCodeAt(i)?(a=":",i++):(a=null,l('":"')),null!==a&&null!==(s=fe())?(58===t.charCodeAt(i)?(u=":",i++):(u=null,l('":"')),null!==u&&null!==(c=fe())?(58===t.charCodeAt(i)?(d=":",i++):(d=null,l('":"')),null!==d&&null!==(f=pe())?e=[e,n,r,o,a,s,u,c,d,f]:(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v),null===e&&(v=i,"::"===t.substr(i,2)?(e="::",i+=2):(e=null,l('"::"')),null!==e&&null!==(n=fe())?(58===t.charCodeAt(i)?(r=":",i++):(r=null,l('":"')),null!==r&&null!==(o=fe())?(58===t.charCodeAt(i)?(a=":",i++):(a=null,l('":"')),null!==a&&null!==(s=fe())?(58===t.charCodeAt(i)?(u=":",i++):(u=null,l('":"')),null!==u&&null!==(c=pe())?e=[e,n,r,o,a,s,u,c]:(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v),null===e&&(v=i,"::"===t.substr(i,2)?(e="::",i+=2):(e=null,l('"::"')),null!==e&&null!==(n=fe())?(58===t.charCodeAt(i)?(r=":",i++):(r=null,l('":"')),null!==r&&null!==(o=fe())?(58===t.charCodeAt(i)?(a=":",i++):(a=null,l('":"')),null!==a&&null!==(s=pe())?e=[e,n,r,o,a,s]:(e=null,i=v)):(e=null,i=v)):(e=null,i=v),null===e&&(v=i,"::"===t.substr(i,2)?(e="::",i+=2):(e=null,l('"::"')),null!==e&&null!==(n=fe())?(58===t.charCodeAt(i)?(r=":",i++):(r=null,l('":"')),null!==r&&null!==(o=pe())?e=[e,n,r,o]:(e=null,i=v)):(e=null,i=v),null===e&&(v=i,"::"===t.substr(i,2)?(e="::",i+=2):(e=null,l('"::"')),null!==e&&null!==(n=pe())?e=[e,n]:(e=null,i=v),null===e&&(v=i,"::"===t.substr(i,2)?(e="::",i+=2):(e=null,l('"::"')),null!==e&&null!==(n=fe())?e=[e,n]:(e=null,i=v),null===e&&(v=i,null!==(e=fe())?("::"===t.substr(i,2)?(n="::",i+=2):(n=null,l('"::"')),null!==n&&null!==(r=fe())?(58===t.charCodeAt(i)?(o=":",i++):(o=null,l('":"')),null!==o&&null!==(a=fe())?(58===t.charCodeAt(i)?(s=":",i++):(s=null,l('":"')),null!==s&&null!==(u=fe())?(58===t.charCodeAt(i)?(c=":",i++):(c=null,l('":"')),null!==c&&null!==(d=fe())?(58===t.charCodeAt(i)?(f=":",i++):(f=null,l('":"')),null!==f&&null!==(p=pe())?e=[e,n,r,o,a,s,u,c,d,f,p]:(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v),null===e&&(v=i,null!==(e=fe())?(g=i,58===t.charCodeAt(i)?(n=":",i++):(n=null,l('":"')),null!==n&&null!==(r=fe())?n=[n,r]:(n=null,i=g),null!==(n=null!==n?n:"")?("::"===t.substr(i,2)?(r="::",i+=2):(r=null,l('"::"')),null!==r&&null!==(o=fe())?(58===t.charCodeAt(i)?(a=":",i++):(a=null,l('":"')),null!==a&&null!==(s=fe())?(58===t.charCodeAt(i)?(u=":",i++):(u=null,l('":"')),null!==u&&null!==(c=fe())?(58===t.charCodeAt(i)?(d=":",i++):(d=null,l('":"')),null!==d&&null!==(f=pe())?e=[e,n,r,o,a,s,u,c,d,f]:(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v),null===e&&(v=i,null!==(e=fe())?(g=i,58===t.charCodeAt(i)?(n=":",i++):(n=null,l('":"')),null!==n&&null!==(r=fe())?n=[n,r]:(n=null,i=g),null!==(n=null!==n?n:"")?(g=i,58===t.charCodeAt(i)?(r=":",i++):(r=null,l('":"')),null!==r&&null!==(o=fe())?r=[r,o]:(r=null,i=g),null!==(r=null!==r?r:"")?("::"===t.substr(i,2)?(o="::",i+=2):(o=null,l('"::"')),null!==o&&null!==(a=fe())?(58===t.charCodeAt(i)?(s=":",i++):(s=null,l('":"')),null!==s&&null!==(u=fe())?(58===t.charCodeAt(i)?(c=":",i++):(c=null,l('":"')),null!==c&&null!==(d=pe())?e=[e,n,r,o,a,s,u,c,d]:(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v),null===e&&(v=i,null!==(e=fe())?(g=i,58===t.charCodeAt(i)?(n=":",i++):(n=null,l('":"')),null!==n&&null!==(r=fe())?n=[n,r]:(n=null,i=g),null!==(n=null!==n?n:"")?(g=i,58===t.charCodeAt(i)?(r=":",i++):(r=null,l('":"')),null!==r&&null!==(o=fe())?r=[r,o]:(r=null,i=g),null!==(r=null!==r?r:"")?(g=i,58===t.charCodeAt(i)?(o=":",i++):(o=null,l('":"')),null!==o&&null!==(a=fe())?o=[o,a]:(o=null,i=g),null!==(o=null!==o?o:"")?("::"===t.substr(i,2)?(a="::",i+=2):(a=null,l('"::"')),null!==a&&null!==(s=fe())?(58===t.charCodeAt(i)?(u=":",i++):(u=null,l('":"')),null!==u&&null!==(c=pe())?e=[e,n,r,o,a,s,u,c]:(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v),null===e&&(v=i,null!==(e=fe())?(g=i,58===t.charCodeAt(i)?(n=":",i++):(n=null,l('":"')),null!==n&&null!==(r=fe())?n=[n,r]:(n=null,i=g),null!==(n=null!==n?n:"")?(g=i,58===t.charCodeAt(i)?(r=":",i++):(r=null,l('":"')),null!==r&&null!==(o=fe())?r=[r,o]:(r=null,i=g),null!==(r=null!==r?r:"")?(g=i,58===t.charCodeAt(i)?(o=":",i++):(o=null,l('":"')),null!==o&&null!==(a=fe())?o=[o,a]:(o=null,i=g),null!==(o=null!==o?o:"")?(g=i,58===t.charCodeAt(i)?(a=":",i++):(a=null,l('":"')),null!==a&&null!==(s=fe())?a=[a,s]:(a=null,i=g),null!==(a=null!==a?a:"")?("::"===t.substr(i,2)?(s="::",i+=2):(s=null,l('"::"')),null!==s&&null!==(u=pe())?e=[e,n,r,o,a,s,u]:(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v),null===e&&(v=i,null!==(e=fe())?(g=i,58===t.charCodeAt(i)?(n=":",i++):(n=null,l('":"')),null!==n&&null!==(r=fe())?n=[n,r]:(n=null,i=g),null!==(n=null!==n?n:"")?(g=i,58===t.charCodeAt(i)?(r=":",i++):(r=null,l('":"')),null!==r&&null!==(o=fe())?r=[r,o]:(r=null,i=g),null!==(r=null!==r?r:"")?(g=i,58===t.charCodeAt(i)?(o=":",i++):(o=null,l('":"')),null!==o&&null!==(a=fe())?o=[o,a]:(o=null,i=g),null!==(o=null!==o?o:"")?(g=i,58===t.charCodeAt(i)?(a=":",i++):(a=null,l('":"')),null!==a&&null!==(s=fe())?a=[a,s]:(a=null,i=g),null!==(a=null!==a?a:"")?(g=i,58===t.charCodeAt(i)?(s=":",i++):(s=null,l('":"')),null!==s&&null!==(u=fe())?s=[s,u]:(s=null,i=g),null!==(s=null!==s?s:"")?("::"===t.substr(i,2)?(u="::",i+=2):(u=null,l('"::"')),null!==u&&null!==(c=fe())?e=[e,n,r,o,a,s,u,c]:(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v),null===e&&(v=i,null!==(e=fe())?(g=i,58===t.charCodeAt(i)?(n=":",i++):(n=null,l('":"')),null!==n&&null!==(r=fe())?n=[n,r]:(n=null,i=g),null!==(n=null!==n?n:"")?(g=i,58===t.charCodeAt(i)?(r=":",i++):(r=null,l('":"')),null!==r&&null!==(o=fe())?r=[r,o]:(r=null,i=g),null!==(r=null!==r?r:"")?(g=i,58===t.charCodeAt(i)?(o=":",i++):(o=null,l('":"')),null!==o&&null!==(a=fe())?o=[o,a]:(o=null,i=g),null!==(o=null!==o?o:"")?(g=i,58===t.charCodeAt(i)?(a=":",i++):(a=null,l('":"')),null!==a&&null!==(s=fe())?a=[a,s]:(a=null,i=g),null!==(a=null!==a?a:"")?(g=i,58===t.charCodeAt(i)?(s=":",i++):(s=null,l('":"')),null!==s&&null!==(u=fe())?s=[s,u]:(s=null,i=g),null!==(s=null!==s?s:"")?(g=i,58===t.charCodeAt(i)?(u=":",i++):(u=null,l('":"')),null!==u&&null!==(c=fe())?u=[u,c]:(u=null,i=g),null!==(u=null!==u?u:"")?("::"===t.substr(i,2)?(c="::",i+=2):(c=null,l('"::"')),null!==c?e=[e,n,r,o,a,s,u,c]:(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v)):(e=null,i=v))))))))))))))),null!==e&&(e=function(e){return qn.host_type="IPv6",t.substring(i,e)}(_)),null===e&&(i=_),e}function fe(){var e,t,n,r,o;return o=i,null!==(e=f())&&null!==(t=null!==(t=f())?t:"")&&null!==(n=null!==(n=f())?n:"")&&null!==(r=null!==(r=f())?r:"")?e=[e,t,n,r]:(e=null,i=o),e}function pe(){var e,n,r,o;return o=i,null!==(e=fe())?(58===t.charCodeAt(i)?(n=":",i++):(n=null,l('":"')),null!==n&&null!==(r=fe())?e=[e,n,r]:(e=null,i=o)):(e=null,i=o),null===e&&(e=he()),e}function he(){var e,n,r,o,a,s,u,c,d;return c=i,d=i,null!==(e=me())?(46===t.charCodeAt(i)?(n=".",i++):(n=null,l('"."')),null!==n&&null!==(r=me())?(46===t.charCodeAt(i)?(o=".",i++):(o=null,l('"."')),null!==o&&null!==(a=me())?(46===t.charCodeAt(i)?(s=".",i++):(s=null,l('"."')),null!==s&&null!==(u=me())?e=[e,n,r,o,a,s,u]:(e=null,i=d)):(e=null,i=d)):(e=null,i=d)):(e=null,i=d),null!==e&&(e=function(e){return qn.host_type="IPv4",t.substring(i,e)}(c)),null===e&&(i=c),e}function me(){var e,n,r,o;return o=i,"25"===t.substr(i,2)?(e="25",i+=2):(e=null,l('"25"')),null!==e?(/^[0-5]/.test(t.charAt(i))?(n=t.charAt(i),i++):(n=null,l("[0-5]")),null!==n?e=[e,n]:(e=null,i=o)):(e=null,i=o),null===e&&(o=i,50===t.charCodeAt(i)?(e="2",i++):(e=null,l('"2"')),null!==e?(/^[0-4]/.test(t.charAt(i))?(n=t.charAt(i),i++):(n=null,l("[0-4]")),null!==n&&null!==(r=c())?e=[e,n,r]:(e=null,i=o)):(e=null,i=o),null===e&&(o=i,49===t.charCodeAt(i)?(e="1",i++):(e=null,l('"1"')),null!==e&&null!==(n=c())&&null!==(r=c())?e=[e,n,r]:(e=null,i=o),null===e&&(o=i,/^[1-9]/.test(t.charAt(i))?(e=t.charAt(i),i++):(e=null,l("[1-9]")),null!==e&&null!==(n=c())?e=[e,n]:(e=null,i=o),null===e&&(e=c())))),e}function _e(){var e,t,n,r,o,a,s,l;return a=i,s=i,null!==(e=null!==(e=c())?e:"")&&null!==(t=null!==(t=c())?t:"")&&null!==(n=null!==(n=c())?n:"")&&null!==(r=null!==(r=c())?r:"")&&null!==(o=null!==(o=c())?o:"")?e=[e,t,n,r,o]:(e=null,i=s),null!==e&&(l=e,l=parseInt(l.join("")),qn.port=l,e=l),null===e&&(i=a),e}function ve(){var e,n,r,o;for(e=[],o=i,59===t.charCodeAt(i)?(n=";",i++):(n=null,l('";"')),null!==n&&null!==(r=ge())?n=[n,r]:(n=null,i=o);null!==n;)e.push(n),o=i,59===t.charCodeAt(i)?(n=";",i++):(n=null,l('";"')),null!==n&&null!==(r=ge())?n=[n,r]:(n=null,i=o);return e}function ge(){var e;return null===(e=ye())&&null===(e=Se())&&null===(e=Te())&&null===(e=Ce())&&null===(e=Ee())&&null===(e=Re())&&(e=be()),e}function ye(){var e,n,r,o,a;return r=i,o=i,"transport="===t.substr(i,10).toLowerCase()?(e=t.substr(i,10),i+=10):(e=null,l('"transport="')),null!==e?("udp"===t.substr(i,3).toLowerCase()?(n=t.substr(i,3),i+=3):(n=null,l('"udp"')),null===n&&("tcp"===t.substr(i,3).toLowerCase()?(n=t.substr(i,3),i+=3):(n=null,l('"tcp"')),null===n&&("sctp"===t.substr(i,4).toLowerCase()?(n=t.substr(i,4),i+=4):(n=null,l('"sctp"')),null===n&&("tls"===t.substr(i,3).toLowerCase()?(n=t.substr(i,3),i+=3):(n=null,l('"tls"')),null===n&&(n=P())))),null!==n?e=[e,n]:(e=null,i=o)):(e=null,i=o),null!==e&&(a=e[1],qn.uri_params||(qn.uri_params={}),e=void(qn.uri_params.transport=a.toLowerCase())),null===e&&(i=r),e}function Se(){var e,n,r,o,a;return r=i,o=i,"user="===t.substr(i,5).toLowerCase()?(e=t.substr(i,5),i+=5):(e=null,l('"user="')),null!==e?("phone"===t.substr(i,5).toLowerCase()?(n=t.substr(i,5),i+=5):(n=null,l('"phone"')),null===n&&("ip"===t.substr(i,2).toLowerCase()?(n=t.substr(i,2),i+=2):(n=null,l('"ip"')),null===n&&(n=P())),null!==n?e=[e,n]:(e=null,i=o)):(e=null,i=o),null!==e&&(a=e[1],qn.uri_params||(qn.uri_params={}),e=void(qn.uri_params.user=a.toLowerCase())),null===e&&(i=r),e}function Te(){var e,n,r,o,a;return r=i,o=i,"method="===t.substr(i,7).toLowerCase()?(e=t.substr(i,7),i+=7):(e=null,l('"method="')),null!==e&&null!==(n=ut())?e=[e,n]:(e=null,i=o),null!==e&&(a=e[1],qn.uri_params||(qn.uri_params={}),e=void(qn.uri_params.method=a)),null===e&&(i=r),e}function Ce(){var e,n,r,o,a;return r=i,o=i,"ttl="===t.substr(i,4).toLowerCase()?(e=t.substr(i,4),i+=4):(e=null,l('"ttl="')),null!==e&&null!==(n=Rn())?e=[e,n]:(e=null,i=o),null!==e&&(a=e[1],qn.params||(qn.params={}),e=void(qn.params.ttl=a)),null===e&&(i=r),e}function Ee(){var e,n,r,o,a;return r=i,o=i,"maddr="===t.substr(i,6).toLowerCase()?(e=t.substr(i,6),i+=6):(e=null,l('"maddr="')),null!==e&&null!==(n=ae())?e=[e,n]:(e=null,i=o),null!==e&&(a=e[1],qn.uri_params||(qn.uri_params={}),e=void(qn.uri_params.maddr=a)),null===e&&(i=r),e}function Re(){var e,n,r,o,a,s;return o=i,a=i,"lr"===t.substr(i,2).toLowerCase()?(e=t.substr(i,2),i+=2):(e=null,l('"lr"')),null!==e?(s=i,61===t.charCodeAt(i)?(n="=",i++):(n=null,l('"="')),null!==n&&null!==(r=P())?n=[n,r]:(n=null,i=s),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,i=a)):(e=null,i=a),null!==e&&(qn.uri_params||(qn.uri_params={}),e=void(qn.uri_params.lr=void 0)),null===e&&(i=o),e}function be(){var e,n,r,o,a,s,u,c;return o=i,a=i,null!==(e=Ae())?(s=i,61===t.charCodeAt(i)?(n="=",i++):(n=null,l('"="')),null!==n&&null!==(r=Ie())?n=[n,r]:(n=null,i=s),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,i=a)):(e=null,i=a),null!==e&&(u=e[0],c=e[1],qn.uri_params||(qn.uri_params={}),c=void 0===c?void 0:c[1],e=void(qn.uri_params[u.toLowerCase()]=c)),null===e&&(i=o),e}function Ae(){var e,t,n;if(n=i,null!==(t=we()))for(e=[];null!==t;)e.push(t),t=we();else e=null;return null!==e&&(e=e.join("")),null===e&&(i=n),e}function Ie(){var e,t,n;if(n=i,null!==(t=we()))for(e=[];null!==t;)e.push(t),t=we();else e=null;return null!==e&&(e=e.join("")),null===e&&(i=n),e}function we(){var e;return null===(e=Oe())&&null===(e=S())&&(e=C()),e}function Oe(){var e;return 91===t.charCodeAt(i)?(e="[",i++):(e=null,l('"["')),null===e&&(93===t.charCodeAt(i)?(e="]",i++):(e=null,l('"]"')),null===e&&(47===t.charCodeAt(i)?(e="/",i++):(e=null,l('"/"')),null===e&&(58===t.charCodeAt(i)?(e=":",i++):(e=null,l('":"')),null===e&&(38===t.charCodeAt(i)?(e="&",i++):(e=null,l('"&"')),null===e&&(43===t.charCodeAt(i)?(e="+",i++):(e=null,l('"+"')),null===e&&(36===t.charCodeAt(i)?(e="$",i++):(e=null,l('"$"')))))))),e}function Pe(){var e,n,r,o,a,s,u;if(s=i,63===t.charCodeAt(i)?(e="?",i++):(e=null,l('"?"')),null!==e)if(null!==(n=Ne())){for(r=[],u=i,38===t.charCodeAt(i)?(o="&",i++):(o=null,l('"&"')),null!==o&&null!==(a=Ne())?o=[o,a]:(o=null,i=u);null!==o;)r.push(o),u=i,38===t.charCodeAt(i)?(o="&",i++):(o=null,l('"&"')),null!==o&&null!==(a=Ne())?o=[o,a]:(o=null,i=u);null!==r?e=[e,n,r]:(e=null,i=s)}else e=null,i=s;else e=null,i=s;return e}function Ne(){var e,n,r,o,a,s,u;return o=i,a=i,null!==(e=De())?(61===t.charCodeAt(i)?(n="=",i++):(n=null,l('"="')),null!==n&&null!==(r=Me())?e=[e,n,r]:(e=null,i=a)):(e=null,i=a),null!==e&&(s=e[0],u=e[2],s=s.join("").toLowerCase(),u=u.join(""),qn.uri_headers||(qn.uri_headers={}),e=void(qn.uri_headers[s]?qn.uri_headers[s].push(u):qn.uri_headers[s]=[u])),null===e&&(i=o),e}function De(){var e,t;if(null===(t=ke())&&null===(t=S())&&(t=C()),null!==t)for(e=[];null!==t;)e.push(t),null===(t=ke())&&null===(t=S())&&(t=C());else e=null;return e}function Me(){var e,t;for(e=[],null===(t=ke())&&null===(t=S())&&(t=C());null!==t;)e.push(t),null===(t=ke())&&null===(t=S())&&(t=C());return e}function ke(){var e;return 91===t.charCodeAt(i)?(e="[",i++):(e=null,l('"["')),null===e&&(93===t.charCodeAt(i)?(e="]",i++):(e=null,l('"]"')),null===e&&(47===t.charCodeAt(i)?(e="/",i++):(e=null,l('"/"')),null===e&&(63===t.charCodeAt(i)?(e="?",i++):(e=null,l('"?"')),null===e&&(58===t.charCodeAt(i)?(e=":",i++):(e=null,l('":"')),null===e&&(43===t.charCodeAt(i)?(e="+",i++):(e=null,l('"+"')),null===e&&(36===t.charCodeAt(i)?(e="$",i++):(e=null,l('"$"')))))))),e}function xe(){var e,t,n,r,o,a;return a=i,null!==(e=ut())&&null!==(t=_())&&null!==(n=Le())&&null!==(r=_())&&null!==(o=Ze())?e=[e,t,n,r,o]:(e=null,i=a),e}function Le(){var e;return null===(e=$())&&(e=Ue()),e}function Ue(){var e,n,r,o;return o=i,null!==(e=Ye())?(58===t.charCodeAt(i)?(n=":",i++):(n=null,l('":"')),null!==n?(null===(r=Fe())&&(r=je()),null!==r?e=[e,n,r]:(e=null,i=o)):(e=null,i=o)):(e=null,i=o),e}function Fe(){var e,n,r,o,a;return o=i,null===(e=He())&&(e=qe()),null!==e?(a=i,63===t.charCodeAt(i)?(n="?",i++):(n=null,l('"?"')),null!==n&&null!==(r=Qe())?n=[n,r]:(n=null,i=a),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,i=o)):(e=null,i=o),e}function He(){var e,n,r,o;return o=i,"//"===t.substr(i,2)?(e="//",i+=2):(e=null,l('"//"')),null!==e&&null!==(n=ze())&&null!==(r=null!==(r=qe())?r:"")?e=[e,n,r]:(e=null,i=o),e}function qe(){var e,n,r;return r=i,47===t.charCodeAt(i)?(e="/",i++):(e=null,l('"/"')),null!==e&&null!==(n=Be())?e=[e,n]:(e=null,i=r),e}function je(){var e,t,n,r;if(r=i,null!==(e=Ge())){for(t=[],n=Ve();null!==n;)t.push(n),n=Ve();null!==t?e=[e,t]:(e=null,i=r)}else e=null,i=r;return e}function Ve(){var e;return null===(e=y())&&null===(e=S())&&(e=C()),e}function Ge(){var e;return null===(e=S())&&null===(e=C())&&(59===t.charCodeAt(i)?(e=";",i++):(e=null,l('";"')),null===e&&(63===t.charCodeAt(i)?(e="?",i++):(e=null,l('"?"')),null===e&&(58===t.charCodeAt(i)?(e=":",i++):(e=null,l('":"')),null===e&&(64===t.charCodeAt(i)?(e="@",i++):(e=null,l('"@"')),null===e&&(38===t.charCodeAt(i)?(e="&",i++):(e=null,l('"&"')),null===e&&(61===t.charCodeAt(i)?(e="=",i++):(e=null,l('"="')),null===e&&(43===t.charCodeAt(i)?(e="+",i++):(e=null,l('"+"')),null===e&&(36===t.charCodeAt(i)?(e="$",i++):(e=null,l('"$"')),null===e&&(44===t.charCodeAt(i)?(e=",",i++):(e=null,l('","'))))))))))),e}function Be(){var e,n,r,o,a,s;if(a=i,null!==(e=We())){for(n=[],s=i,47===t.charCodeAt(i)?(r="/",i++):(r=null,l('"/"')),null!==r&&null!==(o=We())?r=[r,o]:(r=null,i=s);null!==r;)n.push(r),s=i,47===t.charCodeAt(i)?(r="/",i++):(r=null,l('"/"')),null!==r&&null!==(o=We())?r=[r,o]:(r=null,i=s);null!==n?e=[e,n]:(e=null,i=a)}else e=null,i=a;return e}function We(){var e,n,r,o,a,s;for(a=i,e=[],n=Je();null!==n;)e.push(n),n=Je();if(null!==e){for(n=[],s=i,59===t.charCodeAt(i)?(r=";",i++):(r=null,l('";"')),null!==r&&null!==(o=Ke())?r=[r,o]:(r=null,i=s);null!==r;)n.push(r),s=i,59===t.charCodeAt(i)?(r=";",i++):(r=null,l('";"')),null!==r&&null!==(o=Ke())?r=[r,o]:(r=null,i=s);null!==n?e=[e,n]:(e=null,i=a)}else e=null,i=a;return e}function Ke(){var e,t;for(e=[],t=Je();null!==t;)e.push(t),t=Je();return e}function Je(){var e;return null===(e=S())&&null===(e=C())&&(58===t.charCodeAt(i)?(e=":",i++):(e=null,l('":"')),null===e&&(64===t.charCodeAt(i)?(e="@",i++):(e=null,l('"@"')),null===e&&(38===t.charCodeAt(i)?(e="&",i++):(e=null,l('"&"')),null===e&&(61===t.charCodeAt(i)?(e="=",i++):(e=null,l('"="')),null===e&&(43===t.charCodeAt(i)?(e="+",i++):(e=null,l('"+"')),null===e&&(36===t.charCodeAt(i)?(e="$",i++):(e=null,l('"$"')),null===e&&(44===t.charCodeAt(i)?(e=",",i++):(e=null,l('","'))))))))),e}function Ye(){var e,n,r,o,a;if(o=i,a=i,null!==(e=d())){for(n=[],null===(r=d())&&null===(r=c())&&(43===t.charCodeAt(i)?(r="+",i++):(r=null,l('"+"')),null===r&&(45===t.charCodeAt(i)?(r="-",i++):(r=null,l('"-"')),null===r&&(46===t.charCodeAt(i)?(r=".",i++):(r=null,l('"."')))));null!==r;)n.push(r),null===(r=d())&&null===(r=c())&&(43===t.charCodeAt(i)?(r="+",i++):(r=null,l('"+"')),null===r&&(45===t.charCodeAt(i)?(r="-",i++):(r=null,l('"-"')),null===r&&(46===t.charCodeAt(i)?(r=".",i++):(r=null,l('"."')))));null!==n?e=[e,n]:(e=null,i=a)}else e=null,i=a;return null!==e&&(e=function(e){qn.scheme=t.substring(i,e)}(o)),null===e&&(i=o),e}function ze(){var e;return null===(e=Xe())&&(e=$e()),e}function Xe(){var e,n,r,o;return r=i,o=i,null!==(e=te())?(64===t.charCodeAt(i)?(n="@",i++):(n=null,l('"@"')),null!==n?e=[e,n]:(e=null,i=o)):(e=null,i=o),null!==(e=null!==e?e:"")&&null!==(n=ie())?e=[e,n]:(e=null,i=r),e=null!==e?e:""}function $e(){var e,n;if(null===(n=S())&&null===(n=C())&&(36===t.charCodeAt(i)?(n="$",i++):(n=null,l('"$"')),null===n&&(44===t.charCodeAt(i)?(n=",",i++):(n=null,l('","')),null===n&&(59===t.charCodeAt(i)?(n=";",i++):(n=null,l('";"')),null===n&&(58===t.charCodeAt(i)?(n=":",i++):(n=null,l('":"')),null===n&&(64===t.charCodeAt(i)?(n="@",i++):(n=null,l('"@"')),null===n&&(38===t.charCodeAt(i)?(n="&",i++):(n=null,l('"&"')),null===n&&(61===t.charCodeAt(i)?(n="=",i++):(n=null,l('"="')),null===n&&(43===t.charCodeAt(i)?(n="+",i++):(n=null,l('"+"')))))))))),null!==n)for(e=[];null!==n;)e.push(n),null===(n=S())&&null===(n=C())&&(36===t.charCodeAt(i)?(n="$",i++):(n=null,l('"$"')),null===n&&(44===t.charCodeAt(i)?(n=",",i++):(n=null,l('","')),null===n&&(59===t.charCodeAt(i)?(n=";",i++):(n=null,l('";"')),null===n&&(58===t.charCodeAt(i)?(n=":",i++):(n=null,l('":"')),null===n&&(64===t.charCodeAt(i)?(n="@",i++):(n=null,l('"@"')),null===n&&(38===t.charCodeAt(i)?(n="&",i++):(n=null,l('"&"')),null===n&&(61===t.charCodeAt(i)?(n="=",i++):(n=null,l('"="')),null===n&&(43===t.charCodeAt(i)?(n="+",i++):(n=null,l('"+"'))))))))));else e=null;return e}function Qe(){var e,t;for(e=[],t=Ve();null!==t;)e.push(t),t=Ve();return e}function Ze(){var e,n,r,o,a,s,u,d;if(u=i,d=i,"sip"===t.substr(i,3).toLowerCase()?(e=t.substr(i,3),i+=3):(e=null,l('"SIP"')),null!==e)if(47===t.charCodeAt(i)?(n="/",i++):(n=null,l('"/"')),null!==n){if(null!==(o=c()))for(r=[];null!==o;)r.push(o),o=c();else r=null;if(null!==r)if(46===t.charCodeAt(i)?(o=".",i++):(o=null,l('"."')),null!==o){if(null!==(s=c()))for(a=[];null!==s;)a.push(s),s=c();else a=null;null!==a?e=[e,n,r,o,a]:(e=null,i=d)}else e=null,i=d;else e=null,i=d}else e=null,i=d;else e=null,i=d;return null!==e&&(e=function(e){qn.sip_version=t.substring(i,e)}(u)),null===e&&(i=u),e}function et(){var e;return"INVITE"===t.substr(i,6)?(e="INVITE",i+=6):(e=null,l('"INVITE"')),e}function tt(){var e;return"ACK"===t.substr(i,3)?(e="ACK",i+=3):(e=null,l('"ACK"')),e}function nt(){var e;return"OPTIONS"===t.substr(i,7)?(e="OPTIONS",i+=7):(e=null,l('"OPTIONS"')),e}function rt(){var e;return"BYE"===t.substr(i,3)?(e="BYE",i+=3):(e=null,l('"BYE"')),e}function ot(){var e;return"CANCEL"===t.substr(i,6)?(e="CANCEL",i+=6):(e=null,l('"CANCEL"')),e}function it(){var e;return"REGISTER"===t.substr(i,8)?(e="REGISTER",i+=8):(e=null,l('"REGISTER"')),e}function at(){var e;return"SUBSCRIBE"===t.substr(i,9)?(e="SUBSCRIBE",i+=9):(e=null,l('"SUBSCRIBE"')),e}function st(){var e;return"NOTIFY"===t.substr(i,6)?(e="NOTIFY",i+=6):(e=null,l('"NOTIFY"')),e}function lt(){var e;return"REFER"===t.substr(i,5)?(e="REFER",i+=5):(e=null,l('"REFER"')),e}function ut(){var e,n;return n=i,null===(e=et())&&null===(e=tt())&&null===(e=nt())&&null===(e=rt())&&null===(e=ot())&&null===(e=it())&&null===(e=at())&&null===(e=st())&&null===(e=lt())&&(e=P()),null!==e&&(e=function(e){return qn.method=t.substring(i,e),qn.method}(n)),null===e&&(i=n),e}function ct(){var e,t,n,r,o,a;return a=i,null!==(e=Ze())&&null!==(t=_())&&null!==(n=dt())&&null!==(r=_())&&null!==(o=pt())?e=[e,t,n,r,o]:(e=null,i=a),e}function dt(){var e,t,n;return t=i,null!==(e=ft())&&(n=e,e=void(qn.status_code=parseInt(n.join("")))),null===e&&(i=t),e}function ft(){var e,t,n,r;return r=i,null!==(e=c())&&null!==(t=c())&&null!==(n=c())?e=[e,t,n]:(e=null,i=r),e}function pt(){var e,n,r;for(r=i,e=[],null===(n=y())&&null===(n=S())&&null===(n=C())&&null===(n=w())&&null===(n=O())&&null===(n=_())&&(n=v());null!==n;)e.push(n),null===(n=y())&&null===(n=S())&&null===(n=C())&&null===(n=w())&&null===(n=O())&&null===(n=_())&&(n=v());return null!==e&&(e=function(e){qn.reason_phrase=t.substring(i,e)}(r)),null===e&&(i=r),e}function ht(){var e,t,n,r,o,a,s;if(o=i,a=i,null===(e=X())&&(e=mt()),null!==e){for(t=[],s=i,null!==(n=j())&&null!==(r=vt())?n=[n,r]:(n=null,i=s);null!==n;)t.push(n),s=i,null!==(n=j())&&null!==(r=vt())?n=[n,r]:(n=null,i=s);null!==t?e=[e,t]:(e=null,i=a)}else e=null,i=a;return null!==e&&(e=function(e){var t;qn.multi_header||(qn.multi_header=[]);try{t=new Hn(qn.uri,qn.display_name,qn.params),delete qn.uri,delete qn.display_name,delete qn.params}catch(e){t=null}qn.multi_header.push({possition:i,offset:e,parsed:t})}(o)),null===e&&(i=o),e}function mt(){var e,t,n,r,o;return o=i,null!==(e=null!==(e=_t())?e:"")&&null!==(t=H())&&null!==(n=$())&&null!==(r=F())?e=[e,t,n,r]:(e=null,i=o),e}function _t(){var e,t,n,r,o,a,s,l;if(o=i,a=i,null!==(e=P())){for(t=[],s=i,null!==(n=E())&&null!==(r=P())?n=[n,r]:(n=null,i=s);null!==n;)t.push(n),s=i,null!==(n=E())&&null!==(r=P())?n=[n,r]:(n=null,i=s);null!==t?e=[e,t]:(e=null,i=a)}else e=null,i=a;return null===e&&(e=J()),null!==e&&(l=e,e=void(qn.display_name="string"==typeof l?l:l[1].reduce((function(e,t){return e+t[0]+t[1]}),l[0]))),null===e&&(i=o),e}function vt(){var e;return null===(e=gt())&&null===(e=yt())&&(e=Ct()),e}function gt(){var e,n,r,o,a,s;return o=i,a=i,"q"===t.substr(i,1).toLowerCase()?(e=t.substr(i,1),i++):(e=null,l('"q"')),null!==e&&null!==(n=x())&&null!==(r=Tt())?e=[e,n,r]:(e=null,i=a),null!==e&&(s=e[2],qn.params||(qn.params={}),e=void(qn.params.q=s)),null===e&&(i=o),e}function yt(){var e,n,r,o,a,s;return o=i,a=i,"expires"===t.substr(i,7).toLowerCase()?(e=t.substr(i,7),i+=7):(e=null,l('"expires"')),null!==e&&null!==(n=x())&&null!==(r=St())?e=[e,n,r]:(e=null,i=a),null!==e&&(s=e[2],qn.params||(qn.params={}),e=void(qn.params.expires=s)),null===e&&(i=o),e}function St(){var e,t,n;if(n=i,null!==(t=c()))for(e=[];null!==t;)e.push(t),t=c();else e=null;return null!==e&&(e=parseInt(e.join(""))),null===e&&(i=n),e}function Tt(){var e,n,r,o,a,s,u,d;return s=i,u=i,48===t.charCodeAt(i)?(e="0",i++):(e=null,l('"0"')),null!==e?(d=i,46===t.charCodeAt(i)?(n=".",i++):(n=null,l('"."')),null!==n&&null!==(r=null!==(r=c())?r:"")&&null!==(o=null!==(o=c())?o:"")&&null!==(a=null!==(a=c())?a:"")?n=[n,r,o,a]:(n=null,i=d),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,i=u)):(e=null,i=u),null!==e&&(e=function(e){return parseFloat(t.substring(i,e))}(s)),null===e&&(i=s),e}function Ct(){var e,t,n,r,o,a,s,l;return r=i,o=i,null!==(e=P())?(a=i,null!==(t=x())&&null!==(n=Et())?t=[t,n]:(t=null,i=a),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,i=o)):(e=null,i=o),null!==e&&(s=e[0],l=e[1],qn.params||(qn.params={}),l=void 0===l?void 0:l[1],e=void(qn.params[s.toLowerCase()]=l)),null===e&&(i=r),e}function Et(){var e;return null===(e=P())&&null===(e=ae())&&(e=K()),e}function Rt(){var e;return"render"===t.substr(i,6).toLowerCase()?(e=t.substr(i,6),i+=6):(e=null,l('"render"')),null===e&&("session"===t.substr(i,7).toLowerCase()?(e=t.substr(i,7),i+=7):(e=null,l('"session"')),null===e&&("icon"===t.substr(i,4).toLowerCase()?(e=t.substr(i,4),i+=4):(e=null,l('"icon"')),null===e&&("alert"===t.substr(i,5).toLowerCase()?(e=t.substr(i,5),i+=5):(e=null,l('"alert"')),null===e&&(e=P())))),e}function bt(){var e;return null===(e=At())&&(e=Ct()),e}function At(){var e,n,r,o;return o=i,"handling"===t.substr(i,8).toLowerCase()?(e=t.substr(i,8),i+=8):(e=null,l('"handling"')),null!==e&&null!==(n=x())?("optional"===t.substr(i,8).toLowerCase()?(r=t.substr(i,8),i+=8):(r=null,l('"optional"')),null===r&&("required"===t.substr(i,8).toLowerCase()?(r=t.substr(i,8),i+=8):(r=null,l('"required"')),null===r&&(r=P())),null!==r?e=[e,n,r]:(e=null,i=o)):(e=null,i=o),e}function It(){var e,t,n,r,o,a,s,l;if(s=i,null!==(e=wt()))if(null!==(t=k()))if(null!==(n=Mt())){for(r=[],l=i,null!==(o=j())&&null!==(a=kt())?o=[o,a]:(o=null,i=l);null!==o;)r.push(o),l=i,null!==(o=j())&&null!==(a=kt())?o=[o,a]:(o=null,i=l);null!==r?e=[e,t,n,r]:(e=null,i=s)}else e=null,i=s;else e=null,i=s;else e=null,i=s;return e}function wt(){var e;return null===(e=Ot())&&(e=Pt()),e}function Ot(){var e;return"text"===t.substr(i,4).toLowerCase()?(e=t.substr(i,4),i+=4):(e=null,l('"text"')),null===e&&("image"===t.substr(i,5).toLowerCase()?(e=t.substr(i,5),i+=5):(e=null,l('"image"')),null===e&&("audio"===t.substr(i,5).toLowerCase()?(e=t.substr(i,5),i+=5):(e=null,l('"audio"')),null===e&&("video"===t.substr(i,5).toLowerCase()?(e=t.substr(i,5),i+=5):(e=null,l('"video"')),null===e&&("application"===t.substr(i,11).toLowerCase()?(e=t.substr(i,11),i+=11):(e=null,l('"application"')),null===e&&(e=Nt()))))),e}function Pt(){var e;return"message"===t.substr(i,7).toLowerCase()?(e=t.substr(i,7),i+=7):(e=null,l('"message"')),null===e&&("multipart"===t.substr(i,9).toLowerCase()?(e=t.substr(i,9),i+=9):(e=null,l('"multipart"')),null===e&&(e=Nt())),e}function Nt(){var e;return null===(e=P())&&(e=Dt()),e}function Dt(){var e,n,r;return r=i,"x-"===t.substr(i,2).toLowerCase()?(e=t.substr(i,2),i+=2):(e=null,l('"x-"')),null!==e&&null!==(n=P())?e=[e,n]:(e=null,i=r),e}function Mt(){var e;return null===(e=Nt())&&(e=P()),e}function kt(){var e,t,n,r;return r=i,null!==(e=P())&&null!==(t=x())&&null!==(n=xt())?e=[e,t,n]:(e=null,i=r),e}function xt(){var e;return null===(e=P())&&(e=K()),e}function Lt(){var e,t,n,r;if(n=i,null!==(t=c()))for(e=[];null!==t;)e.push(t),t=c();else e=null;return null!==e&&(r=e,e=void(qn.value=parseInt(r.join("")))),null===e&&(i=n),e}function Ut(){var e,n,r,o,a,s;if(a=i,null!==(e=N())){for(n=[],s=i,46===t.charCodeAt(i)?(r=".",i++):(r=null,l('"."')),null!==r&&null!==(o=N())?r=[r,o]:(r=null,i=s);null!==r;)n.push(r),s=i,46===t.charCodeAt(i)?(r=".",i++):(r=null,l('"."')),null!==r&&null!==(o=N())?r=[r,o]:(r=null,i=s);null!==n?e=[e,n]:(e=null,i=a)}else e=null,i=a;return e}function Ft(){var e;return null===(e=Ht())&&(e=Ct()),e}function Ht(){var e,n,r,o,a,s;return o=i,a=i,"tag"===t.substr(i,3).toLowerCase()?(e=t.substr(i,3),i+=3):(e=null,l('"tag"')),null!==e&&null!==(n=x())&&null!==(r=P())?e=[e,n,r]:(e=null,i=a),null!==e&&(s=e[2],e=void(qn.tag=s)),null===e&&(i=o),e}function qt(){var e,n,r,o,a,s,u,c;if(u=i,"digest"===t.substr(i,6).toLowerCase()?(e=t.substr(i,6),i+=6):(e=null,l('"Digest"')),null!==e)if(null!==(n=E()))if(null!==(r=Gt())){for(o=[],c=i,null!==(a=q())&&null!==(s=Gt())?a=[a,s]:(a=null,i=c);null!==a;)o.push(a),c=i,null!==(a=q())&&null!==(s=Gt())?a=[a,s]:(a=null,i=c);null!==o?e=[e,n,r,o]:(e=null,i=u)}else e=null,i=u;else e=null,i=u;else e=null,i=u;return null===e&&(e=jt()),e}function jt(){var e,t,n,r,o,a,s,l;if(s=i,null!==(e=P()))if(null!==(t=E()))if(null!==(n=Vt())){for(r=[],l=i,null!==(o=q())&&null!==(a=Vt())?o=[o,a]:(o=null,i=l);null!==o;)r.push(o),l=i,null!==(o=q())&&null!==(a=Vt())?o=[o,a]:(o=null,i=l);null!==r?e=[e,t,n,r]:(e=null,i=s)}else e=null,i=s;else e=null,i=s;else e=null,i=s;return e}function Vt(){var e,t,n,r;return r=i,null!==(e=P())&&null!==(t=x())?(null===(n=P())&&(n=K()),null!==n?e=[e,t,n]:(e=null,i=r)):(e=null,i=r),e}function Gt(){var e;return null===(e=Bt())&&null===(e=Kt())&&null===(e=Yt())&&null===(e=Xt())&&null===(e=$t())&&null===(e=Qt())&&null===(e=Zt())&&(e=Vt()),e}function Bt(){var e,n,r,o;return o=i,"realm"===t.substr(i,5).toLowerCase()?(e=t.substr(i,5),i+=5):(e=null,l('"realm"')),null!==e&&null!==(n=x())&&null!==(r=Wt())?e=[e,n,r]:(e=null,i=o),e}function Wt(){var e,t,n;return t=i,null!==(e=J())&&(n=e,e=void(qn.realm=n)),null===e&&(i=t),e}function Kt(){var e,n,r,o,a,s,u,c,d;if(c=i,"domain"===t.substr(i,6).toLowerCase()?(e=t.substr(i,6),i+=6):(e=null,l('"domain"')),null!==e)if(null!==(n=x()))if(null!==(r=G()))if(null!==(o=Jt())){if(a=[],d=i,null!==(u=_()))for(s=[];null!==u;)s.push(u),u=_();else s=null;for(null!==s&&null!==(u=Jt())?s=[s,u]:(s=null,i=d);null!==s;){if(a.push(s),d=i,null!==(u=_()))for(s=[];null!==u;)s.push(u),u=_();else s=null;null!==s&&null!==(u=Jt())?s=[s,u]:(s=null,i=d)}null!==a&&null!==(s=B())?e=[e,n,r,o,a,s]:(e=null,i=c)}else e=null,i=c;else e=null,i=c;else e=null,i=c;else e=null,i=c;return e}function Jt(){var e;return null===(e=Ue())&&(e=qe()),e}function Yt(){var e,n,r,o;return o=i,"nonce"===t.substr(i,5).toLowerCase()?(e=t.substr(i,5),i+=5):(e=null,l('"nonce"')),null!==e&&null!==(n=x())&&null!==(r=zt())?e=[e,n,r]:(e=null,i=o),e}function zt(){var e,t,n;return t=i,null!==(e=J())&&(n=e,e=void(qn.nonce=n)),null===e&&(i=t),e}function Xt(){var e,n,r,o,a,s;return o=i,a=i,"opaque"===t.substr(i,6).toLowerCase()?(e=t.substr(i,6),i+=6):(e=null,l('"opaque"')),null!==e&&null!==(n=x())&&null!==(r=J())?e=[e,n,r]:(e=null,i=a),null!==e&&(s=e[2],e=void(qn.opaque=s)),null===e&&(i=o),e}function $t(){var e,n,r,o,a;return o=i,"stale"===t.substr(i,5).toLowerCase()?(e=t.substr(i,5),i+=5):(e=null,l('"stale"')),null!==e&&null!==(n=x())?(a=i,"true"===t.substr(i,4).toLowerCase()?(r=t.substr(i,4),i+=4):(r=null,l('"true"')),null!==r&&(r=void(qn.stale=!0)),null===r&&(i=a),null===r&&(a=i,"false"===t.substr(i,5).toLowerCase()?(r=t.substr(i,5),i+=5):(r=null,l('"false"')),null!==r&&(r=void(qn.stale=!1)),null===r&&(i=a)),null!==r?e=[e,n,r]:(e=null,i=o)):(e=null,i=o),e}function Qt(){var e,n,r,o,a,s;return o=i,a=i,"algorithm"===t.substr(i,9).toLowerCase()?(e=t.substr(i,9),i+=9):(e=null,l('"algorithm"')),null!==e&&null!==(n=x())?("md5"===t.substr(i,3).toLowerCase()?(r=t.substr(i,3),i+=3):(r=null,l('"MD5"')),null===r&&("md5-sess"===t.substr(i,8).toLowerCase()?(r=t.substr(i,8),i+=8):(r=null,l('"MD5-sess"')),null===r&&(r=P())),null!==r?e=[e,n,r]:(e=null,i=a)):(e=null,i=a),null!==e&&(s=e[2],e=void(qn.algorithm=s.toUpperCase())),null===e&&(i=o),e}function Zt(){var e,n,r,o,a,s,u,c,d,f;if(c=i,"qop"===t.substr(i,3).toLowerCase()?(e=t.substr(i,3),i+=3):(e=null,l('"qop"')),null!==e)if(null!==(n=x()))if(null!==(r=G())){if(d=i,null!==(o=en())){for(a=[],f=i,44===t.charCodeAt(i)?(s=",",i++):(s=null,l('","')),null!==s&&null!==(u=en())?s=[s,u]:(s=null,i=f);null!==s;)a.push(s),f=i,44===t.charCodeAt(i)?(s=",",i++):(s=null,l('","')),null!==s&&null!==(u=en())?s=[s,u]:(s=null,i=f);null!==a?o=[o,a]:(o=null,i=d)}else o=null,i=d;null!==o&&null!==(a=B())?e=[e,n,r,o,a]:(e=null,i=c)}else e=null,i=c;else e=null,i=c;else e=null,i=c;return e}function en(){var e,n,r;return n=i,"auth-int"===t.substr(i,8).toLowerCase()?(e=t.substr(i,8),i+=8):(e=null,l('"auth-int"')),null===e&&("auth"===t.substr(i,4).toLowerCase()?(e=t.substr(i,4),i+=4):(e=null,l('"auth"')),null===e&&(e=P())),null!==e&&(r=e,qn.qop||(qn.qop=[]),e=void qn.qop.push(r.toLowerCase())),null===e&&(i=n),e}function tn(){var e,t,n,r,o,a,s;if(o=i,a=i,null!==(e=mt())){for(t=[],s=i,null!==(n=j())&&null!==(r=Ct())?n=[n,r]:(n=null,i=s);null!==n;)t.push(n),s=i,null!==(n=j())&&null!==(r=Ct())?n=[n,r]:(n=null,i=s);null!==t?e=[e,t]:(e=null,i=a)}else e=null,i=a;return null!==e&&(e=function(e){var t;qn.multi_header||(qn.multi_header=[]);try{t=new Hn(qn.uri,qn.display_name,qn.params),delete qn.uri,delete qn.display_name,delete qn.params}catch(e){t=null}qn.multi_header.push({possition:i,offset:e,parsed:t})}(o)),null===e&&(i=o),e}function nn(){var e;return null===(e=rn())&&(e=Ct()),e}function rn(){var e,n,r,o,a,s,u;if(a=i,s=i,"cause"===t.substr(i,5).toLowerCase()?(e=t.substr(i,5),i+=5):(e=null,l('"cause"')),null!==e)if(null!==(n=x())){if(null!==(o=c()))for(r=[];null!==o;)r.push(o),o=c();else r=null;null!==r?e=[e,n,r]:(e=null,i=s)}else e=null,i=s;else e=null,i=s;return null!==e&&(u=e[2],e=void(qn.cause=parseInt(u.join("")))),null===e&&(i=a),e}function on(){var e,t,n,r,o,a;if(o=i,null!==(e=mt())){for(t=[],a=i,null!==(n=j())&&null!==(r=Ct())?n=[n,r]:(n=null,i=a);null!==n;)t.push(n),a=i,null!==(n=j())&&null!==(r=Ct())?n=[n,r]:(n=null,i=a);null!==t?e=[e,t]:(e=null,i=o)}else e=null,i=o;return e}function an(){var e,n;return n=i,"active"===t.substr(i,6).toLowerCase()?(e=t.substr(i,6),i+=6):(e=null,l('"active"')),null===e&&("pending"===t.substr(i,7).toLowerCase()?(e=t.substr(i,7),i+=7):(e=null,l('"pending"')),null===e&&("terminated"===t.substr(i,10).toLowerCase()?(e=t.substr(i,10),i+=10):(e=null,l('"terminated"')),null===e&&(e=P()))),null!==e&&(e=function(e){qn.state=t.substring(i,e)}(n)),null===e&&(i=n),e}function sn(){var e,n,r,o,a,s,u,c;return o=i,a=i,"reason"===t.substr(i,6).toLowerCase()?(e=t.substr(i,6),i+=6):(e=null,l('"reason"')),null!==e&&null!==(n=x())&&null!==(r=ln())?e=[e,n,r]:(e=null,i=a),null!==e&&(e=void(void 0!==(s=e[2])&&(qn.reason=s))),null===e&&(i=o),null===e&&(o=i,a=i,"expires"===t.substr(i,7).toLowerCase()?(e=t.substr(i,7),i+=7):(e=null,l('"expires"')),null!==e&&null!==(n=x())&&null!==(r=St())?e=[e,n,r]:(e=null,i=a),null!==e&&(e=void(void 0!==(c=e[2])&&(qn.expires=c))),null===e&&(i=o),null===e&&(o=i,a=i,"retry_after"===t.substr(i,11).toLowerCase()?(e=t.substr(i,11),i+=11):(e=null,l('"retry_after"')),null!==e&&null!==(n=x())&&null!==(r=St())?e=[e,n,r]:(e=null,i=a),null!==e&&(e=void(void 0!==(u=e[2])&&(qn.retry_after=u))),null===e&&(i=o),null===e&&(e=Ct()))),e}function ln(){var e;return"deactivated"===t.substr(i,11).toLowerCase()?(e=t.substr(i,11),i+=11):(e=null,l('"deactivated"')),null===e&&("probation"===t.substr(i,9).toLowerCase()?(e=t.substr(i,9),i+=9):(e=null,l('"probation"')),null===e&&("rejected"===t.substr(i,8).toLowerCase()?(e=t.substr(i,8),i+=8):(e=null,l('"rejected"')),null===e&&("timeout"===t.substr(i,7).toLowerCase()?(e=t.substr(i,7),i+=7):(e=null,l('"timeout"')),null===e&&("giveup"===t.substr(i,6).toLowerCase()?(e=t.substr(i,6),i+=6):(e=null,l('"giveup"')),null===e&&("noresource"===t.substr(i,10).toLowerCase()?(e=t.substr(i,10),i+=10):(e=null,l('"noresource"')),null===e&&("invariant"===t.substr(i,9).toLowerCase()?(e=t.substr(i,9),i+=9):(e=null,l('"invariant"')),null===e&&(e=P()))))))),e}function un(){var e;return null===(e=Ht())&&(e=Ct()),e}function cn(){var e,t,n,r,o,a,s,l;if(s=i,null!==(e=gn()))if(null!==(t=E()))if(null!==(n=Tn())){for(r=[],l=i,null!==(o=j())&&null!==(a=dn())?o=[o,a]:(o=null,i=l);null!==o;)r.push(o),l=i,null!==(o=j())&&null!==(a=dn())?o=[o,a]:(o=null,i=l);null!==r?e=[e,t,n,r]:(e=null,i=s)}else e=null,i=s;else e=null,i=s;else e=null,i=s;return e}function dn(){var e;return null===(e=fn())&&null===(e=pn())&&null===(e=hn())&&null===(e=mn())&&null===(e=_n())&&(e=Ct()),e}function fn(){var e,n,r,o,a,s;return o=i,a=i,"ttl"===t.substr(i,3).toLowerCase()?(e=t.substr(i,3),i+=3):(e=null,l('"ttl"')),null!==e&&null!==(n=x())&&null!==(r=Rn())?e=[e,n,r]:(e=null,i=a),null!==e&&(s=e[2],e=void(qn.ttl=s)),null===e&&(i=o),e}function pn(){var e,n,r,o,a,s;return o=i,a=i,"maddr"===t.substr(i,5).toLowerCase()?(e=t.substr(i,5),i+=5):(e=null,l('"maddr"')),null!==e&&null!==(n=x())&&null!==(r=ae())?e=[e,n,r]:(e=null,i=a),null!==e&&(s=e[2],e=void(qn.maddr=s)),null===e&&(i=o),e}function hn(){var e,n,r,o,a,s;return o=i,a=i,"received"===t.substr(i,8).toLowerCase()?(e=t.substr(i,8),i+=8):(e=null,l('"received"')),null!==e&&null!==(n=x())?(null===(r=he())&&(r=de()),null!==r?e=[e,n,r]:(e=null,i=a)):(e=null,i=a),null!==e&&(s=e[2],e=void(qn.received=s)),null===e&&(i=o),e}function mn(){var e,n,r,o,a,s;return o=i,a=i,"branch"===t.substr(i,6).toLowerCase()?(e=t.substr(i,6),i+=6):(e=null,l('"branch"')),null!==e&&null!==(n=x())&&null!==(r=P())?e=[e,n,r]:(e=null,i=a),null!==e&&(s=e[2],e=void(qn.branch=s)),null===e&&(i=o),e}function _n(){var e,n,r,o,a;return o=i,"rport"===t.substr(i,5).toLowerCase()?(e=t.substr(i,5),i+=5):(e=null,l('"rport"')),null!==e?(a=i,null!==(n=x())&&null!==(r=vn())?n=[n,r]:(n=null,i=a),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,i=o)):(e=null,i=o),e}function vn(){var e,t,n,r,o,a,s,l;return a=i,s=i,null!==(e=null!==(e=c())?e:"")&&null!==(t=null!==(t=c())?t:"")&&null!==(n=null!==(n=c())?n:"")&&null!==(r=null!==(r=c())?r:"")&&null!==(o=null!==(o=c())?o:"")?e=[e,t,n,r,o]:(e=null,i=s),null!==e&&(l=e,e=void(qn.rport=parseInt(l.join("")))),null===e&&(i=a),e}function gn(){var e,t,n,r,o,a;return a=i,null!==(e=yn())&&null!==(t=k())&&null!==(n=P())&&null!==(r=k())&&null!==(o=Sn())?e=[e,t,n,r,o]:(e=null,i=a),e}function yn(){var e,n,r;return n=i,"sip"===t.substr(i,3).toLowerCase()?(e=t.substr(i,3),i+=3):(e=null,l('"SIP"')),null===e&&(e=P()),null!==e&&(r=e,e=void(qn.protocol=r)),null===e&&(i=n),e}function Sn(){var e,n,r;return n=i,"udp"===t.substr(i,3).toLowerCase()?(e=t.substr(i,3),i+=3):(e=null,l('"UDP"')),null===e&&("tcp"===t.substr(i,3).toLowerCase()?(e=t.substr(i,3),i+=3):(e=null,l('"TCP"')),null===e&&("tls"===t.substr(i,3).toLowerCase()?(e=t.substr(i,3),i+=3):(e=null,l('"TLS"')),null===e&&("sctp"===t.substr(i,4).toLowerCase()?(e=t.substr(i,4),i+=4):(e=null,l('"SCTP"')),null===e&&(e=P())))),null!==e&&(r=e,e=void(qn.transport=r)),null===e&&(i=n),e}function Tn(){var e,t,n,r,o;return r=i,null!==(e=Cn())?(o=i,null!==(t=V())&&null!==(n=En())?t=[t,n]:(t=null,i=o),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,i=r)):(e=null,i=r),e}function Cn(){var e,n;return n=i,null===(e=he())&&null===(e=ce())&&(e=se()),null!==e&&(e=function(e){qn.host=t.substring(i,e)}(n)),null===e&&(i=n),e}function En(){var e,t,n,r,o,a,s,l;return a=i,s=i,null!==(e=null!==(e=c())?e:"")&&null!==(t=null!==(t=c())?t:"")&&null!==(n=null!==(n=c())?n:"")&&null!==(r=null!==(r=c())?r:"")&&null!==(o=null!==(o=c())?o:"")?e=[e,t,n,r,o]:(e=null,i=s),null!==e&&(l=e,e=void(qn.port=parseInt(l.join("")))),null===e&&(i=a),e}function Rn(){var e,t,n,r,o;return r=i,o=i,null!==(e=c())&&null!==(t=null!==(t=c())?t:"")&&null!==(n=null!==(n=c())?n:"")?e=[e,t,n]:(e=null,i=o),null!==e&&(e=parseInt(e.join(""))),null===e&&(i=r),e}function bn(){var e,t,n;return t=i,null!==(e=St())&&(n=e,e=void(qn.expires=n)),null===e&&(i=t),e}function An(){var e;return null===(e=In())&&(e=Ct()),e}function In(){var e,n,r,o,a,s;return o=i,a=i,"refresher"===t.substr(i,9).toLowerCase()?(e=t.substr(i,9),i+=9):(e=null,l('"refresher"')),null!==e&&null!==(n=x())?("uac"===t.substr(i,3).toLowerCase()?(r=t.substr(i,3),i+=3):(r=null,l('"uac"')),null===r&&("uas"===t.substr(i,3).toLowerCase()?(r=t.substr(i,3),i+=3):(r=null,l('"uas"'))),null!==r?e=[e,n,r]:(e=null,i=a)):(e=null,i=a),null!==e&&(s=e[2],e=void(qn.refresher=s.toLowerCase())),null===e&&(i=o),e}function wn(){var e,t;for(e=[],null===(t=I())&&null===(t=O())&&(t=E());null!==t;)e.push(t),null===(t=I())&&null===(t=O())&&(t=E());return e}function On(){var e,n,r,o,a,s,u,c,d,f,p;return f=i,p=i,null!==(e=Nn())?(45===t.charCodeAt(i)?(n="-",i++):(n=null,l('"-"')),null!==n&&null!==(r=Pn())?(45===t.charCodeAt(i)?(o="-",i++):(o=null,l('"-"')),null!==o&&null!==(a=Pn())?(45===t.charCodeAt(i)?(s="-",i++):(s=null,l('"-"')),null!==s&&null!==(u=Pn())?(45===t.charCodeAt(i)?(c="-",i++):(c=null,l('"-"')),null!==c&&null!==(d=Dn())?e=[e,n,r,o,a,s,u,c,d]:(e=null,i=p)):(e=null,i=p)):(e=null,i=p)):(e=null,i=p)):(e=null,i=p),null!==e&&(e=function(e,n){qn=t.substring(i+5,e)}(f,e[0])),null===e&&(i=f),e}function Pn(){var e,t,n,r,o;return o=i,null!==(e=f())&&null!==(t=f())&&null!==(n=f())&&null!==(r=f())?e=[e,t,n,r]:(e=null,i=o),e}function Nn(){var e,t,n;return n=i,null!==(e=Pn())&&null!==(t=Pn())?e=[e,t]:(e=null,i=n),e}function Dn(){var e,t,n,r;return r=i,null!==(e=Pn())&&null!==(t=Pn())&&null!==(n=Pn())?e=[e,t,n]:(e=null,i=r),e}function Mn(){var e,n,r,o,a,s;return o=i,a=i,null!==(e=D())?(s=i,64===t.charCodeAt(i)?(n="@",i++):(n=null,l('"@"')),null!==n&&null!==(r=D())?n=[n,r]:(n=null,i=s),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,i=a)):(e=null,i=a),null!==e&&(e=function(e){qn.call_id=t.substring(i,e)}(o)),null===e&&(i=o),e}function kn(){var e;return null===(e=xn())&&null===(e=Ln())&&null===(e=Un())&&(e=Ct()),e}function xn(){var e,n,r,o,a,s;return o=i,a=i,"to-tag"===t.substr(i,6)?(e="to-tag",i+=6):(e=null,l('"to-tag"')),null!==e&&null!==(n=x())&&null!==(r=P())?e=[e,n,r]:(e=null,i=a),null!==e&&(s=e[2],e=void(qn.to_tag=s)),null===e&&(i=o),e}function Ln(){var e,n,r,o,a,s;return o=i,a=i,"from-tag"===t.substr(i,8)?(e="from-tag",i+=8):(e=null,l('"from-tag"')),null!==e&&null!==(n=x())&&null!==(r=P())?e=[e,n,r]:(e=null,i=a),null!==e&&(s=e[2],e=void(qn.from_tag=s)),null===e&&(i=o),e}function Un(){var e,n;return n=i,"early-only"===t.substr(i,10)?(e="early-only",i+=10):(e=null,l('"early-only"')),null!==e&&(e=void(qn.early_only=!0)),null===e&&(i=n),e}var Fn=n(1987),Hn=n(9437),qn={};if(null===o[r]()||i!==t.length){var jn=Math.max(i,a),Vn=jn<t.length?t.charAt(jn):null,Gn=function(){for(var e=1,n=1,r=!1,o=0;o<Math.max(i,a);o++){var s=t.charAt(o);"\n"===s?(r||e++,n=1,r=!1):"\r"===s||"\u2028"===s||"\u2029"===s?(e++,n=1,r=!0):(n++,r=!1)}return{line:e,column:n}}();return new this.SyntaxError(function(e){e.sort();for(var t=null,n=[],r=0;r<e.length;r++)e[r]!==t&&(n.push(e[r]),t=e[r]);return n}(s),Vn,jn,Gn.line,Gn.column),-1}return qn},toSource:function(){return this._source},SyntaxError:function(t,n,r,o,i){this.name="SyntaxError",this.expected=t,this.found=n,this.message=function(t,n){var r;switch(t.length){case 0:r="end of input";break;case 1:r=t[0];break;default:r=t.slice(0,t.length-1).join(", ")+" or "+t[t.length-1]}return"Expected "+r+" but "+(n?e(n):"end of input")+" found."}(t,n),this.offset=r,this.line=o,this.column=i}};return t.SyntaxError.prototype=Error.prototype,t}()},5979:(e,t,n)=>{"use strict";var r=n(2403),o=n(965),i=n(8063),a=n(5424),s=n(8387),l=n(1987),u=n(9437),c=n(3790),d=n(1288);n(1227)("JsSIP")("version %s",r.version),e.exports={C:o,Exceptions:i,Utils:a,UA:s,URI:l,NameAddrHeader:u,WebSocketInterface:d,Grammar:c,debug:n(1227),get name(){return r.title},get version(){return r.version}}},356:(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(1227),i="JsSIP";e.exports=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t?(this._debug=o.default("".concat(i,":").concat(t)),this._warn=o.default("".concat(i,":WARN:").concat(t)),this._error=o.default("".concat(i,":ERROR:").concat(t))):(this._debug=o.default(i),this._warn=o.default("".concat(i,":WARN")),this._error=o.default("".concat(i,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}var t,n,a;return t=e,(n=[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}])&&r(t.prototype,n),a&&r(t,a),e}()},9193:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var o=l(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return s(this,n)}}function s(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}var u=n(7187).EventEmitter,c=n(356),d=n(965),f=n(6497),p=n(5424),h=n(2066),m=n(8063),_=n(1987),v=new c("Message");e.exports=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(l,e);var t,n,r,s=a(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=s.call(this))._ua=e,t._request=null,t._closed=!1,t._direction=null,t._local_identity=null,t._remote_identity=null,t._is_replied=!1,t._data={},t}return t=l,n=[{key:"send",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=e;if(void 0===e||void 0===t)throw new TypeError("Not enough arguments");if(!(e=this._ua.normalizeTarget(e)))throw new TypeError("Invalid target: ".concat(o));var i=p.cloneArray(r.extraHeaders),a=p.cloneObject(r.eventHandlers),s=r.contentType||"text/plain",l={};for(var u in r.fromUserName&&(l.from_uri=new _("sip",r.fromUserName,this._ua.configuration.uri.host),i.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString()))),r.fromDisplayName&&(l.from_display_name=r.fromDisplayName),a)Object.prototype.hasOwnProperty.call(a,u)&&this.on(u,a[u]);i.push("Content-Type: ".concat(s)),this._request=new f.OutgoingRequest(d.MESSAGE,e,this._ua,l,i),t&&(this._request.body=t);var c=new h(this._ua,this._request,{onRequestTimeout:function(){n._onRequestTimeout()},onTransportError:function(){n._onTransportError()},onReceiveResponse:function(e){n._receiveResponse(e)}});this._newMessage("local",this._request),c.send()}},{key:"init_incoming",value:function(e){this._request=e,this._newMessage("remote",e),this._is_replied||(this._is_replied=!0,e.reply(200)),this._close()}},{key:"accept",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=p.cloneArray(e.extraHeaders),n=e.body;if("incoming"!==this._direction)throw new m.NotSupportedError('"accept" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");this._is_replied=!0,this._request.reply(200,null,t,n)}},{key:"reject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.status_code||480,n=e.reason_phrase,r=p.cloneArray(e.extraHeaders),o=e.body;if("incoming"!==this._direction)throw new m.NotSupportedError('"reject" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");if(t<300||t>=700)throw new TypeError("Invalid status_code: ".concat(t));this._is_replied=!0,this._request.reply(t,n,r,o)}},{key:"_receiveResponse",value:function(e){if(!this._closed)switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):this._succeeded("remote",e);break;default:var t=p.sipErrorCause(e.status_code);this._failed("remote",e,t)}}},{key:"_onRequestTimeout",value:function(){this._closed||this._failed("system",null,d.causes.REQUEST_TIMEOUT)}},{key:"_onTransportError",value:function(){this._closed||this._failed("system",null,d.causes.CONNECTION_ERROR)}},{key:"_close",value:function(){this._closed=!0,this._ua.destroyMessage(this)}},{key:"_newMessage",value:function(e,t){"remote"===e?(this._direction="incoming",this._local_identity=t.to,this._remote_identity=t.from):"local"===e&&(this._direction="outgoing",this._local_identity=t.from,this._remote_identity=t.to),this._ua.newMessage(this,{originator:e,message:this,request:t})}},{key:"_failed",value:function(e,t,n){v.debug("MESSAGE failed"),this._close(),v.debug('emit "failed"'),this.emit("failed",{originator:e,response:t||null,cause:n})}},{key:"_succeeded",value:function(e,t){v.debug("MESSAGE succeeded"),this._close(),v.debug('emit "succeeded"'),this.emit("succeeded",{originator:e,response:t})}},{key:"direction",get:function(){return this._direction}},{key:"local_identity",get:function(){return this._local_identity}},{key:"remote_identity",get:function(){return this._remote_identity}}],n&&o(t.prototype,n),r&&o(t,r),l}(u)},9437:(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var i=n(1987),a=n(3790);e.exports=function(){function e(t,n,r){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(t&&t instanceof i))throw new TypeError('missing or invalid "uri" parameter');for(var o in this._uri=t,this._parameters={},this.display_name=n,r)Object.prototype.hasOwnProperty.call(r,o)&&this.setParam(o,r[o])}return o(e,null,[{key:"parse",value:function(e){return-1!==(e=a.parse(e,"Name_Addr_Header"))?e:void 0}}]),o(e,[{key:"setParam",value:function(e,t){e&&(this._parameters[e.toLowerCase()]=null==t?null:t.toString())}},{key:"getParam",value:function(e){if(e)return this._parameters[e.toLowerCase()]}},{key:"hasParam",value:function(e){if(e)return!!this._parameters.hasOwnProperty(e.toLowerCase())}},{key:"deleteParam",value:function(e){if(e=e.toLowerCase(),this._parameters.hasOwnProperty(e)){var t=this._parameters[e];return delete this._parameters[e],t}}},{key:"clearParams",value:function(){this._parameters={}}},{key:"clone",value:function(){return new e(this._uri.clone(),this._display_name,JSON.parse(JSON.stringify(this._parameters)))}},{key:"_quote",value:function(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}},{key:"toString",value:function(){var e=this._display_name?'"'.concat(this._quote(this._display_name),'" '):"";for(var t in e+="<".concat(this._uri.toString(),">"),this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,t)&&(e+=";".concat(t),null!==this._parameters[t]&&(e+="=".concat(this._parameters[t])));return e}},{key:"uri",get:function(){return this._uri}},{key:"display_name",get:function(){return this._display_name},set:function(e){this._display_name=0===e?"0":e}}]),e}()},9126:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var o=l(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return s(this,n)}}function s(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}var u=n(7187).EventEmitter,c=n(356),d=n(965),f=n(6497),p=n(5424),h=n(2066),m=n(8063),_=new c("Options");e.exports=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(l,e);var t,n,r,s=a(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=s.call(this))._ua=e,t._request=null,t._closed=!1,t._direction=null,t._local_identity=null,t._remote_identity=null,t._is_replied=!1,t._data={},t}return t=l,n=[{key:"send",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=e;if(void 0===e)throw new TypeError("A target is required for OPTIONS");if(!(e=this._ua.normalizeTarget(e)))throw new TypeError("Invalid target: ".concat(o));var i=p.cloneArray(r.extraHeaders),a=p.cloneObject(r.eventHandlers),s=r.contentType||"application/sdp";for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&this.on(l,a[l]);i.push("Content-Type: ".concat(s)),this._request=new f.OutgoingRequest(d.OPTIONS,e,this._ua,null,i),t&&(this._request.body=t);var u=new h(this._ua,this._request,{onRequestTimeout:function(){n._onRequestTimeout()},onTransportError:function(){n._onTransportError()},onReceiveResponse:function(e){n._receiveResponse(e)}});this._newOptions("local",this._request),u.send()}},{key:"init_incoming",value:function(e){this._request=e,this._newOptions("remote",e),this._is_replied||(this._is_replied=!0,e.reply(200)),this._close()}},{key:"accept",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=p.cloneArray(e.extraHeaders),n=e.body;if("incoming"!==this._direction)throw new m.NotSupportedError('"accept" not supported for outgoing Options');if(this._is_replied)throw new Error("incoming Options already replied");this._is_replied=!0,this._request.reply(200,null,t,n)}},{key:"reject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.status_code||480,n=e.reason_phrase,r=p.cloneArray(e.extraHeaders),o=e.body;if("incoming"!==this._direction)throw new m.NotSupportedError('"reject" not supported for outgoing Options');if(this._is_replied)throw new Error("incoming Options already replied");if(t<300||t>=700)throw new TypeError("Invalid status_code: ".concat(t));this._is_replied=!0,this._request.reply(t,n,r,o)}},{key:"_receiveResponse",value:function(e){if(!this._closed)switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):this._succeeded("remote",e);break;default:var t=p.sipErrorCause(e.status_code);this._failed("remote",e,t)}}},{key:"_onRequestTimeout",value:function(){this._closed||this._failed("system",null,d.causes.REQUEST_TIMEOUT)}},{key:"_onTransportError",value:function(){this._closed||this._failed("system",null,d.causes.CONNECTION_ERROR)}},{key:"_close",value:function(){this._closed=!0,this._ua.destroyMessage(this)}},{key:"_newOptions",value:function(e,t){"remote"===e?(this._direction="incoming",this._local_identity=t.to,this._remote_identity=t.from):"local"===e&&(this._direction="outgoing",this._local_identity=t.from,this._remote_identity=t.to),this._ua.newOptions(this,{originator:e,message:this,request:t})}},{key:"_failed",value:function(e,t,n){_.debug("OPTIONS failed"),this._close(),_.debug('emit "failed"'),this.emit("failed",{originator:e,response:t||null,cause:n})}},{key:"_succeeded",value:function(e,t){_.debug("OPTIONS succeeded"),this._close(),_.debug('emit "succeeded"'),this.emit("succeeded",{originator:e,response:t})}},{key:"direction",get:function(){return this._direction}},{key:"local_identity",get:function(){return this._local_identity}},{key:"remote_identity",get:function(){return this._remote_identity}}],n&&o(t.prototype,n),r&&o(t,r),l}(u)},8407:(e,t,n)=>{"use strict";function r(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var i=n(356),a=n(3790),s=n(6497),l=new i("Parser");function u(e,t){var n=t,r=0,o=0;if(e.substring(n,n+2).match(/(^\r\n)/))return-2;for(;0===r;){if(-1===(o=e.indexOf("\r\n",n)))return o;!e.substring(o+2,o+4).match(/(^\r\n)/)&&e.charAt(o+2).match(/(^\s+)/)?n=o+2:r=o}return r}function c(e,t,n,o){var i,l=t.indexOf(":",n),u=t.substring(n,l).trim(),c=t.substring(l+1,o).trim();switch(u.toLowerCase()){case"via":case"v":e.addHeader("via",c),1===e.getHeaders("via").length?(i=e.parseHeader("Via"))&&(e.via=i,e.via_branch=i.branch):i=0;break;case"from":case"f":e.setHeader("from",c),(i=e.parseHeader("from"))&&(e.from=i,e.from_tag=i.getParam("tag"));break;case"to":case"t":e.setHeader("to",c),(i=e.parseHeader("to"))&&(e.to=i,e.to_tag=i.getParam("tag"));break;case"record-route":if(-1===(i=a.parse(c,"Record_Route")))i=void 0;else{var d,f=r(i);try{for(f.s();!(d=f.n()).done;){var p=d.value;e.addHeader("record-route",c.substring(p.possition,p.offset)),e.headers["Record-Route"][e.getHeaders("record-route").length-1].parsed=p.parsed}}catch(e){f.e(e)}finally{f.f()}}break;case"call-id":case"i":e.setHeader("call-id",c),(i=e.parseHeader("call-id"))&&(e.call_id=c);break;case"contact":case"m":if(-1===(i=a.parse(c,"Contact")))i=void 0;else{var h,m=r(i);try{for(m.s();!(h=m.n()).done;){var _=h.value;e.addHeader("contact",c.substring(_.possition,_.offset)),e.headers.Contact[e.getHeaders("contact").length-1].parsed=_.parsed}}catch(e){m.e(e)}finally{m.f()}}break;case"content-length":case"l":e.setHeader("content-length",c),i=e.parseHeader("content-length");break;case"content-type":case"c":e.setHeader("content-type",c),i=e.parseHeader("content-type");break;case"cseq":e.setHeader("cseq",c),(i=e.parseHeader("cseq"))&&(e.cseq=i.value),e instanceof s.IncomingResponse&&(e.method=i.method);break;case"max-forwards":e.setHeader("max-forwards",c),i=e.parseHeader("max-forwards");break;case"www-authenticate":e.setHeader("www-authenticate",c),i=e.parseHeader("www-authenticate");break;case"proxy-authenticate":e.setHeader("proxy-authenticate",c),i=e.parseHeader("proxy-authenticate");break;case"session-expires":case"x":e.setHeader("session-expires",c),(i=e.parseHeader("session-expires"))&&(e.session_expires=i.expires,e.session_expires_refresher=i.refresher);break;case"refer-to":case"r":e.setHeader("refer-to",c),(i=e.parseHeader("refer-to"))&&(e.refer_to=i);break;case"replaces":e.setHeader("replaces",c),(i=e.parseHeader("replaces"))&&(e.replaces=i);break;case"event":case"o":e.setHeader("event",c),(i=e.parseHeader("event"))&&(e.event=i);break;default:e.addHeader(u,c),i=0}return void 0!==i||{error:'error parsing header "'.concat(u,'"')}}t.parseMessage=function(e,t){var n,r,o=e.indexOf("\r\n");if(-1!==o){var i=e.substring(0,o),d=a.parse(i,"Request_Response");if(-1!==d){d.status_code?((n=new s.IncomingResponse).status_code=d.status_code,n.reason_phrase=d.reason_phrase):((n=new s.IncomingRequest(t)).method=d.method,n.ruri=d.uri),n.data=e;for(var f=o+2;;){if(-2===(o=u(e,f))){r=f+2;break}if(-1===o)return void l.warn("parseMessage() | malformed message");if(!0!==(d=c(n,e,f,o)))return void l.warn("parseMessage() |",d.error);f=o+2}if(n.hasHeader("content-length")){var p=n.getHeader("content-length");n.body=e.substr(r,p)}else n.body=e.substring(r);return n}l.warn('parseMessage() | error parsing first line of SIP message: "'.concat(i,'"'))}else l.warn("parseMessage() | no CRLF found, not a SIP message")}},7906:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var o=d(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return c(this,n)}}function c(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}var f=n(7187).EventEmitter,p=n(766),h=n(356),m=n(965),_=n(8063),v=n(3754),g=n(5424),y=n(306),S=n(6497),T=n(316),C=n(2066),E=n(4481),R=n(2126),b=n(5774),A=n(603),I=n(1987),w=new h("RTCSession"),O={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9},P=["audio","video"];e.exports=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(n,e);var t=u(n);function n(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),w.debug("new"),(r=t.call(this))._id=null,r._ua=e,r._status=O.STATUS_NULL,r._dialog=null,r._earlyDialogs={},r._contact=null,r._from_tag=null,r._to_tag=null,r._connection=null,r._connectionPromiseQueue=Promise.resolve(),r._request=null,r._is_canceled=!1,r._cancel_reason="",r._is_confirmed=!1,r._late_sdp=!1,r._rtcOfferConstraints=null,r._rtcAnswerConstraints=null,r._localMediaStream=null,r._localMediaStreamLocallyGenerated=!1,r._rtcReady=!0,r._iceReady=!1,r._timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},r._direction=null,r._local_identity=null,r._remote_identity=null,r._start_time=null,r._end_time=null,r._tones=null,r._audioMuted=!1,r._videoMuted=!1,r._localHold=!1,r._remoteHold=!1,r._sessionTimers={enabled:r._ua.configuration.session_timers,refreshMethod:r._ua.configuration.session_timers_refresh_method,defaultExpires:m.SESSION_EXPIRES,currentExpires:null,running:!1,refresher:!1,timer:null},r._referSubscribers={},r._data={},r}return s(n,null,[{key:"C",get:function(){return O}}]),s(n,[{key:"isInProgress",value:function(){switch(this._status){case O.STATUS_NULL:case O.STATUS_INVITE_SENT:case O.STATUS_1XX_RECEIVED:case O.STATUS_INVITE_RECEIVED:case O.STATUS_WAITING_FOR_ANSWER:return!0;default:return!1}}},{key:"isEstablished",value:function(){switch(this._status){case O.STATUS_ANSWERED:case O.STATUS_WAITING_FOR_ACK:case O.STATUS_CONFIRMED:return!0;default:return!1}}},{key:"isEnded",value:function(){switch(this._status){case O.STATUS_CANCELED:case O.STATUS_TERMINATED:return!0;default:return!1}}},{key:"isMuted",value:function(){return{audio:this._audioMuted,video:this._videoMuted}}},{key:"isOnHold",value:function(){return{local:this._localHold,remote:this._remoteHold}}},{key:"connect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;w.debug("connect()");var r=e,o=g.cloneObject(t.eventHandlers),i=g.cloneArray(t.extraHeaders),a=g.cloneObject(t.mediaConstraints,{audio:!0,video:!0}),s=t.mediaStream||null,l=g.cloneObject(t.pcConfig,{iceServers:[]}),u=t.rtcConstraints||null,c=t.rtcOfferConstraints||null;if(this._rtcOfferConstraints=c,this._rtcAnswerConstraints=t.rtcAnswerConstraints||null,this._data=t.data||this._data,void 0===e)throw new TypeError("Not enough arguments");if(this._status!==O.STATUS_NULL)throw new _.InvalidStateError(this._status);if(!window.RTCPeerConnection)throw new _.NotSupportedError("WebRTC not supported");if(!(e=this._ua.normalizeTarget(e)))throw new TypeError("Invalid target: ".concat(r));for(var d in this._sessionTimers.enabled&&g.isDecimal(t.sessionTimersExpires)&&(t.sessionTimersExpires>=m.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=t.sessionTimersExpires:this._sessionTimers.defaultExpires=m.SESSION_EXPIRES),o)Object.prototype.hasOwnProperty.call(o,d)&&this.on(d,o[d]);this._from_tag=g.newTag();var f=t.anonymous||!1,p={from_tag:this._from_tag};this._contact=this._ua.contact.toString({anonymous:f,outbound:!0}),f?(p.from_display_name="Anonymous",p.from_uri=new I("sip","anonymous","anonymous.invalid"),i.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString())),i.push("Privacy: id")):t.fromUserName&&(p.from_uri=new I("sip",t.fromUserName,this._ua.configuration.uri.host),i.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString()))),t.fromDisplayName&&(p.from_display_name=t.fromDisplayName),i.push("Contact: ".concat(this._contact)),i.push("Content-Type: application/sdp"),this._sessionTimers.enabled&&i.push("Session-Expires: ".concat(this._sessionTimers.defaultExpires).concat(this._ua.configuration.session_timers_force_refresher?";refresher=uac":"")),this._request=new S.InitialOutgoingInviteRequest(e,this._ua,p,i),this._id=this._request.call_id+this._from_tag,this._createRTCConnection(l,u),this._direction="outgoing",this._local_identity=this._request.from,this._remote_identity=this._request.to,n&&n(this),this._newRTCSession("local",this._request),this._sendInitialRequest(a,c,s)}},{key:"init_incoming",value:function(e,t){var n,r=this;w.debug("init_incoming()");var o=e.hasHeader("Content-Type")?e.getHeader("Content-Type").toLowerCase():void 0;e.body&&"application/sdp"!==o?e.reply(415):(this._status=O.STATUS_INVITE_RECEIVED,this._from_tag=e.from_tag,this._id=e.call_id+this._from_tag,this._request=e,this._contact=this._ua.contact.toString(),e.hasHeader("expires")&&(n=1e3*e.getHeader("expires")),e.to_tag=g.newTag(),this._createDialog(e,"UAS",!0)?(e.body?this._late_sdp=!1:this._late_sdp=!0,this._status=O.STATUS_WAITING_FOR_ANSWER,this._timers.userNoAnswerTimer=setTimeout((function(){e.reply(408),r._failed("local",null,m.causes.NO_ANSWER)}),this._ua.configuration.no_answer_timeout),n&&(this._timers.expiresTimer=setTimeout((function(){r._status===O.STATUS_WAITING_FOR_ANSWER&&(e.reply(487),r._failed("system",null,m.causes.EXPIRES))}),n)),this._direction="incoming",this._local_identity=e.to,this._remote_identity=e.from,t&&t(this),this._newRTCSession("remote",e),this._status!==O.STATUS_TERMINATED&&(e.reply(180,null,["Contact: ".concat(this._contact)]),this._progress("local",null))):e.reply(500,"Missing Contact header field"))}},{key:"answer",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};w.debug("answer()");var n=this._request,r=g.cloneArray(t.extraHeaders),i=g.cloneObject(t.mediaConstraints),a=t.mediaStream||null,s=g.cloneObject(t.pcConfig,{iceServers:[]}),l=t.rtcConstraints||null,u=t.rtcAnswerConstraints||null,c=g.cloneObject(t.rtcOfferConstraints),d=!1,f=!1,p=!1,h=!1;if(this._rtcAnswerConstraints=u,this._rtcOfferConstraints=t.rtcOfferConstraints||null,this._data=t.data||this._data,"incoming"!==this._direction)throw new _.NotSupportedError('"answer" not supported for outgoing RTCSession');if(this._status!==O.STATUS_WAITING_FOR_ANSWER)throw new _.InvalidStateError(this._status);if(this._sessionTimers.enabled&&g.isDecimal(t.sessionTimersExpires)&&(t.sessionTimersExpires>=m.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=t.sessionTimersExpires:this._sessionTimers.defaultExpires=m.SESSION_EXPIRES),this._status=O.STATUS_ANSWERED,this._createDialog(n,"UAS")){clearTimeout(this._timers.userNoAnswerTimer),r.unshift("Contact: ".concat(this._contact));var v=n.parseSDP();Array.isArray(v.media)||(v.media=[v.media]);var y,S=o(v.media);try{for(S.s();!(y=S.n()).done;){var T=y.value;"audio"===T.type&&(d=!0,T.direction&&"sendrecv"!==T.direction||(p=!0)),"video"===T.type&&(f=!0,T.direction&&"sendrecv"!==T.direction||(h=!0))}}catch(e){S.e(e)}finally{S.f()}if(a&&!1===i.audio){var C,E=o(a.getAudioTracks());try{for(E.s();!(C=E.n()).done;){var R=C.value;a.removeTrack(R)}}catch(e){E.e(e)}finally{E.f()}}if(a&&!1===i.video){var b,A=o(a.getVideoTracks());try{for(A.s();!(b=A.n()).done;){var I=b.value;a.removeTrack(I)}}catch(e){A.e(e)}finally{A.f()}}a||void 0!==i.audio||(i.audio=p),a||void 0!==i.video||(i.video=h),a||d||c.offerToReceiveAudio||(i.audio=!1),a||f||c.offerToReceiveVideo||(i.video=!1),this._createRTCConnection(s,l),Promise.resolve().then((function(){return a||(i.audio||i.video?(e._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(i).catch((function(t){if(e._status===O.STATUS_TERMINATED)throw new Error("terminated");throw n.reply(480),e._failed("local",null,m.causes.USER_DENIED_MEDIA_ACCESS),w.warn('emit "getusermediafailed" [error:%o]',t),e.emit("getusermediafailed",t),new Error("getUserMedia() failed")}))):void 0)})).then((function(t){if(e._status===O.STATUS_TERMINATED)throw new Error("terminated");e._localMediaStream=t,t&&t.getTracks().forEach((function(n){e._connection.addTrack(n,t)}))})).then((function(){if(!e._late_sdp){var t={originator:"remote",type:"offer",sdp:n.body};w.debug('emit "sdp"'),e.emit("sdp",t);var r=new RTCSessionDescription({type:"offer",sdp:t.sdp});return e._connectionPromiseQueue=e._connectionPromiseQueue.then((function(){return e._connection.setRemoteDescription(r)})).catch((function(t){throw n.reply(488),e._failed("system",null,m.causes.WEBRTC_ERROR),w.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',t),e.emit("peerconnection:setremotedescriptionfailed",t),new Error("peerconnection.setRemoteDescription() failed")})),e._connectionPromiseQueue}})).then((function(){if(e._status===O.STATUS_TERMINATED)throw new Error("terminated");return e._connecting(n),e._late_sdp?e._createLocalDescription("offer",e._rtcOfferConstraints).catch((function(){throw n.reply(500),new Error("_createLocalDescription() failed")})):e._createLocalDescription("answer",u).catch((function(){throw n.reply(500),new Error("_createLocalDescription() failed")}))})).then((function(t){if(e._status===O.STATUS_TERMINATED)throw new Error("terminated");e._handleSessionTimersInIncomingRequest(n,r),n.reply(200,null,r,t,(function(){e._status=O.STATUS_WAITING_FOR_ACK,e._setInvite2xxTimer(n,t),e._setACKTimer(),e._accepted("local")}),(function(){e._failed("system",null,m.causes.CONNECTION_ERROR)}))})).catch((function(t){e._status!==O.STATUS_TERMINATED&&w.warn(t)}))}else n.reply(500,"Error creating dialog")}},{key:"terminate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};w.debug("terminate()");var n,r=t.cause||m.causes.BYE,o=g.cloneArray(t.extraHeaders),i=t.body,a=t.status_code,s=t.reason_phrase;if(this._status===O.STATUS_TERMINATED)throw new _.InvalidStateError(this._status);switch(this._status){case O.STATUS_NULL:case O.STATUS_INVITE_SENT:case O.STATUS_1XX_RECEIVED:if(w.debug("canceling session"),a&&(a<200||a>=700))throw new TypeError("Invalid status_code: ".concat(a));a&&(s=s||m.REASON_PHRASE[a]||"",n="SIP ;cause=".concat(a,' ;text="').concat(s,'"')),this._status===O.STATUS_NULL||this._status===O.STATUS_INVITE_SENT?(this._is_canceled=!0,this._cancel_reason=n):this._status===O.STATUS_1XX_RECEIVED&&this._request.cancel(n),this._status=O.STATUS_CANCELED,this._failed("local",null,m.causes.CANCELED);break;case O.STATUS_WAITING_FOR_ANSWER:case O.STATUS_ANSWERED:if(w.debug("rejecting session"),(a=a||480)<300||a>=700)throw new TypeError("Invalid status_code: ".concat(a));this._request.reply(a,s,o,i),this._failed("local",null,m.causes.REJECTED);break;case O.STATUS_WAITING_FOR_ACK:case O.STATUS_CONFIRMED:if(w.debug("terminating session"),s=t.reason_phrase||m.REASON_PHRASE[a]||"",a&&(a<200||a>=700))throw new TypeError("Invalid status_code: ".concat(a));if(a&&o.push("Reason: SIP ;cause=".concat(a,'; text="').concat(s,'"')),this._status===O.STATUS_WAITING_FOR_ACK&&"incoming"===this._direction&&this._request.server_transaction.state!==v.C.STATUS_TERMINATED){var l=this._dialog;this.receiveRequest=function(t){t.method===m.ACK&&(e.sendRequest(m.BYE,{extraHeaders:o,body:i}),l.terminate())},this._request.server_transaction.on("stateChanged",(function(){e._request.server_transaction.state===v.C.STATUS_TERMINATED&&(e.sendRequest(m.BYE,{extraHeaders:o,body:i}),l.terminate())})),this._ended("local",null,r),this._dialog=l,this._ua.newDialog(l)}else this.sendRequest(m.BYE,{extraHeaders:o,body:i}),this._ended("local",null,r)}}},{key:"sendDTMF",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w.debug("sendDTMF() | tones: %s",e);var n=0,r=t.duration||null,o=t.interToneGap||null,i=t.transportType||m.DTMF_TRANSPORT.INFO;if(void 0===e)throw new TypeError("Not enough arguments");if(this._status!==O.STATUS_CONFIRMED&&this._status!==O.STATUS_WAITING_FOR_ACK&&this._status!==O.STATUS_1XX_RECEIVED)throw new _.InvalidStateError(this._status);if(i!==m.DTMF_TRANSPORT.INFO&&i!==m.DTMF_TRANSPORT.RFC2833)throw new TypeError("invalid transportType: ".concat(i));if("number"==typeof e&&(e=e.toString()),!e||"string"!=typeof e||!e.match(/^[0-9A-DR#*,]+$/i))throw new TypeError("Invalid tones: ".concat(e));if(r&&!g.isDecimal(r))throw new TypeError("Invalid tone duration: ".concat(r));if(r?r<E.C.MIN_DURATION?(w.debug('"duration" value is lower than the minimum allowed, setting it to '.concat(E.C.MIN_DURATION," milliseconds")),r=E.C.MIN_DURATION):r>E.C.MAX_DURATION?(w.debug('"duration" value is greater than the maximum allowed, setting it to '.concat(E.C.MAX_DURATION," milliseconds")),r=E.C.MAX_DURATION):r=Math.abs(r):r=E.C.DEFAULT_DURATION,t.duration=r,o&&!g.isDecimal(o))throw new TypeError("Invalid interToneGap: ".concat(o));if(o?o<E.C.MIN_INTER_TONE_GAP?(w.debug('"interToneGap" value is lower than the minimum allowed, setting it to '.concat(E.C.MIN_INTER_TONE_GAP," milliseconds")),o=E.C.MIN_INTER_TONE_GAP):o=Math.abs(o):o=E.C.DEFAULT_INTER_TONE_GAP,i!==m.DTMF_TRANSPORT.RFC2833)this._tones?this._tones+=e:(this._tones=e,s.call(this));else{var a=this._getDTMFRTPSender();a&&(e=a.toneBuffer+e,a.insertDTMF(e,r,o))}function s(){var e,i=this;if(this._status===O.STATUS_TERMINATED||!this._tones||n>=this._tones.length)this._tones=null;else{var a=this._tones[n];if(n+=1,","===a)e=2e3;else{var l=new E(this);t.eventHandlers={onFailed:function(){i._tones=null}},l.send(a,t),e=r+o}setTimeout(s.bind(this),e)}}}},{key:"sendInfo",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(w.debug("sendInfo()"),this._status!==O.STATUS_CONFIRMED&&this._status!==O.STATUS_WAITING_FOR_ACK&&this._status!==O.STATUS_1XX_RECEIVED)throw new _.InvalidStateError(this._status);var r=new R(this);r.send(e,t,n)}},{key:"mute",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{audio:!0,video:!1};w.debug("mute()");var t=!1,n=!1;!1===this._audioMuted&&e.audio&&(t=!0,this._audioMuted=!0,this._toggleMuteAudio(!0)),!1===this._videoMuted&&e.video&&(n=!0,this._videoMuted=!0,this._toggleMuteVideo(!0)),!0!==t&&!0!==n||this._onmute({audio:t,video:n})}},{key:"unmute",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{audio:!0,video:!0};w.debug("unmute()");var t=!1,n=!1;!0===this._audioMuted&&e.audio&&(t=!0,this._audioMuted=!1,!1===this._localHold&&this._toggleMuteAudio(!1)),!0===this._videoMuted&&e.video&&(n=!0,this._videoMuted=!1,!1===this._localHold&&this._toggleMuteVideo(!1)),!0!==t&&!0!==n||this._onunmute({audio:t,video:n})}},{key:"hold",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(w.debug("hold()"),this._status!==O.STATUS_WAITING_FOR_ACK&&this._status!==O.STATUS_CONFIRMED)return!1;if(!0===this._localHold)return!1;if(!this._isReadyToReOffer())return!1;this._localHold=!0,this._onhold("local");var r={succeeded:function(){n&&n()},failed:function(){e.terminate({cause:m.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Hold Failed"})}};return t.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:r,extraHeaders:t.extraHeaders}):this._sendReinvite({eventHandlers:r,extraHeaders:t.extraHeaders}),!0}},{key:"unhold",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(w.debug("unhold()"),this._status!==O.STATUS_WAITING_FOR_ACK&&this._status!==O.STATUS_CONFIRMED)return!1;if(!1===this._localHold)return!1;if(!this._isReadyToReOffer())return!1;this._localHold=!1,this._onunhold("local");var r={succeeded:function(){n&&n()},failed:function(){e.terminate({cause:m.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Unhold Failed"})}};return t.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:r,extraHeaders:t.extraHeaders}):this._sendReinvite({eventHandlers:r,extraHeaders:t.extraHeaders}),!0}},{key:"renegotiate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;w.debug("renegotiate()");var r=t.rtcOfferConstraints||null;if(this._status!==O.STATUS_WAITING_FOR_ACK&&this._status!==O.STATUS_CONFIRMED)return!1;if(!this._isReadyToReOffer())return!1;var o={succeeded:function(){n&&n()},failed:function(){e.terminate({cause:m.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Media Renegotiation Failed"})}};return this._setLocalMediaStatus(),t.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:o,rtcOfferConstraints:r,extraHeaders:t.extraHeaders}):this._sendReinvite({eventHandlers:o,rtcOfferConstraints:r,extraHeaders:t.extraHeaders}),!0}},{key:"refer",value:function(e,t){var n=this;w.debug("refer()");var r=e;if(this._status!==O.STATUS_WAITING_FOR_ACK&&this._status!==O.STATUS_CONFIRMED)return!1;if(!(e=this._ua.normalizeTarget(e)))throw new TypeError("Invalid target: ".concat(r));var o=new A(this);o.sendRefer(e,t);var i=o.id;return this._referSubscribers[i]=o,o.on("requestFailed",(function(){delete n._referSubscribers[i]})),o.on("accepted",(function(){delete n._referSubscribers[i]})),o.on("failed",(function(){delete n._referSubscribers[i]})),o}},{key:"sendRequest",value:function(e,t){return w.debug("sendRequest()"),this._dialog.sendRequest(e,t)}},{key:"receiveRequest",value:function(e){var t=this;if(w.debug("receiveRequest()"),e.method===m.CANCEL)this._status!==O.STATUS_WAITING_FOR_ANSWER&&this._status!==O.STATUS_ANSWERED||(this._status=O.STATUS_CANCELED,this._request.reply(487),this._failed("remote",e,m.causes.CANCELED));else switch(e.method){case m.ACK:if(this._status!==O.STATUS_WAITING_FOR_ACK)return;if(this._status=O.STATUS_CONFIRMED,clearTimeout(this._timers.ackTimer),clearTimeout(this._timers.invite2xxTimer),this._late_sdp){if(!e.body){this.terminate({cause:m.causes.MISSING_SDP,status_code:400});break}var n={originator:"remote",type:"answer",sdp:e.body};w.debug('emit "sdp"'),this.emit("sdp",n);var r=new RTCSessionDescription({type:"answer",sdp:n.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then((function(){return t._connection.setRemoteDescription(r)})).then((function(){t._is_confirmed||t._confirmed("remote",e)})).catch((function(e){t.terminate({cause:m.causes.BAD_MEDIA_DESCRIPTION,status_code:488}),w.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),t.emit("peerconnection:setremotedescriptionfailed",e)}))}else this._is_confirmed||this._confirmed("remote",e);break;case m.BYE:this._status===O.STATUS_CONFIRMED||this._status===O.STATUS_WAITING_FOR_ACK?(e.reply(200),this._ended("remote",e,m.causes.BYE)):this._status===O.STATUS_INVITE_RECEIVED||this._status===O.STATUS_WAITING_FOR_ANSWER?(e.reply(200),this._request.reply(487,"BYE Received"),this._ended("remote",e,m.causes.BYE)):e.reply(403,"Wrong Status");break;case m.INVITE:this._status===O.STATUS_CONFIRMED?e.hasHeader("replaces")?this._receiveReplaces(e):this._receiveReinvite(e):e.reply(403,"Wrong Status");break;case m.INFO:if(this._status===O.STATUS_1XX_RECEIVED||this._status===O.STATUS_WAITING_FOR_ANSWER||this._status===O.STATUS_ANSWERED||this._status===O.STATUS_WAITING_FOR_ACK||this._status===O.STATUS_CONFIRMED){var o=e.hasHeader("Content-Type")?e.getHeader("Content-Type").toLowerCase():void 0;o&&o.match(/^application\/dtmf-relay/i)?new E(this).init_incoming(e):void 0!==o?new R(this).init_incoming(e):e.reply(415)}else e.reply(403,"Wrong Status");break;case m.UPDATE:this._status===O.STATUS_CONFIRMED?this._receiveUpdate(e):e.reply(403,"Wrong Status");break;case m.REFER:this._status===O.STATUS_CONFIRMED?this._receiveRefer(e):e.reply(403,"Wrong Status");break;case m.NOTIFY:this._status===O.STATUS_CONFIRMED?this._receiveNotify(e):e.reply(403,"Wrong Status");break;default:e.reply(501)}}},{key:"onTransportError",value:function(){w.warn("onTransportError()"),this._status!==O.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:m.causes.CONNECTION_ERROR,cause:m.causes.CONNECTION_ERROR})}},{key:"onRequestTimeout",value:function(){w.warn("onRequestTimeout()"),this._status!==O.STATUS_TERMINATED&&this.terminate({status_code:408,reason_phrase:m.causes.REQUEST_TIMEOUT,cause:m.causes.REQUEST_TIMEOUT})}},{key:"onDialogError",value:function(){w.warn("onDialogError()"),this._status!==O.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:m.causes.DIALOG_ERROR,cause:m.causes.DIALOG_ERROR})}},{key:"newDTMF",value:function(e){w.debug("newDTMF()"),this.emit("newDTMF",e)}},{key:"newInfo",value:function(e){w.debug("newInfo()"),this.emit("newInfo",e)}},{key:"_isReadyToReOffer",value:function(){return this._rtcReady?this._dialog?!0!==this._dialog.uac_pending_reply&&!0!==this._dialog.uas_pending_reply||(w.debug("_isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress"),!1):(w.debug("_isReadyToReOffer() | session not established yet"),!1):(w.debug("_isReadyToReOffer() | internal WebRTC status not ready"),!1)}},{key:"_close",value:function(){if(w.debug("close()"),this._localMediaStream&&this._localMediaStreamLocallyGenerated&&(w.debug("close() | closing local MediaStream"),g.closeMediaStream(this._localMediaStream)),this._status!==O.STATUS_TERMINATED){if(this._status=O.STATUS_TERMINATED,this._connection)try{this._connection.close()}catch(e){w.warn("close() | error closing the RTCPeerConnection: %o",e)}for(var e in this._timers)Object.prototype.hasOwnProperty.call(this._timers,e)&&clearTimeout(this._timers[e]);for(var t in clearTimeout(this._sessionTimers.timer),this._dialog&&(this._dialog.terminate(),delete this._dialog),this._earlyDialogs)Object.prototype.hasOwnProperty.call(this._earlyDialogs,t)&&(this._earlyDialogs[t].terminate(),delete this._earlyDialogs[t]);for(var n in this._referSubscribers)Object.prototype.hasOwnProperty.call(this._referSubscribers,n)&&delete this._referSubscribers[n];this._ua.destroyRTCSession(this)}}},{key:"_setInvite2xxTimer",value:function(e,t){var n=y.T1;this._timers.invite2xxTimer=setTimeout(function r(){this._status===O.STATUS_WAITING_FOR_ACK&&(e.reply(200,null,["Contact: ".concat(this._contact)],t),n<y.T2&&(n*=2)>y.T2&&(n=y.T2),this._timers.invite2xxTimer=setTimeout(r.bind(this),n))}.bind(this),n)}},{key:"_setACKTimer",value:function(){var e=this;this._timers.ackTimer=setTimeout((function(){e._status===O.STATUS_WAITING_FOR_ACK&&(w.debug("no ACK received, terminating the session"),clearTimeout(e._timers.invite2xxTimer),e.sendRequest(m.BYE),e._ended("remote",null,m.causes.NO_ACK))}),y.TIMER_H)}},{key:"_createRTCConnection",value:function(e,t){var n=this;this._connection=new RTCPeerConnection(e,t),this._connection.addEventListener("iceconnectionstatechange",(function(){"failed"===n._connection.iceConnectionState&&n.terminate({cause:m.causes.RTP_TIMEOUT,status_code:408,reason_phrase:m.causes.RTP_TIMEOUT})})),w.debug('emit "peerconnection"'),this.emit("peerconnection",{peerconnection:this._connection})}},{key:"_createLocalDescription",value:function(e,t){var n=this;if(w.debug("createLocalDescription()"),"offer"!==e&&"answer"!==e)throw new Error('createLocalDescription() | invalid type "'.concat(e,'"'));var r=this._connection;return this._rtcReady=!1,Promise.resolve().then((function(){return"offer"===e?r.createOffer(t).catch((function(e){return w.warn('emit "peerconnection:createofferfailed" [error:%o]',e),n.emit("peerconnection:createofferfailed",e),Promise.reject(e)})):r.createAnswer(t).catch((function(e){return w.warn('emit "peerconnection:createanswerfailed" [error:%o]',e),n.emit("peerconnection:createanswerfailed",e),Promise.reject(e)}))})).then((function(e){return r.setLocalDescription(e).catch((function(e){return n._rtcReady=!0,w.warn('emit "peerconnection:setlocaldescriptionfailed" [error:%o]',e),n.emit("peerconnection:setlocaldescriptionfailed",e),Promise.reject(e)}))})).then((function(){var o=t&&t.iceRestart;if("complete"===r.iceGatheringState&&!o||"gathering"===r.iceGatheringState&&n._iceReady){n._rtcReady=!0;var i={originator:"local",type:e,sdp:r.localDescription.sdp};return w.debug('emit "sdp"'),n.emit("sdp",i),Promise.resolve(i.sdp)}return new Promise((function(t){var o,i,a=!1;n._iceReady=!1;var s=function(){r.removeEventListener("icecandidate",o),r.removeEventListener("icegatheringstatechange",i),a=!0,n._rtcReady=!0,n._iceReady=!0;var s={originator:"local",type:e,sdp:r.localDescription.sdp};w.debug('emit "sdp"'),n.emit("sdp",s),t(s.sdp)};r.addEventListener("icecandidate",o=function(e){var t=e.candidate;t?n.emit("icecandidate",{candidate:t,ready:s}):a||s()}),r.addEventListener("icegatheringstatechange",i=function(){"complete"!==r.iceGatheringState||a||s()})}))}))}},{key:"_createDialog",value:function(e,t,n){var r="UAS"===t?e.to_tag:e.from_tag,o="UAS"===t?e.from_tag:e.to_tag,i=e.call_id+r+o,a=this._earlyDialogs[i];if(n)return!!a||((a=new T(this,e,t,T.C.STATUS_EARLY)).error?(w.debug(a.error),this._failed("remote",e,m.causes.INTERNAL_ERROR),!1):(this._earlyDialogs[i]=a,!0));if(this._from_tag=e.from_tag,this._to_tag=e.to_tag,a)return a.update(e,t),this._dialog=a,delete this._earlyDialogs[i],!0;var s=new T(this,e,t);return s.error?(w.debug(s.error),this._failed("remote",e,m.causes.INTERNAL_ERROR),!1):(this._dialog=s,!0)}},{key:"_receiveReinvite",value:function(e){var t=this;w.debug("receiveReinvite()");var n=e.hasHeader("Content-Type")?e.getHeader("Content-Type").toLowerCase():void 0,r={request:e,callback:void 0,reject:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o=!0;var n=t.status_code||403,r=t.reason_phrase||"",i=g.cloneArray(t.extraHeaders);if(this._status!==O.STATUS_CONFIRMED)return!1;if(n<300||n>=700)throw new TypeError("Invalid status_code: ".concat(n));e.reply(n,r,i)}.bind(this)},o=!1;if(this.emit("reinvite",r),!o){if(this._late_sdp=!1,!e.body)return this._late_sdp=!0,this._remoteHold&&(this._remoteHold=!1,this._onunhold("remote")),void(this._connectionPromiseQueue=this._connectionPromiseQueue.then((function(){return t._createLocalDescription("offer",t._rtcOfferConstraints)})).then((function(e){i.call(t,e)})).catch((function(){e.reply(500)})));if("application/sdp"!==n)return w.debug("invalid Content-Type"),void e.reply(415);this._processInDialogSdpOffer(e).then((function(e){t._status!==O.STATUS_TERMINATED&&i.call(t,e)})).catch((function(e){w.warn(e)}))}function i(t){var n=this,o=["Contact: ".concat(this._contact)];this._handleSessionTimersInIncomingRequest(e,o),this._late_sdp&&(t=this._mangleOffer(t)),e.reply(200,null,o,t,(function(){n._status=O.STATUS_WAITING_FOR_ACK,n._setInvite2xxTimer(e,t),n._setACKTimer()})),"function"==typeof r.callback&&r.callback()}}},{key:"_receiveUpdate",value:function(e){var t=this;w.debug("receiveUpdate()");var n=e.hasHeader("Content-Type")?e.getHeader("Content-Type").toLowerCase():void 0,r={request:e,callback:void 0,reject:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o=!0;var n=t.status_code||403,r=t.reason_phrase||"",i=g.cloneArray(t.extraHeaders);if(this._status!==O.STATUS_CONFIRMED)return!1;if(n<300||n>=700)throw new TypeError("Invalid status_code: ".concat(n));e.reply(n,r,i)}.bind(this)},o=!1;if(this.emit("update",r),!o)if(e.body){if("application/sdp"!==n)return w.debug("invalid Content-Type"),void e.reply(415);this._processInDialogSdpOffer(e).then((function(e){t._status!==O.STATUS_TERMINATED&&i.call(t,e)})).catch((function(e){w.warn(e)}))}else i.call(this,null);function i(t){var n=["Contact: ".concat(this._contact)];this._handleSessionTimersInIncomingRequest(e,n),e.reply(200,null,n,t),"function"==typeof r.callback&&r.callback()}}},{key:"_processInDialogSdpOffer",value:function(e){var t=this;w.debug("_processInDialogSdpOffer()");var n,r=e.parseSDP(),i=!1,a=o(r.media);try{for(a.s();!(n=a.n()).done;){var s=n.value;if(-1!==P.indexOf(s.type)){var l=s.direction||r.direction||"sendrecv";if("sendonly"!==l&&"inactive"!==l){i=!1;break}i=!0}}}catch(e){a.e(e)}finally{a.f()}var u={originator:"remote",type:"offer",sdp:e.body};w.debug('emit "sdp"'),this.emit("sdp",u);var c=new RTCSessionDescription({type:"offer",sdp:u.sdp});return this._connectionPromiseQueue=this._connectionPromiseQueue.then((function(){if(t._status===O.STATUS_TERMINATED)throw new Error("terminated");return t._connection.setRemoteDescription(c).catch((function(n){throw e.reply(488),w.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',n),t.emit("peerconnection:setremotedescriptionfailed",n),n}))})).then((function(){if(t._status===O.STATUS_TERMINATED)throw new Error("terminated");!0===t._remoteHold&&!1===i?(t._remoteHold=!1,t._onunhold("remote")):!1===t._remoteHold&&!0===i&&(t._remoteHold=!0,t._onhold("remote"))})).then((function(){if(t._status===O.STATUS_TERMINATED)throw new Error("terminated");return t._createLocalDescription("answer",t._rtcAnswerConstraints).catch((function(t){throw e.reply(500),w.warn('emit "peerconnection:createtelocaldescriptionfailed" [error:%o]',t),t}))})).catch((function(e){w.warn("_processInDialogSdpOffer() failed [error: %o]",e)})),this._connectionPromiseQueue}},{key:"_receiveRefer",value:function(e){var t=this;if(w.debug("receiveRefer()"),!e.refer_to)return w.debug("no Refer-To header field present in REFER"),void e.reply(400);if(e.refer_to.uri.scheme!==m.SIP)return w.debug("Refer-To header field points to a non-SIP URI scheme"),void e.reply(416);e.reply(202);var r=new b(this,e.cseq);function o(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t="function"==typeof t?t:null,this._status!==O.STATUS_WAITING_FOR_ACK&&this._status!==O.STATUS_CONFIRMED)return!1;var i=new n(this._ua);if(i.on("progress",(function(e){var t=e.response;r.notify(t.status_code,t.reason_phrase)})),i.on("accepted",(function(e){var t=e.response;r.notify(t.status_code,t.reason_phrase)})),i.on("_failed",(function(e){var t=e.message,n=e.cause;t?r.notify(t.status_code,t.reason_phrase):r.notify(487,n)})),e.refer_to.uri.hasHeader("replaces")){var a=decodeURIComponent(e.refer_to.uri.getHeader("replaces"));o.extraHeaders=g.cloneArray(o.extraHeaders),o.extraHeaders.push("Replaces: ".concat(a))}i.connect(e.refer_to.uri.toAor(),o,t)}function i(){r.notify(603)}w.debug('emit "refer"'),this.emit("refer",{request:e,accept:function(e,n){o.call(t,e,n)},reject:function(){i.call(t)}})}},{key:"_receiveNotify",value:function(e){if(w.debug("receiveNotify()"),e.event||e.reply(400),"refer"===e.event.event){var t,n;if(e.event.params&&e.event.params.id)t=e.event.params.id,n=this._referSubscribers[t];else{if(1!==Object.keys(this._referSubscribers).length)return void e.reply(400,"Missing event id parameter");n=this._referSubscribers[Object.keys(this._referSubscribers)[0]]}if(!n)return void e.reply(481,"Subscription does not exist");n.receiveNotify(e),e.reply(200)}else e.reply(489)}},{key:"_receiveReplaces",value:function(e){var t=this;function r(t){var r=this;if(this._status!==O.STATUS_WAITING_FOR_ACK&&this._status!==O.STATUS_CONFIRMED)return!1;var o=new n(this._ua);o.on("confirmed",(function(){r.terminate()})),o.init_incoming(e,t)}function o(){w.debug("Replaced INVITE rejected by the user"),e.reply(486)}w.debug("receiveReplaces()"),this.emit("replaces",{request:e,accept:function(e){r.call(t,e)},reject:function(){o.call(t)}})}},{key:"_sendInitialRequest",value:function(e,t,n){var r=this,o=new C(this._ua,this._request,{onRequestTimeout:function(){r.onRequestTimeout()},onTransportError:function(){r.onTransportError()},onAuthenticated:function(e){r._request=e},onReceiveResponse:function(e){r._receiveInviteResponse(e)}});Promise.resolve().then((function(){return n||(e.audio||e.video?(r._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(e).catch((function(e){if(r._status===O.STATUS_TERMINATED)throw new Error("terminated");throw r._failed("local",null,m.causes.USER_DENIED_MEDIA_ACCESS),w.warn('emit "getusermediafailed" [error:%o]',e),r.emit("getusermediafailed",e),e}))):void 0)})).then((function(e){if(r._status===O.STATUS_TERMINATED)throw new Error("terminated");return r._localMediaStream=e,e&&e.getTracks().forEach((function(t){r._connection.addTrack(t,e)})),r._connecting(r._request),r._createLocalDescription("offer",t).catch((function(e){throw r._failed("local",null,m.causes.WEBRTC_ERROR),e}))})).then((function(e){if(r._is_canceled||r._status===O.STATUS_TERMINATED)throw new Error("terminated");r._request.body=e,r._status=O.STATUS_INVITE_SENT,w.debug('emit "sending" [request:%o]',r._request),r.emit("sending",{request:r._request}),o.send()})).catch((function(e){r._status!==O.STATUS_TERMINATED&&w.warn(e)}))}},{key:"_getDTMFRTPSender",value:function(){var e=this._connection.getSenders().find((function(e){return e.track&&"audio"===e.track.kind}));if(e&&e.dtmf)return e.dtmf;w.warn("sendDTMF() | no local audio track to send DTMF with")}},{key:"_receiveInviteResponse",value:function(e){var t=this;if(w.debug("receiveInviteResponse()"),this._dialog&&e.status_code>=200&&e.status_code<=299){if(this._dialog.id.call_id===e.call_id&&this._dialog.id.local_tag===e.from_tag&&this._dialog.id.remote_tag===e.to_tag)return void this.sendRequest(m.ACK);var n=new T(this,e,"UAC");return void 0!==n.error?void w.debug(n.error):(this.sendRequest(m.ACK),void this.sendRequest(m.BYE))}if(this._is_canceled)e.status_code>=100&&e.status_code<200?this._request.cancel(this._cancel_reason):e.status_code>=200&&e.status_code<299&&this._acceptAndTerminate(e);else if(this._status===O.STATUS_INVITE_SENT||this._status===O.STATUS_1XX_RECEIVED)switch(!0){case/^100$/.test(e.status_code):this._status=O.STATUS_1XX_RECEIVED;break;case/^1[0-9]{2}$/.test(e.status_code):if(!e.to_tag){w.debug("1xx response received without to tag");break}if(e.hasHeader("contact")&&!this._createDialog(e,"UAC",!0))break;if(this._status=O.STATUS_1XX_RECEIVED,!e.body){this._progress("remote",e);break}var r={originator:"remote",type:"answer",sdp:e.body};w.debug('emit "sdp"'),this.emit("sdp",r);var o=new RTCSessionDescription({type:"answer",sdp:r.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then((function(){return t._connection.setRemoteDescription(o)})).then((function(){return t._progress("remote",e)})).catch((function(e){w.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),t.emit("peerconnection:setremotedescriptionfailed",e)}));break;case/^2[0-9]{2}$/.test(e.status_code):if(this._status=O.STATUS_CONFIRMED,!e.body){this._acceptAndTerminate(e,400,m.causes.MISSING_SDP),this._failed("remote",e,m.causes.BAD_MEDIA_DESCRIPTION);break}if(!this._createDialog(e,"UAC"))break;var i={originator:"remote",type:"answer",sdp:e.body};w.debug('emit "sdp"'),this.emit("sdp",i);var a=new RTCSessionDescription({type:"answer",sdp:i.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then((function(){if("stable"===t._connection.signalingState)return t._connection.createOffer(t._rtcOfferConstraints).then((function(e){return t._connection.setLocalDescription(e)})).catch((function(n){t._acceptAndTerminate(e,500,n.toString()),t._failed("local",e,m.causes.WEBRTC_ERROR)}))})).then((function(){t._connection.setRemoteDescription(a).then((function(){t._handleSessionTimersInIncomingResponse(e),t._accepted("remote",e),t.sendRequest(m.ACK),t._confirmed("local",null)})).catch((function(n){t._acceptAndTerminate(e,488,"Not Acceptable Here"),t._failed("remote",e,m.causes.BAD_MEDIA_DESCRIPTION),w.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',n),t.emit("peerconnection:setremotedescriptionfailed",n)}))}));break;default:var s=g.sipErrorCause(e.status_code);this._failed("remote",e,s)}}},{key:"_sendReinvite",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};w.debug("sendReinvite()");var n=g.cloneArray(t.extraHeaders),r=g.cloneObject(t.eventHandlers),o=t.rtcOfferConstraints||this._rtcOfferConstraints||null,i=!1;function a(e){var t=this;if(this._status!==O.STATUS_TERMINATED&&(this.sendRequest(m.ACK),!i))if(this._handleSessionTimersInIncomingResponse(e),e.body)if(e.hasHeader("Content-Type")&&"application/sdp"===e.getHeader("Content-Type").toLowerCase()){var n={originator:"remote",type:"answer",sdp:e.body};w.debug('emit "sdp"'),this.emit("sdp",n);var o=new RTCSessionDescription({type:"answer",sdp:n.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then((function(){return t._connection.setRemoteDescription(o)})).then((function(){r.succeeded&&r.succeeded(e)})).catch((function(e){s.call(t),w.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),t.emit("peerconnection:setremotedescriptionfailed",e)}))}else s.call(this);else s.call(this)}function s(e){r.failed&&r.failed(e)}n.push("Contact: ".concat(this._contact)),n.push("Content-Type: application/sdp"),this._sessionTimers.running&&n.push("Session-Expires: ".concat(this._sessionTimers.currentExpires,";refresher=").concat(this._sessionTimers.refresher?"uac":"uas")),this._connectionPromiseQueue=this._connectionPromiseQueue.then((function(){return e._createLocalDescription("offer",o)})).then((function(t){var r={originator:"local",type:"offer",sdp:t=e._mangleOffer(t)};w.debug('emit "sdp"'),e.emit("sdp",r),e.sendRequest(m.INVITE,{extraHeaders:n,body:t,eventHandlers:{onSuccessResponse:function(t){a.call(e,t),i=!0},onErrorResponse:function(t){s.call(e,t)},onTransportError:function(){e.onTransportError()},onRequestTimeout:function(){e.onRequestTimeout()},onDialogError:function(){e.onDialogError()}}})})).catch((function(){s()}))}},{key:"_sendUpdate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};w.debug("sendUpdate()");var n=g.cloneArray(t.extraHeaders),r=g.cloneObject(t.eventHandlers),o=t.rtcOfferConstraints||this._rtcOfferConstraints||null,i=t.sdpOffer||!1,a=!1;function s(e){var t=this;if(this._status!==O.STATUS_TERMINATED&&!a)if(this._handleSessionTimersInIncomingResponse(e),i){if(!e.body)return void l.call(this);if(!e.hasHeader("Content-Type")||"application/sdp"!==e.getHeader("Content-Type").toLowerCase())return void l.call(this);var n={originator:"remote",type:"answer",sdp:e.body};w.debug('emit "sdp"'),this.emit("sdp",n);var o=new RTCSessionDescription({type:"answer",sdp:n.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then((function(){return t._connection.setRemoteDescription(o)})).then((function(){r.succeeded&&r.succeeded(e)})).catch((function(e){l.call(t),w.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),t.emit("peerconnection:setremotedescriptionfailed",e)}))}else r.succeeded&&r.succeeded(e)}function l(e){r.failed&&r.failed(e)}n.push("Contact: ".concat(this._contact)),this._sessionTimers.running&&n.push("Session-Expires: ".concat(this._sessionTimers.currentExpires,";refresher=").concat(this._sessionTimers.refresher?"uac":"uas")),i?(n.push("Content-Type: application/sdp"),this._connectionPromiseQueue=this._connectionPromiseQueue.then((function(){return e._createLocalDescription("offer",o)})).then((function(t){var r={originator:"local",type:"offer",sdp:t=e._mangleOffer(t)};w.debug('emit "sdp"'),e.emit("sdp",r),e.sendRequest(m.UPDATE,{extraHeaders:n,body:t,eventHandlers:{onSuccessResponse:function(t){s.call(e,t),a=!0},onErrorResponse:function(t){l.call(e,t)},onTransportError:function(){e.onTransportError()},onRequestTimeout:function(){e.onRequestTimeout()},onDialogError:function(){e.onDialogError()}}})})).catch((function(){l.call(e)}))):this.sendRequest(m.UPDATE,{extraHeaders:n,eventHandlers:{onSuccessResponse:function(t){s.call(e,t)},onErrorResponse:function(t){l.call(e,t)},onTransportError:function(){e.onTransportError()},onRequestTimeout:function(){e.onRequestTimeout()},onDialogError:function(){e.onDialogError()}}})}},{key:"_acceptAndTerminate",value:function(e,t,n){w.debug("acceptAndTerminate()");var r=[];t&&(n=n||m.REASON_PHRASE[t]||"",r.push("Reason: SIP ;cause=".concat(t,'; text="').concat(n,'"'))),(this._dialog||this._createDialog(e,"UAC"))&&(this.sendRequest(m.ACK),this.sendRequest(m.BYE,{extraHeaders:r})),this._status=O.STATUS_TERMINATED}},{key:"_mangleOffer",value:function(e){if(!this._localHold&&!this._remoteHold)return e;if(e=p.parse(e),this._localHold&&!this._remoteHold){w.debug("mangleOffer() | me on hold, mangling offer");var t,n=o(e.media);try{for(n.s();!(t=n.n()).done;){var r=t.value;-1!==P.indexOf(r.type)&&(r.direction?"sendrecv"===r.direction?r.direction="sendonly":"recvonly"===r.direction&&(r.direction="inactive"):r.direction="sendonly")}}catch(e){n.e(e)}finally{n.f()}}else if(this._localHold&&this._remoteHold){w.debug("mangleOffer() | both on hold, mangling offer");var i,a=o(e.media);try{for(a.s();!(i=a.n()).done;){var s=i.value;-1!==P.indexOf(s.type)&&(s.direction="inactive")}}catch(e){a.e(e)}finally{a.f()}}else if(this._remoteHold){w.debug("mangleOffer() | remote on hold, mangling offer");var l,u=o(e.media);try{for(u.s();!(l=u.n()).done;){var c=l.value;-1!==P.indexOf(c.type)&&(c.direction?"sendrecv"===c.direction?c.direction="recvonly":"recvonly"===c.direction&&(c.direction="inactive"):c.direction="recvonly")}}catch(e){u.e(e)}finally{u.f()}}return p.write(e)}},{key:"_setLocalMediaStatus",value:function(){var e=!0,t=!0;(this._localHold||this._remoteHold)&&(e=!1,t=!1),this._audioMuted&&(e=!1),this._videoMuted&&(t=!1),this._toggleMuteAudio(!e),this._toggleMuteVideo(!t)}},{key:"_handleSessionTimersInIncomingRequest",value:function(e,t){var n;this._sessionTimers.enabled&&(e.session_expires&&e.session_expires>=m.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=e.session_expires,n=e.session_expires_refresher||"uas"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,n="uas"),t.push("Session-Expires: ".concat(this._sessionTimers.currentExpires,";refresher=").concat(n)),this._sessionTimers.refresher="uas"===n,this._runSessionTimer())}},{key:"_handleSessionTimersInIncomingResponse",value:function(e){var t;this._sessionTimers.enabled&&(e.session_expires&&e.session_expires>=m.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=e.session_expires,t=e.session_expires_refresher||"uac"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,t="uac"),this._sessionTimers.refresher="uac"===t,this._runSessionTimer())}},{key:"_runSessionTimer",value:function(){var e=this,t=this._sessionTimers.currentExpires;this._sessionTimers.running=!0,clearTimeout(this._sessionTimers.timer),this._sessionTimers.refresher?this._sessionTimers.timer=setTimeout((function(){e._status!==O.STATUS_TERMINATED&&e._isReadyToReOffer()&&(w.debug("runSessionTimer() | sending session refresh request"),e._sessionTimers.refreshMethod===m.UPDATE?e._sendUpdate():e._sendReinvite())}),500*t):this._sessionTimers.timer=setTimeout((function(){e._status!==O.STATUS_TERMINATED&&(w.warn("runSessionTimer() | timer expired, terminating the session"),e.terminate({cause:m.causes.REQUEST_TIMEOUT,status_code:408,reason_phrase:"Session Timer Expired"}))}),1100*t)}},{key:"_toggleMuteAudio",value:function(e){var t,n=this._connection.getSenders().filter((function(e){return e.track&&"audio"===e.track.kind})),r=o(n);try{for(r.s();!(t=r.n()).done;){t.value.track.enabled=!e}}catch(e){r.e(e)}finally{r.f()}}},{key:"_toggleMuteVideo",value:function(e){var t,n=this._connection.getSenders().filter((function(e){return e.track&&"video"===e.track.kind})),r=o(n);try{for(r.s();!(t=r.n()).done;){t.value.track.enabled=!e}}catch(e){r.e(e)}finally{r.f()}}},{key:"_newRTCSession",value:function(e,t){w.debug("newRTCSession()"),this._ua.newRTCSession(this,{originator:e,session:this,request:t})}},{key:"_connecting",value:function(e){w.debug("session connecting"),w.debug('emit "connecting"'),this.emit("connecting",{request:e})}},{key:"_progress",value:function(e,t){w.debug("session progress"),w.debug('emit "progress"'),this.emit("progress",{originator:e,response:t||null})}},{key:"_accepted",value:function(e,t){w.debug("session accepted"),this._start_time=new Date,w.debug('emit "accepted"'),this.emit("accepted",{originator:e,response:t||null})}},{key:"_confirmed",value:function(e,t){w.debug("session confirmed"),this._is_confirmed=!0,w.debug('emit "confirmed"'),this.emit("confirmed",{originator:e,ack:t||null})}},{key:"_ended",value:function(e,t,n){w.debug("session ended"),this._end_time=new Date,this._close(),w.debug('emit "ended"'),this.emit("ended",{originator:e,message:t||null,cause:n})}},{key:"_failed",value:function(e,t,n){w.debug("session failed"),w.debug('emit "_failed"'),this.emit("_failed",{originator:e,message:t||null,cause:n}),this._close(),w.debug('emit "failed"'),this.emit("failed",{originator:e,message:t||null,cause:n})}},{key:"_onhold",value:function(e){w.debug("session onhold"),this._setLocalMediaStatus(),w.debug('emit "hold"'),this.emit("hold",{originator:e})}},{key:"_onunhold",value:function(e){w.debug("session onunhold"),this._setLocalMediaStatus(),w.debug('emit "unhold"'),this.emit("unhold",{originator:e})}},{key:"_onmute",value:function(e){var t=e.audio,n=e.video;w.debug("session onmute"),this._setLocalMediaStatus(),w.debug('emit "muted"'),this.emit("muted",{audio:t,video:n})}},{key:"_onunmute",value:function(e){var t=e.audio,n=e.video;w.debug("session onunmute"),this._setLocalMediaStatus(),w.debug('emit "unmuted"'),this.emit("unmuted",{audio:t,video:n})}},{key:"C",get:function(){return O}},{key:"causes",get:function(){return m.causes}},{key:"id",get:function(){return this._id}},{key:"connection",get:function(){return this._connection}},{key:"contact",get:function(){return this._contact}},{key:"direction",get:function(){return this._direction}},{key:"local_identity",get:function(){return this._local_identity}},{key:"remote_identity",get:function(){return this._remote_identity}},{key:"start_time",get:function(){return this._start_time}},{key:"end_time",get:function(){return this._end_time}},{key:"data",get:function(){return this._data},set:function(e){this._data=e}},{key:"status",get:function(){return this._status}}]),n}(f)},4481:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var o=l(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return s(this,n)}}function s(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}var u=n(7187).EventEmitter,c=n(356),d=n(965),f=n(8063),p=n(5424),h=new c("RTCSession:DTMF"),m={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};e.exports=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(l,e);var t,n,r,s=a(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=s.call(this))._session=e,t._direction=null,t._tone=null,t._duration=null,t._request=null,t}return t=l,n=[{key:"send",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(void 0===e)throw new TypeError("Not enough arguments");if(this._direction="outgoing",this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK)throw new f.InvalidStateError(this._session.status);var r=p.cloneArray(n.extraHeaders);if(this.eventHandlers=p.cloneObject(n.eventHandlers),"string"==typeof e)e=e.toUpperCase();else{if("number"!=typeof e)throw new TypeError("Invalid tone: ".concat(e));e=e.toString()}if(!e.match(/^[0-9A-DR#*]$/))throw new TypeError("Invalid tone: ".concat(e));this._tone=e,this._duration=n.duration,r.push("Content-Type: application/dtmf-relay");var o="Signal=".concat(this._tone,"\r\n");o+="Duration=".concat(this._duration),this._session.newDTMF({originator:"local",dtmf:this,request:this._request}),this._session.sendRequest(d.INFO,{extraHeaders:r,eventHandlers:{onSuccessResponse:function(e){t.emit("succeeded",{originator:"remote",response:e})},onErrorResponse:function(e){t.eventHandlers.onFailed&&t.eventHandlers.onFailed(),t.emit("failed",{originator:"remote",response:e})},onRequestTimeout:function(){t._session.onRequestTimeout()},onTransportError:function(){t._session.onTransportError()},onDialogError:function(){t._session.onDialogError()}},body:o})}},{key:"init_incoming",value:function(e){var t=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,n=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;if(this._direction="incoming",this._request=e,e.reply(200),e.body){var r=e.body.split("\n");r.length>=1&&t.test(r[0])&&(this._tone=r[0].replace(t,"$2")),r.length>=2&&n.test(r[1])&&(this._duration=parseInt(r[1].replace(n,"$2"),10))}this._duration||(this._duration=m.DEFAULT_DURATION),this._tone?this._session.newDTMF({originator:"remote",dtmf:this,request:e}):h.debug("invalid INFO DTMF received, discarded")}},{key:"tone",get:function(){return this._tone}},{key:"duration",get:function(){return this._duration}}],n&&o(t.prototype,n),r&&o(t,r),l}(u),e.exports.C=m},2126:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var o=l(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return s(this,n)}}function s(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}var u=n(7187).EventEmitter,c=n(965),d=n(8063),f=n(5424);e.exports=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(l,e);var t,n,r,s=a(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=s.call(this))._session=e,t._direction=null,t._contentType=null,t._body=null,t}return t=l,n=[{key:"send",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._direction="outgoing",void 0===e)throw new TypeError("Not enough arguments");if(this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK)throw new d.InvalidStateError(this._session.status);this._contentType=e,this._body=t;var o=f.cloneArray(r.extraHeaders);o.push("Content-Type: ".concat(e)),this._session.newInfo({originator:"local",info:this,request:this.request}),this._session.sendRequest(c.INFO,{extraHeaders:o,eventHandlers:{onSuccessResponse:function(e){n.emit("succeeded",{originator:"remote",response:e})},onErrorResponse:function(e){n.emit("failed",{originator:"remote",response:e})},onTransportError:function(){n._session.onTransportError()},onRequestTimeout:function(){n._session.onRequestTimeout()},onDialogError:function(){n._session.onDialogError()}},body:t})}},{key:"init_incoming",value:function(e){this._direction="incoming",this.request=e,e.reply(200),this._contentType=e.hasHeader("Content-Type")?e.getHeader("Content-Type").toLowerCase():void 0,this._body=e.body,this._session.newInfo({originator:"remote",info:this,request:e})}},{key:"contentType",get:function(){return this._contentType}},{key:"body",get:function(){return this._body}}],n&&o(t.prototype,n),r&&o(t,r),l}(u)},5774:(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(356),i=n(965),a=new o("RTCSession:ReferNotifier"),s="refer",l="message/sipfrag;version=2.0",u=300;e.exports=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._session=t,this._id=n,this._expires=r||u,this._active=!0,this.notify(100)}var t,n,o;return t=e,(n=[{key:"notify",value:function(e,t){var n;a.debug("notify()"),!1!==this._active&&(t=t||i.REASON_PHRASE[e]||"",n=e>=200?"terminated;reason=noresource":"active;expires=".concat(this._expires),this._session.sendRequest(i.NOTIFY,{extraHeaders:["Event: ".concat(s,";id=").concat(this._id),"Subscription-State: ".concat(n),"Content-Type: ".concat(l)],body:"SIP/2.0 ".concat(e," ").concat(t),eventHandlers:{onErrorResponse:function(){this._active=!1}}}))}}])&&r(t.prototype,n),o&&r(t,o),e}()},603:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var o=l(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return s(this,n)}}function s(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}var u=n(7187).EventEmitter,c=n(356),d=n(965),f=n(3790),p=n(5424),h=new c("RTCSession:ReferSubscriber");e.exports=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(l,e);var t,n,r,s=a(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=s.call(this))._id=null,t._session=e,t}return t=l,n=[{key:"sendRefer",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};h.debug("sendRefer()");var r=p.cloneArray(n.extraHeaders),o=p.cloneObject(n.eventHandlers);for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&this.on(i,o[i]);var a=null;n.replaces&&(a=n.replaces._request.call_id,a+=";to-tag=".concat(n.replaces._to_tag),a+=";from-tag=".concat(n.replaces._from_tag),a=encodeURIComponent(a));var s="Refer-To: <".concat(e).concat(a?"?Replaces=".concat(a):"",">");if(r.push(s),!r.some((function(e){return e.toLowerCase().startsWith("referred-by:")}))){var l="Referred-By: <".concat(this._session._ua._configuration.uri._scheme,":").concat(this._session._ua._configuration.uri._user,"@").concat(this._session._ua._configuration.uri._host,">");r.push(l)}r.push("Contact: ".concat(this._session.contact));var u=this._session.sendRequest(d.REFER,{extraHeaders:r,eventHandlers:{onSuccessResponse:function(e){t._requestSucceeded(e)},onErrorResponse:function(e){t._requestFailed(e,d.causes.REJECTED)},onTransportError:function(){t._requestFailed(null,d.causes.CONNECTION_ERROR)},onRequestTimeout:function(){t._requestFailed(null,d.causes.REQUEST_TIMEOUT)},onDialogError:function(){t._requestFailed(null,d.causes.DIALOG_ERROR)}}});this._id=u.cseq}},{key:"receiveNotify",value:function(e){if(h.debug("receiveNotify()"),e.body){var t=f.parse(e.body.trim(),"Status_Line");if(-1!==t)switch(!0){case/^100$/.test(t.status_code):this.emit("trying",{request:e,status_line:t});break;case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",{request:e,status_line:t});break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("accepted",{request:e,status_line:t});break;default:this.emit("failed",{request:e,status_line:t})}else h.debug('receiveNotify() | error parsing NOTIFY body: "'.concat(e.body,'"'))}}},{key:"_requestSucceeded",value:function(e){h.debug("REFER succeeded"),h.debug('emit "requestSucceeded"'),this.emit("requestSucceeded",{response:e})}},{key:"_requestFailed",value:function(e,t){h.debug("REFER failed"),h.debug('emit "requestFailed"'),this.emit("requestFailed",{response:e||null,cause:t})}},{key:"id",get:function(){return this._id}}],n&&o(t.prototype,n),r&&o(t,r),l}(u)},116:(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(356),i=n(5424),a=n(965),s=n(6497),l=n(2066),u=new o("Registrator");e.exports=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._reg_id=1,this._ua=t,this._transport=n,this._registrar=t.configuration.registrar_server,this._expires=t.configuration.register_expires,this._call_id=i.createRandomToken(22),this._cseq=0,this._to_uri=t.configuration.uri,this._registrationTimer=null,this._registering=!1,this._registered=!1,this._contact=this._ua.contact.toString(),this._contact+=";+sip.ice",this._extraHeaders=[],this._extraContactParams="",this._sipInstance='"<urn:uuid:'.concat(this._ua.configuration.instance_id,'>"'),this._contact+=";reg-id=".concat(this._reg_id),this._contact+=";+sip.instance=".concat(this._sipInstance)}var t,n,o;return t=e,n=[{key:"setExtraHeaders",value:function(e){Array.isArray(e)||(e=[]),this._extraHeaders=e.slice()}},{key:"setExtraContactParams",value:function(e){for(var t in e instanceof Object||(e={}),this._extraContactParams="",e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=e[t];this._extraContactParams+=";".concat(t),n&&(this._extraContactParams+="=".concat(n))}}},{key:"register",value:function(){var e=this;if(this._registering)u.debug("Register request in progress...");else{var t=this._extraHeaders.slice();t.push("Contact: ".concat(this._contact,";expires=").concat(this._expires).concat(this._extraContactParams)),t.push("Expires: ".concat(this._expires));var n=new s.OutgoingRequest(a.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1},t),r=new l(this._ua,n,{onRequestTimeout:function(){e._registrationFailure(null,a.causes.REQUEST_TIMEOUT)},onTransportError:function(){e._registrationFailure(null,a.causes.CONNECTION_ERROR)},onAuthenticated:function(){e._cseq+=1},onReceiveResponse:function(t){if(t.cseq===e._cseq)switch(null!==e._registrationTimer&&(clearTimeout(e._registrationTimer),e._registrationTimer=null),!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):if(e._registering=!1,!t.hasHeader("Contact")){u.debug("no Contact header in response to REGISTER, response ignored");break}var n=t.headers.Contact.reduce((function(e,t){return e.concat(t.parsed)}),[]),r=n.find((function(t){return e._sipInstance===t.getParam("+sip.instance")&&e._reg_id===parseInt(t.getParam("reg-id"))}));if(r||(r=n.find((function(t){return t.uri.user===e._ua.contact.uri.user}))),!r){u.debug("no Contact header pointing to us, response ignored");break}var o=r.getParam("expires");!o&&t.hasHeader("expires")&&(o=t.getHeader("expires")),o||(o=e._expires),(o=Number(o))<10&&(o=10);var s=o>64?1e3*o/2+Math.floor(1e3*(o/2-32)*Math.random()):1e3*o-5e3;e._registrationTimer=setTimeout((function(){e._registrationTimer=null,0===e._ua.listeners("registrationExpiring").length?e.register():e._ua.emit("registrationExpiring")}),s),r.hasParam("temp-gruu")&&(e._ua.contact.temp_gruu=r.getParam("temp-gruu").replace(/"/g,"")),r.hasParam("pub-gruu")&&(e._ua.contact.pub_gruu=r.getParam("pub-gruu").replace(/"/g,"")),e._registered||(e._registered=!0,e._ua.registered({response:t}));break;case/^423$/.test(t.status_code):t.hasHeader("min-expires")?(e._expires=Number(t.getHeader("min-expires")),e._expires<10&&(e._expires=10),e.register()):(u.debug("423 response received for REGISTER without Min-Expires"),e._registrationFailure(t,a.causes.SIP_FAILURE_CODE));break;default:var l=i.sipErrorCause(t.status_code);e._registrationFailure(t,l)}}});this._registering=!0,r.send()}}},{key:"unregister",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._registered){this._registered=!1,null!==this._registrationTimer&&(clearTimeout(this._registrationTimer),this._registrationTimer=null);var n=this._extraHeaders.slice();t.all?n.push("Contact: *".concat(this._extraContactParams)):n.push("Contact: ".concat(this._contact,";expires=0").concat(this._extraContactParams)),n.push("Expires: 0");var r=new s.OutgoingRequest(a.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1},n),o=new l(this._ua,r,{onRequestTimeout:function(){e._unregistered(null,a.causes.REQUEST_TIMEOUT)},onTransportError:function(){e._unregistered(null,a.causes.CONNECTION_ERROR)},onAuthenticated:function(){e._cseq+=1},onReceiveResponse:function(t){switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):e._unregistered(t);break;default:var n=i.sipErrorCause(t.status_code);e._unregistered(t,n)}}});o.send()}else u.debug("already unregistered")}},{key:"close",value:function(){this._registered&&this.unregister()}},{key:"onTransportClosed",value:function(){this._registering=!1,null!==this._registrationTimer&&(clearTimeout(this._registrationTimer),this._registrationTimer=null),this._registered&&(this._registered=!1,this._ua.unregistered({}))}},{key:"_registrationFailure",value:function(e,t){this._registering=!1,this._ua.registrationFailed({response:e||null,cause:t}),this._registered&&(this._registered=!1,this._ua.unregistered({response:e||null,cause:t}))}},{key:"_unregistered",value:function(e,t){this._registering=!1,this._registered=!1,this._ua.unregistered({response:e||null,cause:t||null})}},{key:"registered",get:function(){return this._registered}}],n&&r(t.prototype,n),o&&r(t,o),e}()},2066:(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(356),i=n(965),a=n(2999),s=n(3754),l=new o("RequestSender"),u={onRequestTimeout:function(){},onTransportError:function(){},onReceiveResponse:function(){},onAuthenticated:function(){}};e.exports=function(){function e(t,n,r){for(var o in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._ua=t,this._eventHandlers=r,this._method=n.method,this._request=n,this._auth=null,this._challenged=!1,this._staled=!1,u)Object.prototype.hasOwnProperty.call(u,o)&&(this._eventHandlers[o]||(this._eventHandlers[o]=u[o]));t.status!==t.C.STATUS_USER_CLOSED||this._method===i.BYE&&this._method===i.ACK||this._eventHandlers.onTransportError()}var t,n,o;return t=e,(n=[{key:"send",value:function(){var e=this,t={onRequestTimeout:function(){e._eventHandlers.onRequestTimeout()},onTransportError:function(){e._eventHandlers.onTransportError()},onReceiveResponse:function(t){e._receiveResponse(t)}};switch(this._method){case"INVITE":this.clientTransaction=new s.InviteClientTransaction(this._ua,this._ua.transport,this._request,t);break;case"ACK":this.clientTransaction=new s.AckClientTransaction(this._ua,this._ua.transport,this._request,t);break;default:this.clientTransaction=new s.NonInviteClientTransaction(this._ua,this._ua.transport,this._request,t)}this._ua._configuration.authorization_jwt&&this._request.setHeader("Authorization",this._ua._configuration.authorization_jwt),this.clientTransaction.send()}},{key:"_receiveResponse",value:function(e){var t,n,r=e.status_code;if(401!==r&&407!==r||null===this._ua.configuration.password&&null===this._ua.configuration.ha1)this._eventHandlers.onReceiveResponse(e);else{if(401===e.status_code?(t=e.parseHeader("www-authenticate"),n="authorization"):(t=e.parseHeader("proxy-authenticate"),n="proxy-authorization"),!t)return l.debug("".concat(e.status_code," with wrong or missing challenge, cannot authenticate")),void this._eventHandlers.onReceiveResponse(e);if(!this._challenged||!this._staled&&!0===t.stale){if(this._auth||(this._auth=new a({username:this._ua.configuration.authorization_user,password:this._ua.configuration.password,realm:this._ua.configuration.realm,ha1:this._ua.configuration.ha1})),!this._auth.authenticate(this._request,t))return void this._eventHandlers.onReceiveResponse(e);this._challenged=!0,this._ua.set("realm",this._auth.get("realm")),this._ua.set("ha1",this._auth.get("ha1")),t.stale&&(this._staled=!0),this._request=this._request.clone(),this._request.cseq+=1,this._request.setHeader("cseq","".concat(this._request.cseq," ").concat(this._method)),this._request.setHeader(n,this._auth.toString()),this._eventHandlers.onAuthenticated(this._request),this.send()}else this._eventHandlers.onReceiveResponse(e)}}}])&&r(t.prototype,n),o&&r(t,o),e}()},6497:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var o=l(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return s(this,n)}}function s(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function u(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),e}var h=n(766),m=n(356),_=n(965),v=n(5424),g=n(9437),y=n(3790),S=new m("SIPMessage"),T=function(){function e(t,n,r,o,i,a){if(d(this,e),!t||!n||!r)return null;o=o||{},this.ua=r,this.headers={},this.method=t,this.ruri=n,this.body=a,this.extraHeaders=v.cloneArray(i),o.route_set?this.setHeader("route",o.route_set):r.configuration.use_preloaded_route&&this.setHeader("route","<".concat(r.transport.sip_uri,";lr>")),this.setHeader("via",""),this.setHeader("max-forwards",_.MAX_FORWARDS);var s=o.to_uri||n,l=o.to_tag?{tag:o.to_tag}:null,u=void 0!==o.to_display_name?o.to_display_name:null;this.to=new g(s,u,l),this.setHeader("to",this.to.toString());var c,f=o.from_uri||r.configuration.uri,p={tag:o.from_tag||v.newTag()};c=void 0!==o.from_display_name?o.from_display_name:r.configuration.display_name?r.configuration.display_name:null,this.from=new g(f,c,p),this.setHeader("from",this.from.toString());var h=o.call_id||r.configuration.jssip_id+v.createRandomToken(15);this.call_id=h,this.setHeader("call-id",h);var m=o.cseq||Math.floor(1e4*Math.random());this.cseq=m,this.setHeader("cseq","".concat(m," ").concat(t))}return p(e,[{key:"setHeader",value:function(e,t){for(var n=new RegExp("^\\s*".concat(e,"\\s*:"),"i"),r=0;r<this.extraHeaders.length;r++)n.test(this.extraHeaders[r])&&this.extraHeaders.splice(r,1);this.headers[v.headerize(e)]=Array.isArray(t)?t:[t]}},{key:"getHeader",value:function(e){var t=this.headers[v.headerize(e)];if(t){if(t[0])return t[0]}else{var n,r=new RegExp("^\\s*".concat(e,"\\s*:"),"i"),o=u(this.extraHeaders);try{for(o.s();!(n=o.n()).done;){var i=n.value;if(r.test(i))return i.substring(i.indexOf(":")+1).trim()}}catch(e){o.e(e)}finally{o.f()}}}},{key:"getHeaders",value:function(e){var t=this.headers[v.headerize(e)],n=[];if(t){var r,o=u(t);try{for(o.s();!(r=o.n()).done;){var i=r.value;n.push(i)}}catch(e){o.e(e)}finally{o.f()}return n}var a,s=new RegExp("^\\s*".concat(e,"\\s*:"),"i"),l=u(this.extraHeaders);try{for(l.s();!(a=l.n()).done;){var c=a.value;s.test(c)&&n.push(c.substring(c.indexOf(":")+1).trim())}}catch(e){l.e(e)}finally{l.f()}return n}},{key:"hasHeader",value:function(e){if(this.headers[v.headerize(e)])return!0;var t,n=new RegExp("^\\s*".concat(e,"\\s*:"),"i"),r=u(this.extraHeaders);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(n.test(o))return!0}}catch(e){r.e(e)}finally{r.f()}return!1}},{key:"parseSDP",value:function(e){return!e&&this.sdp||(this.sdp=h.parse(this.body||"")),this.sdp}},{key:"toString",value:function(){var e="".concat(this.method," ").concat(this.ruri," SIP/2.0\r\n");for(var t in this.headers)if(Object.prototype.hasOwnProperty.call(this.headers,t)){var n,r=u(this.headers[t]);try{for(r.s();!(n=r.n()).done;){var o=n.value;e+="".concat(t,": ").concat(o,"\r\n")}}catch(e){r.e(e)}finally{r.f()}}var i,a=u(this.extraHeaders);try{for(a.s();!(i=a.n()).done;){var s=i.value;e+="".concat(s.trim(),"\r\n")}}catch(e){a.e(e)}finally{a.f()}var l=[];switch(this.method){case _.REGISTER:l.push("path","gruu");break;case _.INVITE:this.ua.configuration.session_timers&&l.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&l.push("gruu"),l.push("ice","replaces");break;case _.UPDATE:this.ua.configuration.session_timers&&l.push("timer"),l.push("ice")}l.push("outbound");var c=this.ua.configuration.user_agent||_.USER_AGENT;if(e+="Allow: ".concat(_.ALLOWED_METHODS,"\r\n"),e+="Supported: ".concat(l,"\r\n"),e+="User-Agent: ".concat(c,"\r\n"),this.body){var d=v.str_utf8_length(this.body);e+="Content-Length: ".concat(d,"\r\n\r\n"),e+=this.body}else e+="Content-Length: 0\r\n\r\n";return e}},{key:"clone",value:function(){var t=new e(this.method,this.ruri,this.ua);return Object.keys(this.headers).forEach((function(e){t.headers[e]=this.headers[e].slice()}),this),t.body=this.body,t.extraHeaders=v.cloneArray(this.extraHeaders),t.to=this.to,t.from=this.from,t.call_id=this.call_id,t.cseq=this.cseq,t}}]),e}(),C=function(e){o(n,e);var t=a(n);function n(e,r,o,i,a){var s;return d(this,n),(s=t.call(this,_.INVITE,e,r,o,i,a)).transaction=null,s}return p(n,[{key:"cancel",value:function(e){this.transaction.cancel(e)}},{key:"clone",value:function(){var e=new n(this.ruri,this.ua);return Object.keys(this.headers).forEach((function(t){e.headers[t]=this.headers[t].slice()}),this),e.body=this.body,e.extraHeaders=v.cloneArray(this.extraHeaders),e.to=this.to,e.from=this.from,e.call_id=this.call_id,e.cseq=this.cseq,e.transaction=this.transaction,e}}]),n}(T),E=function(){function e(){d(this,e),this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null,this.sdp=null}return p(e,[{key:"addHeader",value:function(e,t){var n={raw:t};e=v.headerize(e),this.headers[e]?this.headers[e].push(n):this.headers[e]=[n]}},{key:"getHeader",value:function(e){var t=this.headers[v.headerize(e)];if(t)return t[0]?t[0].raw:void 0}},{key:"getHeaders",value:function(e){var t=this.headers[v.headerize(e)],n=[];if(!t)return[];var r,o=u(t);try{for(o.s();!(r=o.n()).done;){var i=r.value;n.push(i.raw)}}catch(e){o.e(e)}finally{o.f()}return n}},{key:"hasHeader",value:function(e){return!!this.headers[v.headerize(e)]}},{key:"parseHeader",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e=v.headerize(e),this.headers[e]){if(!(t>=this.headers[e].length)){var n=this.headers[e][t],r=n.raw;if(n.parsed)return n.parsed;var o=y.parse(r,e.replace(/-/g,"_"));return-1===o?(this.headers[e].splice(t,1),void S.debug('error parsing "'.concat(e,'" header field with value "').concat(r,'"'))):(n.parsed=o,o)}S.debug('not so many "'.concat(e,'" headers present'))}else S.debug('header "'.concat(e,'" not present'))}},{key:"s",value:function(e,t){return this.parseHeader(e,t)}},{key:"setHeader",value:function(e,t){var n={raw:t};this.headers[v.headerize(e)]=[n]}},{key:"parseSDP",value:function(e){return!e&&this.sdp||(this.sdp=h.parse(this.body||"")),this.sdp}},{key:"toString",value:function(){return this.data}}]),e}(),R=function(e){o(n,e);var t=a(n);function n(e){var r;return d(this,n),(r=t.call(this)).ua=e,r.headers={},r.ruri=null,r.transport=null,r.server_transaction=null,r}return p(n,[{key:"reply",value:function(e,t,n,r,o,i){var a=[],s=this.getHeader("To");if(t=t||null,!(e=e||null)||e<100||e>699)throw new TypeError("Invalid status_code: ".concat(e));if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: ".concat(t));t=t||_.REASON_PHRASE[e]||"",n=v.cloneArray(n);var l="SIP/2.0 ".concat(e," ").concat(t,"\r\n");if(this.method===_.INVITE&&e>100&&e<=200){var c,d=u(this.getHeaders("record-route"));try{for(d.s();!(c=d.n()).done;){var f=c.value;l+="Record-Route: ".concat(f,"\r\n")}}catch(e){d.e(e)}finally{d.f()}}var p,h=u(this.getHeaders("via"));try{for(h.s();!(p=h.n()).done;){var m=p.value;l+="Via: ".concat(m,"\r\n")}}catch(e){h.e(e)}finally{h.f()}!this.to_tag&&e>100?s+=";tag=".concat(v.newTag()):this.to_tag&&!this.s("to").hasParam("tag")&&(s+=";tag=".concat(this.to_tag)),l+="To: ".concat(s,"\r\n"),l+="From: ".concat(this.getHeader("From"),"\r\n"),l+="Call-ID: ".concat(this.call_id,"\r\n"),l+="CSeq: ".concat(this.cseq," ").concat(this.method,"\r\n");var g,y=u(n);try{for(y.s();!(g=y.n()).done;){var S=g.value;l+="".concat(S.trim(),"\r\n")}}catch(e){y.e(e)}finally{y.f()}switch(this.method){case _.INVITE:this.ua.configuration.session_timers&&a.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&a.push("gruu"),a.push("ice","replaces");break;case _.UPDATE:this.ua.configuration.session_timers&&a.push("timer"),r&&a.push("ice"),a.push("replaces")}if(a.push("outbound"),this.method===_.OPTIONS?(l+="Allow: ".concat(_.ALLOWED_METHODS,"\r\n"),l+="Accept: ".concat(_.ACCEPTED_BODY_TYPES,"\r\n")):405===e?l+="Allow: ".concat(_.ALLOWED_METHODS,"\r\n"):415===e&&(l+="Accept: ".concat(_.ACCEPTED_BODY_TYPES,"\r\n")),l+="Supported: ".concat(a,"\r\n"),r){var T=v.str_utf8_length(r);l+="Content-Type: application/sdp\r\n",l+="Content-Length: ".concat(T,"\r\n\r\n"),l+=r}else l+="Content-Length: ".concat(0,"\r\n\r\n");this.server_transaction.receiveResponse(e,l,o,i)}},{key:"reply_sl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getHeaders("via");if(!e||e<100||e>699)throw new TypeError("Invalid status_code: ".concat(e));if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: ".concat(t));t=t||_.REASON_PHRASE[e]||"";var r,o="SIP/2.0 ".concat(e," ").concat(t,"\r\n"),i=u(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;o+="Via: ".concat(a,"\r\n")}}catch(e){i.e(e)}finally{i.f()}var s=this.getHeader("To");!this.to_tag&&e>100?s+=";tag=".concat(v.newTag()):this.to_tag&&!this.s("to").hasParam("tag")&&(s+=";tag=".concat(this.to_tag)),o+="To: ".concat(s,"\r\n"),o+="From: ".concat(this.getHeader("From"),"\r\n"),o+="Call-ID: ".concat(this.call_id,"\r\n"),o+="CSeq: ".concat(this.cseq," ").concat(this.method,"\r\n"),o+="Content-Length: ".concat(0,"\r\n\r\n"),this.transport.send(o)}}]),n}(E),b=function(e){o(n,e);var t=a(n);function n(){var e;return d(this,n),(e=t.call(this)).headers={},e.status_code=null,e.reason_phrase=null,e}return n}(E);e.exports={OutgoingRequest:T,InitialOutgoingInviteRequest:C,IncomingRequest:R,IncomingResponse:b}},7351:(e,t,n)=>{"use strict";var r=n(356),o=n(5424),i=n(3790),a=new r("Socket");t.isSocket=function(e){if(Array.isArray(e))return!1;if(void 0===e)return a.warn("undefined JsSIP.Socket instance"),!1;try{if(!o.isString(e.url))throw a.warn("missing or invalid JsSIP.Socket url property"),new Error("Missing or invalid JsSIP.Socket url property");if(!o.isString(e.via_transport))throw a.warn("missing or invalid JsSIP.Socket via_transport property"),new Error("Missing or invalid JsSIP.Socket via_transport property");if(-1===i.parse(e.sip_uri,"SIP_URI"))throw a.warn("missing or invalid JsSIP.Socket sip_uri property"),new Error("missing or invalid JsSIP.Socket sip_uri property")}catch(e){return!1}try{["connect","disconnect","send"].forEach((function(t){if(!o.isFunction(e[t]))throw a.warn("missing or invalid JsSIP.Socket method: ".concat(t)),new Error("Missing or invalid JsSIP.Socket method: ".concat(t))}))}catch(e){return!1}return!0}},306:e=>{"use strict";var t=500;e.exports={T1:t,T2:4e3,T4:5e3,TIMER_B:32e3,TIMER_D:0,TIMER_F:32e3,TIMER_H:32e3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32e3,TIMER_M:32e3,PROVISIONAL_RESPONSE_INTERVAL:6e4}},3754:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return c(this,n)}}function c(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?d(e):t}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}var p=n(7187).EventEmitter,h=n(356),m=n(965),_=n(6497),v=n(306),g=new h("NonInviteClientTransaction"),y=new h("InviteClientTransaction"),S=new h("AckClientTransaction"),T=new h("NonInviteServerTransaction"),C=new h("InviteServerTransaction"),E={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"},R=function(e){s(n,e);var t=u(n);function n(e,r,i,a){var s;o(this,n),(s=t.call(this)).type=E.NON_INVITE_CLIENT,s.id="z9hG4bK".concat(Math.floor(1e7*Math.random())),s.ua=e,s.transport=r,s.request=i,s.eventHandlers=a;var l="SIP/2.0/".concat(r.via_transport);return l+=" ".concat(e.configuration.via_host,";branch=").concat(s.id),s.request.setHeader("via",l),s.ua.newTransaction(d(s)),s}return a(n,[{key:"stateChanged",value:function(e){this.state=e,this.emit("stateChanged")}},{key:"send",value:function(){var e=this;this.stateChanged(E.STATUS_TRYING),this.F=setTimeout((function(){e.timer_F()}),v.TIMER_F),this.transport.send(this.request)||this.onTransportError()}},{key:"onTransportError",value:function(){g.debug("transport error occurred, deleting transaction ".concat(this.id)),clearTimeout(this.F),clearTimeout(this.K),this.stateChanged(E.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onTransportError()}},{key:"timer_F",value:function(){g.debug("Timer F expired for transaction ".concat(this.id)),this.stateChanged(E.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout()}},{key:"timer_K",value:function(){this.stateChanged(E.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"receiveResponse",value:function(e){var t=this,n=e.status_code;if(n<200)switch(this.state){case E.STATUS_TRYING:case E.STATUS_PROCEEDING:this.stateChanged(E.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(e)}else switch(this.state){case E.STATUS_TRYING:case E.STATUS_PROCEEDING:this.stateChanged(E.STATUS_COMPLETED),clearTimeout(this.F),408===n?this.eventHandlers.onRequestTimeout():this.eventHandlers.onReceiveResponse(e),this.K=setTimeout((function(){t.timer_K()}),v.TIMER_K)}}},{key:"C",get:function(){return E}}]),n}(p),b=function(e){s(n,e);var t=u(n);function n(e,r,i,a){var s;o(this,n),(s=t.call(this)).type=E.INVITE_CLIENT,s.id="z9hG4bK".concat(Math.floor(1e7*Math.random())),s.ua=e,s.transport=r,s.request=i,s.eventHandlers=a,i.transaction=d(s);var l="SIP/2.0/".concat(r.via_transport);return l+=" ".concat(e.configuration.via_host,";branch=").concat(s.id),s.request.setHeader("via",l),s.ua.newTransaction(d(s)),s}return a(n,[{key:"stateChanged",value:function(e){this.state=e,this.emit("stateChanged")}},{key:"send",value:function(){var e=this;this.stateChanged(E.STATUS_CALLING),this.B=setTimeout((function(){e.timer_B()}),v.TIMER_B),this.transport.send(this.request)||this.onTransportError()}},{key:"onTransportError",value:function(){clearTimeout(this.B),clearTimeout(this.D),clearTimeout(this.M),this.state!==E.STATUS_ACCEPTED&&(y.debug("transport error occurred, deleting transaction ".concat(this.id)),this.eventHandlers.onTransportError()),this.stateChanged(E.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"timer_M",value:function(){y.debug("Timer M expired for transaction ".concat(this.id)),this.state===E.STATUS_ACCEPTED&&(clearTimeout(this.B),this.stateChanged(E.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"timer_B",value:function(){y.debug("Timer B expired for transaction ".concat(this.id)),this.state===E.STATUS_CALLING&&(this.stateChanged(E.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout())}},{key:"timer_D",value:function(){y.debug("Timer D expired for transaction ".concat(this.id)),clearTimeout(this.B),this.stateChanged(E.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"sendACK",value:function(e){var t=this,n=new _.OutgoingRequest(m.ACK,this.request.ruri,this.ua,{route_set:this.request.getHeaders("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq});n.setHeader("from",this.request.getHeader("from")),n.setHeader("via",this.request.getHeader("via")),n.setHeader("to",e.getHeader("to")),this.D=setTimeout((function(){t.timer_D()}),v.TIMER_D),this.transport.send(n)}},{key:"cancel",value:function(e){if(this.state===E.STATUS_PROCEEDING){var t=new _.OutgoingRequest(m.CANCEL,this.request.ruri,this.ua,{route_set:this.request.getHeaders("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq});t.setHeader("from",this.request.getHeader("from")),t.setHeader("via",this.request.getHeader("via")),t.setHeader("to",this.request.getHeader("to")),e&&t.setHeader("reason",e),this.transport.send(t)}}},{key:"receiveResponse",value:function(e){var t=this,n=e.status_code;if(n>=100&&n<=199)switch(this.state){case E.STATUS_CALLING:this.stateChanged(E.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(e);break;case E.STATUS_PROCEEDING:this.eventHandlers.onReceiveResponse(e)}else if(n>=200&&n<=299)switch(this.state){case E.STATUS_CALLING:case E.STATUS_PROCEEDING:this.stateChanged(E.STATUS_ACCEPTED),this.M=setTimeout((function(){t.timer_M()}),v.TIMER_M),this.eventHandlers.onReceiveResponse(e);break;case E.STATUS_ACCEPTED:this.eventHandlers.onReceiveResponse(e)}else if(n>=300&&n<=699)switch(this.state){case E.STATUS_CALLING:case E.STATUS_PROCEEDING:this.stateChanged(E.STATUS_COMPLETED),this.sendACK(e),this.eventHandlers.onReceiveResponse(e);break;case E.STATUS_COMPLETED:this.sendACK(e)}}},{key:"C",get:function(){return E}}]),n}(p),A=function(e){s(n,e);var t=u(n);function n(e,r,i,a){var s;o(this,n),(s=t.call(this)).id="z9hG4bK".concat(Math.floor(1e7*Math.random())),s.transport=r,s.request=i,s.eventHandlers=a;var l="SIP/2.0/".concat(r.via_transport);return l+=" ".concat(e.configuration.via_host,";branch=").concat(s.id),s.request.setHeader("via",l),s}return a(n,[{key:"send",value:function(){this.transport.send(this.request)||this.onTransportError()}},{key:"onTransportError",value:function(){S.debug("transport error occurred for transaction ".concat(this.id)),this.eventHandlers.onTransportError()}},{key:"C",get:function(){return E}}]),n}(p),I=function(e){s(n,e);var t=u(n);function n(e,r,i){var a;return o(this,n),(a=t.call(this)).type=E.NON_INVITE_SERVER,a.id=i.via_branch,a.ua=e,a.transport=r,a.request=i,a.last_response="",i.server_transaction=d(a),a.state=E.STATUS_TRYING,e.newTransaction(d(a)),a}return a(n,[{key:"stateChanged",value:function(e){this.state=e,this.emit("stateChanged")}},{key:"timer_J",value:function(){T.debug("Timer J expired for transaction ".concat(this.id)),this.stateChanged(E.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"onTransportError",value:function(){this.transportError||(this.transportError=!0,T.debug("transport error occurred, deleting transaction ".concat(this.id)),clearTimeout(this.J),this.stateChanged(E.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"receiveResponse",value:function(e,t,n,r){var o=this;if(100===e)switch(this.state){case E.STATUS_TRYING:this.stateChanged(E.STATUS_PROCEEDING),this.transport.send(t)||this.onTransportError();break;case E.STATUS_PROCEEDING:this.last_response=t,this.transport.send(t)?n&&n():(this.onTransportError(),r&&r())}else if(e>=200&&e<=699)switch(this.state){case E.STATUS_TRYING:case E.STATUS_PROCEEDING:this.stateChanged(E.STATUS_COMPLETED),this.last_response=t,this.J=setTimeout((function(){o.timer_J()}),v.TIMER_J),this.transport.send(t)?n&&n():(this.onTransportError(),r&&r())}}},{key:"C",get:function(){return E}}]),n}(p),w=function(e){s(n,e);var t=u(n);function n(e,r,i){var a;return o(this,n),(a=t.call(this)).type=E.INVITE_SERVER,a.id=i.via_branch,a.ua=e,a.transport=r,a.request=i,a.last_response="",i.server_transaction=d(a),a.state=E.STATUS_PROCEEDING,e.newTransaction(d(a)),a.resendProvisionalTimer=null,i.reply(100),a}return a(n,[{key:"stateChanged",value:function(e){this.state=e,this.emit("stateChanged")}},{key:"timer_H",value:function(){C.debug("Timer H expired for transaction ".concat(this.id)),this.state===E.STATUS_COMPLETED&&C.debug("ACK not received, dialog will be terminated"),this.stateChanged(E.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"timer_I",value:function(){this.stateChanged(E.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"timer_L",value:function(){C.debug("Timer L expired for transaction ".concat(this.id)),this.state===E.STATUS_ACCEPTED&&(this.stateChanged(E.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"onTransportError",value:function(){this.transportError||(this.transportError=!0,C.debug("transport error occurred, deleting transaction ".concat(this.id)),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),clearTimeout(this.L),clearTimeout(this.H),clearTimeout(this.I),this.stateChanged(E.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"resend_provisional",value:function(){this.transport.send(this.last_response)||this.onTransportError()}},{key:"receiveResponse",value:function(e,t,n,r){var o=this;if(e>=100&&e<=199&&this.state===E.STATUS_PROCEEDING)this.transport.send(t)||this.onTransportError(),this.last_response=t;if(e>100&&e<=199&&this.state===E.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=setInterval((function(){o.resend_provisional()}),v.PROVISIONAL_RESPONSE_INTERVAL));else if(e>=200&&e<=299)switch(this.state){case E.STATUS_PROCEEDING:this.stateChanged(E.STATUS_ACCEPTED),this.last_response=t,this.L=setTimeout((function(){o.timer_L()}),v.TIMER_L),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case E.STATUS_ACCEPTED:this.transport.send(t)?n&&n():(this.onTransportError(),r&&r())}else if(e>=300&&e<=699&&this.state===E.STATUS_PROCEEDING)null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(t)?(this.stateChanged(E.STATUS_COMPLETED),this.H=setTimeout((function(){o.timer_H()}),v.TIMER_H),n&&n()):(this.onTransportError(),r&&r())}},{key:"C",get:function(){return E}}]),n}(p);e.exports={C:E,NonInviteClientTransaction:R,InviteClientTransaction:b,AckClientTransaction:A,NonInviteServerTransaction:I,InviteServerTransaction:w,checkTransaction:function(e,t){var n,r=e._transactions;switch(t.method){case m.INVITE:if(n=r.ist[t.via_branch]){if(n.state===E.STATUS_PROCEEDING)n.transport.send(n.last_response);return!0}break;case m.ACK:if(!(n=r.ist[t.via_branch]))return!1;if(n.state===E.STATUS_ACCEPTED)return!1;if(n.state===E.STATUS_COMPLETED)return n.state=E.STATUS_CONFIRMED,n.I=setTimeout((function(){n.timer_I()}),v.TIMER_I),!0;break;case m.CANCEL:return(n=r.ist[t.via_branch])?(t.reply_sl(200),n.state!==E.STATUS_PROCEEDING):(t.reply_sl(481),!0);default:if(n=r.nist[t.via_branch]){switch(n.state){case E.STATUS_TRYING:break;case E.STATUS_PROCEEDING:case E.STATUS_COMPLETED:n.transport.send(n.last_response)}return!0}}}}},6103:(e,t,n)=>{"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=n(356),a=n(7351),s=n(965),l=new i("Transport"),u={STATUS_CONNECTED:0,STATUS_CONNECTING:1,STATUS_DISCONNECTED:2,SOCKET_STATUS_READY:0,SOCKET_STATUS_ERROR:1,recovery_options:{min_interval:s.CONNECTION_RECOVERY_MIN_INTERVAL,max_interval:s.CONNECTION_RECOVERY_MAX_INTERVAL}};e.exports=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.recovery_options;r(this,e),l.debug("new()"),this.status=u.STATUS_DISCONNECTED,this.socket=null,this.sockets=[],this.recovery_options=n,this.recover_attempts=0,this.recovery_timer=null,this.close_requested=!1;try{this.textDecoder=new TextDecoder("utf8")}catch(e){l.warn("cannot use TextDecoder: ".concat(e))}if(void 0===t)throw new TypeError("Invalid argument. undefined 'sockets' argument");t instanceof Array||(t=[t]),t.forEach((function(e){if(!a.isSocket(e.socket))throw new TypeError("Invalid argument. invalid 'JsSIP.Socket' instance");if(e.weight&&!Number(e.weight))throw new TypeError("Invalid argument. 'weight' attribute is not a number");this.sockets.push({socket:e.socket,weight:e.weight||0,status:u.SOCKET_STATUS_READY})}),this),this._getSocket()}var t,n,i;return t=e,(n=[{key:"connect",value:function(){l.debug("connect()"),this.isConnected()?l.debug("Transport is already connected"):this.isConnecting()?l.debug("Transport is connecting"):(this.close_requested=!1,this.status=u.STATUS_CONNECTING,this.onconnecting({socket:this.socket,attempts:this.recover_attempts}),this.close_requested||(this.socket.onconnect=this._onConnect.bind(this),this.socket.ondisconnect=this._onDisconnect.bind(this),this.socket.ondata=this._onData.bind(this),this.socket.connect()))}},{key:"disconnect",value:function(){l.debug("close()"),this.close_requested=!0,this.recover_attempts=0,this.status=u.STATUS_DISCONNECTED,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.socket.onconnect=function(){},this.socket.ondisconnect=function(){},this.socket.ondata=function(){},this.socket.disconnect(),this.ondisconnect({socket:this.socket,error:!1})}},{key:"send",value:function(e){if(l.debug("send()"),!this.isConnected())return l.warn("unable to send message, transport is not connected"),!1;var t=e.toString();return l.debug("sending message:\n\n".concat(t,"\n")),this.socket.send(t)}},{key:"isConnected",value:function(){return this.status===u.STATUS_CONNECTED}},{key:"isConnecting",value:function(){return this.status===u.STATUS_CONNECTING}},{key:"_reconnect",value:function(){var e=this;this.recover_attempts+=1;var t=Math.floor(Math.random()*Math.pow(2,this.recover_attempts)+1);t<this.recovery_options.min_interval?t=this.recovery_options.min_interval:t>this.recovery_options.max_interval&&(t=this.recovery_options.max_interval),l.debug("reconnection attempt: ".concat(this.recover_attempts,". next connection attempt in ").concat(t," seconds")),this.recovery_timer=setTimeout((function(){e.close_requested||e.isConnected()||e.isConnecting()||(e._getSocket(),e.connect())}),1e3*t)}},{key:"_getSocket",value:function(){var e=[];if(this.sockets.forEach((function(t){t.status!==u.SOCKET_STATUS_ERROR&&(0===e.length?e.push(t):t.weight>e[0].weight?e=[t]:t.weight===e[0].weight&&e.push(t))})),0===e.length)return this.sockets.forEach((function(e){e.status=u.SOCKET_STATUS_READY})),void this._getSocket();var t=Math.floor(Math.random()*e.length);this.socket=e[t].socket}},{key:"_onConnect",value:function(){this.recover_attempts=0,this.status=u.STATUS_CONNECTED,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.onconnect({socket:this})}},{key:"_onDisconnect",value:function(e,t,n){this.status=u.STATUS_DISCONNECTED,this.ondisconnect({socket:this.socket,error:e,code:t,reason:n}),this.close_requested||(this.sockets.forEach((function(e){this.socket===e.socket&&(e.status=u.SOCKET_STATUS_ERROR)}),this),this._reconnect(e))}},{key:"_onData",value:function(e){if("\r\n"!==e){if("string"!=typeof e){try{e=this.textDecoder?this.textDecoder.decode(e):String.fromCharCode.apply(null,new Uint8Array(e))}catch(e){return void l.debug("received binary message failed to be converted into string, message discarded")}l.debug("received binary message:\n\n".concat(e,"\n"))}else l.debug("received text message:\n\n".concat(e,"\n"));this.ondata({transport:this,message:e})}else l.debug("received message with CRLF Keep Alive response")}},{key:"via_transport",get:function(){return this.socket.via_transport}},{key:"url",get:function(){return this.socket.url}},{key:"sip_uri",get:function(){return this.socket.sip_uri}}])&&o(t.prototype,n),i&&o(t,i),e}()},8387:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=c(e);if(t){var o=c(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return l(this,n)}}function l(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}var d=n(7187).EventEmitter,f=n(356),p=n(965),h=n(116),m=n(7906),_=n(9193),v=n(9126),g=n(3754),y=n(6103),S=n(5424),T=n(8063),C=n(1987),E=n(8407),R=n(6497),b=n(5710),A=n(7830),I=new f("UA"),w={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};function O(e){this.emit("connecting",e)}function P(e){this._status!==w.STATUS_USER_CLOSED&&(this._status=w.STATUS_READY,this._error=null,this.emit("connected",e),this._dynConfiguration.register&&this._registrator.register())}function N(e){for(var t=0,n=["nict","ict","nist","ist"];t<n.length;t++){var r=n[t];for(var o in this._transactions[r])Object.prototype.hasOwnProperty.call(this._transactions[r],o)&&this._transactions[r][o].onTransportError()}this.emit("disconnected",e),this._registrator.onTransportClosed(),this._status!==w.STATUS_USER_CLOSED&&(this._status=w.STATUS_NOT_READY,this._error=w.NETWORK_ERROR)}function D(e){var t=e.transport,n=e.message;if((n=E.parseMessage(n,this))&&!(this._status===w.STATUS_USER_CLOSED&&n instanceof R.IncomingRequest)&&b(n,this,t))if(n instanceof R.IncomingRequest)n.transport=t,this.receiveRequest(n);else if(n instanceof R.IncomingResponse){var r;switch(n.method){case p.INVITE:(r=this._transactions.ict[n.via_branch])&&r.receiveResponse(n);break;case p.ACK:break;default:(r=this._transactions.nict[n.via_branch])&&r.receiveResponse(n)}}}e.exports=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(n,e);var t=s(n);function n(e){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),I.debug("new() [configuration:%o]",e),(r=t.call(this))._cache={credentials:{}},r._configuration=Object.assign({},A.settings),r._dynConfiguration={},r._dialogs={},r._applicants={},r._sessions={},r._transport=null,r._contact=null,r._status=w.STATUS_INIT,r._error=null,r._transactions={nist:{},nict:{},ist:{},ict:{}},r._data={},r._closeTimer=null,void 0===e)throw new TypeError("Not enough arguments");try{r._loadConfig(e)}catch(e){throw r._status=w.STATUS_NOT_READY,r._error=w.CONFIGURATION_ERROR,e}return r._registrator=new h(u(r)),r}return i(n,null,[{key:"C",get:function(){return w}}]),i(n,[{key:"start",value:function(){I.debug("start()"),this._status===w.STATUS_INIT?this._transport.connect():this._status===w.STATUS_USER_CLOSED?(I.debug("restarting UA"),null!==this._closeTimer&&(clearTimeout(this._closeTimer),this._closeTimer=null,this._transport.disconnect()),this._status=w.STATUS_INIT,this._transport.connect()):this._status===w.STATUS_READY?I.debug("UA is in READY status, not restarted"):I.debug("ERROR: connection is down, Auto-Recovery system is trying to reconnect"),this._dynConfiguration.register=this._configuration.register}},{key:"register",value:function(){I.debug("register()"),this._dynConfiguration.register=!0,this._registrator.register()}},{key:"unregister",value:function(e){I.debug("unregister()"),this._dynConfiguration.register=!1,this._registrator.unregister(e)}},{key:"registrator",value:function(){return this._registrator}},{key:"isRegistered",value:function(){return this._registrator.registered}},{key:"isConnected",value:function(){return this._transport.isConnected()}},{key:"call",value:function(e,t){I.debug("call()");var n=new m(this);return n.connect(e,t),n}},{key:"sendMessage",value:function(e,t,n){I.debug("sendMessage()");var r=new _(this);return r.send(e,t,n),r}},{key:"sendOptions",value:function(e,t,n){I.debug("sendOptions()");var r=new v(this);return r.send(e,t,n),r}},{key:"terminateSessions",value:function(e){for(var t in I.debug("terminateSessions()"),this._sessions)this._sessions[t].isEnded()||this._sessions[t].terminate(e)}},{key:"stop",value:function(){var e=this;if(I.debug("stop()"),this._dynConfiguration={},this._status!==w.STATUS_USER_CLOSED){this._registrator.close();var t=Object.keys(this._sessions).length;for(var n in this._sessions)if(Object.prototype.hasOwnProperty.call(this._sessions,n)){I.debug("closing session ".concat(n));try{this._sessions[n].terminate()}catch(e){}}for(var r in this._applicants)if(Object.prototype.hasOwnProperty.call(this._applicants,r))try{this._applicants[r].close()}catch(e){}this._status=w.STATUS_USER_CLOSED,0===Object.keys(this._transactions.nict).length+Object.keys(this._transactions.nist).length+Object.keys(this._transactions.ict).length+Object.keys(this._transactions.ist).length&&0===t?this._transport.disconnect():this._closeTimer=setTimeout((function(){e._closeTimer=null,e._transport.disconnect()}),2e3)}else I.debug("UA already closed")}},{key:"normalizeTarget",value:function(e){return S.normalizeTarget(e,this._configuration.hostport_params)}},{key:"get",value:function(e){switch(e){case"authorization_user":return this._configuration.authorization_user;case"realm":return this._configuration.realm;case"ha1":return this._configuration.ha1;case"authorization_jwt":return this._configuration.authorization_jwt;default:return void I.warn('get() | cannot get "%s" parameter in runtime',e)}}},{key:"set",value:function(e,t){switch(e){case"authorization_user":this._configuration.authorization_user=String(t);break;case"password":this._configuration.password=String(t);break;case"realm":this._configuration.realm=String(t);break;case"ha1":this._configuration.ha1=String(t),this._configuration.password=null;break;case"authorization_jwt":this._configuration.authorization_jwt=String(t);break;case"display_name":this._configuration.display_name=t;break;default:return I.warn('set() | cannot set "%s" parameter in runtime',e),!1}return!0}},{key:"newTransaction",value:function(e){this._transactions[e.type][e.id]=e,this.emit("newTransaction",{transaction:e})}},{key:"destroyTransaction",value:function(e){delete this._transactions[e.type][e.id],this.emit("transactionDestroyed",{transaction:e})}},{key:"newDialog",value:function(e){this._dialogs[e.id]=e}},{key:"destroyDialog",value:function(e){delete this._dialogs[e.id]}},{key:"newMessage",value:function(e,t){this._applicants[e]=e,this.emit("newMessage",t)}},{key:"newOptions",value:function(e,t){this._applicants[e]=e,this.emit("newOptions",t)}},{key:"destroyMessage",value:function(e){delete this._applicants[e]}},{key:"newRTCSession",value:function(e,t){this._sessions[e.id]=e,this.emit("newRTCSession",t)}},{key:"destroyRTCSession",value:function(e){delete this._sessions[e.id]}},{key:"registered",value:function(e){this.emit("registered",e)}},{key:"unregistered",value:function(e){this.emit("unregistered",e)}},{key:"registrationFailed",value:function(e){this.emit("registrationFailed",e)}},{key:"receiveRequest",value:function(e){var t=e.method;if(e.ruri.user!==this._configuration.uri.user&&e.ruri.user!==this._contact.uri.user)return I.debug("Request-URI does not point to us"),void(e.method!==p.ACK&&e.reply_sl(404));if(e.ruri.scheme!==p.SIPS){if(!g.checkTransaction(this,e)){if(t===p.INVITE?new g.InviteServerTransaction(this,this._transport,e):t!==p.ACK&&t!==p.CANCEL&&new g.NonInviteServerTransaction(this,this._transport,e),t===p.OPTIONS){if(0===this.listeners("newOptions").length)return void e.reply(200);new v(this).init_incoming(e)}else if(t===p.MESSAGE){if(0===this.listeners("newMessage").length)return void e.reply(405);new _(this).init_incoming(e)}else if(t===p.INVITE&&!e.to_tag&&0===this.listeners("newRTCSession").length)return void e.reply(405);var n,r;if(e.to_tag)(n=this._findDialog(e.call_id,e.from_tag,e.to_tag))?n.receiveRequest(e):t===p.NOTIFY?(r=this._findSession(e))?r.receiveRequest(e):(I.debug("received NOTIFY request for a non existent subscription"),e.reply(481,"Subscription does not exist")):t!==p.ACK&&e.reply(481);else switch(t){case p.INVITE:if(window.RTCPeerConnection)if(e.hasHeader("replaces")){var o=e.replaces;(n=this._findDialog(o.call_id,o.from_tag,o.to_tag))?(r=n.owner).isEnded()?e.reply(603):r.receiveRequest(e):e.reply(481)}else(r=new m(this)).init_incoming(e);else I.warn("INVITE received but WebRTC is not supported"),e.reply(488);break;case p.BYE:e.reply(481);break;case p.CANCEL:(r=this._findSession(e))?r.receiveRequest(e):I.debug("received CANCEL request for a non existent session");break;case p.ACK:break;case p.NOTIFY:this.emit("sipEvent",{event:e.event,request:e}),e.reply(200);break;default:e.reply(405)}}}else e.reply_sl(416)}},{key:"_findSession",value:function(e){var t=e.call_id,n=e.from_tag,r=e.to_tag,o=t+n,i=this._sessions[o],a=t+r,s=this._sessions[a];return i||(s||null)}},{key:"_findDialog",value:function(e,t,n){var r=e+t+n,o=this._dialogs[r];return o||(r=e+n+t,(o=this._dialogs[r])||null)}},{key:"_loadConfig",value:function(e){try{A.load(this._configuration,e)}catch(e){throw e}0===this._configuration.display_name&&(this._configuration.display_name="0"),this._configuration.instance_id||(this._configuration.instance_id=S.newUUID()),this._configuration.jssip_id=S.createRandomToken(5);var t=this._configuration.uri.clone();t.user=null,this._configuration.hostport_params=t.toString().replace(/^sip:/i,"");try{this._transport=new y(this._configuration.sockets,{max_interval:this._configuration.connection_recovery_max_interval,min_interval:this._configuration.connection_recovery_min_interval}),this._transport.onconnecting=O.bind(this),this._transport.onconnect=P.bind(this),this._transport.ondisconnect=N.bind(this),this._transport.ondata=D.bind(this)}catch(e){throw I.warn(e),new T.ConfigurationError("sockets",this._configuration.sockets)}if(delete this._configuration.sockets,this._configuration.authorization_user||(this._configuration.authorization_user=this._configuration.uri.user),!this._configuration.registrar_server){var n=this._configuration.uri.clone();n.user=null,n.clearParams(),n.clearHeaders(),this._configuration.registrar_server=n}this._configuration.no_answer_timeout*=1e3,this._configuration.contact_uri?this._configuration.via_host=this._configuration.contact_uri.host:this._configuration.contact_uri=new C("sip",S.createRandomToken(8),this._configuration.via_host,null,{transport:"ws"}),this._contact={pub_gruu:null,temp_gruu:null,uri:this._configuration.contact_uri,toString:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.anonymous||null,n=e.outbound||null,r="<";return r+=t?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),!n||(t?this.temp_gruu:this.pub_gruu)||(r+=";ob"),r+=">"}};var r=["authorization_user","password","realm","ha1","authorization_jwt","display_name","register"];for(var o in this._configuration)Object.prototype.hasOwnProperty.call(this._configuration,o)&&(-1!==r.indexOf(o)?Object.defineProperty(this._configuration,o,{writable:!0,configurable:!1}):Object.defineProperty(this._configuration,o,{writable:!1,configurable:!1}));for(var i in I.debug("configuration parameters after validation:"),this._configuration)if(Object.prototype.hasOwnProperty.call(A.settings,i))switch(i){case"uri":case"registrar_server":I.debug("- ".concat(i,": ").concat(this._configuration[i]));break;case"password":case"ha1":case"authorization_jwt":I.debug("- ".concat(i,": NOT SHOWN"));break;default:I.debug("- ".concat(i,": ").concat(JSON.stringify(this._configuration[i])))}}},{key:"C",get:function(){return w}},{key:"status",get:function(){return this._status}},{key:"contact",get:function(){return this._contact}},{key:"configuration",get:function(){return this._configuration}},{key:"transport",get:function(){return this._transport}}]),n}(d)},1987:(e,t,n)=>{"use strict";function r(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}var l=n(965),u=n(5424),c=n(3790);e.exports=function(){function e(t,n,r,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};if(i(this,e),!r)throw new TypeError('missing or invalid "host" parameter');for(var u in this._parameters={},this._headers={},this._scheme=t||l.SIP,this._user=n,this._host=r,this._port=o,a)Object.prototype.hasOwnProperty.call(a,u)&&this.setParam(u,a[u]);for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&this.setHeader(c,s[c])}return s(e,null,[{key:"parse",value:function(e){return-1!==(e=c.parse(e,"SIP_URI"))?e:void 0}}]),s(e,[{key:"setParam",value:function(e,t){e&&(this._parameters[e.toLowerCase()]=null==t?null:t.toString())}},{key:"getParam",value:function(e){if(e)return this._parameters[e.toLowerCase()]}},{key:"hasParam",value:function(e){if(e)return!!this._parameters.hasOwnProperty(e.toLowerCase())}},{key:"deleteParam",value:function(e){if(e=e.toLowerCase(),this._parameters.hasOwnProperty(e)){var t=this._parameters[e];return delete this._parameters[e],t}}},{key:"clearParams",value:function(){this._parameters={}}},{key:"setHeader",value:function(e,t){this._headers[u.headerize(e)]=Array.isArray(t)?t:[t]}},{key:"getHeader",value:function(e){if(e)return this._headers[u.headerize(e)]}},{key:"hasHeader",value:function(e){if(e)return!!this._headers.hasOwnProperty(u.headerize(e))}},{key:"deleteHeader",value:function(e){if(e=u.headerize(e),this._headers.hasOwnProperty(e)){var t=this._headers[e];return delete this._headers[e],t}}},{key:"clearHeaders",value:function(){this._headers={}}},{key:"clone",value:function(){return new e(this._scheme,this._user,this._host,this._port,JSON.parse(JSON.stringify(this._parameters)),JSON.parse(JSON.stringify(this._headers)))}},{key:"toString",value:function(){var e=[],t="".concat(this._scheme,":");for(var n in this._user&&(t+="".concat(u.escapeUser(this._user),"@")),t+=this._host,(this._port||0===this._port)&&(t+=":".concat(this._port)),this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,n)&&(t+=";".concat(n),null!==this._parameters[n]&&(t+="=".concat(this._parameters[n])));for(var o in this._headers)if(Object.prototype.hasOwnProperty.call(this._headers,o)){var i,a=r(this._headers[o]);try{for(a.s();!(i=a.n()).done;){var s=i.value;e.push("".concat(o,"=").concat(s))}}catch(e){a.e(e)}finally{a.f()}}return e.length>0&&(t+="?".concat(e.join("&"))),t}},{key:"toAor",value:function(e){var t="".concat(this._scheme,":");return this._user&&(t+="".concat(u.escapeUser(this._user),"@")),t+=this._host,e&&(this._port||0===this._port)&&(t+=":".concat(this._port)),t}},{key:"scheme",get:function(){return this._scheme},set:function(e){this._scheme=e.toLowerCase()}},{key:"user",get:function(){return this._user},set:function(e){this._user=e}},{key:"host",get:function(){return this._host},set:function(e){this._host=e.toLowerCase()}},{key:"port",get:function(){return this._port},set:function(e){this._port=0===e?e:parseInt(e,10)||null}}]),e}()},5424:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var a=n(965),s=n(1987),l=n(3790);t.str_utf8_length=function(e){return unescape(encodeURIComponent(e)).length};var u=t.isFunction=function(e){return void 0!==e&&"[object Function]"===Object.prototype.toString.call(e)};t.isString=function(e){return void 0!==e&&"[object String]"===Object.prototype.toString.call(e)},t.isDecimal=function(e){return!isNaN(e)&&parseFloat(e)===parseInt(e,10)},t.isEmpty=function(e){return null===e||""===e||void 0===e||Array.isArray(e)&&0===e.length||"number"==typeof e&&isNaN(e)},t.hasMethods=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var o=0,i=n;o<i.length;o++){var a=i[o];if(u(e[a]))return!1}return!0};var c=t.createRandomToken=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,r="";for(t=0;t<e;t++)r+=(Math.random()*n|0).toString(n);return r};t.newTag=function(){return c(10)},t.newUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},t.hostType=function(e){if(e)return-1!==(e=l.parse(e,"host"))?e.host_type:void 0};var d=t.escapeUser=function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")};t.normalizeTarget=function(e,t){if(e){if(e instanceof s)return e;if("string"==typeof e){var n,r,o,i=e.split("@");switch(i.length){case 1:if(!t)return;n=e,r=t;break;case 2:n=i[0],r=i[1];break;default:n=i.slice(0,i.length-1).join("@"),r=i[i.length-1]}return n=n.replace(/^(sips?|tel):/i,""),/^[-.()]*\+?[0-9\-.()]+$/.test(n)&&(n=n.replace(/[-.()]/g,"")),e="".concat(a.SIP,":").concat(d(n),"@").concat(r),(o=s.parse(e))?o:void 0}}else;},t.headerize=function(e){var t,n={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),o="",i=r.length;for(t=0;t<i;t++)0!==t&&(o+="-"),o+=r[t].charAt(0).toUpperCase()+r[t].substring(1);return n[o]&&(o=n[o]),o},t.sipErrorCause=function(e){for(var t in a.SIP_ERROR_CAUSES)if(-1!==a.SIP_ERROR_CAUSES[t].indexOf(e))return a.causes[t];return a.causes.SIP_FAILURE_CODE},t.getRandomTestNetIP=function(){return"192.0.2.".concat((e=1,t=254,Math.floor(Math.random()*(t-e+1)+e)));var e,t},t.calculateMD5=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n=2147483648&e,r=2147483648&t,o=1073741824&e,i=1073741824&t,a=(1073741823&e)+(1073741823&t);return o&i?2147483648^a^n^r:o|i?1073741824&a?3221225472^a^n^r:1073741824^a^n^r:a^n^r}function r(e,r,o,i,a,s,l){return e=n(e,n(n(function(e,t,n){return e&t|~e&n}(r,o,i),a),l)),n(t(e,s),r)}function o(e,r,o,i,a,s,l){return e=n(e,n(n(function(e,t,n){return e&n|t&~n}(r,o,i),a),l)),n(t(e,s),r)}function i(e,r,o,i,a,s,l){return e=n(e,n(n(function(e,t,n){return e^t^n}(r,o,i),a),l)),n(t(e,s),r)}function a(e,r,o,i,a,s,l){return e=n(e,n(n(function(e,t,n){return t^(e|~n)}(r,o,i),a),l)),n(t(e,s),r)}function s(e){var t,n="",r="";for(t=0;t<=3;t++)n+=(r="0".concat((e>>>8*t&255).toString(16))).substr(r.length-2,2);return n}var l,u,c,d,f,p,h,m,_,v;for(l=function(e){for(var t,n=e.length,r=n+8,o=16*((r-r%64)/64+1),i=new Array(o-1),a=0,s=0;s<n;)a=s%4*8,i[t=(s-s%4)/4]=i[t]|e.charCodeAt(s)<<a,s++;return a=s%4*8,i[t=(s-s%4)/4]=i[t]|128<<a,i[o-2]=n<<3,i[o-1]=n>>>29,i}(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}(e)),h=1732584193,m=4023233417,_=2562383102,v=271733878,u=0;u<l.length;u+=16)c=h,d=m,f=_,p=v,h=r(h,m,_,v,l[u+0],7,3614090360),v=r(v,h,m,_,l[u+1],12,3905402710),_=r(_,v,h,m,l[u+2],17,606105819),m=r(m,_,v,h,l[u+3],22,3250441966),h=r(h,m,_,v,l[u+4],7,4118548399),v=r(v,h,m,_,l[u+5],12,1200080426),_=r(_,v,h,m,l[u+6],17,2821735955),m=r(m,_,v,h,l[u+7],22,4249261313),h=r(h,m,_,v,l[u+8],7,1770035416),v=r(v,h,m,_,l[u+9],12,2336552879),_=r(_,v,h,m,l[u+10],17,4294925233),m=r(m,_,v,h,l[u+11],22,2304563134),h=r(h,m,_,v,l[u+12],7,1804603682),v=r(v,h,m,_,l[u+13],12,4254626195),_=r(_,v,h,m,l[u+14],17,2792965006),h=o(h,m=r(m,_,v,h,l[u+15],22,1236535329),_,v,l[u+1],5,4129170786),v=o(v,h,m,_,l[u+6],9,3225465664),_=o(_,v,h,m,l[u+11],14,643717713),m=o(m,_,v,h,l[u+0],20,3921069994),h=o(h,m,_,v,l[u+5],5,3593408605),v=o(v,h,m,_,l[u+10],9,38016083),_=o(_,v,h,m,l[u+15],14,3634488961),m=o(m,_,v,h,l[u+4],20,3889429448),h=o(h,m,_,v,l[u+9],5,568446438),v=o(v,h,m,_,l[u+14],9,3275163606),_=o(_,v,h,m,l[u+3],14,4107603335),m=o(m,_,v,h,l[u+8],20,1163531501),h=o(h,m,_,v,l[u+13],5,2850285829),v=o(v,h,m,_,l[u+2],9,4243563512),_=o(_,v,h,m,l[u+7],14,1735328473),h=i(h,m=o(m,_,v,h,l[u+12],20,2368359562),_,v,l[u+5],4,4294588738),v=i(v,h,m,_,l[u+8],11,2272392833),_=i(_,v,h,m,l[u+11],16,1839030562),m=i(m,_,v,h,l[u+14],23,4259657740),h=i(h,m,_,v,l[u+1],4,2763975236),v=i(v,h,m,_,l[u+4],11,1272893353),_=i(_,v,h,m,l[u+7],16,4139469664),m=i(m,_,v,h,l[u+10],23,3200236656),h=i(h,m,_,v,l[u+13],4,681279174),v=i(v,h,m,_,l[u+0],11,3936430074),_=i(_,v,h,m,l[u+3],16,3572445317),m=i(m,_,v,h,l[u+6],23,76029189),h=i(h,m,_,v,l[u+9],4,3654602809),v=i(v,h,m,_,l[u+12],11,3873151461),_=i(_,v,h,m,l[u+15],16,530742520),h=a(h,m=i(m,_,v,h,l[u+2],23,3299628645),_,v,l[u+0],6,4096336452),v=a(v,h,m,_,l[u+7],10,1126891415),_=a(_,v,h,m,l[u+14],15,2878612391),m=a(m,_,v,h,l[u+5],21,4237533241),h=a(h,m,_,v,l[u+12],6,1700485571),v=a(v,h,m,_,l[u+3],10,2399980690),_=a(_,v,h,m,l[u+10],15,4293915773),m=a(m,_,v,h,l[u+1],21,2240044497),h=a(h,m,_,v,l[u+8],6,1873313359),v=a(v,h,m,_,l[u+15],10,4264355552),_=a(_,v,h,m,l[u+6],15,2734768916),m=a(m,_,v,h,l[u+13],21,1309151649),h=a(h,m,_,v,l[u+4],6,4149444226),v=a(v,h,m,_,l[u+11],10,3174756917),_=a(_,v,h,m,l[u+2],15,718787259),m=a(m,_,v,h,l[u+9],21,3951481745),h=n(h,c),m=n(m,d),_=n(_,f),v=n(v,p);return(s(h)+s(m)+s(_)+s(v)).toLowerCase()},t.closeMediaStream=function(e){if(e)try{if(e.getTracks){var t,n=o(e.getTracks());try{for(n.s();!(t=n.n()).done;){t.value.stop()}}catch(e){n.e(e)}finally{n.f()}}else{var i,a=o(e.getAudioTracks());try{for(a.s();!(i=a.n()).done;){i.value.stop()}}catch(e){a.e(e)}finally{a.f()}var s,l=o(e.getVideoTracks());try{for(l.s();!(s=l.n()).done;){s.value.stop()}}catch(e){l.e(e)}finally{l.f()}}}catch(t){"function"!=typeof e.stop&&"object"!==r(e.stop)||e.stop()}},t.cloneArray=function(e){return e&&e.slice()||[]},t.cloneObject=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e&&Object.assign({},e)||t}},1288:(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(356),i=n(3790),a=new o("WebSocketInterface");e.exports=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a.debug('new() [url:"%s"]',t),this._url=t,this._sip_uri=null,this._via_transport=null,this._ws=null;var n=i.parse(t,"absoluteURI");if(-1===n)throw a.warn("invalid WebSocket URI: ".concat(t)),new TypeError("Invalid argument: ".concat(t));if("wss"!==n.scheme&&"ws"!==n.scheme)throw a.warn("invalid WebSocket URI scheme: ".concat(n.scheme)),new TypeError("Invalid argument: ".concat(t));this._sip_uri="sip:".concat(n.host).concat(n.port?":".concat(n.port):"",";transport=ws"),this._via_transport=n.scheme.toUpperCase()}var t,n,o;return t=e,(n=[{key:"connect",value:function(){if(a.debug("connect()"),this.isConnected())a.debug("WebSocket ".concat(this._url," is already connected"));else if(this.isConnecting())a.debug("WebSocket ".concat(this._url," is connecting"));else{this._ws&&this.disconnect(),a.debug("connecting to WebSocket ".concat(this._url));try{this._ws=new WebSocket(this._url,"sip"),this._ws.binaryType="arraybuffer",this._ws.onopen=this._onOpen.bind(this),this._ws.onclose=this._onClose.bind(this),this._ws.onmessage=this._onMessage.bind(this),this._ws.onerror=this._onError.bind(this)}catch(e){this._onError(e)}}}},{key:"disconnect",value:function(){a.debug("disconnect()"),this._ws&&(this._ws.onopen=function(){},this._ws.onclose=function(){},this._ws.onmessage=function(){},this._ws.onerror=function(){},this._ws.close(),this._ws=null)}},{key:"send",value:function(e){return a.debug("send()"),this.isConnected()?(this._ws.send(e),!0):(a.warn("unable to send message, WebSocket is not open"),!1)}},{key:"isConnected",value:function(){return this._ws&&this._ws.readyState===this._ws.OPEN}},{key:"isConnecting",value:function(){return this._ws&&this._ws.readyState===this._ws.CONNECTING}},{key:"_onOpen",value:function(){a.debug("WebSocket ".concat(this._url," connected")),this.onconnect()}},{key:"_onClose",value:function(e){var t=e.wasClean,n=e.code,r=e.reason;a.debug("WebSocket ".concat(this._url," closed")),!1===t&&a.debug("WebSocket abrupt disconnection"),this.ondisconnect(!t,n,r)}},{key:"_onMessage",value:function(e){var t=e.data;a.debug("received WebSocket message"),this.ondata(t)}},{key:"_onError",value:function(e){a.warn("WebSocket ".concat(this._url," error: "),e)}},{key:"via_transport",get:function(){return this._via_transport},set:function(e){this._via_transport=e.toUpperCase()}},{key:"sip_uri",get:function(){return this._sip_uri}},{key:"url",get:function(){return this._url}}])&&r(t.prototype,n),o&&r(t,o),e}()},5710:(e,t,n)=>{"use strict";function r(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var i,a,s,l=n(356),u=n(965),c=n(6497),d=n(5424),f=new l("sanityCheck"),p=[function(){for(var e=0,t=["from","to","call_id","cseq","via"];e<t.length;e++){var n=t[e];if(!i.hasHeader(n))return f.debug("missing mandatory header field : ".concat(n,", dropping the response")),!1}}],h=[function(){if("sip"!==i.s("to").uri.scheme)return _(416),!1},function(){if(!i.to_tag&&i.call_id.substr(0,5)===a.configuration.jssip_id)return _(482),!1},function(){var e=d.str_utf8_length(i.body),t=i.getHeader("content-length");if(e<t)return _(400),!1},function(){var e,t=i.from_tag,n=i.call_id,r=i.cseq;if(i.to_tag)return;if(i.method===u.INVITE){if(a._transactions.ist[i.via_branch])return!1;for(var o in a._transactions.ist)if(Object.prototype.hasOwnProperty.call(a._transactions.ist,o)&&(e=a._transactions.ist[o]).request.from_tag===t&&e.request.call_id===n&&e.request.cseq===r)return _(482),!1}else{if(a._transactions.nist[i.via_branch])return!1;for(var s in a._transactions.nist)if(Object.prototype.hasOwnProperty.call(a._transactions.nist,s)&&(e=a._transactions.nist[s]).request.from_tag===t&&e.request.call_id===n&&e.request.cseq===r)return _(482),!1}}],m=[function(){if(i.getHeaders("via").length>1)return f.debug("more than one Via header field present in the response, dropping the response"),!1},function(){var e=d.str_utf8_length(i.body),t=i.getHeader("content-length");if(e<t)return f.debug("message body length is lower than the value in Content-Length header field, dropping the response"),!1}];function _(e){var t,n,o=i.getHeaders("via"),a="SIP/2.0 ".concat(e," ").concat(u.REASON_PHRASE[e],"\r\n"),l=r(o);try{for(l.s();!(n=l.n()).done;){var c=n.value;a+="Via: ".concat(c,"\r\n")}}catch(e){l.e(e)}finally{l.f()}t=i.getHeader("To"),i.to_tag||(t+=";tag=".concat(d.newTag())),a+="To: ".concat(t,"\r\n"),a+="From: ".concat(i.getHeader("From"),"\r\n"),a+="Call-ID: ".concat(i.call_id,"\r\n"),a+="CSeq: ".concat(i.cseq," ").concat(i.method,"\r\n"),a+="\r\n",s.send(a)}e.exports=function(e,t,n){i=e,a=t,s=n;var o,l=r(p);try{for(l.s();!(o=l.n()).done;){if(!1===(0,o.value)())return!1}}catch(e){l.e(e)}finally{l.f()}if(i instanceof c.IncomingRequest){var u,d=r(h);try{for(d.s();!(u=d.n()).done;){if(!1===(0,u.value)())return!1}}catch(e){d.e(e)}finally{d.f()}}else if(i instanceof c.IncomingResponse){var f,_=r(m);try{for(_.s();!(f=_.n()).done;){if(!1===(0,f.value)())return!1}}catch(e){_.e(e)}finally{_.f()}}return!0}},7824:e=>{var t=1e3,n=60*t,r=60*n,o=24*r,i=7*o,a=365.25*o;function s(e,t,n,r){var o=t>=1.5*n;return Math.round(e/n)+" "+r+(o?"s":"")}e.exports=function(e,l){l=l||{};var u=typeof e;if("string"===u&&e.length>0)return function(e){if((e=String(e)).length>100)return;var s=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!s)return;var l=parseFloat(s[1]);switch((s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return l*a;case"weeks":case"week":case"w":return l*i;case"days":case"day":case"d":return l*o;case"hours":case"hour":case"hrs":case"hr":case"h":return l*r;case"minutes":case"minute":case"mins":case"min":case"m":return l*n;case"seconds":case"second":case"secs":case"sec":case"s":return l*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}(e);if("number"===u&&isFinite(e))return l.long?function(e){var i=Math.abs(e);if(i>=o)return s(e,i,o,"day");if(i>=r)return s(e,i,r,"hour");if(i>=n)return s(e,i,n,"minute");if(i>=t)return s(e,i,t,"second");return e+" ms"}(e):function(e){var i=Math.abs(e);if(i>=o)return Math.round(e/o)+"d";if(i>=r)return Math.round(e/r)+"h";if(i>=n)return Math.round(e/n)+"m";if(i>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},6692:e=>{var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach((function(e){t[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},766:(e,t,n)=>{var r=n(962),o=n(5776);t.write=o,t.parse=r.parse,t.parseParams=r.parseParams,t.parseFmtpConfig=r.parseFmtpConfig,t.parsePayloads=r.parsePayloads,t.parseRemoteCandidates=r.parseRemoteCandidates,t.parseImageAttributes=r.parseImageAttributes,t.parseSimulcastStreamList=r.parseSimulcastStreamList},962:(e,t,n)=>{var r=function(e){return String(Number(e))===e?Number(e):e},o=function(e,t,n){var o=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:o&&!t[e.name]&&(t[e.name]={});var i=e.push?{}:o?t[e.name]:t;!function(e,t,n,o){if(o&&!n)t[o]=r(e[1]);else for(var i=0;i<n.length;i+=1)null!=e[i+1]&&(t[n[i]]=r(e[i+1]))}(n.match(e.reg),i,e.names,e.name),e.push&&t[e.push].push(i)},i=n(6692),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},n=[],r=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach((function(e){var t=e[0],a=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),r=n[n.length-1]);for(var s=0;s<(i[t]||[]).length;s+=1){var l=i[t][s];if(l.reg.test(a))return o(l,r,a)}})),t.media=n,t};var s=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length?e[n[0]]=r(n[1]):1===n.length&&t.length>1&&(e[n[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(r),o=0;o<n.length;o+=3)t.push({component:n[o],ip:n[o+1],port:n[o+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,n=!1;return"~"!==e[0]?t=r(e):(t=r(e.substring(1,e.length)),n=!0),{scid:t,paused:n}}))}))}},5776:(e,t,n)=>{var r=n(6692),o=/%[sdv%]/g,i=function(e){var t=1,n=arguments,r=n.length;return e.replace(o,(function(e){if(t>=r)return e;var o=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(o);case"%d":return Number(o);case"%v":return""}}))},a=function(e,t,n){var r=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var a=t.names[o];t.name?r.push(n[t.name][a]):r.push(n[t.names[o]])}else r.push(n[t.name]);return i.apply(null,r)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],l=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var n=t.outerOrder||s,o=t.innerOrder||l,i=[];return n.forEach((function(t){r[t].forEach((function(n){n.name in e&&null!=e[n.name]?i.push(a(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){i.push(a(t,n,e))}))}))})),e.media.forEach((function(e){i.push(a("m",r.m[0],e)),o.forEach((function(t){r[t].forEach((function(n){n.name in e&&null!=e[n.name]?i.push(a(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){i.push(a(t,n,e))}))}))}))})),i.join("\r\n")+"\r\n"}},7539:e=>{"use strict";const t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){let t=e.substr(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){const t={};let n;const r=e.substr(e.indexOf(" ")+1).split(";");for(let e=0;e<r.length;e++)n=r[e].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},t.parseSsrcGroup=function(e){const t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substr(6)},t.parseFingerprint=function(e){const t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],o=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&o?{usernameFragment:r.substr(12),password:o.substr(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");for(let o=3;o<r.length;o++){const i=r[o],a=t.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(a){const r=t.parseRtpMap(a),o=t.matchPrefix(e,"a=fmtp:"+i+" ");switch(r.parameters=o.length?t.parseFmtp(o[0]):{},r.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(t.parseRtcpFb),n.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(r.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))})),n},t.writeRtpDescription=function(e,n){let r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));let o=0;return n.codecs.forEach((e=>{e.maxptime>o&&(o=e.maxptime)})),o>0&&(r+="a=maxptime:"+o+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){const n=[],r=t.parseRtpParameters(e),o=-1!==r.fecMechanisms.indexOf("RED"),i=-1!==r.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),s=a.length>0&&a[0].ssrc;let l;const u=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substr(17).split(" ").map((e=>parseInt(e,10)))));u.length>0&&u[0].length>1&&u[0][0]===s&&(l=u[0][1]),r.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&l&&(t.rtx={ssrc:l}),n.push(t),o&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:s,mechanism:i?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&s&&n.push({ssrc:s});let c=t.matchPrefix(e,"b=");return c.length&&(c=0===c[0].indexOf("b=TIAS:")?parseInt(c[0].substr(7),10):0===c[0].indexOf("b=AS:")?1e3*parseInt(c[0].substr(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=c}))),n},t.parseRtcpParameters=function(e){const n={},r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const o=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=o.length>0,n.compound=0===o.length;const i=t.matchPrefix(e,"a=rtcp-mux");return n.mux=i.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const r=t.matchPrefix(e,"a=msid:");if(1===r.length)return n=r[0].substr(7).split(" "),{stream:n[0],track:n[1]};const o=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return o.length>0?(n=o[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");let o;r.length>0&&(o=parseInt(r[0].substr(19),10)),isNaN(o)&&(o=65536);const i=t.matchPrefix(e,"a=sctp-port:");if(i.length>0)return{port:parseInt(i[0].substr(12),10),protocol:n.fmt,maxMessageSize:o};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substr(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:o}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,n,r){let o;const i=void 0!==n?n:2;o=e||t.generateSessionId();return"v=0\r\no="+(r||"thisisadapterortc")+" "+o+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const r=t.splitLines(e);for(let e=0;e<r.length;e++)switch(r[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[e].substr(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},e.exports=t},4125:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Call=void 0;var r=n(655),o=r.__importStar(n(2749)),i=r.__importStar(n(5979)),a=n(4547),s=n(7187),l=n(9011),u=n(878),c=n(9616),d=n(4682),f=n(1784),p=a.Debugger.extend("Call"),h=a.Debugger.extend("ERROR:Call"),m=function(e){function t(n,a){var s=e.call(this)||this;s.mCseq=0,s.mNbDisconnection=0,s.mFailedReason=t.FailedReason.SUCCESS,s.mIsAnEmergencyCall=!1,s.mIsOnHold=!1,s.mStopRequested=!1,s.mNumberOfReconnectionAttempts=0,s.mParticipants=new d.Participants,s.getError=function(){return s.mFailedReason},s.getStoppedReason=function(){return s.mStoppedReason},s.getFloorOwner=function(){return s.mFloorControl.getFloorOwner()},s.getFloorOwnerLast=function(){return s.mFloorControl.getFloorOwnerLast()},s.getFloorOwnerExtUserIdUpdated=function(){return s.mFloorControl.getFloorOwnerExtUserIdUpdated()},s.getFloorState=function(){return s.mFloorControl.getFloorState()},s.getPreviousFloorState=function(){return s.mFloorControl.getPreviousFloorState()},s.getFloorGrantedDuration=function(){return s.mFloorControl.getFloorGrantedDuration()},s.getFloorDenyReason=function(){return s.mFloorControl.getFloorDenyReason()},s.getFloorRevokeReason=function(){return s.mFloorControl.getFloorRevokeReason()},s.hasPermissionToRequestFloor=function(){return s.mFloorControl.hasPermissionToRequestFloor()},s.getOptions=function(){return s.mOptions},s.getLocalId=function(){return s.mLocalId},s.getSessionId=function(){return s.mSessionId?s.mSessionId:s.mOptions.sessionId},s.getSwTo=function(){return s.mOptions.swTo},s.getSessionType=function(){return s.mSessionType?s.mSessionType:s.mOptions.sessionType},s.getSessionMedia=function(){return s.mSessionMedia?s.mSessionMedia:s.mOptions.sessionMedia},s.getSessionGroupId=function(){return s.mSessionGroupId?s.mSessionGroupId:s.mOptions.sessionGroupId},s.isAChannel=function(){var e;return s.mSessionType===t.SessionType.WALKIETALKIE&&-1!==(null===(e=s.mSessionId)||void 0===e?void 0:e.indexOf("group:"))},s.isLargeGroup=function(){return!!s.mLargeGroupCount},s.isEmergencyCall=function(){return s.mIsAnEmergencyCall},s.getEmergencyInitiator=function(){return s.mEmergencyInitiator},s.isAudio=function(){var e=s.getSessionMedia();return!!e&&e.includes(t.SessionMedia.AUDIO)},s.isVideo=function(){var e=s.getSessionMedia();return!!e&&e.includes(t.SessionMedia.VIDEO)},s.sendsAndReceives=function(){return s.mOptions.sessionType!==t.SessionType.LIVESTREAM},s.receivesOnly=function(){return s.mOptions.sessionType===t.SessionType.LIVESTREAM&&(!!s.mOptions.sessionId||!!s.mOptions.swTo&&s.mOptions.swTo.includes("camera:"))},s.sendsOnly=function(){return!(s.mOptions.sessionType!==t.SessionType.LIVESTREAM||s.mOptions.sessionId||s.mOptions.swTo&&s.mOptions.swTo.includes("camera:"))},s.getParticipants=function(e){return s.mParticipants.getByState(e)},s.getNewParticipants=function(e){return s.mParticipants.getByState(e)},s.getGroupNames=function(){return s.mGroupNames},s.getGroupUsersList=function(){return s.mGroupUsersList},s.getGroupAddedUsers=function(){return s.mGroupAddedUsers},s.getReceptionTime=function(){return s.mReceptionTime},s.getParticipantState=function(e){var t=s.mParticipants.get(e);return t?t.getState():c.Participant.State.UNKNOWN},s.getParticipantPreviousState=function(e){var t=s.mParticipants.get(e);return t?t.getPreviousState():c.Participant.State.UNKNOWN},s.getParticipantFloorPriority=function(e){var t=s.mParticipants.get(e);return t?t.getFloorPriority():0},s.getParticipantArrivalTime=function(e){var t=s.mParticipants.get(e);return null==t?void 0:t.getArrivalTime()},s.getParticipantVideoCaptureSource=function(e){var t=s.mParticipants.get(e);return null==t?void 0:t.getVideoCaptureSource()},s.getLastUpdatedParticipant=function(){var e;return null===(e=s.mParticipants.getLastUpdated())||void 0===e?void 0:e.getDisplayName()},s.isParticipantFromInterASRegroup=function(e){var t=s.mParticipants.get(e);return!!t&&t.isFromInterASRegroup()},s.getTransferor=function(){return s.mTransferor},s.getMergedSessionIds=function(){return s.mMergedSessionIds},s.setPlayOptions=function(e){return e.rendererLocal&&(s.mOptions.playOptions.rendererLocal=e.rendererLocal),e.rendererRemote&&(s.mOptions.playOptions.rendererRemote=e.rendererRemote),!!s.mMediaHandler&&s.mMediaHandler.setPlayOptions(s.mOptions.playOptions)},s.getMediaVolumeLocal=function(){return s.mMediaHandler.getVolumeLocal()},s.getMediaVolumeRemote=function(){return s.mMediaHandler.getVolumeRemote()},s.getRecordLocal=function(){return s.mMediaHandler.getRecordLocal()},s.getRecordDurationLocal=function(){return s.mMediaHandler.getRecordDurationLocal()},s.getRecordRemote=function(){return s.mMediaHandler.getRecordRemote()},s.getRecordDurationRemote=function(){return s.mMediaHandler.getRecordDurationRemote()},s.getMediaQos=function(){return s.mMediaHandler.getQos()},s.openMediaStatsWindow=function(){return s.mMediaHandler.openMediaStatsWindow()},s.setAudioPlayChannel=function(e){return s.mMediaHandler.setAudioPlayPanning(e)},s.start=function(){if(!s.mOptions.getSubscriberToken||s.mSubscriberToken){var e=s.mOptions.mediaStream||s.mMediaHandler.getMediaStreamLocal();if(s.receivesOnly()||e){p("".concat(s.toString()," Using mediastream: ").concat(f.Utils.strMediaStream(e)));var n=function(){return s.start()},r=function(){if(0!==s.mNumberOfReconnectionAttempts)return s.newEvent(t.Event.DISCONNECTED_AND_RECONNECTING),s.mNumberOfReconnectionAttempts++,void p("UA ".concat(s.mUa.toString()," is still not connected, ").concat(s.toString()," ")+"number of reconnection attempts: ".concat(s.mNumberOfReconnectionAttempts));s.mFailedReason=t.FailedReason.CONNECTION_ERROR,s.newEvent(t.Event.FAILED),s.stop(),s.stopJssipUa(),s.newEvent(t.Event.STOPPED)};if(!s.mUa.isConnected())return p("UA ".concat(s.mUa.toString()," is still not connected, ").concat(s.toString()," ")+"will wait for it to actually connect before proceeding"),void s.mUa.addConnectionEventListeners(n,r);s.mUa.removeConnectionEventListeners(n,r);var a=s.mUa.getTransport(),l=s.mUa.getOptions(),u={uri:s.mOptions.subscriberMsisdn+"@"+l.host+":"+l.port,sockets:[a],register:!1,user_agent:o.USER_AGENT,session_timers:!1};s.mJssipUa=new i.UA(u),s.mJssipUa.start();var c=s.receivesOnly(),d=s.sendsOnly(),m={},_={};s.isAudio()&&(_.offerToReceiveAudio=!d,m.audio=!c),s.isVideo()&&(_.offerToReceiveVideo=!d,m.video=!c);var v={mediaStream:e,mediaConstraints:m,extraHeaders:s.getInviteExtraHeaders(),pcConfig:{iceServers:[]},rtcOfferConstraints:_};s.mJssipUa.on("connecting",(function(e){p("".concat(s.toString()," Connecting to: ").concat(e.socket.sip_uri))})),s.mJssipUa.on("connected",(function(e){p("".concat(s.toString()," Connected to: ").concat(e.socket.sip_uri)),s.mNumberOfReconnectionAttempts&&s.start()})),s.mJssipUa.on("disconnected",(function(e){var n;if(!s.mStopRequested){p("".concat(s.toString()," Disconnected from: ").concat(e.socket.sip_uri));var r=s.mMediaHandler.getRtcSession();null==r||r.off("accepted",s.onAccepted),null==r||r.off("ended",s.onEnded),null==r||r.off("failed",s.onFailed),s.mMediaHandler.destroyConnectionToRemote(),null===(n=s.mJssipUa)||void 0===n||n.terminateSessions(),s.newEvent(t.Event.DISCONNECTED_AND_RECONNECTING),s.mNumberOfReconnectionAttempts++,s.start()}})),s.mJssipUa.on("newRTCSession",s.onNewRtcSession),s.mJssipUa.on("newMessage",s.onMessage),s.mJssipUa.call(s.mUri.toString(),v)}else{var g={audio:s.mOptions.sessionMedia.includes(t.SessionMedia.AUDIO),video:s.mOptions.sessionMedia.includes(t.SessionMedia.VIDEO)};s.mMediaHandler.getMediaStream(g).then((function(e){p("".concat(s.toString()," Got mediastream: ").concat(f.Utils.strMediaStream(e))),s.mMediaHandler.setMediaStreamLocal(e),s.start()})).catch((function(e){var n=e;h("".concat(s.toString()," Error while getting mediastream, aborting: ").concat(n.message)),h(n.stack),s.mFailedReason=t.FailedReason.COULD_NOT_GET_MEDIASTREAM,s.newEvent(t.Event.FAILED),s.stop(),s.stopJssipUa(),s.newEvent(t.Event.STOPPED)}))}}else s.mOptions.getSubscriberToken().then((function(e){if(!e)throw new Error("Invalid empty token");s.mSubscriberToken=e,p("".concat(s.toString()," Got susbcriber token")),s.start()})).catch((function(e){var n=e;h("".concat(s.toString()," Error while getting subscriber token, aborting: ").concat(n.message)),h(n.stack),s.mNbDisconnection?setTimeout((function(){return s.start()}),1e3):(s.mFailedReason=t.FailedReason.COULD_NOT_GET_TOKEN,s.newEvent(t.Event.FAILED),s.stop(),s.stopJssipUa(),s.newEvent(t.Event.STOPPED))}))},s.stop=function(){if(s.mMediaHandler.destroy(),s.mStopRequested=!0,!s.mJssipUa)return!1;var e={extraHeaders:["SWReason: "+t.Hangup.USER_HANGUP]};return s.mJssipUa.terminateSessions(e),!0},s.isMuted=function(){return s.mMediaHandler.isMutedCapture()},s.mute=function(e){return s.mIsOnHold||s.mMediaHandler.muteCapture(e)},s.unmute=function(e){return s.mIsOnHold||s.mMediaHandler.unmuteCapture(e)},s.isPlayMuted=function(){return s.mMediaHandler.isMutedPlay()},s.mutePlay=function(e){var t=s.mFloorControl.getFloorOwner();return t&&p("".concat(s.toString()," muting audio while floor is taken by ").concat(t)),s.mIsOnHold||s.mMediaHandler.mutePlay(e)},s.unmutePlay=function(e){return s.mIsOnHold||s.mMediaHandler.unmutePlay(e)},s.setPlayVolume=function(e){return s.mMediaHandler.setPlayVolume(e)},s.isOnHold=function(){return s.mIsOnHold},s.areOthersOnHold=function(){return s.mParticipants.count([c.Participant.State.ATTENDING])<=1&&s.mParticipants.count([c.Participant.State.ATTENDING_ONHOLD])>0},s.putOnHold=function(){return s.mIsOnHold?(p("".concat(s.toString()," is already on hold")),!0):(s.mIsOnHold=!0,s.mMediaHandler.muteCapture(),s.mMediaHandler.mutePlay(),s.sendServiceMessage("RequestOnHold"))},s.resume=function(){return s.mIsOnHold?(s.mIsOnHold=!1,s.mMediaHandler.unmuteCapture(),s.mMediaHandler.unmutePlay(),s.sendServiceMessage("RequestResume")):(p("".concat(s.toString()," is already on not hold")),!0)},s.inviteNewParticipants=function(e,n,r){if(!s.mJssipUa||!e&&!n)return!1;var o={eventHandlers:{succeeded:function(e){e.response&&(p("".concat(s.toString()," could successfully invite new Participants")),s.newEvent(t.Event.SESSION_SUBSCRIBER_INVITATION_OK))},failed:function(e){s.received500Error(e.response),s.newEvent(t.Event.SESSION_SUBSCRIBER_INVITATION_NOK)}},extraHeaders:["MessageType: SERVICE","ServiceMessageType: VoipSessionInviteNewSubscriber"]};return e&&o.extraHeaders&&o.extraHeaders.push("swto: "+e),n&&o.extraHeaders&&o.extraHeaders.push("swout: "+n),r&&o.extraHeaders&&o.extraHeaders.push("SessionGroupId: "+r),s.mJssipUa.sendMessage(s.mUri,"",o),!0},s.transfer=function(e,n){if(!s.mJssipUa||!e&&!n)return!1;var r={eventHandlers:{succeeded:function(e){e.response&&(p(s.toString()+" could successfully invite new Participants"),s.newEvent(t.Event.SESSION_TRANSFER_OK))},failed:function(e){s.received500Error(e.response),s.newEvent(t.Event.SESSION_TRANSFER_NOK)}},extraHeaders:["MessageType: SERVICE","ServiceMessageType: VoipSessionTransfer"]};return e&&r.extraHeaders&&r.extraHeaders.push("swto: "+e),n&&r.extraHeaders&&r.extraHeaders.push("swout: "+n),s.mJssipUa.sendMessage(s.mUri,"",r),!0},s.update=function(e){if(!s.mJssipUa)return!1;var n={eventHandlers:{succeeded:function(e){e.response&&(p(s.toString()+" could successfully update the session"),s.newEvent(t.Event.SESSION_UPDATE_OK))},failed:function(e){s.received500Error(e.response),s.newEvent(t.Event.SESSION_UPDATE_NOK)}},extraHeaders:["MessageType: SERVICE","ServiceMessageType: VoipSessionUpdate"]};return void 0!==e.isEmergencyCall&&n.extraHeaders&&n.extraHeaders.push("isEmergencyCall: "+String(e.isEmergencyCall)),s.mJssipUa.sendMessage(s.mUri,"",n),!0},s.kickInvitedParticipants=function(e){return s.sendServiceMessage("VoipSessionKickInvitedParticipants",["swto: "+e])},s.requestParticipantList=function(){if(!s.mJssipUa)return!1;var e={eventHandlers:{succeeded:function(e){if(e.response){p("RequestParticipantList has been successfully executed: ".concat(e.response.status_code));var t=e.response.getHeader("ParticipantList"),n=JSON.parse(f.Utils.stripslashes(t.substring(1,t.length-1)));s.onServiceMessageParticipantList(n)}else p("RequestParticipantList succeeded without body?")},failed:function(e){s.received500Error(e.response)}},extraHeaders:["MessageType: SERVICE","ServiceMessageType: RequestParticipantList"]};return s.mJssipUa.sendMessage(s.mUri,"",e),!0},s.requestFloor=function(){return s.mFloorControl.requestFloor()},s.releaseFloor=function(){return s.mFloorControl.releaseFloor()},s.enqueueDtmf=function(e){return s.mMediaHandler.enqueueDtmf(e)},s.toString=function(){var e="Session #".concat(s.mInstanceId," ");return e+="[sessionId: ".concat(s.getSessionId()||"?","] "),e+="[sessionType: ".concat(s.getSessionType()||"?","] "),e+="[sessionMedia: ".concat(s.getSessionMedia()||"?","] "),s.mOptions.localId&&(e+="[localId: ".concat(s.mOptions.localId,"]")),e},s.newEvent=function(e,t){var n={type:e,subtype:t,call:s};try{s.emit(n.type,n),n.subtype&&s.emit(n.type+":"+n.subtype,n)}catch(e){var r=e,o=n.type+(n.subtype?":"+n.subtype:"");h("".concat(s.toString(),": error in caller while handling event ").concat(o,": ").concat(r.message)),h(r.stack)}},s.isWalkieTalkie=function(){return s.mOptions.sessionType===t.SessionType.WALKIETALKIE},s.onNewRtcSession=function(e){s.mMediaHandler.setRtcSession(e.session),e.session.on("accepted",s.onAccepted),e.session.on("ended",s.onEnded),e.session.on("failed",s.onFailed)},s.onAccepted=function(e){p("".concat(s.toString()," onAccepted")),s.parseheaders(e.response)?s.newEvent(t.Event.STARTED):h("".concat(s.toString()," Failed to parse headers")),s.getSessionType()===t.SessionType.WALKIETALKIE&&s.mFloorControl.getFloorState()!==l.FloorControl.State.HAS_PERMISSION&&s.mMediaHandler.muteCapture()},s.onEnded=function(e){if(p("".concat(s.toString()," onEnded: ").concat(e.cause)),e.cause===i.C.causes.BYE){if("local"===e.originator)s.mStoppedReason=t.StoppedReason.STOPPED_BYE_SENT,p("".concat(s.toString()," Call ended by sending a BYE"));else if(e.message){var n=e.message.getHeader("bye_reason");switch(n){case"END_REASON_GROUP_REMOVED":s.mStoppedReason=t.StoppedReason.STOPPED_BYE_RECEIVED_GROUP_REMOVED;break;case"END_REASON_CALL_REPLACED":s.mStoppedReason=t.StoppedReason.STOPPED_BYE_RECEIVED_CALL_REPLACED;break;case"END_REASON_INITIATOR_LEFT":s.mStoppedReason=t.StoppedReason.STOPPED_BYE_RECEIVED_INITIATOR_LEFT;break;case"END_REASON_NOT_ALLOWED":s.mStoppedReason=t.StoppedReason.STOPPED_BYE_RECEIVED_NOT_ALLOWED;break;case"END_REASON_HANG_TIME":s.mStoppedReason=t.StoppedReason.STOPPED_BYE_RECEIVED_HANG_TIME;break;case"END_REASON_TERMINATED":s.mStoppedReason=t.StoppedReason.STOPPED_BYE_RECEIVED_TERMINATED;break;default:p("".concat(s.toString()," Received a BYE with unknown reason: ").concat(n)),s.mStoppedReason=t.StoppedReason.STOPPED_BYE_RECEIVED}p("".concat(s.toString()," Call ended with reason: ").concat(s.mStoppedReason))}else s.mStoppedReason=t.StoppedReason.STOPPED_BYE_RECEIVED,p("".concat(s.toString()," Call ended without a reason given by backend"));s.newEvent(t.Event.STOPPED)}s.stopJssipUa(),s.stop()},s.onFailed=function(e){if(p("".concat(s.toString()," onFailed: ").concat(e.cause)),e.cause===i.C.causes.SIP_FAILURE_CODE)s.received500Error(e.message);else s.mFailedReason=t.FailedReason.INTERNAL_SERVER_ERROR;s.newEvent(t.Event.FAILED),s.stop(),s.stopJssipUa(),s.newEvent(t.Event.STOPPED)},s.stopJssipUa=function(){s.mJssipUa&&(s.mJssipUa.stop(),delete s.mJssipUa)},s.getInviteExtraHeaders=function(){var e=[];s.mSubscriberToken?(e[e.length]="token: ".concat(s.mSubscriberToken),delete s.mSubscriberToken):s.mOptions.subscriberPassword&&(e[e.length]="password: ".concat(s.mOptions.subscriberPassword));var t=function(){s.mOptions.sessionId&&(e[e.length]="sessionid: ".concat(s.mOptions.sessionId)),s.mOptions.synchronizeWithOtherDevices&&(e[e.length]="synchronizewithotherdevices: true")};return s.mOptions.sessionId&&s.mNbDisconnection>0?t():(s.mOptions.sessionId&&t(),e[e.length]="sessionmedia: ".concat(s.mOptions.sessionMedia),e[e.length]="sessiontype: ".concat(s.mOptions.sessionType),s.mOptions.swTo&&(e[e.length]="swto: ".concat(s.mOptions.swTo)),s.mOptions.swOut&&(e[e.length]="swout: ".concat(s.mOptions.swOut)),s.mOptions.isAnonymous&&(e[e.length]="isanonymous: true"),s.mOptions.sessionGroupId&&(e[e.length]="sessiongroupid: ".concat(s.mOptions.sessionGroupId)),s.mOptions.localId&&(e[e.length]="clientsessionid: ".concat(s.mOptions.localId)),s.mOptions.isEmergencyCall&&(e[e.length]="isemergencycall: true"),s.mOptions.isBroadcastCall&&(e[e.length]="isbroadcastcall: true"),s.mOptions.availableOnlyRecipients&&(e[e.length]="availableonlyrecipients: true"),s.mOptions.sessionSipPriority&&(e[e.length]="priority: ".concat(s.mOptions.sessionSipPriority.toString())),s.mOptions.floorRequestOnInvite&&(e[e.length]="implicitFloorRequest: true",s.mOptions.floorRequestOnInvite=!1),s.mOptions.mergedSessionIds&&(e[e.length]="mergedsessionids: ".concat(s.mOptions.mergedSessionIds)),s.mMediaHandler.getVideoCaptureSource()!==c.Participant.VideoCaptureSource.DEFAULT&&(e[e.length]="videocapturesource: ".concat(s.mMediaHandler.getVideoCaptureSource()))),e},s.parseheaders=function(e){var t,n;if(!e)return!1;try{for(var o=r.__values(["sessionid","isemergencycall","isbroadcastcall","largegroup","sessiongroupid","priority","swfrom","swfromname","forwardedfrom","forwardedname","participantlist","call-id","cseq"]),i=o.next();!i.done;i=o.next()){var a=i.value,l=e.getHeader(a);if(l)switch(a){case"sessionid":s.mSessionId=l,p("VoIP call ".concat(s.toString()," ").concat(a,": ").concat(s.mSessionId));break;case"isemergencycall":s.mIsAnEmergencyCall="true"===l,p("VoIP call ".concat(s.toString()," ").concat(a,": ").concat(f.Utils.strBool(s.mIsAnEmergencyCall)));break;case"isbroadcastcall":s.mIsABroadcastCall="true"===l,p("VoIP call ".concat(s.toString()," ").concat(a,": ").concat(f.Utils.strBool(s.mIsABroadcastCall)));break;case"largegroup":s.mLargeGroupCount=Number.parseInt(l,10),p("VoIP call ".concat(s.toString()," ").concat(a,": ").concat(s.mLargeGroupCount));break;case"sessiongroupid":s.mSessionGroupId=l,p("VoIP call ".concat(s.toString()," ").concat(a,": ").concat(s.mSessionGroupId));break;case"priority":s.mSessionPriority=l,p("VoIP call ".concat(s.toString()," ").concat(a,": ").concat(s.mSessionPriority));break;case"swfrom":s.mSwFrom=l,p("VoIP call ".concat(s.toString()," ").concat(a,": ").concat(s.mSwFrom));break;case"swfromname":s.mSwFromName=l,p("VoIP call ".concat(s.toString()," ").concat(a,": ").concat(s.mSwFromName));break;case"forwardedfrom":s.mForwardedFrom=l,p("VoIP call ".concat(s.toString()," ").concat(a,": ").concat(s.mForwardedFrom));break;case"forwardedname":s.mForwardedName=l,p("VoIP call ".concat(s.toString()," ").concat(a,": ").concat(s.mForwardedName));break;case"participantlist":try{var u=JSON.parse(f.Utils.stripslashes(l.substring(1,l.length-1)));s.onServiceMessageParticipantList(u)}catch(e){var c=e;return h("Failed to parse ".concat(a,": ").concat(c.name,": ").concat(c.message)),!1}break;case"call-id":s.mCallId=l,p("VoIP call ".concat(s.toString()," ").concat(a,": ").concat(s.mCallId));break;case"cseq":s.mCseq=parseInt(l,10),p("VoIP call ".concat(s.toString()," ").concat(a,": ").concat(s.mCseq))}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return!0},s.onMessageOutgoingRequest=function(e){if(s.mCallId){var t=e.getHeader("call-id");p("".concat(s.toString(),' Overwriting Call-ID "').concat(t,'" to: "').concat(s.mCallId,'"')),e.call_id=s.mCallId,e.setHeader("call-id",s.mCallId),e.cseq=++s.mCseq,e.setHeader("cseq",e.cseq.toString()+" "+e.method);var n=s.mMediaHandler.getRtcSession();n&&(n._dialog._local_seqnum=s.mCseq)}},s.onMessage=function(e){var n=e.request.getHeader("MessageType"),r=e.request.getHeader(t.messageType2Sub(n));if(p("".concat(s.toString()," messagetype: ").concat(n,"/").concat(r)),"local"===e.originator&&s.onMessageOutgoingRequest(e.request),s.isWalkieTalkie()){var o=e.request.getHeader(t.MessageTypeSub.MB_CONTROL_MESSAGE_TYPE);s.mFloorControl.onMediaburstMessage(o,e.request)}n===t.MessageType.SERVICE?s.onServiceMessage(e):n!==t.MessageType.MB_CONTROL&&p("".concat(s.toString()," MessageType: ").concat(n))},s.onServiceMessage=function(e){if("local"===e.originator)return!0;var n=e.request.getHeader(t.MessageTypeSub.SERVICE_MESSAGE_TYPE);if(!n)return!1;if("VoipSessionUpdated"===n){var r=JSON.parse(e.request.body);return r.ReadyToTransmit&&s.newEvent(t.Event.FLOOR_CONTROL,l.FloorControl.Event.READY_TO_TRANSMIT),void 0!==r.isEmergencyCall&&(p("Emergency call has been updated: ".concat(f.Utils.strBool(r.isEmergencyCall))+" (was: ".concat(f.Utils.strBool(s.mIsAnEmergencyCall),")")),s.mIsAnEmergencyCall=r.isEmergencyCall,s.mIsAnEmergencyCall&&void 0!==r.emergencyInitiator&&(s.mEmergencyInitiator=r.emergencyInitiator,p("Emergency call intiator has been updated: ".concat(s.mEmergencyInitiator))),s.newEvent(t.Event.SESSION_UPDATED)),!0}var o=JSON.parse(e.request.body);switch(n){case c.Participant.Event.PARTICIPANT_LIST:case c.Participant.Event.PARTICIPANT_INVITED:case c.Participant.Event.PARTICIPANT_TRANSFER:s.onServiceMessageParticipantList(o);break;case c.Participant.Event.PARTICIPANT_LIST:default:o.Contact&&s.mParticipants.onServiceMessageParticipant(n,o)}return!0},s.onServiceMessageParticipantList=function(e){e.ParticipantList&&s.mParticipants.updateParticipantList(e.ParticipantList,!0),e.AddedParticipantList&&s.mParticipants.updateParticipantList(e.AddedParticipantList,!1),e.SessionType&&(s.mSessionType=e.SessionType),e.SessionMedia&&(s.mSessionMedia=e.SessionMedia),e.SessionGroupId&&(s.mSessionGroupId=e.SessionGroupId),e.SessionPriority&&(s.mSessionPriority=e.SessionPriority),e.GroupNames&&(s.mGroupNames=e.GroupNames),e.GroupUsersList&&(s.mGroupUsersList=Object.assign([],e.GroupUsersList)),e.GroupAddedUsers&&(s.mGroupAddedUsers?s.mGroupAddedUsers.concat(e.GroupAddedUsers):s.mGroupAddedUsers=Object.assign([],e.GroupAddedUsers)),e.ReceptionTime&&(s.mReceptionTime=new Date(e.ReceptionTime)),s.mParticipants.parseAttendingArrivalTime(e),s.mParticipants.parseFloorPriority(e),e.FloorOwner&&(s.mFloorControl.updateFloorControlState(l.FloorControl.State.HAS_NO_PERMISSION),s.mFloorControl.updateFloorOwner(e.FloorOwner)),e.Transferor&&(s.mTransferor=e.Transferor),e.MergedSessionIds&&(s.mMergedSessionIds=e.MergedSessionIds),(e.ParticipantList||e.AddedParticipantList)&&s.newEvent(t.Event.PARTICIPANT,c.Participant.Event.PARTICIPANT_LIST)},s.sendServiceMessage=function(e,t){if(!s.mJssipUa)return!1;var n={eventHandlers:{succeeded:function(t){t.response&&p("".concat(e," has been successfully executed: ").concat(t.response.status_code))},failed:function(e){s.received500Error(e.response)}},extraHeaders:["MessageType: SERVICE","ServiceMessageType: "+e]};return t&&n.extraHeaders&&(n.extraHeaders=n.extraHeaders.concat(t)),s.mJssipUa.sendMessage(s.mUri,"",n),!0},s.received500Error=function(e){if(!e)return!1;if(e.body){var n=JSON.parse(e.body);s.mFailedReason=n.error,h(s.toString()+": Server error: "+n.error)}else h(s.toString()+": No explicit error from Server"),s.mFailedReason=t.FailedReason.INTERNAL_SERVER_ERROR;return!0},s.mInstanceId=t.sInstanceCount++,s.mUa=n;var m=n.getOptions();return s.mUri=new i.URI("sips",o.VOIP_APP,m.host,o.VOIP_APP_PORT),a.localId?s.mLocalId=a.localId:s.mLocalId=f.Utils.guid(),s.mOptions=a,s.mOptions.captureOptions||(s.mOptions.captureOptions={}),s.mOptions.playOptions||(s.mOptions.playOptions={}),t.logOptions(a),s.mMediaHandler=new u.MediaHandler(s.mOptions.captureOptions,s.mOptions.playOptions,"[Session #".concat(s.mInstanceId,"]")),s.mMediaHandler.onvolumelocal=function(){s.mMediaHandler&&s.newEvent(t.Event.MEDIA,u.MediaHandler.Event.VOLUME_LOCAL)},s.mMediaHandler.onvolumeremote=function(){s.mMediaHandler&&s.newEvent(t.Event.MEDIA,u.MediaHandler.Event.VOLUME_REMOTE)},s.mMediaHandler.onqos=function(){s.mMediaHandler&&s.newEvent(t.Event.MEDIA,u.MediaHandler.Event.QOS)},s.mMediaHandler.onrecordlocal=function(){s.mMediaHandler&&s.newEvent(t.Event.MEDIA,u.MediaHandler.Event.BURST_RECORDED_SENT)},s.mMediaHandler.onrecordremote=function(){s.mMediaHandler&&s.newEvent(t.Event.MEDIA,u.MediaHandler.Event.BURST_RECORDED_RECEIVED)},s.mMediaHandler.onlocalmediastreamtrackend=function(){if(s.mMediaHandler){s.newEvent(t.Event.MEDIA,u.MediaHandler.Event.MEDIA_STREAM_LOCAL_TRACK_ENDED);var e=function(){p("".concat(s.toString()," Has no local mediastream with active tracks, ending now")),s.mStoppedReason=t.StoppedReason.STOPPED_SHARING_LOCAL_MEDIA,s.stop(),s.stopJssipUa(),s.newEvent(t.Event.STOPPED)};if(!s.mMediaHandler.doesMediaStreamLocalHaveActiveTracks()){if(s.receivesOnly())return void e();var n={audio:s.mOptions.sessionMedia.includes(t.SessionMedia.AUDIO),video:s.mOptions.sessionMedia.includes(t.SessionMedia.VIDEO)};s.mMediaHandler.getMediaStream(n).then((function(e){p("".concat(s.toString()," Got mediastream: ").concat(f.Utils.strMediaStream(e))),s.mMediaHandler.setMediaStreamLocal(e)})).catch((function(t){var n=t;h("".concat(s.toString()," Error while getting mediastream, aborting: ").concat(n.message)),h(n.stack),e()}))}}},s.mMediaHandler.ondevicechange=function(){if(s.mMediaHandler){s.newEvent(t.Event.MEDIA,u.MediaHandler.Event.MEDIA_STREAM_DEVICE_CHANGE);var e={audio:s.mOptions.sessionMedia.includes(t.SessionMedia.AUDIO),video:s.mOptions.sessionMedia.includes(t.SessionMedia.VIDEO)};s.mMediaHandler.getMediaStream(e).then((function(e){p("".concat(s.toString()," Got mediastream: ").concat(f.Utils.strMediaStream(e))),s.mMediaHandler.setMediaStreamLocal(e)})).catch((function(e){var t=e;h("".concat(s.toString()," Error while getting mediastream, aborting: ").concat(t.message)),h(t.stack)}))}},s.mParticipants.onevent=function(e){s.newEvent(t.Event.PARTICIPANT,e)},s.mFloorControl=new l.FloorControl(a.subscriberMsisdn,s.mParticipants),s.mFloorControl.sendmessage=function(e){if(s.mJssipUa)return s.mJssipUa.sendMessage(s.mUri,"",e)},s.mFloorControl.onevent=function(e){s.newEvent(t.Event.FLOOR_CONTROL,e),e===l.FloorControl.Event.GRANTED?s.mMediaHandler.startRecordLocal():e===l.FloorControl.Event.TAKEN?(s.isMuted()&&p("".concat(s.toString()," Floor taken while muted.")),s.mMediaHandler.startRecordRemote()):e===l.FloorControl.Event.IDLE&&(s.mMediaHandler.stopRecordLocal(),s.mMediaHandler.stopRecordRemote())},s.mFloorControl.mute=function(e){return e?s.mMediaHandler.muteCapture():s.mMediaHandler.unmuteCapture()},s}return r.__extends(t,e),t.sInstanceCount=0,t.logOptions=function(e){if(p(" - subscriberMsisdn: ".concat(e.subscriberMsisdn)),e.getSubscriberToken?p(" - getSubscriberToken"):e.subscriberPassword?p(" - subscriberPassword: XXX"):p(" - no auth method???"),e.swTo&&p(" - swTo: ".concat(e.swTo)),e.swOut&&p(" - swOut: ".concat(e.swOut)),e.isAnonymous&&p(" - isAnonymous: ".concat(f.Utils.strBool(e.isAnonymous))),e.sessionId&&p(" - sessionId: ".concat(e.sessionId)),e.sessionType&&p(" - sessionType: ".concat(e.sessionType)),e.sessionSipPriority&&p(" - sessionSipPriority: ".concat(e.sessionSipPriority)),e.sessionMedia&&p(" - sessionMedia: ".concat(e.sessionMedia)),e.sessionGroupId&&p(" - sessionGroupId: ".concat(e.sessionGroupId)),e.localId&&p(" - localId: ".concat(e.localId)),e.autoReconnect&&p(" - autoReconnect: ".concat(f.Utils.strBool(e.autoReconnect))),e.synchronizeWithOtherDevices&&p(" - synchronizeWithOtherDevices: ".concat(f.Utils.strBool(e.synchronizeWithOtherDevices))),e.isEmergencyCall&&p(" - isEmergencyCall: ".concat(f.Utils.strBool(e.isEmergencyCall))),e.isBroadcastCall&&p(" - isBroadcastCall: ".concat(f.Utils.strBool(e.isBroadcastCall))),e.availableOnlyRecipients&&p(" - availableOnlyRecipients: ".concat(f.Utils.strBool(e.availableOnlyRecipients))),e.floorRequestOnInvite&&p(" - floorRequestOnInvite: ".concat(f.Utils.strBool(e.floorRequestOnInvite))),e.mergedSessionIds&&p(" - mergedSessionIds: ".concat(e.mergedSessionIds)),e.mediaStream&&p(" - mediaStream: ".concat(f.Utils.strMediaStream(e.mediaStream))),e.captureOptions){if(p(" - captureOptions:"),e.captureOptions.htmlSource){var t=e.captureOptions.htmlSource;p("   - htmlSource: ".concat(t.localName,": ").concat(t.id))}e.captureOptions.screensharing&&p("   - screensharing: ".concat(f.Utils.strBool(e.captureOptions.screensharing)))}e.playOptions&&(p(" - playOptions:"),e.playOptions.rendererRemote&&p("   - rendererRemote: ".concat(f.Utils.strMediaElement(e.playOptions.rendererRemote))),e.playOptions.rendererLocal&&p("   - rendererLocal: ".concat(f.Utils.strMediaElement(e.playOptions.rendererLocal))))},t}(s.EventEmitter);t.Call=m,function(e){var t,n;!function(e){e.SERVICE="SERVICE",e.MB_CONTROL="MB_CONTROL"}(t=e.MessageType||(e.MessageType={})),function(e){e.SERVICE_MESSAGE_TYPE="ServiceMessageType",e.MB_CONTROL_MESSAGE_TYPE="MBControlMessageType"}(n=e.MessageTypeSub||(e.MessageTypeSub={})),e.messageType2Sub=function(e){switch(e){case t.SERVICE:return n.SERVICE_MESSAGE_TYPE;case t.MB_CONTROL:return n.MB_CONTROL_MESSAGE_TYPE;default:return""}},function(e){e.STARTED="Started",e.STOPPED="Stopped",e.FAILED="Failed",e.DISCONNECTED_AND_RECONNECTING="disconnected_and_reconnecting",e.SESSION_SUBSCRIBER_INVITATION_OK="invite_new_participants_ok",e.SESSION_SUBSCRIBER_INVITATION_NOK="invite_new_participants_nok",e.SESSION_TRANSFER_OK="transfer_ok",e.SESSION_TRANSFER_NOK="transfer_nok",e.SESSION_UPDATE_OK="update_ok",e.SESSION_UPDATE_NOK="update_nok",e.SESSION_UPDATED="updated",e.PARTICIPANT="Participant",e.FLOOR_CONTROL="FloorControl",e.MEDIA="Media"}(e.Event||(e.Event={})),function(e){e.UNKNOWN="unknown",e.AUDIO="audio",e.VIDEO="video",e.AUDIOVIDEO="audiovideo"}(e.SessionMedia||(e.SessionMedia={})),function(e){e.UNKNOWN="unknown",e.FREECALL="live",e.WALKIETALKIE="PoC",e.LIVESTREAM="livestream",e.CONFERENCE="conference",e.AMBIENT_LISTENING="ambient-listening"}(e.SessionType||(e.SessionType={})),function(e){e.NON_URGENT="non-urgent",e.NORMAL="normal",e.URGENT="urgent",e.EMERGENCY="emergency"}(e.SipPriority||(e.SipPriority={})),function(e){e.USER_HANGUP="USER_HANGUP",e.CANCEL="CANCEL"}(e.Hangup||(e.Hangup={})),function(e){e.STOPPED_UNKNOWN="unknown",e.STOPPED_CANCELLED="cancelled",e.STOPPED_DISCONNECTION="disconnection",e.STOPPED_BYE_SENT="bye_sent",e.STOPPED_BYE_RECEIVED="bye_received",e.STOPPED_BYE_RECEIVED_NOT_ALLOWED="bye_received_not_allowed",e.STOPPED_BYE_RECEIVED_CALL_REPLACED="bye_received_call_replaced",e.STOPPED_BYE_RECEIVED_INITIATOR_LEFT="bye_received_initiator_left",e.STOPPED_BYE_RECEIVED_GROUP_REMOVED="bye_received_group_received",e.STOPPED_BYE_RECEIVED_HANG_TIME="bye_received_hang_time",e.STOPPED_BYE_RECEIVED_TERMINATED="bye_received_terminated",e.STOPPED_AUTORECONNECTION_TIMEOUT="autoreconnection_timeout",e.STOPPED_SHARING_LOCAL_MEDIA="stopped_sharing_local_media"}(e.StoppedReason||(e.StoppedReason={})),function(e){e.SUCCESS="SUCCESS",e.ACCOUNT_NOT_EXIST="ACCOUNT_NOT_EXIST",e.AUTH_BAD_PASSWORD="AUTH_BAD_PASSWORD",e.UNAUTHORIZED_MSISDN="UNAUTHORIZED_MSISDN",e.SUBSCRIBER_BLOCKED="SUBSCRIBER_BLOCKED",e.SUBSCRIBER_DISABLED="SUBSCRIBER_DISABLED",e.SUBSCRIBER_UNASSIGNED="SUBSCRIBER_UNASSIGNED",e.ORGANIZATION_BLOCKED="ORGANIZATION_BLOCKED",e.ORGANIZATION_EXPIRED="ORGANIZATION_EXPIRED",e.CALL_OUT_FAILED="CALL_OUT_FAILED",e.CALL_OUT_BUSY="CALL_OUT_BUSY",e.UNKNOWN_SESSION_ID="UNKNOWN_SESSION_ID",e.SERVICE_UNAVAILABLE="SERVICE_UNAVAILABLE",e.FEATURE_NOT_ALLOWED="FEATURE_NOT_ALLOWED",e.CUG_DENIED="CUG_DENIED",e.NO_RESOURCE="NO_RESOURCE",e.CHANNEL_FULL="CHANNEL_FULL",e.MISSING_SDP="MISSING_SDP",e.INVALID_INVITE="INVALID_INVITE",e.INTERNAL_SERVER_ERROR="INTERNAL_SERVER_ERROR",e.INCOMING_SIP_INVITES_LIMIT_REACHED="INCOMING_SIP_INVITES_LIMIT_REACHED",e.INCOMING_SIP_MESSAGES_LIMIT_REACHED="INCOMING_SIP_MESSAGES_LIMIT_REACHED",e.FAILED_AUTHENTICATION_LIMIT_REACHED="FAILED_AUTHENTICATION_LIMIT_REACHED",e.TOO_MANY_PARTICIPANTS="TOO_MANY_PARTICIPANTS",e.COULD_NOT_GET_TOKEN="COULD_NOT_GET_TOKEN",e.COULD_NOT_GET_MEDIASTREAM="COULD_NOT_GET_MEDIASTREAM",e.CONNECTION_ERROR="CONNECTION_ERROR"}(e.FailedReason||(e.FailedReason={}))}(m=t.Call||(t.Call={})),t.Call=m},9341:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Configuration=void 0;var r=n(655),o=n(4547),i=n(878),a=n(1116),s=o.Debugger.extend("Configuration"),l=o.Debugger.extend("ERROR:Configuration"),u=new Map([["voip_sip_connection_timeout",a.Socket.setConnectionTimeout],["voip_sip_keepalive_interval",a.Socket.setKeepAliveInterval],["voip_sip_keepalive_timeout",a.Socket.setKeepAliveTimeout],["voip_video_camera_max_framerate",i.MediaHandler.setCameraMaxFramerate],["voip_video_camera_max_resolution",i.MediaHandler.setCameraMaxResolution],["voip_video_screensharing_max_framerate",i.MediaHandler.setScreenSharingMaxFramerate]]),c=function(){function e(){}return e.setGlobalConfiguration=function(e){var t,n;try{for(var o=r.__values(Object.entries(e)),i=o.next();!i.done;i=o.next()){var a=r.__read(i.value,2),c=a[0],d=a[1],f=u.get(c);f?f(d)?s("Successfully set "+c+" to "+d):l("Could not set "+c+" to "+d):s("Skipping "+c)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},e}();t.Configuration=c},2749:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VOIP_APP_PORT=t.VOIP_APP=t.AUTO_RECONNECT_MAX_DELAY=t.USER_AGENT=t.name=t.version=void 0;var r=n(655),o=r.__importStar(n(5979)),i=n(3696),a=r.__importDefault(n(835));t.version=i.LIBRARY_VERSION,t.name="SWSIPVOIP2",t.USER_AGENT="".concat(a.default.browserDetails.browser," ").concat(a.default.browserDetails.version||"?"," ")+"".concat(o.name,"/").concat(o.version," SWSIPVOIP2.js/").concat(i.LIBRARY_VERSION),t.AUTO_RECONNECT_MAX_DELAY=25,t.VOIP_APP="swsmartms-voip",t.VOIP_APP_PORT=5063},4547:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.disable=t.enable=t.Debugger=void 0;var r=n(655),o=r.__importStar(n(2749)),i=r.__importStar(n(5979)),a=n(1227);t.Debugger=(0,a.debug)(o.name),a.debug.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.log("".concat((new Date).toISOString()," | ").concat(e[0]),e[1],e[2],e[3])};t.enable=function(e){e||(e="".concat(o.name,":*,").concat(i.name,":*")),a.debug.enable(e)};t.disable=function(){a.debug.disable()}},9011:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FloorControl=void 0;var r=n(4547),o=n(9616),i=n(1784),a=r.Debugger.extend("FloorControl"),s=function e(t,n){var r=this;this.mFloorStateCurrent=e.State.HAS_NO_PERMISSION,this.mFloorStatePrevious=e.State.HAS_NO_PERMISSION,this.mFloorDenyReason=e.DenyReason.UNKNOWN,this.mFloorRevokeReason=e.RevokeReason.UNKNOWN,this.mFloorHasPermissionToRequestFloor=!1,this.getFloorOwner=function(){return r.mFloorOwner},this.getFloorOwnerLast=function(){return r.mFloorOwnerLast},this.getFloorOwnerExtUserIdUpdated=function(){return r.mFloorOwnerExtUserIdUpdated},this.getFloorState=function(){return r.mFloorStateCurrent},this.getPreviousFloorState=function(){return r.mFloorStatePrevious},this.getFloorGrantedDuration=function(){return r.mFloorGrantedDuration},this.getFloorDenyReason=function(){return r.mFloorDenyReason},this.getFloorRevokeReason=function(){return r.mFloorRevokeReason},this.hasPermissionToRequestFloor=function(){return r.mFloorHasPermissionToRequestFloor},this.updateFloorOwner=function(e){r.mFloorOwner=o.Participant.contactBeforeAt(e),r.mFloorOwnerLast=r.mFloorOwner;var t=r.mParticipants.get(r.mFloorOwner),n=r.mParticipants.get(r.mSubscriberMsisdn);r.mFloorHasPermissionToRequestFloor=!t||!n||n.getFloorPriority()>t.getFloorPriority(),a('New floor owner set to "'.concat(r.mFloorOwner,'",')+" permission to request floor: ".concat(i.Utils.strBool(r.mFloorHasPermissionToRequestFloor)))},this.updateFloorControlState=function(t){t!==r.mFloorStateCurrent&&(r.mFloorStatePrevious=r.mFloorStateCurrent,r.mFloorStateCurrent=t,a("Floor control state new state: ".concat(r.mFloorStateCurrent," (was: ").concat(r.mFloorStatePrevious,")")),r.mute(r.mFloorStateCurrent!==e.State.HAS_PERMISSION))},this.requestFloor=function(){var t={eventHandlers:{succeeded:function(t){t.response&&a("FloorRequest has been granted: ".concat(t.response.status_code)),r.updateFloorControlState(e.State.HAS_PERMISSION),r.onevent(e.Event.GRANTED)},failed:function(t){if(t.response&&t.response.body){var n=JSON.parse(t.response.body);r.mFloorDenyReason=n.error,a("FloorRequest has been denied: ".concat(r.mFloorDenyReason))}r.updateFloorControlState(e.State.HAS_NO_PERMISSION),a(t),r.onevent(e.Event.DENY)}},extraHeaders:["MessageType: MB_CONTROL","MBControlMessageType: MediaBurstRequest"]};return r.sendmessage(t),!0},this.releaseFloor=function(){var t={eventHandlers:{succeeded:function(t){t.response&&a("FloorRelease has been granted: ".concat(t.response.status_code)),r.updateFloorControlState(e.State.HAS_NO_PERMISSION),r.onevent(e.Event.IDLE)},failed:function(t){t.response&&a("FloorRelease has been denied: ".concat(t.response.status_code)),r.updateFloorControlState(e.State.HAS_NO_PERMISSION),r.onevent(e.Event.IDLE)}},extraHeaders:["MessageType: MB_CONTROL","MBControlMessageType: MediaBurstRelease"]};return r.sendmessage(t),!0},this.onMediaburstMessage=function(t,n){var o,i,s=!0;switch(t){case e.Event.REQUEST:r.updateFloorControlState(e.State.PENDING_REQUEST);break;case e.Event.RELEASE:r.updateFloorControlState(e.State.PENDING_RELEASE);break;case e.Event.TAKEN:r.updateFloorControlState(e.State.HAS_NO_PERMISSION),o=JSON.parse(n.body),r.updateFloorOwner(o.FloorOwner);break;case e.Event.GRANTED:r.updateFloorControlState(e.State.HAS_PERMISSION),i=JSON.parse(n.body),r.mFloorGrantedDuration=i.FloorGrantedTime;break;case e.Event.DENY:if(n.body){var l=JSON.parse(n.body);r.mFloorDenyReason=l.error,a("FloorRequest has been denied: ".concat(r.mFloorDenyReason))}r.updateFloorControlState(e.State.HAS_NO_PERMISSION);break;case e.Event.EXT_FLOOR_OWNER_USER_ID_UPDATE:o=JSON.parse(n.body),r.mFloorOwnerExtUserIdUpdated=o.FloorOwner,a('Floor owner "'.concat(r.mFloorOwner||"?",'" ')+'updated identity: "'.concat(r.mFloorOwnerExtUserIdUpdated,'"'));break;case e.Event.IDLE:r.updateFloorControlState(e.State.HAS_NO_PERMISSION),delete r.mFloorOwner,delete r.mFloorOwnerExtUserIdUpdated,delete r.mFloorGrantedDuration;break;case e.Event.REVOKE:r.updateFloorControlState(e.State.HAS_NO_PERMISSION),delete r.mFloorOwner,delete r.mFloorOwnerExtUserIdUpdated;break;default:s=!1}return s?(a("Successfully processed event: ".concat(t)),r.onevent(t)):a("Unknown event: ".concat(t)),s},this.mSubscriberMsisdn=t,this.mParticipants=n,this.sendmessage=function(e){return a("options: ".concat(JSON.stringify(e)))},this.onevent=function(e){return a("event: ".concat(e))},this.mute=function(e){return a("mute: ".concat(i.Utils.strBool(e)))}};t.FloorControl=s,function(e){!function(e){e.START_STOP="StartStop",e.HAS_NO_PERMISSION="HasNoPermission",e.PENDING_REQUEST="PendingRequest",e.HAS_PERMISSION="HasPermission",e.PENDING_RELEASE="PendingRelease",e.INACTIVE="Inactive"}(e.State||(e.State={})),function(e){e.REQUEST="MediaBurstRequest",e.RELEASE="MediaBurstRelease",e.IDLE="MediaBurstIdle",e.TAKEN="MediaBurstTaken",e.GRANTED="MediaBurstGranted",e.REQUEST_TIMEOUT="MediaBurstRequestTimeout",e.DENY="MediaBurstDeny",e.REVOKE="MediaBurstRevoke",e.RELEASE_TIMEOUT="MediaBurstReleaseTimeout",e.QUEUED="MediaBurstQueued",e.EXT_FLOOR_OWNER_USER_ID_UPDATE="MediaBurstExtFloorOwnerUserIdUpdate",e.READY_TO_TRANSMIT="ReadyToTransmit"}(e.Event||(e.Event={})),function(e){e.ANOTHER_CLIENT_HAS_PERMISSION="BURST_DENIED_ANOTHER_CLIENT_HAS_PERMISSION",e.INTERNAL_SERVER_ERROR="BURST_DENIED_INTERNAL_SERVER_ERROR",e.ONLY_ONE_PARTICIPANT="BURST_DENIED_ONLY_ONE_PARTICIPANT",e.RETRY_AFTER_TIMER_NOT_EXPIRED="BURST_DENIED_RETRY_AFTER_TIMER_NOT_EXPIRED",e.RECEIVE_ONLY="BURST_DENIED_RECEIVE_ONLY",e.NO_RESOURCES="BURST_DENIED_NO_RESOURCES",e.QUEUE_FULL="BURST_DENIED_QUEUE_FULL",e.OTHER="BURST_DENIED_OTHER",e.UNKNOWN="BURST_DENIED_UNKNOWN"}(e.DenyReason||(e.DenyReason={})),function(e){e.ONLY_ONE_PARTICIPANT="OnlyOneParticipant",e.MEDIABURST_TOO_LONG="MediaburstTooLong",e.NO_PERMISSION="NoPermission",e.PREEMPTED="Preempted",e.NO_RESOURCES="NoResources",e.OTHER="Other",e.UNKNOWN="Unknown"}(e.RevokeReason||(e.RevokeReason={}))}(s=t.FloorControl||(t.FloorControl={})),t.FloorControl=s},878:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaHandler=void 0;var r=n(655),o=r.__importStar(n(766)),i=n(4547),a=n(6607),s=n(2717),l=n(6150),u=n(9616),c=n(1784),d=r.__importDefault(n(835)),f=i.Debugger.extend("MediaHandler"),p=i.Debugger.extend("ERROR:MediaHandler"),h=f.extend("ICE"),m=function(){function e(t,n,i){var m=this;this.mPrefix="",this.mPlayOptions={},this.mMutedCapture={audio:!1,video:!1},this.mMutedPlay={audio:!1,video:!1},this.mVideoCaptureSource=u.Participant.VideoCaptureSource.DEFAULT,this.getMediaStream=function(t){var n=function(n){var r={};return t.audio&&(r.audio={channelCount:e.sConfig.audio.channelCount,echoCancellation:e.sConfig.audio.echoCancellation}),t.video&&(n===u.Participant.VideoCaptureSource.SCREEN_SHARING?r.video={frameRate:e.sConfig.video.screensharing.fps}:r.video={frameRate:e.sConfig.video.camera.fps,height:e.sConfig.video.camera.height,width:e.sConfig.video.camera.width}),r};if(m.mCaptureOptions.htmlSource){m.mVideoCaptureSource=u.Participant.VideoCaptureSource.CANVAS;var r=m.mCaptureOptions.htmlSource.captureStream(e.sConfig.video.screensharing.fps),o=m.mCaptureOptions.htmlSource.tagName;return new Promise((function(e,t){r?(f("".concat(m.mPrefix," Got mediastream from element: ").concat(o)),e(r)):t(new DOMException("Could not get mediastream from element: "+o))}))}return m.mCaptureOptions.screensharing?(m.mVideoCaptureSource=u.Participant.VideoCaptureSource.SCREEN_SHARING,navigator.mediaDevices.getDisplayMedia(n(m.mVideoCaptureSource))):(e.listDevices(),m.mVideoCaptureSource=u.Participant.VideoCaptureSource.CAMERA,navigator.mediaDevices.getUserMedia(n(m.mVideoCaptureSource)))},this.getVideoCaptureSource=function(){return m.mVideoCaptureSource},this.getRtcSession=function(){return m.mJssipRtcSession},this.setRtcSession=function(e){if(m.mJssipRtcSession=e,m.mJssipRtcSession.connection){var t=function(e){var t=e.target;h("".concat(m.mPrefix," ").concat(e.type,', gathering "').concat(t.iceGatheringState,'",')+' connection: "'.concat(t.iceConnectionState,'"'))};m.mJssipRtcSession.connection.onconnectionstatechange=t,m.mJssipRtcSession.connection.onicecandidate=function(e){var t,n=e.target;h("".concat(m.mPrefix," ").concat(e.type,', gathering "').concat(n.iceGatheringState,'",')+' connection: "'.concat(n.iceConnectionState,'": ').concat((null===(t=e.candidate)||void 0===t?void 0:t.candidate)||"?"))},m.mJssipRtcSession.connection.onicecandidateerror=t,m.mJssipRtcSession.connection.oniceconnectionstatechange=t,m.mJssipRtcSession.connection.onicegatheringstatechange=t,m.mJssipRtcSession.connection.onnegotiationneeded=t,m.mJssipRtcSession.connection.onsignalingstatechange=t,m.mJssipRtcSession.connection.ondatachannel=function(e){var t=e.target;h("".concat(m.mPrefix," ").concat(e.type,', gathering "').concat(t.iceGatheringState,'",')+' connection: "'.concat(t.iceConnectionState,'": ').concat(e.channel.label))},m.mJssipRtcSession.connection.ontrack=function(e){var t,n,o=e.target;if(h("".concat(m.mPrefix," ").concat(e.type,', gathering ""').concat(o.iceGatheringState,'",')+' connection: "'.concat(o.iceConnectionState,'": ').concat(e.track.label,"/").concat(e.track.id)),e.track.getSettings){var i=e.track.getSettings();h("".concat(m.mPrefix," Track ").concat(c.Utils.strMediaStreamTrack(e.track)," settings: ")+"".concat(JSON.stringify(i,null,"\t")))}if(e.track.getCapabilities){var s=e.track.getCapabilities();h("".concat(m.mPrefix," Track ").concat(c.Utils.strMediaStreamTrack(e.track)," capabilities:")+" ".concat(JSON.stringify(s,null,"\t")))}try{for(var l=r.__values(e.streams),u=l.next();!u.done;u=l.next()){var p=u.value;m.mMediaStreamRemote!==p&&(m.mMediaStreamRemote=p,f("".concat(m.mPrefix," Setting new remote mediastream: ").concat(c.Utils.strMediaStream(m.mMediaStreamRemote))),"firefox"===d.default.browserDetails.browser&&(delete m.mMediaHandlerAudioRemote,m.mMediaStreamRemote&&m.mMediaStreamRemote.getAudioTracks().length&&(m.mMediaHandlerAudioRemote=new a.MediaHandlerAudio(m.mMediaStreamRemote),m.mMediaHandlerAudioRemote.onvolume=m.onvolumeremote)))}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}f("".concat(m.mPrefix," Setting receiver: ").concat(c.Utils.strMediaStreamTrack(e.track))),"audio"===e.track.kind?m.mRtpReceiver.audio=e.receiver:"video"===e.track.kind&&(m.mRtpReceiver.video=e.receiver),m.plugRenderers()},m.mJssipRtcSession.on("sdp",m.onsdp),m.mJssipRtcSession.on("peerconnection:setremotedescriptionfailed",m.onSetRemoteDescriptionFailed),m.mMediaHandlerStats=new l.MediaHandlerStats(m.mJssipRtcSession.connection,m.mPrefix),m.mMediaHandlerStats.onqos=m.onqos}},this.destroy=function(){var t;m.destroyConnectionToRemote(),f("".concat(m.mPrefix," Destroying MediaHandler")),null===(t=m.mMediaHandlerAudioLocal)||void 0===t||t.destroy(),delete m.mMediaHandlerAudioLocal,m.mMediaStreamLocal&&e.stopMediaStream(m.mMediaStreamLocal),delete m.mMediaStreamLocal},this.destroyConnectionToRemote=function(){var t,n;f("".concat(m.mPrefix," Destroying MediaHandler to remote")),null===(t=m.mMediaHandlerStats)||void 0===t||t.destroy(),delete m.mMediaHandlerStats,null===(n=m.mMediaHandlerAudioRemote)||void 0===n||n.destroy(),delete m.mMediaHandlerAudioRemote,e.stopMediaStream(m.mMediaStreamRemote),delete m.mMediaStreamRemote,delete m.mJssipRtcSession},this.enqueueDtmf=function(e){if(!m.mRtpSender.dtmf){if(!m.mRtpSender.audio)return p("".concat(m.mPrefix," Could not enqueue DTMF ").concat(e,": no audio sender is available")),!1;if(!m.mRtpSender.audio.dtmf)return p("".concat(m.mPrefix," Could not enqueue DTMF ").concat(e,": no DTMF sender is available")),!1;m.mRtpSender.dtmf=m.mRtpSender.audio.dtmf,m.mRtpSender.dtmf.ontonechange=function(e){e.tone&&f("".concat(m.mPrefix," DTMF sent: ").concat(e.tone))}}return f("".concat(m.mPrefix," DTMF Now enqueuing: ").concat(e)),m.mRtpSender.dtmf.insertDTMF(e),!0},this.setPlayOptions=function(e){return!!e&&(e.rendererLocal&&(m.mPlayOptions.rendererLocal=e.rendererLocal,f("".concat(m.mPrefix," Setting renderer local: ").concat(c.Utils.strMediaElement(m.mPlayOptions.rendererLocal)))),e.rendererRemote&&(m.mPlayOptions.rendererRemote=e.rendererRemote,f("".concat(m.mPrefix," Setting renderer remote: ").concat(c.Utils.strMediaElement(m.mPlayOptions.rendererRemote)))),m.mPlayOptions.shouldRecord=e.shouldRecord,m.plugRenderers(),!0)},this.getVolumeLocal=function(){return m.mMediaHandlerAudioLocal?m.mMediaHandlerAudioLocal.getVolume():a.MediaHandlerAudio.AUDIO_LEVEL_MIN},this.getVolumeRemote=function(){return m.mMediaHandlerAudioRemote?m.mMediaHandlerAudioRemote.getVolume():a.MediaHandlerAudio.AUDIO_LEVEL_MIN},this.getRecordLocal=function(){return m.mRecordLocal},this.getRecordDurationLocal=function(){return m.mRecordDurationLocal},this.getRecordRemote=function(){return m.mRecordRemote},this.getRecordDurationRemote=function(){return m.mRecordDurationRemote},this.getQos=function(){return m.mMediaHandlerStats?m.mMediaHandlerStats.getQos():0},this.openMediaStatsWindow=function(){m.mMediaHandlerStats&&m.mMediaHandlerStats.openWindow()},this.setAudioPlayPanning=function(e){m.mMediaHandlerAudioRemote?(m.mMediaHandlerAudioRemote.pan(e),f("".concat(m.mPrefix," Audio channel set to: ").concat(e))):p("".concat(m.mPrefix," Panning is not available"))},this.isMutedCapture=function(){return m.mMutedCapture},this.muteCapture=function(e){return void 0===e&&(e={audio:!0,video:!0}),f("".concat(m.mPrefix," muteCapture: ").concat(JSON.stringify(e))),e.audio=e.audio&&!!m.mRtpSender.audio,e.video=e.video&&!!m.mRtpSender.video,e.audio&&m.mRtpSender.audio&&m.mRtpSender.audio.track&&(m.mMutedCapture.audio=!0,m.mRtpSender.audio.track.enabled=!1),e.video&&m.mRtpSender.video&&m.mRtpSender.video.track&&(m.mMutedCapture.video=!0,m.mRtpSender.video.track.enabled=!1),!0},this.unmuteCapture=function(e){return void 0===e&&(e={audio:!0,video:!0}),f("".concat(m.mPrefix," unmuteCapture: ").concat(JSON.stringify(e))),(e=e||{audio:!0,video:!0}).audio&&m.mRtpSender.audio&&m.mRtpSender.audio.track&&(m.mMutedCapture.audio=!1,m.mRtpSender.audio.track.enabled=!0),e.video&&m.mRtpSender.video&&m.mRtpSender.video.track&&(m.mMutedCapture.video=!1,m.mRtpSender.video.track.enabled=!0),!0},this.isMutedPlay=function(){return m.mMutedPlay},this.mutePlay=function(e){return void 0===e&&(e={audio:!0,video:!0}),m.mJssipRtcSession&&m.mMediaStreamRemote?(e.audio&&m.mRtpReceiver.audio&&(m.mRtpReceiver.audio.track.enabled=!1,m.mMutedPlay.audio=!0,f("".concat(m.mPrefix," Successfully muted audio play: ").concat(c.Utils.strMediaElement(m.mPlayOptions.rendererRemote)))),e.video&&m.mRtpReceiver.video&&(m.mRtpReceiver.video.track.enabled=!1,m.mMutedPlay.video=!0,f("".concat(m.mPrefix," Successfully muted video play: ").concat(c.Utils.strMediaElement(m.mPlayOptions.rendererRemote)))),!0):(p("".concat(m.mPrefix," Cannot mute play: no RTC session nor remote mediastream")),!1)},this.unmutePlay=function(e){return void 0===e&&(e={audio:!0,video:!0}),m.mJssipRtcSession&&m.mMediaStreamRemote?(e.audio&&m.mRtpReceiver.audio&&(m.mRtpReceiver.audio.track.enabled=!0,m.mMutedPlay.audio=!1,f("".concat(m.mPrefix," Successfully unmuted audio play: ").concat(c.Utils.strMediaElement(m.mPlayOptions.rendererRemote)))),e.video&&m.mRtpReceiver.video&&(m.mRtpReceiver.video.track.enabled=!0,m.mMutedPlay.video=!1,f("".concat(m.mPrefix," Successfully unmuted video play: ").concat(c.Utils.strMediaElement(m.mPlayOptions.rendererRemote)))),!0):(p("".concat(m.mPrefix," Cannot unmute play: no RTC session nor remote mediastream")),!1)},this.setPlayVolume=function(e){var t=!0;return m.mMediaHandlerAudioRemote?(m.mMediaHandlerAudioRemote.setGain(e),f("".concat(m.mPrefix," Set the play gain to: ").concat(e))):m.mPlayOptions.rendererRemote?(m.mPlayOptions.rendererRemote.volume=e,f("".concat(m.mPrefix," Set the play volume of ")+"".concat(c.Utils.strMediaElement(m.mPlayOptions.rendererRemote)," to: ").concat(e))):(f("".concat(m.mPrefix," Could not set the play volume to: ").concat(e)),t=!1),t},this.doesMediaStreamLocalHaveActiveTracks=function(){var e,t;if(!m.mMediaStreamLocal)return!1;var n=!1,o=m.mMediaStreamLocal.getTracks();try{for(var i=r.__values(o),a=i.next();!a.done;a=i.next()){if(n="ended"!==a.value.readyState)break}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},this.getMediaStreamLocal=function(){return m.mMediaStreamLocal},this.setMediaStreamLocal=function(e){var t,n;m.mMediaStreamLocal=e,delete m.mMediaHandlerAudioLocal,m.mMediaStreamLocal&&m.mMediaStreamLocal.getAudioTracks().length&&(m.mMediaHandlerAudioLocal=new a.MediaHandlerAudio(m.mMediaStreamLocal,!0),m.mMediaHandlerAudioLocal.onvolume=m.onvolumelocal);var o=e.getTracks(),i=function(e){if(e.getSettings){var t=e.getSettings();f("".concat(m.mPrefix," Track ").concat(c.Utils.strMediaStreamTrack(e)," settings: ").concat(JSON.stringify(t,null,"\t")))}if(e.getCapabilities){var n=e.getCapabilities();f("".concat(m.mPrefix," Track ").concat(c.Utils.strMediaStreamTrack(e)," capabilities: ")+"".concat(JSON.stringify(n,null,"\t")))}e.onended=function(t){f("".concat(m.mPrefix," UI Event: ").concat(t.type," for media track: ")+c.Utils.strMediaStreamTrack(t.target)),m.onlocalmediastreamtrackend&&m.onlocalmediastreamtrackend(e)}};try{for(var s=r.__values(o),l=s.next();!l.done;l=s.next()){i(l.value)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}m.plugRenderers()},this.startRecordRemote=function(){if(m.mPlayOptions.shouldRecord&&m.mMediaStreamRemote){var e=Date.now();m.mMediaRecorderRemote=new MediaRecorder(m.mMediaStreamRemote),m.mMediaRecorderRemote.ondataavailable=function(t){t.data&&t.data.size>0?(m.mRecordRemote=t.data,m.mRecordDurationRemote=Date.now()-e,f("".concat(m.mPrefix," New recording of remote burst of ").concat(t.data.size," bytes ")+"(duration ".concat(m.mRecordDurationRemote,") (").concat(t.data.type,")")),m.onrecordremote&&m.onrecordremote()):f("".concat(m.mPrefix," unhandled record event for remote burst: ").concat(t.type)+" on stream ".concat(c.Utils.strMediaStream(m.mMediaStreamRemote)))},m.mMediaRecorderRemote.onerror=function(e){var t=e;f("".concat(m.mPrefix," ev ").concat(e.type," ").concat(t.error.name,": ").concat(t.error.message))},m.mMediaRecorderRemote.onstart=function(e){return f("Starting recording remote burst (".concat(e.type,")"))},m.mMediaRecorderRemote.onstop=function(e){return f("Stopping recording remote burst (".concat(e.type,")"))},m.mMediaRecorderRemote.start(),f("".concat(m.mPrefix," Now recording remote burst on stream ").concat(c.Utils.strMediaStream(m.mMediaStreamRemote)))}},this.stopRecordRemote=function(){var e;null===(e=m.mMediaRecorderRemote)||void 0===e||e.stop(),delete m.mMediaRecorderRemote},this.startRecordLocal=function(){if(m.mPlayOptions.shouldRecord&&m.mMediaStreamLocal){var e=Date.now();m.mMediaRecorderLocal=new MediaRecorder(m.mMediaStreamLocal),m.mMediaRecorderLocal.ondataavailable=function(t){t.data&&t.data.size>0?(m.mRecordLocal=t.data,m.mRecordDurationLocal=Date.now()-e,f("".concat(m.mPrefix," New recording of local burst of ").concat(t.data.size," bytes ")+"(duration ".concat(m.mRecordDurationRemote||"?",") (").concat(t.data.type,")")),m.onrecordlocal&&m.onrecordlocal()):f("".concat(m.mPrefix," unhandled record event for local burst: ").concat(t.type)+" on stream ".concat(c.Utils.strMediaStream(m.mMediaStreamRemote)))},m.mMediaRecorderLocal.onerror=function(e){var t=e;f("ev ".concat(e.type," ").concat(t.error.name,": ").concat(t.error.message))},m.mMediaRecorderLocal.onstart=function(e){return f("Starting recording local burst (".concat(e.type,")"))},m.mMediaRecorderLocal.onstop=function(e){return f("Stopping recording local burst (".concat(e.type,")"))},m.mMediaRecorderLocal.start(),f("".concat(m.mPrefix," Now recording local burst on stream ").concat(c.Utils.strMediaStream(m.mMediaStreamLocal)))}},this.stopRecordLocal=function(){var e;null===(e=m.mMediaRecorderLocal)||void 0===e||e.stop(),delete m.mMediaRecorderLocal},this.plugRenderers=function(){var e,t,n=[m.mPlayOptions.rendererLocal,m.mPlayOptions.rendererRemote],o=function(e){f("".concat(m.mPrefix," UI Event: ").concat(e.type," for rendering element: ")+c.Utils.strMediaElement(e.target))};try{for(var i=r.__values(n),a=i.next();!a.done;a=i.next()){var s=a.value;if(!s)break;s.onabort=o,s.onended=o,s.onpause=o,s.onplaying=o,s.onstalled=o,s.onerror=function(e,t,n,r,o){f("string"==typeof e?"".concat(m.mPrefix," UI Event: ").concat(e," for rendering element: ").concat((null==o?void 0:o.message)||"?"):"".concat(m.mPrefix," UI Event: ").concat(e.type,", error: ").concat((null==o?void 0:o.message)||"?"," for rendering element: ")+c.Utils.strMediaElement(e.target))}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}var l=function(e,t){if(e.srcObject!==t){f("".concat(m.mPrefix," Plugging ").concat(c.Utils.strMediaStream(t))+" to renderer ".concat(c.Utils.strMediaElement(e))),e.autoplay=!0,e.srcObject=t,e.muted=!0;try{e.play().then((function(t){f("".concat(m.mPrefix," Successfully starting to play renderer ").concat(c.Utils.strMediaElement(e))),f(t)})).catch((function(t){var n=t;f("".concat(m.mPrefix," Failed to play renderer ").concat(c.Utils.strMediaElement(e),": ").concat(n.name,": ").concat(n.message))}))}catch(t){var n=t;f("".concat(m.mPrefix," Exception when playing renderer ").concat(c.Utils.strMediaElement(e),": ").concat(n.name,": ").concat(n.message))}}};m.mPlayOptions.rendererLocal&&m.mMediaStreamLocal&&l(m.mPlayOptions.rendererLocal,m.mMediaStreamLocal),m.mPlayOptions.rendererRemote&&m.mMediaStreamRemote&&(l(m.mPlayOptions.rendererRemote,m.mMediaStreamRemote),m.mPlayOptions.rendererRemote.muted=!!m.mMediaHandlerAudioRemote)},this.onsdp=function(t){if("local"===t.originator){var n=o.parse(t.sdp);n=s.MediaHandlerSdp.filterCodecs(n,"audio",["opus"],!0),n=s.MediaHandlerSdp.setCodecFmtp(n,"audio","opus",{stereo:0,maxaveragebitrate:e.sConfig.audio.opus.bitrate,useinbandfec:e.sConfig.audio.opus.fec}),n=s.MediaHandlerSdp.rmExtensions(n,"audio"),m.mSdpLocal=n,t.sdp=o.write(n)}else"remote"===t.originator&&(m.mSdpRemote=o.parse(t.sdp),s.MediaHandlerSdp.setCodecFmtp(m.mSdpRemote,"video","h264",{"profile-level-id":e.sConfig.video.h264.profileId}),t.sdp=o.write(m.mSdpRemote),m.setRtcSenders())},this.onSetRemoteDescriptionFailed=function(){f("".concat(m.mPrefix," Error onSetRemoteDescriptionFailed"))},this.setRtcSenders=function(){var t,n,o,i;if(m.mJssipRtcSession&&m.mJssipRtcSession.connection){var a=m.mJssipRtcSession.connection.getSenders(),s=function(t){var n=c.Utils.strRtpRtcpCname(t);if(f("".concat(m.mPrefix," Setting sender: ").concat(c.Utils.strMediaStreamTrack(t.track)," / cname: ").concat(n||"-","}")),"audio"===(null===(o=t.track)||void 0===o?void 0:o.kind))m.mRtpSender.audio=t;else if("video"===(null===(i=t.track)||void 0===i?void 0:i.kind)&&(m.mRtpSender.video=t,t&&t.track)){if(t.track.getSettings){var r=t.track.getSettings();h("".concat(m.mPrefix," Track ").concat(c.Utils.strMediaStreamTrack(t.track)," settings: ").concat(JSON.stringify(r,null,"\t")))}if(t.track.getCapabilities){var a=t.track.getCapabilities();h("".concat(m.mPrefix," Track ").concat(c.Utils.strMediaStreamTrack(t.track)," capabilities: ").concat(JSON.stringify(a,null,"\t")))}var s=t.getParameters();h("".concat(m.mPrefix," rtcSender parameters ").concat(c.Utils.strMediaStreamTrack(t.track)," params: ").concat(JSON.stringify(s,null,"\t"))),s.encodings||(s.encodings=[{scaleResolutionDownBy:1}]);var l=1e5;if(m.mSdpRemote)switch(m.mSdpRemote.media[0].rtp[0].codec.toLowerCase()){case"vp8":l=e.sConfig.video.vp8.bitrateMax;break;case"vp9":l=e.sConfig.video.vp9.bitrateMax;break;case"h264":l=e.sConfig.video.h264.bitrateMax}s.encodings[0].maxBitrate=l,t.setParameters(s).then((function(){if(t.track){var e=t.getParameters();h("".concat(m.mPrefix," rtcSender parameters ").concat(c.Utils.strMediaStreamTrack(t.track)," new params: ").concat(JSON.stringify(e,null,"\t")))}})).catch((function(e){p(e.name+": "+e.message)}))}};try{for(var l=r.__values(a),u=l.next();!u.done;u=l.next()){s(u.value)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}}},this.deactivateSend=function(e){if(void 0===e&&(e={audio:!0,video:!0}),m.mJssipRtcSession&&m.mJssipRtcSession.connection){var t=m.mJssipRtcSession.connection,n={iceRestart:!1};f("".concat(m.mPrefix," muteCapture: ").concat(JSON.stringify(n))),t.createOffer(n).then((function(n){if(!m.mSdpLocal)throw new Error("No local SDP???");var r=m.mSdpLocal;return e.audio&&(r=s.MediaHandlerSdp.deactivateDirection(r,"send","audio")),e.video&&(r=s.MediaHandlerSdp.deactivateDirection(r,"send","video")),n.sdp=o.write(r),f("".concat(m.mPrefix," deactivateSend: Setting new ").concat(n.type?n.type:"null",": ").concat(n.sdp)),t.setLocalDescription(n)})).then((function(){if(!m.mSdpRemote)throw new Error("No remote SDP???");var n=m.mSdpRemote;e.audio&&(n=s.MediaHandlerSdp.deactivateDirection(n,"recv","audio")),e.video&&(n=s.MediaHandlerSdp.deactivateDirection(n,"recv","video"));var r=new RTCSessionDescription({type:"answer",sdp:o.write(n)});return f("".concat(m.mPrefix," deactivateSend: Setting new ").concat(r.type,": ").concat(r.sdp)),t.setRemoteDescription(r)})).then((function(){f("".concat(m.mPrefix,' Successfully modified peerConnection object deactivated -> "send"'))})).catch((function(e){p(e.name+": "+e.message)}))}else f("".concat(m.mPrefix," No RTCPeerConnection to alter"))},this.activateSend=function(){if(m.mJssipRtcSession&&m.mJssipRtcSession.connection){var e=m.mJssipRtcSession.connection;e.createOffer({iceRestart:!1}).then((function(t){if(!m.mSdpLocal)throw new Error("No local SDP???");var n=m.mSdpLocal;return n=s.MediaHandlerSdp.activateDirection(n,"send"),t.sdp=o.write(n),f("".concat(m.mPrefix," activateSend: Setting new ").concat(t.type?t.type:"null",": ").concat(t.sdp)),e.setLocalDescription(t)})).then((function(){if(!m.mSdpRemote)throw new Error("No remote SDP???");var t=m.mSdpRemote;t=s.MediaHandlerSdp.activateDirection(t,"recv");var n=new RTCSessionDescription({type:"answer",sdp:o.write(t)});return f("".concat(m.mPrefix," switchToSendRecv: Setting new ").concat(n.type?n.type:"null",": ").concat(n.sdp)),e.setRemoteDescription(n)})).then((function(){f("".concat(m.mPrefix,' Successfully modified peerConnection object -> "sendrecv"'))})).catch((function(e){p("".concat(m.mPrefix," ").concat(e.name,": ").concat(e.message))}))}else f("".concat(m.mPrefix," No RTCPeerConnection to alter"))},this.mPrefix=i,f("".concat(this.mPrefix," new MediaHandler")),this.mRtpSender={},this.mRtpReceiver={},t||(t={}),this.mCaptureOptions=t,this.setPlayOptions(n),navigator.mediaDevices.addEventListener("devicechange",(function(t){f("".concat(m.mPrefix," Event: ").concat(t.type)),e.listDevices(),m.ondevicechange&&m.ondevicechange()}))}var t;return t=e,e.sConfig={audio:{autoGainControl:!0,channelCount:1,echoCancellation:!0,noiseSuppression:!0,opus:{bitrate:28e3,fec:1},ptime:20,maxptime:60},video:{camera:{fps:15,height:640,width:480},screensharing:{fps:5},vp8:{bitrateMax:1e6},vp9:{bitrateMax:1e6},h264:{bitrateMax:1e6,profileId:"42e01f"}}},e.setPTime=function(t){return e.sConfig.audio.ptime=Number(t),!0},e.setMaxPTime=function(t){return e.sConfig.audio.maxptime=Number(t),!0},e.setCameraMaxFramerate=function(t){return e.sConfig.video.camera.fps=Number(t),!0},e.setCameraMaxResolution=function(t){var n=t.split("x");return 2!==n.length?(p("Invalid resolution: "+t),!1):(e.sConfig.video.camera.width=Number(n[0]),e.sConfig.video.camera.height=Number(n[1]),!0)},e.setScreenSharingMaxFramerate=function(t){return e.sConfig.video.screensharing.fps=Number(t),!0},e.listDevices=function(){navigator.mediaDevices.enumerateDevices().then((function(e){var t,n;f("List of available devices:");var o=0;try{for(var i=r.__values(e),a=i.next();!a.done;a=i.next()){var s=a.value;f(" * [".concat(++o,"] ").concat(s.kind,": ")+"".concat(s.label," id = ").concat(s.deviceId," - ").concat(s.groupId))}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}})).catch((function(e){var t=e;f("".concat(t.name,": ").concat(t.message))}))},e.initDeviceChangeListener=function(){navigator.mediaDevices.ondevicechange=function(e){f("New devices: "+e.type),t.listDevices()}},e.stopMediaStream=function(e){var t,n;if(e){var o=e.getTracks();try{for(var i=r.__values(o),a=i.next();!a.done;a=i.next()){var s=a.value;s.stop(),e.removeTrack(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}},e}();t.MediaHandler=m,function(e){!function(e){e.VOLUME_LOCAL="volumeLocal",e.VOLUME_REMOTE="volumeRemote",e.QOS="qos",e.MEDIA_STREAM_LOCAL_TRACK_ENDED="mediaStreamLocalTrackEnded",e.MEDIA_STREAM_DEVICE_CHANGE="mediaStreamDeviceChange",e.BURST_RECORDED_RECEIVED="burstRecordedReceived",e.BURST_RECORDED_SENT="burstRecordedSent"}(e.Event||(e.Event={})),function(e){e[e.CENTER=0]="CENTER",e[e.LEFT=-1]="LEFT",e[e.RIGHT=1]="RIGHT"}(e.Panning||(e.Panning={}))}(m=t.MediaHandler||(t.MediaHandler={})),t.MediaHandler=m},6607:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaHandlerAudio=void 0;var r=n(4547),o=n(1784),i=r.Debugger.extend("MediaHandlerAudio"),a=function(){function e(t,n){var r=this;this.mAudioContext=new AudioContext,this.mAudioNodes=[],this.mAnalyse=0,this.mVolume=e.AUDIO_LEVEL_MIN,this.destroy=function(){delete r.onvolume,r.mAnalyse&&(cancelAnimationFrame(r.mAnalyse),r.mAnalyse=0),r.mAudioNodes.forEach((function(e){return e.disconnect()})),r.mAudioNodes=[],delete r.mStereoPannerNode,delete r.mGainNode,r.mAudioContext&&r.mAudioContext.close().then((function(){i("Audio Context is now closed")})).catch((function(e){var t=e;i("Failed to close context: ".concat(t.name,": ").concat(t.message))}))},this.pan=function(t){r.mStereoPannerNode&&r.mStereoPannerNode.pan.setValueAtTime(e.clamp(t,r.mStereoPannerNode.pan),r.mAudioContext.currentTime)},this.setGain=function(t){r.mGainNode&&r.mGainNode.gain.setValueAtTime(e.clamp(t,r.mGainNode.gain),r.mAudioContext.currentTime)},this.getVolume=function(){return r.mVolume},this.doAudioProcess=function(){var t=r.mAnalyserNode.fftSize,n=new Uint8Array(t);r.mAnalyserNode.getByteTimeDomainData(n);for(var o=0,i=0,a=0;a<t;++a)o+=(i=n[a++]/128-1)*i;(o=Math.sqrt(o/t))>0&&(r.mVolume=20*Math.log10(o),r.mVolume<e.AUDIO_LEVEL_MIN&&(r.mVolume=e.AUDIO_LEVEL_MIN),r.mVolume>e.AUDIO_LEVEL_MAX&&(r.mVolume=e.AUDIO_LEVEL_MAX)),r.mAnalyse=requestAnimationFrame(r.doAudioProcess),r.onvolume&&r.onvolume()},this.mMediaStream=t,i("Creating MediaHandlerAudio for stream: ".concat(o.Utils.strMediaStream(this.mMediaStream))),this.mAudioContext.addEventListener("statechange",(function(e){i("".concat(e.type,": ").concat(r.mAudioContext.state," - stream: ").concat(o.Utils.strMediaStream(r.mMediaStream)))})),this.mMediaStreamAudioSourceNode=this.mAudioContext.createMediaStreamSource(this.mMediaStream),this.mAnalyserNode=this.mAudioContext.createAnalyser(),this.mAnalyserNode.fftSize=256,this.mMediaStreamAudioSourceNode.connect(this.mAnalyserNode),this.mAudioNodes.push(this.mMediaStreamAudioSourceNode),this.mAudioNodes.push(this.mAnalyserNode),n||(this.mStereoPannerNode=this.mAudioContext.createStereoPanner(),this.mGainNode=this.mAudioContext.createGain(),this.mAudioNodes.push(this.mStereoPannerNode),this.mAudioNodes.push(this.mGainNode),this.mAnalyserNode.connect(this.mGainNode).connect(this.mStereoPannerNode).connect(this.mAudioContext.destination)),this.doAudioProcess()}return e.AUDIO_LEVEL_MIN=-127,e.AUDIO_LEVEL_MAX=0,e.clamp=function(e,t){return Math.max(Math.min(e,t.maxValue),t.minValue)},e}();t.MediaHandlerAudio=a},2717:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaHandlerSdp=void 0;var r=n(655);!function(e){e.fmtpParse=function(e){var t,n,o={},i=e.split(";");try{for(var a=r.__values(i),s=a.next();!s.done;s=a.next()){var l=s.value;if(l){var u=l.trim().split("=");o[u[0].trim()]=u[1].trim()}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return o},e.fmtpWrite=function(e){var t,n,o=[];try{for(var i=r.__values(Object.keys(e)),a=i.next();!a.done;a=i.next()){var s=a.value;o.push("".concat(s,"=").concat(e[s]))}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return o.join(";")},e.setCodecFmtp=function(t,n,o,i){var a,s,l,u,c,d;try{for(var f=r.__values(t.media),p=f.next();!p.done;p=f.next()){var h=p.value;if(h.type.toLowerCase()===n.toLowerCase())try{for(var m=(l=void 0,r.__values(h.rtp)),_=m.next();!_.done;_=m.next()){var v=_.value;if(v.codec.toLowerCase()===o.toLowerCase()){var g=v.payload,y={};try{for(var S=(c=void 0,r.__values(h.fmtp)),T=S.next();!T.done;T=S.next()){var C=T.value;if(C.payload===g){y=e.fmtpParse(C.config),i=Object.assign(y,i),C.config=e.fmtpWrite(i);break}}}catch(e){c={error:e}}finally{try{T&&!T.done&&(d=S.return)&&d.call(S)}finally{if(c)throw c.error}}}}}catch(e){l={error:e}}finally{try{_&&!_.done&&(u=m.return)&&u.call(m)}finally{if(l)throw l.error}}}}catch(e){a={error:e}}finally{try{p&&!p.done&&(s=f.return)&&s.call(f)}finally{if(a)throw a.error}}return t},e.filterCodecs=function(e,t,n,o){var i,a,s,l,u,c,d,f,p,h,m,_;try{for(var v=r.__values(e.media),g=v.next();!g.done;g=v.next()){var y=g.value;if("*"===t||y.type.toLowerCase()===t.toLowerCase()){var S=[],T=[],C=[],E=[],R="";try{for(var b=(s=void 0,r.__values(y.rtp)),A=b.next();!A.done;A=b.next()){var I=A.value;if(n.includes(I.codec.toLowerCase())){0!==R.length&&(R+=" "),R+=I.payload,S.push(I),I.rate&&E.push(I.rate);try{for(var w=(u=void 0,r.__values(y.fmtp)),O=w.next();!O.done;O=w.next()){var P=O.value;P.payload===I.payload&&T.push(P)}}catch(e){u={error:e}}finally{try{O&&!O.done&&(c=w.return)&&c.call(w)}finally{if(u)throw u.error}}if(y.rtcpFb)try{for(var N=(d=void 0,r.__values(y.rtcpFb)),D=N.next();!D.done;D=N.next()){var M=D.value;M.payload===I.payload&&C.push(M)}}catch(e){d={error:e}}finally{try{D&&!D.done&&(f=N.return)&&f.call(N)}finally{if(d)throw d.error}}}}}catch(e){s={error:e}}finally{try{A&&!A.done&&(l=b.return)&&l.call(b)}finally{if(s)throw s.error}}if(o){var k=!1,x=function(e){if("telephone-event"!==e.codec.toLowerCase())return"continue";if(e.rate&&E.includes(e.rate)){R+=" ".concat(e.payload),S.push(e),k=!0;var t=y.fmtp.find((function(t){return t.payload===e.payload}));t&&T.push(t)}};try{for(var L=(p=void 0,r.__values(y.rtp)),U=L.next();!U.done;U=L.next()){x(I=U.value)}}catch(e){p={error:e}}finally{try{U&&!U.done&&(h=L.return)&&h.call(L)}finally{if(p)throw p.error}}if(!k){var F=101;try{for(var H=(m=void 0,r.__values(E)),q=H.next();!q.done;q=H.next()){var j=q.value;I={payload:F++,codec:"telephone-event",rate:j};R+=" ".concat(I.payload),S.push(I)}}catch(e){m={error:e}}finally{try{q&&!q.done&&(_=H.return)&&_.call(H)}finally{if(m)throw m.error}}}}y.rtp=S,y.fmtp=T,y.rtcpFb=C,y.payloads=R}}}catch(e){i={error:e}}finally{try{g&&!g.done&&(a=v.return)&&a.call(v)}finally{if(i)throw i.error}}return e},e.setPTime=function(e,t,n,o){var i,a;try{for(var s=r.__values(e.media),l=s.next();!l.done;l=s.next()){var u=l.value;u.type.toLowerCase()===t.toLowerCase()&&(u.ptime=n,u.maxptime=o)}}catch(e){i={error:e}}finally{try{l&&!l.done&&(a=s.return)&&a.call(s)}finally{if(i)throw i.error}}return e},e.rmExtensions=function(e,t){var n,o;try{for(var i=r.__values(e.media),a=i.next();!a.done;a=i.next()){var s=a.value;"*"!==t&&s.type.toLowerCase()!==t.toLowerCase()||delete s.ext}}catch(e){n={error:e}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}return e},e.addExtension=function(e,t,n,o){var i,a;try{for(var s=r.__values(e.media),l=s.next();!l.done;l=s.next()){var u=l.value;if("*"===t||u.type.toLowerCase()===t.toLowerCase()){var c={value:o,uri:n};u.ext?u.ext.push(c):u.ext=[c]}}}catch(e){i={error:e}}finally{try{l&&!l.done&&(a=s.return)&&a.call(s)}finally{if(i)throw i.error}}return e},e.toggleSdpDirection=function(e,t){switch(e){case"sendrecv":return"send"===t?"recvonly":"sendonly";case"recvonly":return"send"===t?"sendrecv":"inactive";case"sendonly":return"send"===t?"inactive":"sendrecv";case"inactive":return"send"===t?"sendonly":"recvonly"}},e.activateSdpDirection=function(e,t){switch(e){case"sendrecv":return"sendrecv";case"recvonly":return"send"===t?"sendrecv":"recvonly";case"sendonly":return"send"===t?"sendonly":"sendrecv";case"inactive":return"send"===t?"sendonly":"recvonly"}},e.deactivateSdpDirection=function(e,t){switch(e){case"sendrecv":return"send"===t?"recvonly":"sendonly";case"recvonly":return"send"===t?"recvonly":"inactive";case"sendonly":return"send"===t?"inactive":"sendonly";case"inactive":return"inactive"}},e.activateDirection=function(t,n,o){var i,a;t.direction&&(t.direction=e.activateSdpDirection(t.direction,n));try{for(var s=r.__values(t.media),l=s.next();!l.done;l=s.next()){var u=l.value;o&&u.type!==o||u.direction&&(u.direction=e.activateSdpDirection(u.direction,n))}}catch(e){i={error:e}}finally{try{l&&!l.done&&(a=s.return)&&a.call(s)}finally{if(i)throw i.error}}return t},e.deactivateDirection=function(t,n,o){var i,a;t.direction&&(t.direction=e.deactivateSdpDirection(t.direction,n));try{for(var s=r.__values(t.media),l=s.next();!l.done;l=s.next()){var u=l.value;o&&u.type!==o||u.direction&&(u.direction=e.deactivateSdpDirection(u.direction,n))}}catch(e){i={error:e}}finally{try{l&&!l.done&&(a=s.return)&&a.call(s)}finally{if(i)throw i.error}}return t}}(t.MediaHandlerSdp||(t.MediaHandlerSdp={}))},6150:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaHandlerStats=void 0;var r=n(655),o=n(4547),i=n(7210),a=n(9139),s=n(1784),l=o.Debugger.extend("MediaHandlerStats"),u=o.Debugger.extend("ERROR:MediaHandlerStats"),c=function(){function e(t,n){var o=this;this.mQosIndicator=0,this.mPrefix="",this.mLastIceCandidateStat=0,this.destroy=function(){o.disarm(),o.mDisplayWin&&(delete o.mDisplayWin,o.mDisplayWinEnabled=!1)},this.openWindow=function(){o.mDisplayWinEnabled=!0},this.getQos=function(){return o.mQosIndicator},this.arm=function(){o.mStatsInterval=window.setInterval((function(){try{o.getStats()}catch(e){u("".concat(o.mPrefix," Error while processing stats: "),e)}}),1e3)},this.disarm=function(){o.mStatsInterval&&(clearInterval(o.mStatsInterval),delete o.mStatsInterval)},this.getStats=function(){o.mQosIndicator=0,"stable"===o.mPeerConnection.signalingState&&o.mPeerConnection.getStats(null).then((function(t){var n=new Map;t.forEach((function(e,t){n.set(t,e)}));var r=Date.now(),i=r-o.mLastIceCandidateStat>1e4;i&&(o.mLastIceCandidateStat=r),n.forEach((function(t,n,a){if("candidate-pair"===t.type){var c=t;if(i){var d=a.get(c.localCandidateId),f=a.get(c.remoteCandidateId),p="[".concat(d.protocol,"][").concat(d.address,":").concat(d.port,"]"),h="[".concat(f.protocol,"][").concat(f.address,":").concat(f.port,"]");l("".concat(o.mPrefix," candidate pair | state: ").concat(c.state.padStart("in-progress".length," ")," |")+" nominated: ".concat(c.nominated?"yes":" no"," |")+" local ".concat(p.padStart(30," ")," | remote ").concat(h.padStart(30," ")," |"))}if("succeeded"!==c.state)return;o.mStun.current.timestamp=r;var m=c.requestsSent?c.requestsSent:0,_=c.responsesReceived?c.responsesReceived:0;return o.mStun.current.diff=m-_,void(o.mStun.current.rtt=c.currentRoundTripTime)}if("audio"===t.kind||"video"===t.kind){if(!o.mValuesDiff.has(t.kind)){var v={current:s.Utils.deepCopy(e.DEFAULT_VALUES),previous:s.Utils.deepCopy(e.DEFAULT_VALUES)};o.mValuesDiff.set(t.kind,v)}var g=o.mValuesDiff.get(t.kind);if(g)switch(g.current.timestamp=r,t.type){case"outbound-rtp":var y=t;g.current.sentSsrc=y.ssrc,g.current.sentPacketsRtp=y.packetsSent,g.current.sentBytesRtp=y.bytesSent;break;case"remote-inbound-rtp":y=t;g.current.sentSsrc=y.ssrc,g.current.sentPacketsLost=y.packetsLost,g.current.sentJitter=y.jitter;break;case"inbound-rtp":y=t;g.current.receivedSsrc=y.ssrc,g.current.receivedPacketsRtp=y.packetsReceived,g.current.receivedBytesRtp=y.bytesReceived,g.current.receivedJitter=y.jitter,g.current.receivedPacketsLost=y.packetsLost}else u("Should never occur")}})),o.process()})).catch((function(e){u("".concat(o.mPrefix," Could not get stats: ").concat(e.name," - ").concat(e.message)),"InvalidStateError"===e.name&&o.disarm()}))},this.process=function(){var t=new Map,n=0,i=0;o.mValuesDiff.forEach((function(r,a,l){var u=function(t,n){if(t.timestamp&&n.timestamp){var r=t.timestamp-n.timestamp;if(0!==r){var o=s.Utils.deepCopy(e.DEFAULT_REPORT);if(o.ssrcUp=t.sentSsrc||-1,o.ssrcDown=t.receivedSsrc||-1,t.sentPackets&&n.sentPackets&&(o.packetsUp+=t.sentPackets-n.sentPackets),t.sentPacketsRtp&&n.sentPacketsRtp&&(o.packetsUp+=t.sentPacketsRtp-n.sentPacketsRtp),t.sentPacketsRtcp&&n.sentPacketsRtcp&&(o.packetsUp+=t.sentPacketsRtcp-n.sentPacketsRtcp),t.sentBytes&&n.sentBytes&&(o.brateUp+=t.sentBytes-n.sentBytes),t.sentBytesRtp&&n.sentBytesRtp&&(o.brateUp+=t.sentBytesRtp-n.sentBytesRtp),t.sentBytesRtcp&&n.sentBytesRtcp&&(o.brateUp+=t.sentBytesRtcp-n.sentBytesRtcp),t.receivedPackets&&n.receivedPackets&&(o.packetsDown+=t.receivedPackets-n.receivedPackets),t.receivedPacketsRtp&&n.receivedPacketsRtp&&(o.packetsDown+=t.receivedPacketsRtp-n.receivedPacketsRtp),t.receivedPacketsRtcp&&n.receivedPacketsRtcp&&(o.packetsDown+=t.receivedPacketsRtcp-n.receivedPacketsRtcp),t.receivedBytes&&n.receivedBytes&&(o.brateDown+=t.receivedBytes-n.receivedBytes),t.receivedBytesRtp&&n.receivedBytesRtp&&(o.brateDown+=t.receivedBytesRtp-n.receivedBytesRtp),t.receivedBytesRtcp&&n.receivedBytesRtcp&&(o.brateDown+=t.receivedBytesRtcp-n.receivedBytesRtcp),o.packetsUp=Math.round(o.packetsUp/(r/1e3)),o.packetsDown=Math.round(o.packetsDown/(r/1e3)),o.brateUp=Math.round(8*o.brateUp/(r/1e3)),o.brateDown=Math.round(8*o.brateDown/(r/1e3)),o.indicator=5,t.sentPacketsLost&&t.sentPacketsRtp){n.sentPacketsLost||(n.sentPacketsLost=0),n.sentPacketsRtp||(n.sentPacketsRtp=0);var i=t.sentPacketsRtp-n.sentPacketsRtp;0!==i&&(o.lossrateUp=100*(t.sentPacketsLost-n.sentPacketsLost)/i,o.indicator=o.indicator*Math.exp(-1*o.lossrateUp*4/100))}if(t.receivedPacketsLost&&t.receivedPacketsRtp){n.receivedPacketsLost||(n.receivedPacketsLost=0),n.receivedPacketsRtp||(n.receivedPacketsRtp=0);var a=t.receivedPacketsRtp-n.receivedPacketsRtp;0!==a&&(o.lossrateDown=100*(t.receivedPacketsLost-n.receivedPacketsLost)/a,o.indicator=o.indicator*Math.exp(-1*o.lossrateDown*2/100))}if(t.sentJitter){var l=t.sentJitter/e.LIMIT_JITTER;l>1&&(l=1),o.indicator=o.indicator*(1-.1*l),o.jitterUp=t.sentJitter}return o.indicator=Math.round(o.indicator),o}}}(r.current,r.previous);u&&(t.set(a,u),n+=u.indicator,++i),r.previous=s.Utils.deepCopy(r.current),l.set(a,r),o.updateDisplay(t)})),o.mQosIndicator=n/i;var a;l("".concat(o.mPrefix," ")+JSON.stringify((a=t,Array.from(a).reduce((function(e,t){var n=r.__read(t,2),o=n[0],i=n[1];return e[o]=i,e}),{})))),o.onqos&&o.onqos(),o.mStun.previous=s.Utils.deepCopy(o.mStun.current)},this.updateDisplay=function(e){var t,n=Date.now();if(o.mDisplayWinEnabled){if(!o.mDisplayWin){"<html>\n","<head>\n",'    <meta charset="UTF-8">\n',"    <style>\n","        div.graph-container {float: left; margin: 0.5em;}\n","        canvas {background-color: #ccc; max-width: 100%; width: 100%;}\n","    </style>\n","</head>\n","<body>\n",'    <div id="sw-graphs"></div>\n',"</body>\n","</html>\n",(t=window.open("","Stats ","toolbar=no, location=no, directories=no, status=no, menubar=no, width=800, height=800"))&&(o.mDisplayWin=t,o.mDisplayWin.document.body.innerHTML='<html>\n<head>\n    <meta charset="UTF-8">\n    <style>\n        div.graph-container {float: left; margin: 0.5em;}\n        canvas {background-color: #ccc; max-width: 100%; width: 100%;}\n    </style>\n</head>\n<body>\n    <div id="sw-graphs"></div>\n</body>\n</html>\n',o.mDisplayWin.onbeforeunload=function(){o.mDisplayWinEnabled=!1,delete o.mDisplayWin,delete o.mDataViews})}t=o.mDisplayWin}e.forEach((function(e,s){var l,u;try{for(var c=r.__values(Object.entries(e)),d=c.next();!d.done;d=c.next()){var f=r.__read(d.value,2),p=f[0],h=f[1],m=s+"-"+p,_=void 0;if(o.mDataSeries.has(m)?_=o.mDataSeries.get(m):((_=new i.TimelineDataSerie).setColor("red"),o.mDataSeries.set(m,_)),_&&_.addPoint(n,h),t&&null!==t){if(o.mDataViews||(o.mDataViews=new Map),!o.mDataViews.has(m)){var v=t.document.getElementById("sw-graphs");if(null===v)continue;var g="sw-graph-".concat(m),y="sw-canvas-".concat(m),S='<div class="graph-container" id="'.concat(g,'">')+"<div>".concat(s," ").concat(p,"</div>")+'<canvas id="'.concat(y,'"></canvas>')+"</div>";v.insertAdjacentHTML("beforeend",S);var T=t.document.getElementById(y);if(null===T)continue;o.mDataViews.set(m,new a.TimelineDataView(T))}var C=o.mDataViews.get(m);C&&_&&(C.setDataSeries([_]),C.updateEndDate())}}}catch(e){l={error:e}}finally{try{d&&!d.done&&(u=c.return)&&u.call(c)}finally{if(l)throw l.error}}}))},this.isAudio=function(){var e=o.mPeerConnection.localDescription;return!!e&&e.sdp.includes("audio")},this.isVideo=function(){var e=o.mPeerConnection.localDescription;return!!e&&e.sdp.includes("video")},this.mDisplayWinEnabled=!1,this.mCounter=0,this.mPeerConnection=t,this.mPrefix=n;var c=Date.now();this.mValuesDiff=new Map,this.mStun={current:{timestamp:c},previous:{timestamp:c}},this.mDataSeries=new Map,this.mDataViews=new Map,this.arm()}return e.DEFAULT_VALUES={sentPackets:0,sentPacketsRtp:0,sentPacketsRtcp:0,sentBytes:0,sentBytesRtp:0,sentBytesRtcp:0,sentPacketsLost:0,sentJitter:0,sentSsrc:0,receivedPackets:0,receivedPacketsRtp:0,receivedPacketsRtcp:0,receivedBytes:0,receivedBytesRtp:0,receivedBytesRtcp:0,receivedPacketsLost:0,receivedJitter:0,receivedSsrc:0,timestamp:0},e.DEFAULT_REPORT={timestamp:0,ssrcUp:0,ssrcDown:0,packetsUp:0,packetsDown:0,brateUp:0,brateDown:0,lossrateUp:0,lossrateDown:0,jitterUp:0,indicator:0},e}();t.MediaHandlerStats=c,function(e){e.LIMIT_LOSS=5,e.LIMIT_RTT=200,e.LIMIT_JITTER=40}(c=t.MediaHandlerStats||(t.MediaHandlerStats={})),t.MediaHandlerStats=c},9616:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Participant=void 0;var r=n(4547).Debugger.extend("Participant"),o=function(){function e(t){var n=this;this.mState=e.State.CREATED,this.mStatePrevious=e.State.CREATED,this.mFloorPriority=0,this.mIsNew=!0,this.mIsFromInterASRegroup=!1,this.getDisplayName=function(){return n.mIdentity},this.getIdentity=function(){return n.mIdentity+(n.mHost?"@"+n.mHost:"")},this.isAttending=function(){return n.mState===e.State.ATTENDING||n.mState===e.State.ATTENDING_ONHOLD},this.getFloorPriority=function(){return n.mFloorPriority},this.getState=function(){return n.mState},this.getPreviousState=function(){return n.mStatePrevious},this.getArrivalTime=function(){return n.mArrivalTime},this.getVideoCaptureSource=function(){return n.mVideoCaptureSource?n.mVideoCaptureSource:e.VideoCaptureSource.CAMERA},this.isNew=function(){return n.mIsNew},this.setNew=function(e){n.mIsNew=e},this.isFromInterASRegroup=function(){return n.mIsFromInterASRegroup},this.hasIdentity=function(t){return e.contactBeforeAt(t)===n.mIdentity},this.updateState=function(t,o){if(n.mState!==t){if(n.isAttending())switch(t){case e.State.CREATED:case e.State.INVITED:case e.State.REACHED:return void r("NOT updating "+n.mIdentity+" item: "+n.toString()+' to "'+t+'"')}n.mStatePrevious=n.mState,n.mState=t,n.isAttending()||delete n.mArrivalTime,r("Updated state: "+n.toString())}o&&(n.mIsNew=!0,r("Updated state: "+n.toString()+" has been renewed"))},this.updateArrivalTime=function(e){n.mArrivalTime=e,r("Updated arrival time: "+n.toString())},this.updateFloorPriority=function(e){n.mFloorPriority=e,r("Updated floor priority: "+n.toString())},this.updateVideoCaptureSource=function(e){n.mVideoCaptureSource=e,r("Updated VideoCaptureSource: "+n.toString())},this.toString=function(){var e='Participant "'+n.mIdentity;return n.mHost&&(e+="@"+n.mHost),e+='" ['+n.mState+"]",n.mIsFromInterASRegroup&&(e+=" [interasregroup]"),n.mStatePrevious&&(e+=" [previous: ".concat(n.mStatePrevious,"]")),n.mFloorPriority&&(e+=" [priority: ".concat(n.mFloorPriority,"]")),n.mArrivalTime&&n.isAttending()&&(e+=" [arrivalTime: ".concat(n.mArrivalTime.toISOString(),"]")),n.mVideoCaptureSource&&n.isAttending()&&(e+=" [VideoCapture: ".concat(n.mVideoCaptureSource,"]")),e},this.mIsFromInterASRegroup=t.startsWith(e.PREFIX_INTERASREGROUP),this.mIsFromInterASRegroup&&(t=t.substring(e.PREFIX_INTERASREGROUP.length));var o=t.indexOf("@");o>0?(this.mIdentity=t.substr(0,o),this.mHost=t.substr(o+1)):this.mIdentity=t}return e.PREFIX_INTERASREGROUP="interasregroup:",e.contactBeforeAt=function(t){t.startsWith(e.PREFIX_INTERASREGROUP)&&(t=t.substring(e.PREFIX_INTERASREGROUP.length));var n=t.indexOf("@");return n>0?t.substr(0,n):t},e}();t.Participant=o,function(e){!function(e){e.PARTICIPANT_LIST="ParticipantList",e.PARTICIPANT_INVITED="ParticipantInvited",e.PARTICIPANT_REACHED="ParticipantReached",e.PARTICIPANT_JOINED="ParticipantJoined",e.PARTICIPANT_LEFT="ParticipantLeft",e.PARTICIPANT_REFUSED="ParticipantRefused",e.PARTICIPANT_ONHOLD="ParticipantOnHold",e.PARTICIPANT_RESUME="ParticipantResume",e.PARTICIPANT_TRANSFER="ParticipantTransfer"}(e.Event||(e.Event={})),function(e){e.CONNECTION_ERROR="ConnectionError"}(e.LeftCause||(e.LeftCause={})),function(e){e.UNANSWERING="UNANSWERING",e.DECLINED="DECLINED",e.BUSY="BUSY"}(e.RefusedReason||(e.RefusedReason={})),function(e){e.UNKNOWN="UNKNOWN",e.CREATED="CREATED",e.INVITED="INVITED",e.REACHED="REACHED",e.ATTENDING="ATTENDING",e.ATTENDING_ONHOLD="ATTENDING_ONHOLD",e.RECONNECTING="RECONNECTING",e.HUNGUP="HUNGUP",e.UNANSWERING="UNANSWERING",e.DECLINED="DECLINED",e.BUSY="BUSY",e.FEATURE_NOT_ALLOWED="FEATURE_NOT_ALLOWED",e.CUG_DENIED="CUG_DENIED",e.ALL_PARTICIPANT="All"}(e.State||(e.State={})),function(e){e.CAMERA="camera",e.CAMERA_EXTERNAL="camera_external",e.SCREEN_SHARING="screen_sharing",e.CANVAS="canvas",e.FILE="file",e.DEFAULT="camera"}(e.VideoCaptureSource||(e.VideoCaptureSource={}))}(o=t.Participant||(t.Participant={})),t.Participant=o},4682:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Participants=void 0;var r=n(655),o=n(4547),i=n(9616),a=o.Debugger.extend("Participants"),s=function(){var e=this;this.mParticipantMap=new Map,this.getLastUpdated=function(){return e.mParticipantLastUpdated},this.add=function(t,n){var r,o=i.Participant.contactBeforeAt(t);return e.mParticipantMap.has(o)?r=e.mParticipantMap.get(o):(r=new i.Participant(t),e.mParticipantMap.set(o,r)),r.updateState(n,!0),e.mParticipantLastUpdated=r,r},this.get=function(t){var n;if(null===(n=e.mParticipantLastUpdated)||void 0===n?void 0:n.hasIdentity(t))return e.mParticipantLastUpdated;var r=i.Participant.contactBeforeAt(t),o=e.mParticipantMap.get(r);return e.mParticipantLastUpdated=o,o},this.count=function(t){var n,o,i=0;try{for(var a=r.__values(e.mParticipantMap.values()),s=a.next();!s.done;s=a.next()){var l=s.value;t.includes(l.getState())&&++i}}catch(e){n={error:e}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}return i},this.getByState=function(t,n){var o,a;t||(t=i.Participant.State.ALL_PARTICIPANT);var s=new Map;try{for(var l=r.__values(e.mParticipantMap.values()),u=l.next();!u.done;u=l.next()){var c=u.value;if((t===i.Participant.State.ALL_PARTICIPANT||t===c.getState())&&(!n||c.isNew())){c.setNew(!1);var d=s.get(c.getState());d||(d=[],s.set(c.getState(),d)),d.push(c.getIdentity())}}}catch(e){o={error:e}}finally{try{u&&!u.done&&(a=l.return)&&a.call(l)}finally{if(o)throw o.error}}return s},this.clear=function(){delete e.mParticipantLastUpdated,e.mParticipantMap.clear()},this.updateParticipantList=function(t,n){var o,i,a,s;n&&e.clear();var l=Object.keys(t);try{for(var u=r.__values(l),c=u.next();!c.done;c=u.next()){var d=c.value,f=t[d];try{for(var p=(a=void 0,r.__values(f)),h=p.next();!h.done;h=p.next()){var m=h.value;e.add(m,d)}}catch(e){a={error:e}}finally{try{h&&!h.done&&(s=p.return)&&s.call(p)}finally{if(a)throw a.error}}}}catch(e){o={error:e}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(o)throw o.error}}},this.parseAttendingArrivalTime=function(t){var n,o;if(t.AttendingArrivalTime)try{for(var i=r.__values(Object.keys(t.AttendingArrivalTime)),s=i.next();!s.done;s=i.next()){var l=s.value,u=e.get(l);if(u){var c=new Date(t.AttendingArrivalTime[l]);u.updateArrivalTime(c)}else a('Trying to update arrival time of unknown participant: "'+l+'"')}}catch(e){n={error:e}}finally{try{s&&!s.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}},this.parseFloorPriority=function(t){var n,o,i=t.WTSupervisoryLevels?t.WTSupervisoryLevels:t.Priorities;if(i)try{for(var s=r.__values(Object.keys(i)),l=s.next();!l.done;l=s.next()){var u=l.value,c=e.get(u);if(c){var d=parseInt(i[u],10);c.updateFloorPriority(d)}else a('Trying to update floor priority of unknown participant: "'+u+'"')}}catch(e){n={error:e}}finally{try{l&&!l.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}},this.parseVideoCaptureSources=function(t){var n,o;if(t.VideoCaptureSources)try{for(var i=r.__values(Object.keys(t.VideoCaptureSources)),s=i.next();!s.done;s=i.next()){var l=s.value,u=e.get(l);if(u){var c=t.VideoCaptureSources[l];u.updateVideoCaptureSource(c)}else a('Trying to update Video Capture source of unknown participant: "'+l+'"')}}catch(e){n={error:e}}finally{try{s&&!s.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}},this.onServiceMessageParticipant=function(t,n){if(n.Contact){var r=i.Participant.State.UNKNOWN;switch(t){case i.Participant.Event.PARTICIPANT_INVITED:r=i.Participant.State.INVITED;break;case i.Participant.Event.PARTICIPANT_REACHED:r=i.Participant.State.REACHED;break;case i.Participant.Event.PARTICIPANT_JOINED:r=i.Participant.State.ATTENDING;break;case i.Participant.Event.PARTICIPANT_LEFT:r=n.Cause===i.Participant.LeftCause.CONNECTION_ERROR?i.Participant.State.RECONNECTING:i.Participant.State.HUNGUP;break;case i.Participant.Event.PARTICIPANT_REFUSED:switch(r=i.Participant.State.DECLINED,n.Reason){case i.Participant.RefusedReason.BUSY:r=i.Participant.State.BUSY;break;case i.Participant.RefusedReason.UNANSWERING:r=i.Participant.State.UNANSWERING;break;default:case i.Participant.RefusedReason.DECLINED:r=i.Participant.State.DECLINED}break;case i.Participant.Event.PARTICIPANT_RESUME:r=i.Participant.State.ATTENDING;break;case i.Participant.Event.PARTICIPANT_ONHOLD:r=i.Participant.State.ATTENDING_ONHOLD}if(r!==i.Participant.State.UNKNOWN){var o=e.get(n.Contact);o?o.updateState(r,!1):(a("Received update about unknown participant "+n.Contact),o=e.add(n.Contact,r)),e.parseAttendingArrivalTime(n),e.onevent(t)}else a('Participant message  "'+t+'" sets '+n.Contact+" to "+i.Participant.State.UNKNOWN+", aborting...")}else a('Invalid message "'+t+'": missing "Contact" field')},this.onevent=function(e){a("event: "+e)}};t.Participants=s},1116:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Socket=void 0;var r=n(4547),o=n(1784),i=r.Debugger.extend("Transport"),a=r.Debugger.extend("ERROR:Transport"),s=function(){function e(t){var n=this;this.mInstanceId=e.sInstanceCount++,this.connect=function(){if(i("".concat(n.toString(),": connect()")),n.isConnected())return i("WebSocket ".concat(n.url," is already connected, recall onconnect")),void n.onconnect();if(n.isConnecting())i("WebSocket ".concat(n.url," is connecting"));else{n.mWs&&n.disconnect(),i("".concat(n.toString(),": Connecting"));try{n.mWs=new WebSocket(n.url,"sip"),n.mWs.binaryType="arraybuffer",n.mWs.onopen=n.onOpen,n.mWs.onclose=n.onClose,n.mWs.onmessage=n.onMessage,n.mWs.onerror=n.onError,n.mConnectionTimeout=window.setTimeout((function(){i("".concat(n.toString(),": Connection timeout")),n.onconnectiontimeout(),n.disconnect()}),1e3*e.sConfig.connectionTimeout)}catch(e){var t=e;i("Connect error in ".concat(n.toString(),": ").concat(t.name,": ").concat(t.message))}}},this.disconnect=function(){var t;if(n.mWs){var r=1e3;i("".concat(n.toString(),": Disconnect with code: ").concat(e.code2String(r)," (").concat(r,")")),null===(t=n.mWs)||void 0===t||t.close(r),delete n.mWs}n.disarmKeepAlive(),n.disarmKeepAliveTimeout()},this.isConnected=function(){return!!n.mWs&&n.mWs.readyState===WebSocket.OPEN},this.isConnecting=function(){return!!n.mWs&&n.mWs.readyState===WebSocket.CONNECTING},this.send=function(e){return n.mWs&&n.isConnected()?(n.mWs.send(e),!0):(a("".concat(n.toString()," is unable to send message, WebSocket is not open")),!1)},this.toString=function(){var e="#".concat(n.mInstanceId,": [url: ").concat(n.url,"]");return n.mWs&&(e+=" [websocket state: ".concat(function(e){switch(e){case WebSocket.CLOSED:return"CLOSED";case WebSocket.CLOSING:return"CLOSING";case WebSocket.CONNECTING:return"CONNECTING";case WebSocket.OPEN:return"OPEN"}return"unknown"}(n.mWs.readyState)," (").concat(n.mWs.readyState,")]")),e},this.onOpen=function(e){i("".concat(n.toString(),": Connected ").concat(e.type)),n.mConnectionTimeout&&window.clearTimeout(n.mConnectionTimeout),delete n.mConnectionTimeout,n.onconnect&&n.onconnect(),n.armKeepAlive(),n.armKeepAliveTimeout()},this.onClose=function(t){if(i("".concat(n.toString(),": Closed ").concat(t.type," wasClean: ").concat(o.Utils.strBool(t.wasClean),",")+" code: ".concat(e.code2String(t.code)," (").concat(t.code,"), reason: ").concat(t.reason)),n.disarmKeepAlive(),n.disarmKeepAliveTimeout(),!1===t.wasClean&&i("".concat(n.toString(),": WebSocket abrupt disconnection")),delete n.mWs,n.mWs=void 0,n.ondisconnect){var r={socket:n,error:!t.wasClean,code:t.code,reason:t.reason};n.ondisconnect(r)}},this.onMessage=function(t){i("".concat(n.toString(),": Received message ").concat(t.type)),t.data===e.CRLF&&n.resetKeepAliveTimeout(),n.ondata&&n.ondata(t.data)},this.onError=function(e){i("".concat(n.toString(),": onError ").concat(e.type))},this.armKeepAlive=function(){n.mKeepAliveInterval=window.setInterval((function(){n.doKeepAlive()}),1e3*e.sConfig.keepAlive.interval)},this.disarmKeepAlive=function(){n.mKeepAliveInterval&&(clearInterval(n.mKeepAliveInterval),delete n.mKeepAliveInterval)},this.doKeepAlive=function(){n.send(e.CRLF2)?i("".concat(n.toString(),": Sent KeepAlive.")):a("".concat(n.toString(),": Failed to send KeepAlive."))},this.armKeepAliveTimeout=function(){i("".concat(n.toString(),": Arming keep alive timeout to ").concat(e.sConfig.keepAlive.timeout,"s.")),n.mKeepAliveTimeout=window.setTimeout((function(){n.doKeepAliveTimeout()}),1e3*e.sConfig.keepAlive.timeout)},this.disarmKeepAliveTimeout=function(){n.mKeepAliveTimeout&&(i("".concat(n.toString(),": Clearing keep alive timeout.")),clearTimeout(n.mKeepAliveTimeout),delete n.mKeepAliveTimeout)},this.resetKeepAliveTimeout=function(){n.disarmKeepAliveTimeout(),n.armKeepAliveTimeout()},this.doKeepAliveTimeout=function(){i("".concat(n.toString(),": No keep alive response! Shutting the transport down.")),n.disarmKeepAlive(),n.disconnect(),n.ondisconnect({socket:n,error:!0})},i("".concat(this.toString(),": New transport")),this.url=t,this.sip_uri="",this.via_transport="",this.onconnect=function(){return i("".concat(n.toString(),": base onconnect"))},this.ondisconnect=function(e){return i("".concat(n.toString(),": base ondisconnect")+" ".concat(o.Utils.strBool(e.error),"/").concat(e.code||"?","/").concat(e.reason||"?"))},this.onconnectiontimeout=function(){return i("".concat(n.toString(),": base onconnectiontimeout"))},this.ondata=function(e){return i("".concat(n.toString(),": base ondata ").concat(e.substr(0,20),"..."))};var r=new URL(t),s=r.protocol.toUpperCase().slice(0,-1);if("WSS"!==s&&"WS"!==s)throw a("invalid WebSocket URI scheme: ".concat(r.protocol)),new TypeError("Invalid argument: ".concat(t));this.sip_uri="sip:".concat(r.host,";transport=ws"),this.via_transport=s}return e.sConfig={connectionTimeout:2,keepAlive:{interval:3,timeout:30}},e.CRLF="\r\n",e.CRLF2="\r\n\r\n",e.sInstanceCount=0,e.setConnectionTimeout=function(t){return e.sConfig.connectionTimeout=Number(t),!0},e.setKeepAliveInterval=function(t){return e.sConfig.keepAlive.interval=Number(t),!0},e.setKeepAliveTimeout=function(t){return e.sConfig.keepAlive.timeout=Number(t),!0},e.code2String=function(e){switch(e){case 1e3:return"Normal Closure";case 1001:return"Going Away";case 1002:return"Protocol Error";case 1003:return"Unsupported Data";case 1004:return"(For future)";case 1005:return"No Status Received";case 1006:return"Abnormal Closure";case 1007:return"Invalid frame payload data";case 1008:return"Policy Violation";case 1009:return"Message too big";case 1010:return"Missing Extension";case 1011:return"Internal Error";case 1012:return"Service Restart";case 1013:return"Try Again Later";case 1014:return"Bad Gateway";case 1015:return"TLS Handshake";default:if(e>=0&&e<=999)return"unknown";if(e<=1999)return"Reserved for future use by the WebSocket standard.";if(e<=2999)return"Reserved for use by WebSocket extensions.";if(e<=3999)return"Available for use by libraries and frameworks.";if(e<=4999)return"Available for use by applications."}return"unknown"},e}();t.Socket=s},3861:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimelineConstants=void 0,function(e){e.MAX_VERTICAL_LABELS=6,e.LABEL_VERTICAL_SPACING=4,e.LABEL_HORIZONTAL_SPACING=3,e.Y_AXIS_TICK_LENGTH=10,e.GRID_COLOR="#CCC",e.TEXT_COLOR="#000",e.BACKGROUND_COLOR="#FFF",e.MAX_DECIMAL_PRECISION=2}(t.TimelineConstants||(t.TimelineConstants={}))},7210:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimelineDataSerie=void 0;var r=n(655),o=function(){var e=this;this.mDataPoints=[],this.mColor="red",this.mIsVisible=!0,this.mCacheStepSize=0,this.mCacheValues=[],this.toJSON=function(){var t,n;if(e.mDataPoints.length<1)return{};var o=[];try{for(var i=r.__values(e.mDataPoints),a=i.next();!a.done;a=i.next()){var s=a.value;o.push(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return{startTime:e.mDataPoints[0].time,endTime:e.mDataPoints[e.mDataPoints.length-1].time,values:JSON.stringify(o)}},this.addPoint=function(t,n){var r={time:new Date(t).getTime(),value:n};e.mDataPoints.push(r),e.mDataPoints.length>1e3&&e.mDataPoints.shift()},this.isVisible=function(){return e.mIsVisible},this.show=function(t){e.mIsVisible=t},this.getColor=function(){return e.mColor},this.setColor=function(t){e.mColor=t},this.getCount=function(){return e.mDataPoints.length},this.getValues=function(t,n,r){return e.mCacheStartTime===t&&e.mCacheStepSize===n&&e.mCacheValues.length===r||(e.mCacheValues=e.getValuesInternal(t,n,r),e.mCacheStartTime=t,e.mCacheStepSize=n),e.mCacheValues},this.getValuesInternal=function(t,n,r){for(var o=[],i=0,a=0,s=t,l=0;l<r;++l){for(;i<e.mDataPoints.length&&e.mDataPoints[i].time<s;)a=e.mDataPoints[i].value,++i;o[l]=a,s+=n}return o}};t.TimelineDataSerie=o},9139:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimelineDataView=void 0;var r=n(655),o=n(3861),i=n(7643),a=function(e){var t=this;this.scrollbar={position:0,range:0},this.startTime=0,this.endTime=1,this.scale=1e3,this.setScale=function(e){t.scale=e},this.setDateRange=function(e,n){t.startTime=e.getTime(),t.endTime=n.getTime(),t.endTime<=t.startTime&&(t.startTime=t.endTime-1),t.updateScrollbarrange(!0)},this.updateEndDate=function(e){e||(e=(new Date).getTime()),t.endTime=e,t.updateScrollbarrange(t.graphScrolledToRightEdge())},this.getStartDate=function(){return new Date(t.startTime)},this.setDataSeries=function(e){var n,o;t.graph=new i.TimelineGraph;try{for(var a=r.__values(e),s=a.next();!s.done;s=a.next()){var l=s.value;t.graph.addDataSeries(l)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}t.repaint()},this.addDataSeries=function(e){t.graph||(t.graph=new i.TimelineGraph),t.graph.addDataSeries(e),t.repaint()},this.repaint=function(){if(t.canvas){var e=t.canvas.width,n=t.canvas.height,r=t.canvas.getContext("2d");if(r){r.fillStyle=o.TimelineConstants.BACKGROUND_COLOR,r.fillRect(0,0,e,n);var i=RegExp("([0-9]+)px").exec(r.font);if(i){var a=i[1],s=parseInt(a,10);if(!(0===a.length||s<=0||4*s>n||e<50)){r.save(),r.translate(.5,.5);var l=t.scrollbar.position;0===t.scrollbar.range&&(l=t.getLength()-t.canvas.width);var u=t.startTime+l*t.scale,c=n;n-=s+o.TimelineConstants.LABEL_VERTICAL_SPACING,t.drawTimeLabels(r,e,n,c,u),r.strokeStyle=o.TimelineConstants.GRID_COLOR,r.strokeRect(0,0,e-1,n-1),t.graph&&(t.graph.layout(e,n,s,u,t.scale),t.graph.drawTicks(r),t.graph.drawLines(r),t.graph.drawLabels(r)),r.restore()}}}}},this.drawTimeLabels=function(e,n,r,i,a){var s=6e4,l=Math.ceil(a/s)*s;for(e.textBaseline="bottom",e.textAlign="center",e.fillStyle=o.TimelineConstants.TEXT_COLOR,e.strokeStyle=o.TimelineConstants.GRID_COLOR;;){var u=Math.round((l-a)/t.scale);if(u>=n)break;var c=new Date(l).toLocaleTimeString();e.fillText(c,u,i),e.beginPath(),e.lineTo(u,0),e.lineTo(u,r),e.stroke(),l+=s}},this.getDataSeriesCount=function(){return t.graph?t.graph.getDataSeries().length:0},this.hasDataSerie=function(e){return!!t.graph&&t.graph.hasDataSerie(e)},this.getLength=function(){var e=t.endTime-t.startTime;return Math.floor(e/t.scale)},this.graphScrolledToRightEdge=function(){return t.scrollbar.position===t.scrollbar.range},this.updateScrollbarrange=function(e){if(t.canvas){var n=t.getLength()-t.canvas.width;n<0&&(n=0),t.scrollbar.position>n&&(e=!0),t.scrollbar.range=n,e&&(t.scrollbar.position=n,t.repaint())}},this.canvas=e,this.startTime=0,this.endTime=1,this.scale=1e3,this.updateScrollbarrange(!0)};t.TimelineDataView=a},7643:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimelineGraph=void 0;var r=n(655),o=n(3861),i=function(){var e=this;this.addDataSeries=function(t){e.mDataSeries.push(t)},this.hasDataSerie=function(t){var n,o;try{for(var i=r.__values(e.mDataSeries),a=i.next();!a.done;a=i.next())if(a.value===t)return!0}catch(e){n={error:e}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}return!1},this.getDataSeries=function(){return e.mDataSeries},this.getValues=function(t){return t.isVisible()?t.getValues(e.mStartTime,e.mScale,e.mWidth):null},this.layout=function(t,n,o,i,a){var s,l,u,c;e.mWidth=t,e.mHeight=n,e.mFontHeight=o,e.mStartTime=i,e.mScale=a;var d=0,f=0;try{for(var p=r.__values(e.mDataSeries),h=p.next();!h.done;h=p.next()){var m=h.value,_=e.getValues(m);if(_)try{for(var v=(u=void 0,r.__values(_)),g=v.next();!g.done;g=v.next()){var y=g.value;y>d?d=y:y<f&&(f=y)}}catch(e){u={error:e}}finally{try{g&&!g.done&&(c=v.return)&&c.call(v)}finally{if(u)throw u.error}}}}catch(e){s={error:e}}finally{try{h&&!h.done&&(l=p.return)&&l.call(p)}finally{if(s)throw s.error}}e.layoutlabels(f,d)},this.layoutLabelsBasic=function(t,n,r){e.mLabels=[];var i=n-t;if(0!==i){var a=2*e.mFontHeight+o.TimelineConstants.LABEL_VERTICAL_SPACING,s=1+e.mHeight/a;s<2?s=2:s>o.TimelineConstants.MAX_VERTICAL_LABELS&&(s=o.TimelineConstants.MAX_VERTICAL_LABELS);for(var l=Math.pow(10,-r),u=r;!(Math.ceil(i/l)+1<=s);){if(Math.ceil(i/(2*l))+1<=s){l*=2;break}if(Math.ceil(i/(5*l))+1<=s){l*=5;break}l*=10,u>0&&--u}e.mMax=Math.ceil(n/l)*l,e.mMin=Math.floor(t/l)*l;for(var c=e.mMax;c>=e.mMin;c-=l)e.mLabels.push(c.toFixed(u))}else e.mMin=e.mMax=n},this.drawTicks=function(t){var n=e.mWidth-1,r=e.mWidth-1-o.TimelineConstants.Y_AXIS_TICK_LENGTH;t.fillStyle=o.TimelineConstants.GRID_COLOR,t.beginPath();for(var i=1;i<e.mLabels.length-1;++i){var a=Math.round(e.mHeight*i/(e.mLabels.length-1));t.moveTo(n,a),t.lineTo(r,a)}t.stroke()},this.drawLines=function(t){var n=0,r=e.mHeight-1;e.mMax&&(n=r/(e.mMax-e.mMin));for(var o=e.mDataSeries.length-1;o>=0;--o){var i=e.getValues(e.mDataSeries[o]);if(i){t.strokeStyle=e.mDataSeries[o].getColor(),t.beginPath();for(var a=0;a<i.length;++a)t.lineTo(a,r-Math.round((i[a]-e.mMin)*n));t.stroke()}}},this.drawLabels=function(t){if(0!==e.mLabels.length){var n=e.mWidth-o.TimelineConstants.LABEL_HORIZONTAL_SPACING;t.fillStyle=o.TimelineConstants.TEXT_COLOR,t.textAlign="right",t.textBaseline="top",t.fillText(e.mLabels[0],n,0),t.textBaseline="bottom";for(var r=(e.mHeight-1)/(e.mLabels.length-1),i=1;i<e.mLabels.length;++i)t.fillText(e.mLabels[i],n,r*i)}},this.layoutlabels=function(t,n){if(n-t<1024)e.layoutLabelsBasic(t,n,o.TimelineConstants.MAX_DECIMAL_PRECISION);else{var r=["","k","M","G","T","P"],i=1;for(t/=1024,n/=1024;r[i+1]&&n-t>=1024;)t/=1024,n/=1024,++i;e.layoutLabelsBasic(t,n,o.TimelineConstants.MAX_DECIMAL_PRECISION);for(var a=0;a<e.mLabels.length;++a)e.mLabels[a]+=" "+r[i];e.mMin*=Math.pow(1024,i),e.mMax*=Math.pow(1024,i)}},this.mDataSeries=[],this.mWidth=0,this.mHeight=0,this.mFontHeight=0,this.mStartTime=0,this.mScale=0,this.mMin=0,this.mMax=0,this.mLabels=[]};t.TimelineGraph=i},4956:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UA=void 0;var r=n(655),o=r.__importStar(n(2749)),i=n(4125),a=n(4547),s=n(7187),l=n(1116),u=a.Debugger.extend("UA"),c=function(e){function t(n){var r=e.call(this)||this;return r.mCalls=new Map,r.mIsConnectionTimeout=!1,r.newCall=function(e){var t=new i.Call(r,e);return r.mCalls.set(t.getLocalId(),t),t.on(i.Call.Event.STOPPED,(function(e){var t,n=e;r.mCalls.delete(n.call.getLocalId()),r.isEmpty()&&(null===(t=r.mSocket)||void 0===t||t.disconnect())})),t},r.getTransport=function(){return r.mSocket},r.getOptions=function(){return r.mOptions},r.isEmpty=function(){return 0===r.mCalls.size},r.disconnect=function(){r.mSocket.disconnect()},r.isConnected=function(){return r.mSocket.isConnected()},r.toString=function(){return"UA #".concat(r.mInstanceId," ").concat(r.mSocket.toString())},r.addConnectionEventListeners=function(e,n){r.mIsConnectionTimeout?n():(r.addListener(t.Event.CONNECTED,e),r.addListener(t.Event.CONNECTION_TIMEOUT,n))},r.removeConnectionEventListeners=function(e,n){r.removeListener(t.Event.CONNECTED,e),r.removeListener(t.Event.CONNECTION_TIMEOUT,n)},r.mInstanceId=t.sInstanceCount++,r.mOptions=n,r.mSocket=new l.Socket("wss:"+o.VOIP_APP+"@"+n.host+":"+n.port),r.mSocket.onconnect=function(){u("Transport connects to "+r.mSocket.url),r.emit(t.Event.CONNECTED)},r.mSocket.onconnectiontimeout=function(){u("Transport connection timeout to "+r.mSocket.url),r.mIsConnectionTimeout=!0,r.emit(t.Event.CONNECTION_TIMEOUT)},r.mSocket.ondisconnect=function(e){e.error?(u("Transport disconnected on error: ".concat(e.reason||"?"," (").concat(e.code||"?",")")),r.emit(t.Event.DISCONNECTED)):(u("Transport disconnected gracefully"),r.emit(t.Event.DISCONNECTED_ERROR))},r.mSocket.connect(),r}return r.__extends(t,e),t.sInstanceCount=0,t}(s.EventEmitter);t.UA=c,function(e){!function(e){e.CONNECTED="CONNECTED",e.CONNECTION_TIMEOUT="CONNECTION_TIMEOUT",e.DISCONNECTED="DISCONNECTED",e.DISCONNECTED_ERROR="DISCONNECTED_ERROR"}(e.Event||(e.Event={}))}(c=t.UA||(t.UA={})),t.UA=c},1784:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Utils=void 0;var r=n(655);!function(e){e.strBool=function(e){return e?"true":"false"},e.deepCopy=function(t){if(null===t)return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof Array){var n=[];return t.forEach((function(e){n.push(e)})),n.map((function(t){return e.deepCopy(t)}))}if("object"==typeof t&&t!=={}){var o=r.__assign({},t);return Object.keys(o).forEach((function(t){o[t]=e.deepCopy(o[t])})),o}return t},e.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},e.addslashes=function(e){return e=(e=(e=(e=(e=e.replace(/\\/g,"\\\\")).replace(/\"/g,'\\"')).replace(/\"/g,'\\"')).replace(/\'/g,"\\'")).replace(/\0/g,"\\0")},e.stripslashes=function(e){return e=(e=(e=(e=(e=e.replace(/\\"/g,'"')).replace(/\\"/g,'"')).replace(/\\'/g,"'")).replace(/\\0/g,"\0")).replace(/\\\\/g,"\\")},e.random=function(e,t){return Math.floor(Math.random()*(t-e))+e},e.isEmpty=function(e){return 0===e.length},e.strMediaElement=function(t){if(!t)return"No element";var n="Element ".concat(t.localName);return n+=" id: '".concat(t.id),n+=" / srcObj: ['".concat(e.strMediaStream(t.srcObject),"']"),n+=" [muted: '".concat(e.strBool(t.muted),"']"),n+=" [paused: '".concat(e.strBool(t.paused),"']"),n+=" [volume: '".concat(t.volume,"']")},e.strMediaStream=function(t){var n,o;if(!t)return"No stream";var i="Stream: ".concat(t.id),a=t.getTracks();try{for(var s=r.__values(a),l=s.next();!l.done;l=s.next()){var u=l.value;i+=e.strMediaStreamTrack(u)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}return i},e.strMediaStreamTrack=function(t){return t?"[".concat(t.kind," ('").concat(t.label,"'): ").concat(t.id," [enabled: ").concat(e.strBool(t.enabled),"] [state: ").concat(t.readyState,"]] "):" [notrack]"},e.strRtpRtcpCname=function(e){var t,n=e.getParameters();if(n)return null===(t=n.rtcp)||void 0===t?void 0:t.cname}}(t.Utils||(t.Utils={}))},3696:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LIBRARY_VERSION=void 0,t.LIBRARY_VERSION="2.0.101247"},655:(e,t,n)=>{"use strict";n.r(t),n.d(t,{__assign:()=>i,__asyncDelegator:()=>T,__asyncGenerator:()=>S,__asyncValues:()=>C,__await:()=>y,__awaiter:()=>c,__classPrivateFieldGet:()=>I,__classPrivateFieldIn:()=>O,__classPrivateFieldSet:()=>w,__createBinding:()=>f,__decorate:()=>s,__exportStar:()=>p,__extends:()=>o,__generator:()=>d,__importDefault:()=>A,__importStar:()=>b,__makeTemplateObject:()=>E,__metadata:()=>u,__param:()=>l,__read:()=>m,__rest:()=>a,__spread:()=>_,__spreadArray:()=>g,__spreadArrays:()=>v,__values:()=>h});var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)};function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},i.apply(this,arguments)};function a(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function s(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}function l(e,t){return function(n,r){t(n,r,e)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function c(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))}function d(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var f=Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]};function p(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||f(t,e,n)}function h(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function m(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function _(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(m(arguments[t]));return e}function v(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}function g(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function y(e){return this instanceof y?(this.v=e,this):new y(e)}function S(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(e){o[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{(n=o[e](t)).value instanceof y?Promise.resolve(n.value.v).then(l,u):c(i[0][2],n)}catch(e){c(i[0][3],e)}var n}function l(e){s("next",e)}function u(e){s("throw",e)}function c(e,t){e(t),i.shift(),i.length&&s(i[0][0],i[0][1])}}function T(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,o){t[r]=e[r]?function(t){return(n=!n)?{value:y(e[r](t)),done:"return"===r}:o?o(t):t}:o}}function C(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=h(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,o,(t=e[n](t)).done,t.value)}))}}}function E(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var R=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function b(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&f(t,e,n);return R(t,e),t}function A(e){return e&&e.__esModule?e:{default:e}}function I(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}function w(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n}function O(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}},835:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>le});var r={};n.r(r),n.d(r,{fixNegotiationNeeded:()=>P,shimAddTrackRemoveTrack:()=>w,shimAddTrackRemoveTrackWithNative:()=>I,shimGetDisplayMedia:()=>T,shimGetSendersWithDtmf:()=>R,shimGetStats:()=>b,shimGetUserMedia:()=>S,shimMediaStream:()=>C,shimOnTrack:()=>E,shimPeerConnection:()=>O,shimSenderReceiverGetStats:()=>A});var o={};n.r(o),n.d(o,{shimAddTransceiver:()=>H,shimCreateAnswer:()=>V,shimCreateOffer:()=>j,shimGetDisplayMedia:()=>D,shimGetParameters:()=>q,shimGetUserMedia:()=>N,shimOnTrack:()=>M,shimPeerConnection:()=>k,shimRTCDataChannel:()=>F,shimReceiverGetStats:()=>L,shimRemoveStream:()=>U,shimSenderGetStats:()=>x});var i={};n.r(i),n.d(i,{shimAudioContext:()=>$,shimCallbacksAPI:()=>W,shimConstraints:()=>J,shimCreateOfferLegacy:()=>X,shimGetUserMedia:()=>K,shimLocalStreamsAPI:()=>G,shimRTCIceServerUrls:()=>Y,shimRemoteStreamsAPI:()=>B,shimTrackEventTransceiver:()=>z});var a={};n.r(a),n.d(a,{removeExtmapAllowMixed:()=>oe,shimAddIceCandidateNullOrEmpty:()=>ie,shimConnectionState:()=>re,shimMaxMessageSize:()=>te,shimParameterlessSetLocalDescription:()=>ae,shimRTCIceCandidate:()=>ee,shimSendThrowTypeError:()=>ne});let s=!0,l=!0;function u(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function c(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,o=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return o.apply(this,arguments);const i=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,i),o.apply(this,[e,i])};const i=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return i.apply(this,arguments);if(!this._eventMap[t].has(n))return i.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,i.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function d(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(s=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function f(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(l=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function p(){if("object"==typeof window){if(s)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function h(e,t){l&&console.warn(e+" is deprecated, please use "+t+" instead.")}function m(e){return"[object Object]"===Object.prototype.toString.call(e)}function _(e){return m(e)?Object.keys(e).reduce((function(t,n){const r=m(e[n]),o=r?_(e[n]):e[n],i=r&&!Object.keys(o).length;return void 0===o||i?t:Object.assign(t,{[n]:o})}),{}):e}function v(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((r=>{r.endsWith("Id")?v(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((t=>{v(e,e.get(t),n)}))})))}function g(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",o=new Map;if(null===t)return o;const i=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&i.push(e)})),i.forEach((t=>{e.forEach((n=>{n.type===r&&n.trackId===t.id&&v(e,n,o)}))})),o}const y=p;function S(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[o("min",n)]=r.ideal,t.optional.push(e),e={},e[o("max",n)]=r.ideal,t.optional.push(e)):(e[o("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",n)]=r.exact):["min","max"].forEach((e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,n)]=r[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},o=function(e,o){if(t.version>=61)return o(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let i=e.video.facingMode;i=i&&("object"==typeof i?i:{ideal:i});const a=t.version<66;if(i&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===i.exact||"environment"===i.ideal?t=["back","rear"]:"user"!==i.exact&&"user"!==i.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let a=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!a&&n.length&&t.includes("back")&&(a=n[n.length-1]),a&&(e.video.deviceId=i.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=r(e.video),y("chrome: "+JSON.stringify(e)),o(e)}))}e.video=r(e.video)}return y("chrome: "+JSON.stringify(e)),o(e)},i=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){o(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{r&&r(i(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return o(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(i(e))))))}}}function T(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{const r=n.video&&n.video.width,o=n.video&&n.video.height,i=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:i||3}},r&&(n.video.mandatory.maxWidth=r),o&&(n.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function C(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function E(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const o=new Event("track");o.track=n.track,o.receiver=r,o.transceiver={receiver:r},o.streams=[t.stream],this.dispatchEvent(o)})),t.stream.getTracks().forEach((n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=[t.stream],this.dispatchEvent(o)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else c(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function R(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let o=n.apply(this,arguments);return o||(o=t(this,e),this._senders.push(o)),o};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function b(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const o=function(e){const t={};return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},i=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const r=function(e){n(i(o(e)))};return t.apply(this,[r,e])}return new Promise(((e,n)=>{t.apply(this,[function(t){e(i(o(t)))},n])})).then(n,r)}}function A(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>g(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),c(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>g(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach((n=>{n.track===e&&(t?r=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?r=!0:n=t),t.track===e))),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function I(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),o.apply(this,arguments)}}function w(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return I(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const o=e.RTCPeerConnection.prototype.removeStream;function i(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],o=e._streams[r.id];n=n.replace(new RegExp(o.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}function a(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],o=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),o.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const o=this.getSenders().find((e=>e.track===t));if(o)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const i=this._streams[n.id];if(i)i.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=i(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>i(this,e)))}};e.RTCPeerConnection.prototype[t]=r[t]}));const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=a(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=l.get.apply(this);return""===e.type?e:i(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function O(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}))}function P(e,t){c(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}function N(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){h("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function D(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function M(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function k(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,o,i]=arguments;return r.apply(this,[e||null]).then((e=>{if(t.version<53&&!o)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(o,i)}}function x(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function L(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),c(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function U(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){h("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function F(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function H(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],n=e&&"sendEncodings"in e;n&&e.sendEncodings.forEach((e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return r})}function q(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function j(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function V(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function G(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...n){return n&&n.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function B(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function W(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,o=t.setLocalDescription,i=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],o=n.apply(this,[r]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],o=r.apply(this,[n]);return t?(o.then(e,t),Promise.resolve()):o};let s=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){const r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}function K(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(J(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function J(e){return e&&void 0!==e.video?Object.assign({},e,{video:_(e.video)}):e}function Y(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(h("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function z(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function X(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function $(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Q=n(7539),Z=n.n(Q);function ee(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),r=Z().parseCandidate(e.candidate),o=Object.assign(n,r);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,c(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function te(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=Z().splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Z().parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},r=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},o=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},i=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const o=Z().matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?r=parseInt(o[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=r(arguments[0]),t=o(e),n=i(arguments[0],e);let a;a=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const s={};Object.defineProperty(s,"maxMessageSize",{get:()=>a}),this._sctp=s}return a.apply(this,arguments)}}function ne(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],o=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&o>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},c(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function re(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function oe(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function ie(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ae(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return n.apply(this,[e]);const t="offer"===e.type?this.createOffer:this.createAnswer;return t.apply(this).then((e=>n.apply(this,[e])))})}const se=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=p,s=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=u(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=u(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=u(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),l={browserDetails:s,commonShim:a,extractVersion:u,disableLog:d,disableWarnings:f,sdp:Q};switch(s.browser){case"chrome":if(!r||!O||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),l;if(null===s.version)return n("Chrome shim can not determine version, not shimming."),l;n("adapter.js shimming chrome."),l.browserShim=r,ie(e,s),ae(e),S(e,s),C(e),O(e,s),E(e),w(e,s),R(e),b(e),A(e),P(e,s),ee(e),re(e),te(e,s),ne(e),oe(e,s);break;case"firefox":if(!o||!k||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),l;n("adapter.js shimming firefox."),l.browserShim=o,ie(e,s),ae(e),N(e,s),k(e,s),M(e),U(e),x(e),L(e),F(e),H(e),q(e),j(e),V(e),ee(e),re(e),te(e,s),ne(e);break;case"safari":if(!i||!t.shimSafari)return n("Safari shim is not included in this adapter release."),l;n("adapter.js shimming safari."),l.browserShim=i,ie(e,s),ae(e),Y(e),X(e),W(e),G(e),B(e),z(e),K(e),$(e),ee(e),te(e,s),ne(e),oe(e,s);break;default:n("Unsupported browser!")}return l}({window:"undefined"==typeof window?void 0:window}),le=se},2403:e=>{"use strict";e.exports=JSON.parse('{"name":"jssip","title":"JsSIP","description":"the Javascript SIP library","version":"3.9.0","homepage":"https://jssip.net","contributors":["Jos\xe9 Luis Mill\xe1n <jmillan@aliax.net> (https://github.com/jmillan)","I\xf1aki Baz Castillo <ibc@aliax.net> (https://inakibaz.me)"],"types":"lib/JsSIP.d.ts","main":"lib-es5/JsSIP.js","keywords":["sip","websocket","webrtc","node","browser","library"],"license":"MIT","repository":{"type":"git","url":"https://github.com/versatica/JsSIP.git"},"bugs":{"url":"https://github.com/versatica/JsSIP/issues"},"dependencies":{"@types/debug":"^4.1.5","@types/node":"^14.14.34","debug":"^4.3.1","events":"^3.3.0","sdp-transform":"^2.14.1"},"devDependencies":{"@babel/core":"^7.13.10","@babel/preset-env":"^7.13.10","ansi-colors":"^3.2.4","browserify":"^16.5.1","eslint":"^5.16.0","fancy-log":"^1.3.3","gulp":"^4.0.2","gulp-babel":"^8.0.0","gulp-eslint":"^5.0.0","gulp-expect-file":"^1.0.2","gulp-header":"^2.0.9","gulp-nodeunit-runner":"^0.2.2","gulp-plumber":"^1.2.1","gulp-rename":"^1.4.0","gulp-uglify-es":"^1.0.4","pegjs":"^0.7.0","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0"},"scripts":{"lint":"gulp lint","test":"gulp test","prepublishOnly":"gulp babel"}}')}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";var e=r;Object.defineProperty(e,"__esModule",{value:!0}),e.version=e.name=e.Utils=e.UA=e.Socket=e.Participant=e.MediaHandler=e.FloorControl=e.Configuration=e.Call=e.JsSIP=e.disableLog=e.enableLog=void 0;var t=n(655),o=t.__importStar(n(4547));e.enableLog=o.enable,e.disableLog=o.disable;var i=t.__importStar(n(5979));e.JsSIP=i;var a=n(2749);Object.defineProperty(e,"name",{enumerable:!0,get:function(){return a.name}}),Object.defineProperty(e,"version",{enumerable:!0,get:function(){return a.version}});var s=n(4125);Object.defineProperty(e,"Call",{enumerable:!0,get:function(){return s.Call}});var l=n(9341);Object.defineProperty(e,"Configuration",{enumerable:!0,get:function(){return l.Configuration}});var u=n(9011);Object.defineProperty(e,"FloorControl",{enumerable:!0,get:function(){return u.FloorControl}});var c=n(878);Object.defineProperty(e,"MediaHandler",{enumerable:!0,get:function(){return c.MediaHandler}});var d=n(9616);Object.defineProperty(e,"Participant",{enumerable:!0,get:function(){return d.Participant}});var f=n(1116);Object.defineProperty(e,"Socket",{enumerable:!0,get:function(){return f.Socket}});var p=n(4956);Object.defineProperty(e,"UA",{enumerable:!0,get:function(){return p.UA}});var h=n(1784);Object.defineProperty(e,"Utils",{enumerable:!0,get:function(){return h.Utils}})})(),r})()));